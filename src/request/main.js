/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else {
		var a = factory();
		for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];
	}
})(self, function() {
return /******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/@rongcloud/engine/dist/index.esm.js":
/*!**********************************************************!*\
  !*** ./node_modules/@rongcloud/engine/dist/index.esm.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AEngine\": () => (/* binding */ vr),\n/* harmony export */   \"ANavi\": () => (/* binding */ mr),\n/* harmony export */   \"APIContext\": () => (/* binding */ is),\n/* harmony export */   \"AppStorage\": () => (/* binding */ R),\n/* harmony export */   \"AssertRules\": () => (/* binding */ He),\n/* harmony export */   \"CONNECTION_TYPE\": () => (/* binding */ t),\n/* harmony export */   \"CPP_PROTOCAL_MSGTYPE_OPTION\": () => (/* binding */ m),\n/* harmony export */   \"CallLibMsgType\": () => (/* binding */ qe),\n/* harmony export */   \"ChatroomEntryType\": () => (/* binding */ Ue),\n/* harmony export */   \"ChatroomMemberChangeType\": () => (/* binding */ Pe),\n/* harmony export */   \"CometChannel\": () => (/* binding */ yr),\n/* harmony export */   \"ConnectResultCode\": () => (/* binding */ Te),\n/* harmony export */   \"ConnectionStatus\": () => (/* binding */ Ie),\n/* harmony export */   \"ConversationType\": () => (/* binding */ j),\n/* harmony export */   \"DelayTimer\": () => (/* binding */ Et),\n/* harmony export */   \"ErrorCode\": () => (/* binding */ Ee),\n/* harmony export */   \"EventEmitter\": () => (/* binding */ ge),\n/* harmony export */   \"FileType\": () => (/* binding */ W),\n/* harmony export */   \"HttpMethod\": () => (/* binding */ pr),\n/* harmony export */   \"IM_COMET_PULLMSG_TIMEOUT\": () => (/* binding */ y),\n/* harmony export */   \"IM_PING_INTERVAL_TIME\": () => (/* binding */ d),\n/* harmony export */   \"IM_PING_MIN_TIMEOUT\": () => (/* binding */ p),\n/* harmony export */   \"IM_PING_TIMEOUT\": () => (/* binding */ f),\n/* harmony export */   \"IM_SIGNAL_TIMEOUT\": () => (/* binding */ l),\n/* harmony export */   \"LiveRole\": () => (/* binding */ ke),\n/* harmony export */   \"LiveType\": () => (/* binding */ Ve),\n/* harmony export */   \"LogLevel\": () => (/* binding */ A),\n/* harmony export */   \"LogType\": () => (/* binding */ U),\n/* harmony export */   \"Logger\": () => (/* binding */ fe),\n/* harmony export */   \"MAX_MESSAGE_CONTENT_BYTES\": () => (/* binding */ _),\n/* harmony export */   \"MINI_COMET_CONNECT_URIS\": () => (/* binding */ h),\n/* harmony export */   \"MINI_SOCKET_CONNECT_URIS\": () => (/* binding */ c),\n/* harmony export */   \"MentionedType\": () => (/* binding */ we),\n/* harmony export */   \"MessageBlockType\": () => (/* binding */ xe),\n/* harmony export */   \"MessageDirection\": () => (/* binding */ ye),\n/* harmony export */   \"MessageType\": () => (/* binding */ Re),\n/* harmony export */   \"NAVI_CACHE_DURATION\": () => (/* binding */ r),\n/* harmony export */   \"NAVI_REQ_TIMEOUT\": () => (/* binding */ s),\n/* harmony export */   \"NotificationStatus\": () => (/* binding */ Ne),\n/* harmony export */   \"PING_REQ_TIMEOUT\": () => (/* binding */ o),\n/* harmony export */   \"PUBLIC_CLOUD_NAVI_URIS\": () => (/* binding */ u),\n/* harmony export */   \"PluginContext\": () => (/* binding */ Wr),\n/* harmony export */   \"RCAssertError\": () => (/* binding */ $e),\n/* harmony export */   \"RTCApiType\": () => (/* binding */ Be),\n/* harmony export */   \"RTCIdentityChangeType\": () => (/* binding */ Fe),\n/* harmony export */   \"RTCJoinType\": () => (/* binding */ Ke),\n/* harmony export */   \"RTCMode\": () => (/* binding */ De),\n/* harmony export */   \"RTCPluginContext\": () => (/* binding */ Jr),\n/* harmony export */   \"ReceivedStatus\": () => (/* binding */ i),\n/* harmony export */   \"SEND_MESSAGE_TYPE_OPTION\": () => (/* binding */ E),\n/* harmony export */   \"STATUS_MESSAGE\": () => (/* binding */ I),\n/* harmony export */   \"STORAGE_ROOT_KEY\": () => (/* binding */ v),\n/* harmony export */   \"TagChangeType\": () => (/* binding */ ns),\n/* harmony export */   \"UploadMethod\": () => (/* binding */ Me),\n/* harmony export */   \"VersionManage\": () => (/* binding */ je),\n/* harmony export */   \"WEB_SOCKET_TIMEOUT\": () => (/* binding */ a),\n/* harmony export */   \"WebSocketChannel\": () => (/* binding */ _r),\n/* harmony export */   \"appendUrl\": () => (/* binding */ k),\n/* harmony export */   \"assert\": () => (/* binding */ et),\n/* harmony export */   \"cloneByJSON\": () => (/* binding */ pt),\n/* harmony export */   \"forEach\": () => (/* binding */ ct),\n/* harmony export */   \"formatConnectResponseCode\": () => (/* binding */ yt),\n/* harmony export */   \"getBrowser\": () => (/* binding */ _t),\n/* harmony export */   \"getMimeKey\": () => (/* binding */ rt),\n/* harmony export */   \"getUploadFileName\": () => (/* binding */ it),\n/* harmony export */   \"indexOf\": () => (/* binding */ lt),\n/* harmony export */   \"isArray\": () => (/* binding */ X),\n/* harmony export */   \"isArrayBuffer\": () => (/* binding */ $),\n/* harmony export */   \"isBoolean\": () => (/* binding */ z),\n/* harmony export */   \"isFunction\": () => (/* binding */ ie),\n/* harmony export */   \"isHttpUrl\": () => (/* binding */ oe),\n/* harmony export */   \"isInObject\": () => (/* binding */ ft),\n/* harmony export */   \"isInclude\": () => (/* binding */ dt),\n/* harmony export */   \"isNull\": () => (/* binding */ se),\n/* harmony export */   \"isNumber\": () => (/* binding */ Z),\n/* harmony export */   \"isObject\": () => (/* binding */ ne),\n/* harmony export */   \"isString\": () => (/* binding */ J),\n/* harmony export */   \"isUndefined\": () => (/* binding */ re),\n/* harmony export */   \"isValidChrmEntryKey\": () => (/* binding */ at),\n/* harmony export */   \"isValidChrmEntryValue\": () => (/* binding */ ut),\n/* harmony export */   \"isValidConversationType\": () => (/* binding */ ue),\n/* harmony export */   \"isValidFileType\": () => (/* binding */ ce),\n/* harmony export */   \"map\": () => (/* binding */ ht),\n/* harmony export */   \"notEmptyArray\": () => (/* binding */ te),\n/* harmony export */   \"notEmptyObject\": () => (/* binding */ ae),\n/* harmony export */   \"notEmptyString\": () => (/* binding */ ee),\n/* harmony export */   \"pushConfigsToJSON\": () => (/* binding */ st),\n/* harmony export */   \"pushJSONToConfigs\": () => (/* binding */ ot),\n/* harmony export */   \"todo\": () => (/* binding */ P),\n/* harmony export */   \"usingCppEngine\": () => (/* binding */ gt),\n/* harmony export */   \"validate\": () => (/* binding */ tt),\n/* harmony export */   \"version\": () => (/* binding */ rs)\n/* harmony export */ });\nvar e;!function(e){e[e.READ=1]=\"READ\",e[e.LISTENED=2]=\"LISTENED\",e[e.DOWNLOADED=4]=\"DOWNLOADED\",e[e.RETRIEVED=8]=\"RETRIEVED\",e[e.UNREAD=0]=\"UNREAD\"}(e||(e={}));var t,n,i=e,r=72e5,s=1e4,o=5e3,a=5e3,u=[\"https://nav.cn.ronghub.com\",\"https://nav2-cn.ronghub.com\"],c=[\"wsproxy.cn.ronghub.com\",\"wsap-cn.ronghub.com\"],h=[\"cometproxy-cn.ronghub.com\",\"mini-cn.ronghub.com\"],l=3e4,d=15e3,f=15e3,p=2e3,_=131072,y=45e3,v=\"RCV4-\",E={\"RC:TxtMsg\":{isCounted:!0,isPersited:!0},\"RC:ImgMsg\":{isCounted:!0,isPersited:!0},\"RC:VcMsg\":{isCounted:!0,isPersited:!0},\"RC:ImgTextMsg\":{isCounted:!0,isPersited:!0},\"RC:FileMsg\":{isCounted:!0,isPersited:!0},\"RC:HQVCMsg\":{isCounted:!0,isPersited:!0},\"RC:LBSMsg\":{isCounted:!0,isPersited:!0},\"RC:PSImgTxtMsg\":{isCounted:!0,isPersited:!0},\"RC:PSMultiImgTxtMsg\":{isCounted:!0,isPersited:!0},\"RCJrmf:RpMsg\":{isCounted:!0,isPersited:!0},\"RCJrmf:RpOpendMsg\":{isCounted:!0,isPersited:!0},\"RC:CombineMsg\":{isCounted:!0,isPersited:!0},\"RC:ReferenceMsg\":{isCounted:!0,isPersited:!0},\"RC:SightMsg\":{isCounted:!0,isPersited:!0},\"RC:GIFMsg\":{isCounted:!0,isPersited:!0},\"RC:InfoNtf\":{isCounted:!1,isPersited:!0},\"RC:ContactNtf\":{isCounted:!1,isPersited:!0},\"RC:ProfileNtf\":{isCounted:!1,isPersited:!0},\"RC:CmdNtf\":{isCounted:!1,isPersited:!0},\"RC:GrpNtf\":{isCounted:!1,isPersited:!0},\"RC:RcCmd\":{isCounted:!1,isPersited:!0},\"RC:CmdMsg\":{isCounted:!1,isPersited:!1},\"RC:TypSts\":{isCounted:!1,isPersited:!1},\"RC:PSCmd\":{isCounted:!1,isPersited:!1},\"RC:SRSMsg\":{isCounted:!1,isPersited:!1},\"RC:RRReqMsg\":{isCounted:!1,isPersited:!1},\"RC:RRRspMsg\":{isCounted:!1,isPersited:!1},\"RC:CsChaR\":{isCounted:!1,isPersited:!1},\"RC:CSCha\":{isCounted:!1,isPersited:!1},\"RC:CsEva\":{isCounted:!1,isPersited:!1},\"RC:CsContact\":{isCounted:!1,isPersited:!1},\"RC:CsHs\":{isCounted:!1,isPersited:!1},\"RC:CsHsR\":{isCounted:!1,isPersited:!1},\"RC:CsSp\":{isCounted:!1,isPersited:!1},\"RC:CsEnd\":{isCounted:!1,isPersited:!1},\"RC:CsUpdate\":{isCounted:!1,isPersited:!1},\"RC:ReadNtf\":{isCounted:!1,isPersited:!1},\"RC:chrmKVNotiMsg\":{isCounted:!1,isPersited:!1},\"RC:VCAccept\":{isCounted:!1,isPersited:!1},\"RC:VCRinging\":{isCounted:!1,isPersited:!1},\"RC:VCSummary\":{isCounted:!1,isPersited:!1},\"RC:VCHangup\":{isCounted:!1,isPersited:!1},\"RC:VCInvite\":{isCounted:!1,isPersited:!1},\"RC:VCModifyMedia\":{isCounted:!1,isPersited:!1},\"RC:VCModifyMem\":{isCounted:!1,isPersited:!1},\"RC:MsgExMsg\":{isCounted:!1,isPersited:!1},\"RC:RRMsg\":{isCounted:!1,isPersited:!1},\"RC:LogCmdMsg\":{isCounted:!1,isPersited:!1},\"RC:InterceptMsg\":{isCounted:!1,isPersited:!1}},m={\"RC:DizNtf\":{isCounted:!1,isPersited:!1}},I=[\"RC:TypSts\",\"RC:InterceptMsg\"];!function(e){e.WEBSOCKET=\"websocket\",e.COMET=\"comet\"}(t||(t={}));var T=function(e){return n||(n={set:function(t,n){e.localStorage.setItem(t,JSON.stringify(n))},get:function(t){var n;try{n=JSON.parse(e.localStorage.getItem(t))}catch(e){n=null}return n},remove:function(t){return e.localStorage.removeItem(t)},getKeys:function(){var t=[];for(var n in e.localStorage)t.push(n);return t}}),n},C=function(){function e(e){this._caches={},e&&(this._caches=e)}return e.prototype.set=function(e,t){this._caches[e]=t},e.prototype.remove=function(e){var t=this.get(e);return delete this._caches[e],t},e.prototype.get=function(e){return this._caches[e]},e.prototype.getKeys=function(){var e=[];for(var t in this._caches)e.push(t);return e},e}(),R=function(){function e(e,t){var n,i=t?\"RCV4-\"+t:\"RCV4-\";this._rootStorage=T(e);var r=this._rootStorage.get(i)||{};this._cache=new C(((n={})[i]=r,n)),this._storageKey=i}return e.prototype._get=function(){var e=this._storageKey;return this._cache.get(e)||{}},e.prototype._set=function(e){var t=this._storageKey;e=e||{},this._cache.set(t,e),this._rootStorage.set(t,e)},e.prototype.set=function(e,t){var n=this._get();n[e]=t,this._set(n)},e.prototype.remove=function(e){var t=this._get();delete t[e],this._set(t)},e.prototype.clear=function(){var e=this._storageKey;this._rootStorage.remove(e),this._cache.remove(e)},e.prototype.get=function(e){return this._get()[e]},e.prototype.getKeys=function(){var e=this._get(),t=[];for(var n in e)t.push(n);return t},e.prototype.getValues=function(){return this._get()||{}},e}(),S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function N(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Class extends value \"+String(t)+\" is not a constructor or null\");function n(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var O=function(){return(O=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function w(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))}function b(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError(\"Generator is already executing.\");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function M(e,t){for(var n=0,i=t.length,r=e.length;n<i;n++,r++)e[r]=t[n];return e}var A,U,L=function(e){function t(t){return e.call(this,\"TODO => \"+t)||this}return N(t,e),t}(Error),P=function(e){return new L(e)},D=function(e,t,n){if(void 0===t||void 0===n)return e.toUpperCase();var i=e.slice(t,n);return e=e.replace(i,(function(e){return e.toUpperCase()}))},V=function(e,t){void 0===t&&(t=\"utf-8\");var n,i=0;if(\"utf-16\"===t)for(var r=0,s=e.length;r<s;r++)i+=(n=e.charCodeAt(r))<=65535?2:4;else for(r=0,s=e.length;r<s;r++)i+=(n=e.charCodeAt(r))<127?1:n<=2047?2:n<=65535?3:4;return i},k=function(e,t){if(e=e.replace(/\\?$/,\"\"),!t)return e;var n=Object.keys(t).map((function(e){return e+\"=\"+t[e]})).filter((function(e){return!!e}));return n.length?[e,n.join(\"&\")].join(\"?\"):e},x=function(e){return e.match(/\\d+(\\.\\d+){2}/)[0]};!function(e){e[e.LOG=0]=\"LOG\",e[e.DEBUG=0]=\"DEBUG\",e[e.INFO=1]=\"INFO\",e[e.WARN=2]=\"WARN\",e[e.ERROR=3]=\"ERROR\",e[e.FATAL=4]=\"FATAL\",e[e.NONE=1e3]=\"NONE\"}(A||(A={})),function(e){e.IM=\"IM\",e.RTC=\"RTC\"}(U||(U={}));var B=\"RC_Logs\";function F(e){var t=e.target.result;1===e.oldVersion&&t.deleteObjectStore(B),function(e,t,n){var i;if(!e.objectStoreNames.contains(t)){var r=O({},n.objectStoreParams);i=e.createObjectStore(t,r),n.indexs&&n.indexs.length>0&&n.indexs.forEach((function(e){i.createIndex(e.indexName,e.key,{unique:e.unique})}))}}(t,B,{indexs:[{indexName:\"time\",key:\"time\",unique:!1}],objectStoreParams:{autoIncrement:!0}})}var K,q=function(){function e(){}return e.init=function(){if(\"undefined\"!=typeof window&&window&&window.indexedDB){var t=window.indexedDB.open(\"RC_ENGINE_DB\",2);t.onerror=function(e){console.warn(\"open indexDB request failed \"+e.target.error)},t.onsuccess=function(t){e._db=t.target.result,e._db&&(e._db.onclose=function(t){var n;console.warn(\"The database \"+(null===(n=e._db)||void 0===n?void 0:n.name)+\" has unexpectedly closed.\",t),e._db=null,e._instance=null},e._db.onerror=function(t){var n;console.warn(\"The database \"+(null===(n=e._db)||void 0===n?void 0:n.name)+\" has opening error.\",t),e._db=null,e._instance=null},e._db.onabort=function(t){var n;console.warn(\"The database \"+(null===(n=e._db)||void 0===n?void 0:n.name)+\" has opening aborted.\",t),e._db=null,e._instance=null}),e._instance=new e},t.onupgradeneeded=function(t){e._db=t.target.result,F(t)}}else console.debug(\"IndexDB is not currently supported in the environment!\")},e.getInstance=function(){return e._instance},e.prototype.addList=function(t,n){return new Promise((function(i){if(e._db){var r=e._db.transaction([t],\"readwrite\"),s=r.objectStore(t);n.forEach((function(e){null==s||s.add(e)})),r.oncomplete=function(e){i(!0)},r.onerror=function(e){i(!1)}}else i(!1)}))},e.prototype.getRangeData=function(t,n,i,r){return new Promise((function(s){if(e._db){var o=e._db.transaction([t],\"readwrite\").objectStore(t),a=IDBKeyRange.bound(i,r),u=o.index(n),c=[],h=u.openCursor(a);h.onsuccess=function(e){var t=e.target.result;t?(c.push(t.value),t.continue()):s(c)},h.onerror=function(e){console.error(e),s([])}}else s([])}))},e.prototype.getCount=function(t,n){return new Promise((function(n){if(e._db){var i=e._db.transaction([t],\"readonly\").objectStore(t).count();i.onsuccess=function(){n(i.result)},i.onerror=function(e){console.error(e),n(0)}}else n(0)}))},e.prototype.removeFirstData=function(t,n,i){return new Promise((function(n){if(e._db){var r=e._db.transaction([t],\"readwrite\").objectStore(t),s=r.getAllKeys(IDBKeyRange.lowerBound(0),i);s.onsuccess=function(){var e=s.result;e.length>0&&(r.delete(IDBKeyRange.bound(e[0],e[e.length-1])).onsuccess=function(){n(!0)})}}else n(!1)}))},e._db=null,e}(),Y=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return(\"x\"===e?t:3&t|8).toString(16)}))},H=function(){var e=Y();if(e=e.replace(/-/g,\"\")+\"a\",(e=function(e){var t=\"0123456789abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZa0\".split(\"\"),n=t.length+1,i=+e,r=[];do{var s=i%n;i=(i-s)/n,r.unshift(t[s])}while(i);return r.join(\"\")}(e=parseInt(e,16))).length>22&&(e=e.slice(0,22)),e.length<22)for(var t=22-e.length,n=0;n<t;n++)e+=\"0\";return e};!function(e){e[e.NONE=0]=\"NONE\",e[e.PRIVATE=1]=\"PRIVATE\",e[e.DISCUSSION=2]=\"DISCUSSION\",e[e.GROUP=3]=\"GROUP\",e[e.CHATROOM=4]=\"CHATROOM\",e[e.CUSTOMER_SERVICE=5]=\"CUSTOMER_SERVICE\",e[e.SYSTEM=6]=\"SYSTEM\",e[e.APP_PUBLIC_SERVICE=7]=\"APP_PUBLIC_SERVICE\",e[e.PUBLIC_SERVICE=8]=\"PUBLIC_SERVICE\",e[e.RTC_ROOM=12]=\"RTC_ROOM\"}(K||(K={}));var G,j=K;!function(e){e[e.IMAGE=1]=\"IMAGE\",e[e.AUDIO=2]=\"AUDIO\",e[e.VIDEO=3]=\"VIDEO\",e[e.FILE=4]=\"FILE\",e[e.SIGHT=5]=\"SIGHT\",e[e.COMBINE_HTML=6]=\"COMBINE_HTML\"}(G||(G={}));var Q,W=G,J=function(e){return\"string\"==typeof e},z=function(e){return\"boolean\"==typeof e},Z=function(e){return\"number\"==typeof e&&!isNaN(e)},X=function(e){return-1!==Object.prototype.toString.call(e).indexOf(\"Array\")},$=function(e){return\"[object ArrayBuffer]\"===Object.prototype.toString.call(e)},ee=function(e){return J(e)&&e.length>0},te=function(e){return X(e)&&e.length>0},ne=function(e){return\"[object Object]\"===Object.prototype.toString.call(e)},ie=function(e){return\"[object Function]\"===Object.prototype.toString.call(e)},re=function(e){return void 0===e||\"[object Undefined]\"===Object.prototype.toString.call(e)},se=function(e){return\"[object Null]\"===Object.prototype.toString.call(e)},oe=function(e){return J(e)&&/https?:\\/\\//.test(e)},ae=function(e){for(var t in e)return!0;return!1},ue=function(e){return Z(e)&&Object.prototype.hasOwnProperty.call(j,e)},ce=function(e){return Z(e)&&Object.prototype.hasOwnProperty.call(W,e)},he={};console&&((Q={})[A.DEBUG]=console.debug.bind(console),Q[A.INFO]=console.info.bind(console),Q[A.WARN]=console.warn.bind(console),Q[A.ERROR]=console.error.bind(console),Q[A.FATAL]=console.log.bind(console),he=Q);var le,de=function(e){return J(e)||Z(e)||re(e)||z(e)?e:e instanceof Error?JSON.stringify({name:e.name,message:e.message,stack:e.stack}):JSON.stringify(e)},fe=function(){function e(e,t,n){this.tag=e,this.type=t,this.initiator=n,this._outLevel=A.WARN,this.debug=this.log.bind(this,A.DEBUG),this.info=this.log.bind(this,A.INFO),this.warn=this.log.bind(this,A.WARN),this.error=this.log.bind(this,A.ERROR),this.fatal=this.log.bind(this,A.FATAL)}return e.init=function(t){e.userId=t},e.reset=function(){e.userId=\"\"},e.prototype._defaultStdout=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];he[e]&&he[e].apply(he,M([t+\":\"],n))},e.prototype.__pushLocalLog=function(t,n,i){var r;r=this.type?this.type:[\"RCRTCLog\",\"RCCall\",\"RCRTC\",\"RTC-A\"].includes(this.tag)?U.RTC:U.IM;var s=Date.now();V(n)>=1e3&&(n=function(e,t,n){if(void 0===n&&(n=\"utf-8\"),!e||!t)return\"\";var i=\"utf-8\"===n?3:2,r=0,s=0,o=\"\";for(s=0;s<e.length;s++){if(e.charCodeAt(s)>255?r+=i:r++,r>t)return o;o+=e.charAt(s)}return e}(n,1e3));var o=JSON.stringify({message:n,userId:e.userId}).replace(/\"/g,'\"\"'),a=/^[\\w]+-[\\w]+-[\\w]+?/.test(i)?i:(this.initiator||\"L\")+\"-\"+i+\"-O\",u={sessionId:e.sessionId,time:s,level:4-t,content:e.sessionId+\",\"+Date.now()+\",\"+r+\",\"+(4-t)+\",\"+a+',\"'+o+'\"\\n',userId:e.userId};e.databaseLogList.push(u),(e.databaseLogList.length>=100||t===A.FATAL)&&this.__insertLogIntoDatabase()},e.prototype.__insertLogIntoDatabase=function(){return w(this,void 0,void 0,(function(){var t,n,i;return b(this,(function(r){switch(r.label){case 0:return t=M([],e.databaseLogList),e.databaseLogList=[],(n=q.getInstance())?[4,n.addList(B,t)]:[3,3];case 1:return i=r.sent(),[4,n.getCount(B,\"time\")];case 2:return r.sent()>1e5&&n.removeFirstData(B,\"time\",2e3),[2,i];case 3:return[2,!1]}}))}))},e.prototype.setLogLevel=function(e){this._outLevel=\"number\"!=typeof e?A.WARN:e},e.prototype.setLogStdout=function(e){this._logStdout=e},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e>A.DEBUG&&this.__pushLocalLog(e,t.map(de).join(\" \"),this.tag),!(e<this._outLevel)){var i=(new Date).toISOString()+\"[\"+this.tag+\"][\"+A[e]+\"]\",r=i+\" - \"+t.map(de).join(\" \");this._logStdout?this._logStdout(e,r):this._stdout?this._stdout(e,r):this._defaultStdout.apply(this,M([e,i],t))}},e.prototype.reportLog=function(t,n,i){this.__pushLocalLog(4-t,i,n);var r=JSON.stringify({message:i}).replace(/\"/g,'\"\"');r='\"'+r+'\"';var s={level:t,content:[e.sessionId,Date.now(),this.type,t,n,r].join()+\"\\n\"};e.realTimeLogList.push(s),e.realTimeLogList.length>=600&&(e.realTimeLogList=e.realTimeLogList.slice(-500))},e.prototype.set=function(e,t){this.warn(\"logger.set has being deprecated!\")},e.prototype.setStdout=function(e){this._stdout=e},e.prototype.__clearRealTimeLog=function(){e.realTimeLogList=[]},e.databaseLogList=[],e.realTimeLogList=[],e.sessionId=H(),e.userId=\"\",e}(),pe=new fe(\"RCLog\"),ge=function(){function e(){this._map={}}return e.prototype.on=function(e,t,n){var i=this._map[e]||(this._map[e]=[]);i.some((function(e){return e.listener===t&&e.target===n}))||i.push({listener:t,target:n})},e.prototype.once=function(e,t,n){var i=this._map[e]||(this._map[e]=[]);i.some((function(e){return e.listener===t&&e.target===n}))||i.push({listener:t,target:n,once:!0})},e.prototype.off=function(e,t,n){var i=this._map[e];i&&((i=i.filter((function(e){return e.listener!==t||e.target!==n}))).length?this._map[e]=i:delete this._map[e])},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=this._map[e];if(i)for(var r=i.length-1;r>=0;r-=1){var s=i[r],o=s.target,a=s.once,u=s.listener;a&&i.splice(r,1);try{u.call.apply(u,M([o],t))}catch(e){pe.error(e)}}},e.prototype.removeAll=function(e){delete this._map[e]},e.prototype.clear=function(){Object.keys(this._map).forEach(this.removeAll,this)},e}();!function(e){e[e.SEND=1]=\"SEND\",e[e.RECEIVE=2]=\"RECEIVE\"}(le||(le={}));var _e,ye=le;!function(e){e[e.TIMEOUT=-1]=\"TIMEOUT\",e[e.UNKNOWN=-2]=\"UNKNOWN\",e[e.PARAMETER_ERROR=-3]=\"PARAMETER_ERROR\",e[e.EXTRA_METHOD_UNDEFINED=-4]=\"EXTRA_METHOD_UNDEFINED\",e[e.MAIN_PROCESS_ERROR=-5]=\"MAIN_PROCESS_ERROR\",e[e.PARAMETER_CHANGED=-6]=\"PARAMETER_CHANGED\",e[e.SUCCESS=0]=\"SUCCESS\",e[e.RC_MSG_UNAUTHORIZED=20406]=\"RC_MSG_UNAUTHORIZED\",e[e.RC_DISCUSSION_GROUP_ID_INVALID=20407]=\"RC_DISCUSSION_GROUP_ID_INVALID\",e[e.SEND_FREQUENCY_TOO_FAST=20604]=\"SEND_FREQUENCY_TOO_FAST\",e[e.NOT_IN_DISCUSSION=21406]=\"NOT_IN_DISCUSSION\",e[e.FORBIDDEN_IN_GROUP=22408]=\"FORBIDDEN_IN_GROUP\",e[e.RECALL_MESSAGE=25101]=\"RECALL_MESSAGE\",e[e.NOT_IN_GROUP=22406]=\"NOT_IN_GROUP\",e[e.NOT_IN_CHATROOM=23406]=\"NOT_IN_CHATROOM\",e[e.FORBIDDEN_IN_CHATROOM=23408]=\"FORBIDDEN_IN_CHATROOM\",e[e.RC_CHATROOM_USER_KICKED=23409]=\"RC_CHATROOM_USER_KICKED\",e[e.RC_CHATROOM_NOT_EXIST=23410]=\"RC_CHATROOM_NOT_EXIST\",e[e.RC_CHATROOM_IS_FULL=23411]=\"RC_CHATROOM_IS_FULL\",e[e.RC_CHATROOM_PATAMETER_INVALID=23412]=\"RC_CHATROOM_PATAMETER_INVALID\",e[e.CHATROOM_GET_HISTORYMSG_ERROR=23413]=\"CHATROOM_GET_HISTORYMSG_ERROR\",e[e.CHATROOM_NOT_OPEN_HISTORYMSG_STORE=23414]=\"CHATROOM_NOT_OPEN_HISTORYMSG_STORE\",e[e.CHATROOM_KV_EXCEED=23423]=\"CHATROOM_KV_EXCEED\",e[e.CHATROOM_KV_OVERWRITE_INVALID=23424]=\"CHATROOM_KV_OVERWRITE_INVALID\",e[e.CHATROOM_KV_STORE_NOT_OPEN=23426]=\"CHATROOM_KV_STORE_NOT_OPEN\",e[e.CHATROOM_KEY_NOT_EXIST=23427]=\"CHATROOM_KEY_NOT_EXIST\",e[e.SENSITIVE_SHIELD=21501]=\"SENSITIVE_SHIELD\",e[e.SENSITIVE_REPLACE=21502]=\"SENSITIVE_REPLACE\",e[e.JOIN_IN_DISCUSSION=21407]=\"JOIN_IN_DISCUSSION\",e[e.CREATE_DISCUSSION=21408]=\"CREATE_DISCUSSION\",e[e.INVITE_DICUSSION=21409]=\"INVITE_DICUSSION\",e[e.GET_USERINFO_ERROR=23407]=\"GET_USERINFO_ERROR\",e[e.REJECTED_BY_BLACKLIST=405]=\"REJECTED_BY_BLACKLIST\",e[e.RC_NET_CHANNEL_INVALID=30001]=\"RC_NET_CHANNEL_INVALID\",e[e.RC_NET_UNAVAILABLE=30002]=\"RC_NET_UNAVAILABLE\",e[e.RC_MSG_RESP_TIMEOUT=30003]=\"RC_MSG_RESP_TIMEOUT\",e[e.RC_HTTP_SEND_FAIL=30004]=\"RC_HTTP_SEND_FAIL\",e[e.RC_HTTP_REQ_TIMEOUT=30005]=\"RC_HTTP_REQ_TIMEOUT\",e[e.RC_HTTP_RECV_FAIL=30006]=\"RC_HTTP_RECV_FAIL\",e[e.RC_NAVI_RESOURCE_ERROR=30007]=\"RC_NAVI_RESOURCE_ERROR\",e[e.RC_NODE_NOT_FOUND=30008]=\"RC_NODE_NOT_FOUND\",e[e.RC_DOMAIN_NOT_RESOLVE=30009]=\"RC_DOMAIN_NOT_RESOLVE\",e[e.RC_SOCKET_NOT_CREATED=30010]=\"RC_SOCKET_NOT_CREATED\",e[e.RC_SOCKET_DISCONNECTED=30011]=\"RC_SOCKET_DISCONNECTED\",e[e.RC_PING_SEND_FAIL=30012]=\"RC_PING_SEND_FAIL\",e[e.RC_PONG_RECV_FAIL=30013]=\"RC_PONG_RECV_FAIL\",e[e.RC_MSG_SEND_FAIL=30014]=\"RC_MSG_SEND_FAIL\",e[e.RC_MSG_CONTENT_EXCEED_LIMIT=30016]=\"RC_MSG_CONTENT_EXCEED_LIMIT\",e[e.RC_CONN_ACK_TIMEOUT=31e3]=\"RC_CONN_ACK_TIMEOUT\",e[e.RC_CONN_PROTO_VERSION_ERROR=31001]=\"RC_CONN_PROTO_VERSION_ERROR\",e[e.RC_CONN_ID_REJECT=31002]=\"RC_CONN_ID_REJECT\",e[e.RC_CONN_SERVER_UNAVAILABLE=31003]=\"RC_CONN_SERVER_UNAVAILABLE\",e[e.RC_CONN_USER_OR_PASSWD_ERROR=31004]=\"RC_CONN_USER_OR_PASSWD_ERROR\",e[e.RC_CONN_NOT_AUTHRORIZED=31005]=\"RC_CONN_NOT_AUTHRORIZED\",e[e.RC_CONN_REDIRECTED=31006]=\"RC_CONN_REDIRECTED\",e[e.RC_CONN_PACKAGE_NAME_INVALID=31007]=\"RC_CONN_PACKAGE_NAME_INVALID\",e[e.RC_CONN_APP_BLOCKED_OR_DELETED=31008]=\"RC_CONN_APP_BLOCKED_OR_DELETED\",e[e.RC_CONN_USER_BLOCKED=31009]=\"RC_CONN_USER_BLOCKED\",e[e.RC_DISCONN_KICK=31010]=\"RC_DISCONN_KICK\",e[e.RC_DISCONN_EXCEPTION=31011]=\"RC_DISCONN_EXCEPTION\",e[e.RC_APP_AUTH_NOT_PASS=31026]=\"RC_APP_AUTH_NOT_PASS\",e[e.RC_OTP_USED=31027]=\"RC_OTP_USED\",e[e.RC_PLATFORM_ERROR=31028]=\"RC_PLATFORM_ERROR\",e[e.RC_QUERY_ACK_NO_DATA=32001]=\"RC_QUERY_ACK_NO_DATA\",e[e.RC_MSG_DATA_INCOMPLETE=32002]=\"RC_MSG_DATA_INCOMPLETE\",e[e.BIZ_ERROR_CLIENT_NOT_INIT=33001]=\"BIZ_ERROR_CLIENT_NOT_INIT\",e[e.BIZ_ERROR_DATABASE_ERROR=33002]=\"BIZ_ERROR_DATABASE_ERROR\",e[e.BIZ_ERROR_INVALID_PARAMETER=33003]=\"BIZ_ERROR_INVALID_PARAMETER\",e[e.BIZ_ERROR_NO_CHANNEL=33004]=\"BIZ_ERROR_NO_CHANNEL\",e[e.BIZ_ERROR_RECONNECT_SUCCESS=33005]=\"BIZ_ERROR_RECONNECT_SUCCESS\",e[e.BIZ_ERROR_CONNECTING=33006]=\"BIZ_ERROR_CONNECTING\",e[e.MSG_ROAMING_SERVICE_UNAVAILABLE=33007]=\"MSG_ROAMING_SERVICE_UNAVAILABLE\",e[e.MSG_INSERT_ERROR=33008]=\"MSG_INSERT_ERROR\",e[e.MSG_DEL_ERROR=33009]=\"MSG_DEL_ERROR\",e[e.TAG_EXISTS=33101]=\"TAG_EXISTS\",e[e.TAG_NOT_EXIST=33100]=\"TAG_NOT_EXIST\",e[e.NO_TAG_IN_CONVER=33102]=\"NO_TAG_IN_CONVER\",e[e.CONVER_REMOVE_ERROR=34001]=\"CONVER_REMOVE_ERROR\",e[e.CONVER_GETLIST_ERROR=34002]=\"CONVER_GETLIST_ERROR\",e[e.CONVER_SETOP_ERROR=34003]=\"CONVER_SETOP_ERROR\",e[e.CONVER_TOTAL_UNREAD_ERROR=34004]=\"CONVER_TOTAL_UNREAD_ERROR\",e[e.CONVER_TYPE_UNREAD_ERROR=34005]=\"CONVER_TYPE_UNREAD_ERROR\",e[e.CONVER_ID_TYPE_UNREAD_ERROR=34006]=\"CONVER_ID_TYPE_UNREAD_ERROR\",e[e.CONVER_CLEAR_ERROR=34007]=\"CONVER_CLEAR_ERROR\",e[e.EXPANSION_LIMIT_EXCEET=34010]=\"EXPANSION_LIMIT_EXCEET\",e[e.MESSAGE_KV_NOT_SUPPORT=34008]=\"MESSAGE_KV_NOT_SUPPORT\",e[e.CLEAR_HIS_TIME_ERROR=34011]=\"CLEAR_HIS_TIME_ERROR\",e[e.CONVER_OUT_LIMIT_ERROR=34013]=\"CONVER_OUT_LIMIT_ERROR\",e[e.CONVER_GET_ERROR=35021]=\"CONVER_GET_ERROR\",e[e.GROUP_SYNC_ERROR=35001]=\"GROUP_SYNC_ERROR\",e[e.GROUP_MATCH_ERROR=35002]=\"GROUP_MATCH_ERROR\",e[e.READ_RECEIPT_ERROR=35003]=\"READ_RECEIPT_ERROR\",e[e.PACKAGE_ENVIRONMENT_ERROR=35006]=\"PACKAGE_ENVIRONMENT_ERROR\",e[e.CAN_NOT_RECONNECT=35007]=\"CAN_NOT_RECONNECT\",e[e.SERVER_UNAVAILABLE=35008]=\"SERVER_UNAVAILABLE\",e[e.HOSTNAME_ERROR=35009]=\"HOSTNAME_ERROR\",e[e.HAS_OHTER_SAME_CLIENT_ON_LINE=35010]=\"HAS_OHTER_SAME_CLIENT_ON_LINE\",e[e.UPLOAD_FILE_FAILED=35020]=\"UPLOAD_FILE_FAILED\",e[e.CHATROOM_ID_ISNULL=36001]=\"CHATROOM_ID_ISNULL\",e[e.CHARTOOM_JOIN_ERROR=36002]=\"CHARTOOM_JOIN_ERROR\",e[e.CHATROOM_HISMESSAGE_ERROR=36003]=\"CHATROOM_HISMESSAGE_ERROR\",e[e.CHATROOM_KV_NOT_FOUND=36004]=\"CHATROOM_KV_NOT_FOUND\",e[e.BLACK_ADD_ERROR=37001]=\"BLACK_ADD_ERROR\",e[e.BLACK_GETSTATUS_ERROR=37002]=\"BLACK_GETSTATUS_ERROR\",e[e.BLACK_REMOVE_ERROR=37003]=\"BLACK_REMOVE_ERROR\",e[e.DRAF_GET_ERROR=38001]=\"DRAF_GET_ERROR\",e[e.DRAF_SAVE_ERROR=38002]=\"DRAF_SAVE_ERROR\",e[e.DRAF_REMOVE_ERROR=38003]=\"DRAF_REMOVE_ERROR\",e[e.SUBSCRIBE_ERROR=39001]=\"SUBSCRIBE_ERROR\",e[e.NOT_SUPPORT=39002]=\"NOT_SUPPORT\",e[e.QNTKN_FILETYPE_ERROR=41001]=\"QNTKN_FILETYPE_ERROR\",e[e.QNTKN_GET_ERROR=41002]=\"QNTKN_GET_ERROR\",e[e.COOKIE_ENABLE=51001]=\"COOKIE_ENABLE\",e[e.GET_MESSAGE_BY_ID_ERROR=61001]=\"GET_MESSAGE_BY_ID_ERROR\",e[e.HAVNODEVICEID=24001]=\"HAVNODEVICEID\",e[e.DEVICEIDISHAVE=24002]=\"DEVICEIDISHAVE\",e[e.FEILD=24009]=\"FEILD\",e[e.VOIPISNULL=24013]=\"VOIPISNULL\",e[e.NOENGINETYPE=24010]=\"NOENGINETYPE\",e[e.NULLCHANNELNAME=24011]=\"NULLCHANNELNAME\",e[e.VOIPDYANMICERROR=24012]=\"VOIPDYANMICERROR\",e[e.NOVOIP=24014]=\"NOVOIP\",e[e.INTERNALERRROR=24015]=\"INTERNALERRROR\",e[e.VOIPCLOSE=24016]=\"VOIPCLOSE\",e[e.CLOSE_BEFORE_OPEN=51001]=\"CLOSE_BEFORE_OPEN\",e[e.ALREADY_IN_USE=51002]=\"ALREADY_IN_USE\",e[e.INVALID_CHANNEL_NAME=51003]=\"INVALID_CHANNEL_NAME\",e[e.VIDEO_CONTAINER_IS_NULL=51004]=\"VIDEO_CONTAINER_IS_NULL\",e[e.DELETE_MESSAGE_ID_IS_NULL=61001]=\"DELETE_MESSAGE_ID_IS_NULL\",e[e.CANCEL=1]=\"CANCEL\",e[e.REJECT=2]=\"REJECT\",e[e.HANGUP=3]=\"HANGUP\",e[e.BUSYLINE=4]=\"BUSYLINE\",e[e.NO_RESPONSE=5]=\"NO_RESPONSE\",e[e.ENGINE_UN_SUPPORTED=6]=\"ENGINE_UN_SUPPORTED\",e[e.NETWORK_ERROR=7]=\"NETWORK_ERROR\",e[e.REMOTE_CANCEL=11]=\"REMOTE_CANCEL\",e[e.REMOTE_REJECT=12]=\"REMOTE_REJECT\",e[e.REMOTE_HANGUP=13]=\"REMOTE_HANGUP\",e[e.REMOTE_BUSYLINE=14]=\"REMOTE_BUSYLINE\",e[e.REMOTE_NO_RESPONSE=15]=\"REMOTE_NO_RESPONSE\",e[e.REMOTE_ENGINE_UN_SUPPORTED=16]=\"REMOTE_ENGINE_UN_SUPPORTED\",e[e.REMOTE_NETWORK_ERROR=17]=\"REMOTE_NETWORK_ERROR\",e[e.VOIP_NOT_AVALIABLE=18]=\"VOIP_NOT_AVALIABLE\",e[e.CHATROOM_KV_STORE_NOT_ALL_SUCCESS=23428]=\"CHATROOM_KV_STORE_NOT_ALL_SUCCESS\",e[e.CHATROOM_KV_STORE_OUT_LIMIT=23429]=\"CHATROOM_KV_STORE_OUT_LIMIT\"}(_e||(_e={}));var ve,Ee=_e;!function(e){e[e.CONNECTED=0]=\"CONNECTED\",e[e.CONNECTING=1]=\"CONNECTING\",e[e.DISCONNECTED=2]=\"DISCONNECTED\",e[e.NETWORK_UNAVAILABLE=3]=\"NETWORK_UNAVAILABLE\",e[e.CONNECTION_CLOSED=4]=\"CONNECTION_CLOSED\",e[e.KICKED_OFFLINE_BY_OTHER_CLIENT=6]=\"KICKED_OFFLINE_BY_OTHER_CLIENT\",e[e.WEBSOCKET_UNAVAILABLE=7]=\"WEBSOCKET_UNAVAILABLE\",e[e.WEBSOCKET_ERROR=8]=\"WEBSOCKET_ERROR\",e[e.BLOCKED=9]=\"BLOCKED\",e[e.DOMAIN_INCORRECT=12]=\"DOMAIN_INCORRECT\",e[e.DISCONNECT_BY_SERVER=13]=\"DISCONNECT_BY_SERVER\",e[e.REDIRECT=14]=\"REDIRECT\",e[e.APPKEY_IS_FAKE=20]=\"APPKEY_IS_FAKE\",e[e.ULTRALIMIT=1101]=\"ULTRALIMIT\",e[e.REQUEST_NAVI=201]=\"REQUEST_NAVI\",e[e.RESPONSE_NAVI=202]=\"RESPONSE_NAVI\",e[e.RESPONSE_NAVI_ERROR=203]=\"RESPONSE_NAVI_ERROR\",e[e.RESPONSE_NAVI_TIMEOUT=204]=\"RESPONSE_NAVI_TIMEOUT\"}(ve||(ve={}));var me,Ie=ve,Te={ACCEPTED:0,UNACCEPTABLE_PROTOCOL_VERSION:1,IDENTIFIER_REJECTED:2,SERVER_UNAVAILABLE:3,TOKEN_INCORRECT:4,NOT_AUTHORIZED:5,REDIRECT:6,PACKAGE_ERROR:7,APP_BLOCK_OR_DELETE:8,BLOCK:9,TOKEN_EXPIRE:10,DEVICE_ERROR:11,HOSTNAME_ERROR:12,HASOHTERSAMECLIENTONLINE:13,IN_OTHER_CLUSTER:15,APP_AUTH_NOT_PASS:16,OTP_USED:17,PLATFORM_ERROR:18};!function(e){e.TextMessage=\"RC:TxtMsg\",e.VOICE=\"RC:VcMsg\",e.HQ_VOICE=\"RC:HQVCMsg\",e.IMAGE=\"RC:ImgMsg\",e.GIF=\"RC:GIFMsg\",e.RICH_CONTENT=\"RC:ImgTextMsg\",e.LOCATION=\"RC:LBSMsg\",e.FILE=\"RC:FileMsg\",e.SIGHT=\"RC:SightMsg\",e.COMBINE=\"RC:CombineMsg\",e.CHRM_KV_NOTIFY=\"RC:chrmKVNotiMsg\",e.LOG_COMMAND=\"RC:LogCmdMsg\",e.EXPANSION_NOTIFY=\"RC:MsgExMsg\",e.REFERENCE=\"RC:ReferenceMsg\",e.RECALL=\"RC:RcCmd\",e.READ_RECEIPT=\"RC:ReadNtf\",e.READ_RECEIPT_REQUEST=\"RC:RRReqMsg\",e.READ_RECEIPT_RESPONSE=\"RC:RRRspMsg\",e.SYNC_READ_STATUS=\"RC:SRSMsg\",e.GROUP_READ_RECEIPT_REQUEST=\"RC:RRMsg\",e.CHATROOM_JOIN=\"RC:ChrmJoinNtf\",e.CHATROOM_LEFT=\"RC:ChrmQuitNtf\",e.CHATROOM_MERGE_CHANGE=\"RC:ChrmMemChange\",e.TYPING_STATUS=\"RC:TypSts\",e.INTERCEPT=\"RC:InterceptMsg\"}(me||(me={}));var Ce,Re=me;!function(e){e[e.OPEN=1]=\"OPEN\",e[e.CLOSE=2]=\"CLOSE\"}(Ce||(Ce={}));var Se,Ne=Ce;!function(e){e[e.ALL=1]=\"ALL\",e[e.SINGAL=2]=\"SINGAL\"}(Se||(Se={}));var Oe,we=Se;!function(e){e[e.QINIU=1]=\"QINIU\",e[e.ALI=2]=\"ALI\",e[e.AWS=3]=\"AWS\",e[e.STC=4]=\"STC\"}(Oe||(Oe={}));var be,Me=Oe;!function(e){e[e.UPDATE=1]=\"UPDATE\",e[e.DELETE=2]=\"DELETE\"}(be||(be={}));var Ae,Ue=be;!function(e){e[e.QUIT=0]=\"QUIT\",e[e.JOIN=1]=\"JOIN\"}(Ae||(Ae={}));var Le,Pe=Ae;!function(e){\n/*!\n    全局敏感词：命中了融云内置的全局敏感词\n   */\ne[e.GLOBAL=1]=\"GLOBAL\",\n/*!\n     自定义敏感词拦截：命中了客户在融云自定义的敏感词\n    */\ne[e.CUSTOM=2]=\"CUSTOM\",\n/*!\n     第三方审核拦截：命中了第三方（数美）或模板路由决定不下发的状态\n    */\ne[e.THIRD_PARTY=3]=\"THIRD_PARTY\"}(Le||(Le={}));var De,Ve,ke,xe=Le;!function(e){e[e.RTC=0]=\"RTC\",e[e.LIVE=2]=\"LIVE\"}(De||(De={})),function(e){e[e.AUDIO_AND_VIDEO=0]=\"AUDIO_AND_VIDEO\",e[e.AUDIO=1]=\"AUDIO\"}(Ve||(Ve={})),function(e){e[e.ANCHOR=1]=\"ANCHOR\",e[e.AUDIENCE=2]=\"AUDIENCE\"}(ke||(ke={}));var Be,Fe,Ke,qe={\"RC:VCAccept\":\"RC:VCAccept\",\"RC:VCRinging\":\"RC:VCRinging\",\"RC:VCSummary\":\"RC:VCSummary\",\"RC:VCHangup\":\"RC:VCHangup\",\"RC:VCInvite\":\"RC:VCInvite\",\"RC:VCModifyMedia\":\"RC:VCModifyMedia\",\"RC:VCModifyMem\":\"RC:VCModifyMem\"};!function(e){e[e.ROOM=1]=\"ROOM\",e[e.PERSON=2]=\"PERSON\"}(Be||(Be={})),function(e){e[e.AnchorToViewer=1]=\"AnchorToViewer\",e[e.ViewerToAnchor=2]=\"ViewerToAnchor\"}(Fe||(Fe={})),function(e){e[e.KICK=0]=\"KICK\",e[e.REFUSE=1]=\"REFUSE\",e[e.COEXIST=2]=\"COEXIST\"}(Ke||(Ke={}));var Ye,He,Ge={engine:\"5.1.2\"},je=function(){function e(){}return e.add=function(e,t){Ge[e]=t},e.validEngine=function(e){var t=e.match(/\\d+\\.\\d+\\.\\d+/);if(!t)return pe.warn(\"The validation engine version '\"+e+\"' is invalid!\"),!1;var n=t[0].split(\".\").map((function(e){return e.padStart(3,\"0\")})).join(\"\");return Ge.engine.match(/\\d+\\.\\d+\\.\\d+/)[0].split(\".\").map((function(e){return e.padStart(3,\"0\")})).join(\"\")>=n},e.getInfo=function(){return Ge},e}();!function(e){e[e.STRING=0]=\"STRING\",e[e.ONLY_STRING=1]=\"ONLY_STRING\",e[e.NUMBER=2]=\"NUMBER\",e[e.BOOLEAN=3]=\"BOOLEAN\",e[e.OBJECT=4]=\"OBJECT\",e[e.ARRAY=5]=\"ARRAY\",e[e.CALLBACK=6]=\"CALLBACK\",e[e.CHANNEL_ID=7]=\"CHANNEL_ID\"}(He||(He={}));var Qe,We,Je,ze,Ze,Xe=((Ye={})[He.STRING]=ee,Ye[He.ONLY_STRING]=J,Ye[He.NUMBER]=Z,Ye[He.BOOLEAN]=function(e){return\"boolean\"==typeof e},Ye[He.OBJECT]=ne,Ye[He.ARRAY]=X,Ye[He.CALLBACK]=function(e){var t=!0;return ne(e)||(t=!1),(e=e||{}).onSuccess&&!ie(e.onSuccess)&&(t=!1),e.onError&&!ie(e.onError)&&(t=!1),t},Ye[He.CHANNEL_ID]=function(e){var t=!1;return J(e)&&!/_/g.test(e)&&e.length<=20&&(t=!0),t},Ye),$e=function(e){function t(t){var n=e.call(this,t)||this;return n.name=\"RCAssertError\",n}return N(t,e),t}(Error),et=function(e,t,n,i){if(void 0===i&&(i=!1),!tt(e,t,n,i))throw new $e(\"'\"+e+\"' is invalid: \"+JSON.stringify(t))},tt=function(e,t,n,i){void 0===i&&(i=!1),n=Xe[n]||n;var r=i&&!n(t)||!i&&!(re(t)||null===t||n(t));return r&&pe.error(\"'\"+e+\"' is invalid: \"+JSON.stringify(t)),!r},nt=function(e){if(!ne(e)||void 0===e.low||void 0===e.high)return e;var t=e.low;return t<0&&(t+=4294967296),t=t.toString(16),parseInt(e.high.toString(16)+\"00000000\".replace(new RegExp(\"0{\"+t.length+\"}$\"),t),16)},it=function(e,t){var n=Math.floor(1e3*Math.random()%1e4),i=Y(),r=function(e){e=e||\"-\";var t=new Date;return\"\"+t.getFullYear()+e+(t.getMonth()+1)+e+t.getDate()}(),s=(new Date).getTime(),o=\"\";if(t){var a=t.split(\".\");o=\".\"+a[a.length-1]}return e+\"__RC-\"+r+\"_\"+n+\"_\"+s+i+o},rt=function(e){var t=\"application/octet-stream\";switch(e){case W.IMAGE:t=\"image/jpeg\";break;case W.AUDIO:t=\"audio/amr\";break;case W.VIDEO:t=\"video/3gpp\";break;case W.SIGHT:t=\"video/mpeg4\";break;case W.COMBINE_HTML:t=\"text/html\"}return t},st=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var n=e.threadId,i=e.apnsCollapseId,r=e.category,s=e.richMediaUri,o=t.channelIdMi,a=t.channelIdHW,u=t.channelIdOPPO,c=t.typeVivo,h=t.googleConfig,l={};l[\"thread-id\"]=n||\"\",l[\"apns-collapse-id\"]=i||\"\",l.category=r||\"\",l.richMediaUri=s||\"\";var d={};d.collapse_key=null==h?void 0:h.collapseKey,d.imageUrl=null==h?void 0:h.imageUrl;var f=null==h?void 0:h.priority;f&&![\"high\",\"normal\"].includes(f)&&(f=\"normal\"),d.priority=f;var p=[{HW:{channelId:a||\"\"}},{MI:{channelId:o||\"\"}},{OPPO:{channelId:u||\"\"}},{VIVO:{classification:c||\"\"}},{APNS:l},{FCM:d}];return JSON.stringify(p)},ot=function(e,t){var n={},i={notificationId:t||\"\"};if(!e)return{iOSConfig:n,androidConfig:i};try{var r=JSON.parse(e);null==r||r.forEach((function(e){var t,r,s,o,a=Object.keys(e);if(0!==a.length){var u=a[0];switch(u){case\"HW\":return void(i.channelIdHW=null===(t=e[u])||void 0===t?void 0:t.channelId);case\"MI\":return void(i.channelIdMi=null===(r=e[u])||void 0===r?void 0:r.channelId);case\"OPPO\":return void(i.channelIdOPPO=null===(s=e[u])||void 0===s?void 0:s.channelId);case\"VIVO\":return void(i.typeVivo=null===(o=e[u])||void 0===o?void 0:o.classification);case\"APNS\":return n.threadId=e[u][\"thread-id\"],n.apnsCollapseId=e[u][\"apns-collapse-id\"],n.category=e[u].category,void(n.richMediaUri=e[u].richMediaUri);case\"FCM\":i.googleConfig={collapseKey:e[u].collapse_key||\"\",imageUrl:e[u].imageUrl||\"\",priority:e[u].priority||\"\"}}}}))}catch(t){pe.error(\"Wrong format for pushConfigs field! content: \"+e)}return{iOSConfig:n,androidConfig:i}},at=function(e){var t=/^[A-Za-z0-9_=+-]+$/.test(e),n=e.length;return t&&(n<=128&&n>=1)},ut=function(e){var t=e.length;return t<=4096&&t>=1},ct=function(e,t,n){t=t||function(){};var i=(n=n||{}).isReverse;ne(e)&&function(){for(var n in e)t(e[n],n,e)}(),(X(e)||J(e))&&function(){if(i)for(var n=e.length-1;n>=0;n--)t(e[n],n);else for(var r=0,s=e.length;r<s;r++)t(e[r],r)}()},ht=function(e,t){return ct(e,(function(n,i){e[i]=t(n,i)})),e},lt=function(e,t){if(e.indexOf)return e.indexOf(t);var n=-1;return ct(e,(function(e,i){t===e&&(n=i)})),n},dt=function(e,t){return-1!==lt(e,t)},ft=function(e,t){var n=[];return ct(e,(function(e){n.push(e)})),-1!==lt(n,t)},pt=function(e){return JSON.parse(JSON.stringify(e))},gt=function(){return\"undefined\"!=typeof RCCppEngine},_t=function(e){if(\"browser\"!==e.tag)return{type:e.tag,version:\"UnKonw\"};var t,n,i=navigator.userAgent,r={IE:/rv:([\\d.]+)\\) like Gecko|MSIE ([\\d.]+)/,Edge:/Edge\\/([\\d.]+)/,Firefox:/Firefox\\/([\\d.]+)/,Opera:/(?:OPERA|OPR).([\\d.]+)/,WeChat:/MicroMessenger\\/([\\d.]+)/,QQBrowser:/QQBrowser\\/([\\d.]+)/,Chrome:/Chrome\\/([\\d.]+)/,Safari:/Version\\/([\\d.]+).*Safari/,iOSChrome:/Mobile\\/([\\d.]+).*Safari/};for(var s in r)if(r.hasOwnProperty(s)){var o=i.match(r[s]);if(o){n=s,t=o[1]||o[2];break}}return{type:n||\"UnKonw\",version:t||\"UnKonw\"}},yt=function(e){switch(e){case Te.SERVER_UNAVAILABLE:return Ee.SERVER_UNAVAILABLE;case Te.TOKEN_INCORRECT:return Ee.RC_CONN_USER_OR_PASSWD_ERROR;case Te.REDIRECT:return Ee.RC_CONN_REDIRECTED;case Te.APP_BLOCK_OR_DELETE:return Ee.RC_CONN_APP_BLOCKED_OR_DELETED;case Te.BLOCK:return Ee.RC_CONN_USER_BLOCKED;case Te.TOKEN_EXPIRE:return Ee.RC_CONN_USER_OR_PASSWD_ERROR;case Te.HOSTNAME_ERROR:return Ee.HOSTNAME_ERROR;case Te.HASOHTERSAMECLIENTONLINE:return Ee.HAS_OHTER_SAME_CLIENT_ON_LINE;case Te.APP_AUTH_NOT_PASS:return Ee.RC_APP_AUTH_NOT_PASS;case Te.OTP_USED:return Ee.RC_OTP_USED;case Te.PLATFORM_ERROR:return Ee.RC_PLATFORM_ERROR;default:return Ee.RC_NET_UNAVAILABLE}},vt=function(e){var t={},n=JSON.parse(e);return ct(n,(function(e,n){t[n]=e.v})),t},Et={_delayTime:0,setTime:function(e){var t=(new Date).getTime();Et._delayTime=t-e},getTime:function(){var e=Et._delayTime;return(new Date).getTime()-e}},mt=function(e,t){var n=0;return e.isAutoDelete&&(n|=1),e.isOverwrite&&(n|=2),2===t&&(n|=4),n};!function(e){e[e.AT_MOST_ONCE=0]=\"AT_MOST_ONCE\",e[e.AT_LEAST_ONCE=1]=\"AT_LEAST_ONCE\",e[e.EXACTLY_ONCE=2]=\"EXACTLY_ONCE\",e[e.DEFAULT=3]=\"DEFAULT\"}(Qe||(Qe={})),function(e){e[e.SYMMETRIC=0]=\"SYMMETRIC\",e[e.CONNECT=1]=\"CONNECT\",e[e.CONN_ACK=2]=\"CONN_ACK\",e[e.PUBLISH=3]=\"PUBLISH\",e[e.PUB_ACK=4]=\"PUB_ACK\",e[e.QUERY=5]=\"QUERY\",e[e.QUERY_ACK=6]=\"QUERY_ACK\",e[e.QUERY_CONFIRM=7]=\"QUERY_CONFIRM\",e[e.SUBSCRIBE=8]=\"SUBSCRIBE\",e[e.SUB_ACK=9]=\"SUB_ACK\",e[e.UNSUBSCRIBE=10]=\"UNSUBSCRIBE\",e[e.UNSUB_ACK=11]=\"UNSUB_ACK\",e[e.PING_REQ=12]=\"PING_REQ\",e[e.PING_RESP=13]=\"PING_RESP\",e[e.DISCONNECT=14]=\"DISCONNECT\",e[e.RESERVER2=15]=\"RESERVER2\"}(We||(We={})),function(e){e.CONN_ACK=\"ConnAckMessage\",e.DISCONNECT=\"DisconnectMessage\",e.PING_REQ=\"PingReqMessage\",e.PING_RESP=\"PingRespMessage\",e.PUBLISH=\"PublishMessage\",e.PUB_ACK=\"PubAckMessage\",e.QUERY=\"QueryMessage\",e.QUERY_CON=\"QueryConMessage\",e.QUERY_ACK=\"QueryAckMessage\"}(Je||(Je={})),function(e){e.PUB=\"pub\",e.QUERY=\"qry\"}(ze||(ze={})),function(e){e[e.V4=4]=\"V4\",e[e.V3=3]=\"V3\"}(Ze||(Ze={}));var It,Tt=function(){function e(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=Qe.AT_LEAST_ONCE),void 0===i&&(i=!1),this._retain=!1,this.qos=Qe.AT_LEAST_ONCE,this._dup=!1,this.syncMsg=!1;var r=e>0;e&&r&&1===arguments.length?(this._retain=(1&e)>0,this.qos=(6&e)>>1,this._dup=(8&e)>0,this.type=e>>4&15,this.syncMsg=8==(8&e)):(this.type=e,this._retain=t,this.qos=n,this._dup=i)}return e.prototype.encode=function(){var e=this.type<<4;return e|=this._retain?1:0,e|=this.qos<<1,e|=this._dup?8:0},e}(),Ct=function(){function e(){}return e.writeUTF=function(e,t){var n=[],i=0;if(J(e))for(var r=0,s=e.length;r<s;r++){var o=e.charCodeAt(r);o>=0&&o<=127?(i+=1,n.push(o)):o>=128&&o<=2047?(i+=2,n.push(192|31&o>>6),n.push(128|63&o)):o>=2048&&o<=65535&&(i+=3,n.push(224|15&o>>12),n.push(128|63&o>>6),n.push(128|63&o))}for(r=0,s=n.length;r<s;r++)n[r]>255&&(n[r]&=255);return t?n:i<=255?[0,i].concat(n):[i>>8,255&i].concat(n)},e.readUTF=function(e){for(var t,n,i=[],r=-1,s=e,o=\"\";++r<s.length;){var a=Number(s[r]);if(a===(127&a)||(240==(240&a)?a=(a=(a=(a^=240)<<6|128^s[++r])<<6|128^s[++r])<<6|128^s[++r]:224==(224&a)?a=(a=(a^=224)<<6|128^s[++r])<<6|128^s[++r]:192==(192&a)&&(a=(a^=192)<<6|128^s[++r])),!isFinite(a)||a<0||a>1114111||Math.floor(a)!==a)throw RangeError(\"Invalid code point: \"+a);a<=65535?i.push(a):(t=(a-=65536)>>10|55296,n=a%1024|56320,i.push(t,n)),(r+1===s.length||i.length>16384)&&(o+=String.fromCharCode.apply(null,i),i.length=0)}return o},e}(),Rt=function(){function e(e){this._position=0,this._poolLen=0,this._pool=e,this._poolLen=e.length}return e.prototype.check=function(){return this._position>=this._pool.length},e.prototype.read2Byte=function(){var e=this;if(e.check())return-1;for(var t=\"\",n=0;n<2;n++){var i=e._pool[e._position++].toString(16);1===i.length&&(i=\"0\"+i),t+=i.toString()}return parseInt(t,16)},e.prototype.readInt=function(){var e=this;if(e.check())return-1;for(var t=\"\",n=0;n<4;n++){var i=e._pool[e._position++].toString(16);1===i.length&&(i=\"0\"+i),t+=i.toString()}return parseInt(t,16)},e.prototype.readLong=function(){var e=this;if(e.check())return-1;for(var t=\"\",n=0;n<8;n++){var i=e._pool[e._position++].toString(16);1===i.length&&(i=\"0\"+i),t+=i}return parseInt(t,16)},e.prototype.readByte=function(){if(this.check())return-1;var e=this._pool[this._position++];return e>255&&(e&=255),e},e.prototype.readUTF=function(){if(this.check())return\"\";var e=this.readByte()<<8|this.readByte(),t=this._pool.subarray(this._position,this._position+=e);return Ct.readUTF(t)},e.prototype.readAll=function(){return this._pool.subarray(this._position,this._poolLen)},e}(),St=function(){function e(){this._pool=[],this._position=0,this._writen=0}return e.prototype.write=function(e){return-1!==Object.prototype.toString.call(e).indexOf(\"Array\")?this._pool=this._pool.concat(e):e>=0&&(e>255&&(e&=255),this._pool.push(e),this._writen++),e},e.prototype.writeArr=function(e){return this._pool=this._pool.concat(e),e},e.prototype.writeUTF=function(e){var t=Ct.writeUTF(e);this._pool=this._pool.concat(t),this._writen+=t.length},e.prototype.getBytesArray=function(){return this._pool},e}(),Nt=\"UpStreamMessage\",Ot=\"PushExtra\",wt=\"DownStreamMessage\",bt=\"DownStreamMessages\",Mt=\"SessionsAttQryInput\",At=\"SessionsAttOutput\",Ut=\"SyncRequestMsg\",Lt=\"ChrmPullMsg\",Pt=\"NotifyMsg\",Dt=\"HistoryMsgInput\",Vt=\"HistoryMsgOuput\",kt=\"RelationQryInput\",xt=\"RelationsOutput\",Bt=\"DeleteSessionsInput\",Ft=\"SessionInfo\",Kt=\"DeleteSessionsOutput\",qt=\"RelationsInput\",Yt=\"DeleteMsgInput\",Ht=\"CleanHisMsgInput\",Gt=\"SessionMsgReadInput\",jt=\"ChrmInput\",Qt=\"ChrmOutput\",Wt=\"QueryChatRoomInfoInput\",Jt=\"QueryChatRoomInfoOutput\",zt=\"RtcInput\",Zt=\"RtcUserListOutput\",Xt=\"SetUserStatusInput\",$t=\"RtcSetDataInput\",en=\"RtcUserSetDataInput\",tn=\"RtcDataInput\",nn=\"RtcSetOutDataInput\",rn=\"MCFollowInput\",sn=\"RtcTokenOutput\",on=\"RtcQryOutput\",an=\"RtcQryUserOutDataInput\",un=\"RtcUserOutDataOutput\",cn=\"RtcQueryListInput\",hn=\"RtcRoomInfoOutput\",ln=\"RtcValueInfo\",dn=\"RtcKeyDeleteInput\",fn=\"GetQNupTokenInput\",pn=\"GetQNupTokenOutput\",gn=\"GetQNdownloadUrlInput\",_n=\"GetDownloadUrlInput\",yn=\"GetQNdownloadUrlOutput\",vn=\"GetDownloadUrlOutput\",En=\"SetChrmKV\",mn=\"SetChrmKVS\",In=\"DeleteChrmKVS\",Tn=\"ChrmKVOutput\",Cn=\"ChrmKVSOutput\",Rn=\"ChrmKVSOutputEntity\",Sn=\"QueryChrmKV\",Nn=\"SetUserSettingInput\",On=\"SetUserSettingOutput\",wn=\"PullUserSettingInput\",bn=\"PullUserSettingOutput\",Mn=\"UserSettingNotification\",An=\"SessionReq\",Un=\"SessionStates\",Ln=\"SessionState\",Pn=\"SessionStateItem\",Dn=\"SessionStateModifyReq\",Vn=\"SessionStateModifyResp\",kn=\"GrpReadReceiptMsg\",xn=\"GrpReadReceiptQryReq\",Bn=\"GrpReadReceiptQryResp\",Fn=\"GrpMsgReadUser\",Kn=\"SessionTagAddInput\",qn=\"SessionTagItem\",Yn=\"SessionTagDelInput\",Hn=\"SessionDisTagReq\",Gn=\"ReportSDKInput\",jn=\"ReportSDKOutput\",Qn=\"RtcNotifyMsg\",Wn=\"RtcPullKV\",Jn=\"RtcKVOutput\",zn=\"RtcQueryUserJoinedInput\",Zn=\"RtcQueryUserJoinedOutput\",Xn=\"RtcViewerJoinedOutput\",$n=\"RtcInviteInput\",ei=\"RtcCancelInviteInput\",ti=\"RtcInviteAnswerInput\",ni=\"RtcEndInviteInput\",ii=((It={})[Nt]=[\"sessionId\",\"classname\",\"content\",\"pushText\",\"userId\",\"configFlag\",\"appData\",\"extraContent\",\"pushExt\",\"busChannel\"],It[bt]=[\"list\",\"syncTime\",\"finished\"],It[wt]=[\"fromUserId\",\"type\",\"groupId\",\"classname\",\"content\",\"dataTime\",\"status\",\"msgId\",\"extraContent\",\"pushContent\",\"configFlag\",\"pushExt\",\"busChannel\"],It[Ot]=[\"title\",\"templateIdNoUse\",\"pushId\",\"pushConfigs\",\"templateId\"],It[Mt]=[\"nothing\"],It[At]=[\"inboxTime\",\"sendboxTime\",\"totalUnreadCount\"],It[Ut]=[\"syncTime\",\"ispolling\",\"isweb\",\"isPullSend\",\"isKeeping\",\"sendBoxSyncTime\"],It[Lt]=[\"syncTime\",\"count\"],It[Pt]=[\"type\",\"time\",\"chrmId\"],It[Dt]=[\"targetId\",\"time\",\"count\",\"order\",\"busChannel\"],It[Vt]=[\"list\",\"syncTime\",\"hasMsg\"],It[kt]=[\"type\",\"count\",\"startTime\",\"order\"],It[xt]=[\"info\"],It[Bt]=[\"sessions\"],It[Ft]=[\"type\",\"channelId\",\"busChannel\"],It[Kt]=[\"nothing\"],It[qt]=[\"type\",\"msg\",\"count\",\"busChannel\",\"startTime\",\"endTime\"],It[Yt]=[\"type\",\"conversationId\",\"msgs\",\"busChannel\"],It[Ht]=[\"targetId\",\"dataTime\",\"conversationType\",\"busChannel\"],It[Gt]=[\"type\",\"msgTime\",\"channelId\"],It[jt]=[\"nothing\"],It[Qt]=[\"nothing\",\"sessionId\",\"joinTime\"],It[Wt]=[\"count\",\"order\"],It[Jt]=[\"userTotalNums\",\"userInfos\"],It[fn]=[\"type\",\"key\",\"httpMethod\",\"queryString\"],It[gn]=[\"type\",\"key\",\"fileName\"],It[_n]=[\"type\",\"key\",\"fileName\"],It[pn]=[\"deadline\",\"token\",\"bosToken\",\"bosDate\",\"path\",\"osskeyId\",\"ossPolicy\",\"ossSign\",\"ossBucketName\"],It[yn]=[\"downloadUrl\"],It[vn]=[\"downloadUrl\"],It[En]=[\"entry\",\"bNotify\",\"notification\",\"type\"],It[mn]=[\"entry\",\"bNotify\",\"notification\",\"type\"],It[In]=[\"entry\",\"bNotify\",\"notification\",\"type\"],It[Tn]=[\"entries\",\"bFullUpdate\",\"syncTime\"],It[Cn]=[\"timestamp\",\"errorKeys\"],It[Rn]=[\"key\",\"errorCode\"],It[Sn]=[\"timestamp\"],It[Nn]=[\"version\",\"value\"],It[On]=[\"version\",\"reserve\"],It[wn]=[\"version\",\"reserve\"],It[bn]=[\"items\",\"version\"],It.UserSettingItem=[\"targetId\",\"type\",\"key\",\"value\",\"version\",\"status\",\"tags\"],It[An]=[\"time\"],It[Un]=[\"version\",\"state\"],It[Ln]=[\"type\",\"channelId\",\"time\",\"stateItem\",\"busChannel\"],It[Pn]=[\"sessionStateType\",\"value\",\"tags\"],It[Dn]=[\"version\",\"state\"],It[Vn]=[\"version\"],It[kn]=[\"msgId\",\"busChannel\"],It[xn]=[\"msgId\",\"busChannel\"],It[Bn]=[\"totalMemberNum\",\"list\"],It[Fn]=[\"readTime\",\"userId\"],It[Kn]=[\"version\",\"tags\"],It[qn]=[\"tagId\",\"name\",\"createdTime\",\"isTop\"],It[Yn]=[\"version\",\"tags\"],It[Hn]=[\"tagId\"],It[Mn]=[\"version\",\"reserve\"],It[Gn]=[\"sdkInfo\"],It[jn]=[\"nothing\"],It[zt]=[\"roomType\",\"broadcastType\",\"extraInnerData\",\"needSysChatroom\",\"identityChangeType\",\"joinType\"],It[Zt]=[\"users\",\"token\",\"sessionId\",\"roomInfo\"],It[Xt]=[\"status\"],It[$t]=[\"interior\",\"target\",\"key\",\"value\",\"objectName\",\"content\"],It[en]=[\"valueInfo\",\"objectName\",\"content\"],It[tn]=[\"interior\",\"target\",\"key\",\"objectName\",\"content\"],It[nn]=[\"target\",\"valueInfo\",\"objectName\",\"content\"],It[rn]=[\"state\"],It[sn]=[\"rtcToken\"],It[on]=[\"outInfo\"],It[an]=[\"userId\"],It[un]=[\"user\"],It[cn]=[\"order\"],It[hn]=[\"roomId\",\"roomData\",\"userCount\",\"list\"],It[ln]=[\"key\",\"value\"],It[dn]=[\"key\"],It[Qn]=[\"type\",\"time\",\"roomId\"],It[Wn]=[\"timestamp\",\"roomId\"],It[Jn]=[\"entries\",\"bFullUpdate\",\"syncTime\"],It[zn]=[\"userId\"],It[Zn]=[\"info\"],It[$n]=[\"invitedUserId\",\"timeoutTime\",\"invitedRoomId\",\"inviteInfo\",\"inviteSessionId\"],It[ei]=[\"invitedUserId\",\"invitedRoomId\",\"inviteInfo\",\"inviteSessionId\"],It[ti]=[\"inviteUserID\",\"answerCode\",\"inviteRoomId\",\"inviteSessionId\",\"content\",\"key\",\"value\"],It[ni]=[\"inviteRoomId\",\"inviteSessionId\",\"inviteContent\",\"inviteRoomKeys\"],It),ri={},si=function(e){var t=ii[e];ri[e]=function(){for(var e={},n={getArrayData:function(){return e}},i=function(i){var r=t[i],s=\"set\"+D(r,0,1);n[s]=function(t){e[r]=t}},r=0;r<t.length;r++)i(r);return n},ri[e].decode=function(e){var t={};J(e)&&(e=JSON.parse(e));var n=function(n){var i=\"get\"+D(n,0,1);t[n]=e[n],t[i]=function(){return e[n]}};for(var i in e)n(i);return t}};for(var oi in ii)si(oi);ri.getModule=function(e){return ri[e]()};var ai=\"\\npackage Modules;\\nmessage probuf {\\n  message \"+Xt+\"\\n  {\\n    optional int32 status=1;\\n  }\\n\\n  message SetUserStatusOutput\\n  {\\n    optional int32 nothing=1;\\n  }\\n\\n  message GetUserStatusInput\\n  {\\n    optional int32 nothing=1;\\n  }\\n\\n  message GetUserStatusOutput\\n  {\\n    optional string status=1;\\n    optional string subUserId=2;\\n  }\\n\\n  message SubUserStatusInput\\n  {\\n    repeated string userid =1;\\n  }\\n\\n  message SubUserStatusOutput\\n  {\\n    optional int32 nothing=1;\\n  }\\n  message VoipDynamicInput\\n  {\\n    required int32  engineType = 1;\\n    required string channelName = 2;\\n    optional string channelExtra = 3;\\n  }\\n\\n  message VoipDynamicOutput\\n  {\\n      required string dynamicKey=1;\\n  }\\n  message \"+Pt+\" {\\n    required int32 type = 1;\\n    optional int64 time = 2;\\n    optional string chrmId=3;\\n  }\\n  message \"+Ut+\" {\\n    required int64 syncTime = 1;\\n    required bool ispolling = 2;\\n    optional bool isweb=3;\\n    optional bool isPullSend=4;\\n    optional bool isKeeping=5;\\n    optional int64 sendBoxSyncTime=6;\\n  }\\n  message \"+Nt+\" {\\n    required int32 sessionId = 1;\\n    required string classname = 2;\\n    required bytes content = 3;\\n    optional string pushText = 4;\\n    optional string appData = 5;\\n    repeated string userId = 6;\\n    optional int64 delMsgTime = 7;\\n    optional string delMsgId = 8;\\n    optional int32 configFlag = 9;\\n    optional int64 clientUniqueId = 10;\\n    optional string extraContent = 11;\\n    optional PushExtra pushExt = 12;\\n    optional string busChannel = 13; // 该消息所属会话的业务标识\\n  }\\n  message \"+Ot+\" {\\n    optional string title = 1;\\n    optional int32  templateIdNoUse= 2;\\n    optional string pushId = 3;\\n    optional string pushConfigs = 4;\\n    optional string templateId = 5;\\n  }\\n  message \"+bt+\" {\\n    repeated DownStreamMessage list = 1;\\n    required int64 syncTime = 2;\\n    optional bool finished = 3;\\n  }\\n  message \"+wt+\" {\\n    required string fromUserId = 1;\\n    required ChannelType type = 2;\\n    optional string groupId = 3;\\n    required string classname = 4;\\n    required bytes content = 5;\\n    required int64 dataTime = 6;\\n    required int64 status = 7;\\n    optional int64 extra = 8;\\n    optional string msgId = 9;\\n    optional int32 direction = 10;\\n    optional int32 plantform =11;\\n    optional int32 isRemoved = 12;\\n    optional string source = 13;\\n    optional int64 clientUniqueId = 14;\\n    optional string extraContent = 15;\\n    optional string pushContent = 16;\\n    optional int32 configFlag = 17;\\n    optional PushExtra pushExt = 18;\\n    optional string busChannel = 19; // 该消息所属会话的业务标识，限制20字符以内\\n  }\\n  enum ChannelType {\\n    PERSON = 1;\\n    PERSONS = 2;\\n    GROUP = 3;\\n    TEMPGROUP = 4;\\n    CUSTOMERSERVICE = 5;\\n    NOTIFY = 6;\\n    MC=7;\\n    MP=8;\\n  }\\n  message CreateDiscussionInput {\\n    optional string name = 1;\\n  }\\n  message CreateDiscussionOutput {\\n    required string id = 1;\\n  }\\n  message ChannelInvitationInput {\\n    repeated string users = 1;\\n  }\\n  message LeaveChannelInput {\\n    required int32 nothing = 1;\\n  }\\n  message ChannelEvictionInput {\\n    required string user = 1;\\n  }\\n  message RenameChannelInput {\\n    required string name = 1;\\n  }\\n  message ChannelInfoInput {\\n    required int32 nothing = 1;\\n  }\\n  message ChannelInfoOutput {\\n    required ChannelType type = 1;\\n    required string channelId = 2;\\n    required string channelName = 3;\\n    required string adminUserId = 4;\\n    repeated string firstTenUserIds = 5;\\n    required int32 openStatus = 6;\\n  }\\n  message ChannelInfosInput {\\n    required int32 page = 1;\\n    optional int32 number = 2;\\n  }\\n  message ChannelInfosOutput {\\n    repeated ChannelInfoOutput channels = 1;\\n    required int32 total = 2;\\n  }\\n  message MemberInfo {\\n    required string userId = 1;\\n    required string userName = 2;\\n    required string userPortrait = 3;\\n    required string extension = 4;\\n  }\\n  message GroupMembersInput {\\n    required int32 page = 1;\\n    optional int32 number = 2;\\n  }\\n  message GroupMembersOutput {\\n    repeated MemberInfo members = 1;\\n    required int32 total = 2;\\n  }\\n  message GetUserInfoInput {\\n    required int32 nothing = 1;\\n  }\\n  message GetUserInfoOutput {\\n    required string userId = 1;\\n    required string userName = 2;\\n    required string userPortrait = 3;\\n  }\\n  message GetSessionIdInput {\\n    required int32 nothing = 1;\\n  }\\n  message GetSessionIdOutput {\\n    required int32 sessionId = 1;\\n  }\\n  enum FileType {\\n    image = \"+W.IMAGE+\";\\n    audio = \"+W.AUDIO+\";\\n    video = \"+W.VIDEO+\";\\n    file = \"+W.FILE+\";\\n  }\\n  message \"+fn+\" {\\n    required FileType type = 1;\\n    optional string key = 2;\\n    optional string httpMethod = 3;\\n    optional string queryString = 4;\\n  }\\n  message \"+gn+\" {\\n    required FileType type = 1;\\n    required string key = 2;\\n    optional string  fileName = 3;\\n  }\\n  message \"+_n+\" {\\n    required FileType type = 1;\\n    required string key = 2;\\n    optional string fileName = 3;\\n   }\\n  message \"+pn+\" {\\n    required int64 deadline = 1;\\n    required string token = 2;\\n    optional string bosToken = 3;\\n    optional string bosDate = 4;\\n    optional string path = 5;\\n    optional string osskeyId = 6;\\n    optional string ossPolicy = 7;\\n    optional string ossSign = 8;\\n    optional string ossBucketName = 9;\\n    optional string s3Credential = 10;\\n    optional string s3Algorithm = 11;\\n    optional string s3Date = 12;\\n    optional string s3Policy = 13;\\n    optional string s3Signature = 14;\\n    optional string s3BucketName = 15;\\n    optional string stcAuthorization = 16;\\n    optional string stcContentSha256 = 17;\\n    optional string stcDate = 18;\\n    optional string stcBucketName = 19;\\n  }\\n  message \"+yn+\" {\\n    required string downloadUrl = 1;\\n  }\\n  message \"+vn+\" {\\n    required string downloadUrl = 1;\\n  }\\n  message Add2BlackListInput {\\n    required string userId = 1;\\n  }\\n  message RemoveFromBlackListInput {\\n    required string userId = 1;\\n  }\\n  message QueryBlackListInput {\\n    required int32 nothing = 1;\\n  }\\n  message QueryBlackListOutput {\\n    repeated string userIds = 1;\\n  }\\n  message BlackListStatusInput {\\n    required string userId = 1;\\n  }\\n  message BlockPushInput {\\n    required string blockeeId = 1;\\n  }\\n  message ModifyPermissionInput {\\n    required int32 openStatus = 1;\\n  }\\n  message GroupInput {\\n    repeated GroupInfo groupInfo = 1;\\n  }\\n  message GroupOutput {\\n    required int32 nothing = 1;\\n  }\\n  message GroupInfo {\\n    required string id = 1;\\n    required string name = 2;\\n  }\\n  message GroupHashInput {\\n    required string userId = 1;\\n    required string groupHashCode = 2;\\n  }\\n  message GroupHashOutput {\\n    required GroupHashType result = 1;\\n  }\\n  enum GroupHashType {\\n    group_success = 0x00;\\n    group_failure = 0x01;\\n  }\\n  message \"+jt+\" {\\n    required int32 nothing = 1;\\n  }\\n  message \"+Qt+\" {\\n    required int32 nothing = 1;\\n    optional string sessionId = 2;\\n    optional int64 joinTime = 3;\\n  }\\n  message \"+Lt+\" {\\n    required int64 syncTime = 1;\\n    required int32 count = 2;\\n  }\\n\\n  message ChrmPullMsgNew\\n  {\\n    required int32 count = 1;\\n    required int64 syncTime = 2;\\n    optional string chrmId=3;\\n  }\\n  message \"+kt+\"\\n  {\\n    optional ChannelType type = 1;\\n    optional int32 count = 2;\\n    optional int64 startTime = 3;\\n    optional int32 order = 4;\\n  }\\n  message \"+qt+\"\\n  {\\n    required ChannelType type = 1;\\n    optional DownStreamMessage msg =2;\\n    optional int32 count = 3;\\n    optional string busChannel = 4;\\n    optional int64 startTime = 5;\\n    optional int64 endTime = 6;\\n  }\\n  message \"+xt+\"\\n  {\\n    repeated RelationInfo info = 1;\\n  }\\n  message RelationInfo\\n  {\\n    required ChannelType type = 1;\\n    required string userId = 2;\\n    optional DownStreamMessage msg =3;\\n    optional int64 readMsgTime= 4;\\n    optional int64 unreadCount= 5;\\n    optional string busChannel = 6;//该消息所属会话的业务标识\\n  }\\n  message RelationInfoReadTime\\n  {\\n    required ChannelType type = 1;\\n    required int64 readMsgTime= 2;\\n    required string targetId = 3;\\n  }\\n  message \"+Ht+\"\\n  {\\n      required string targetId = 1;\\n      required int64 dataTime = 2;\\n      optional int32 conversationType= 3;\\n      optional string busChannel = 4; //该消息所属会话的业务标识，限制20字符以内\\n  }\\n  message HistoryMessageInput\\n  {\\n    required string targetId = 1;\\n    required int64 dataTime =2;\\n    required int32 size  = 3;\\n  }\\n\\n  message HistoryMessagesOuput\\n  {\\n    repeated DownStreamMessage list = 1;\\n    required int64 syncTime = 2;\\n    required int32 hasMsg = 3;\\n  }\\n  message \"+Wt+\"\\n  {\\n    required int32 count= 1;\\n    optional int32 order= 2;\\n  }\\n\\n  message \"+Jt+\"\\n  {\\n    optional int32 userTotalNums = 1;\\n    repeated ChrmMember userInfos = 2;\\n  }\\n  message ChrmMember\\n  {\\n    required int64 time = 1;\\n    required string id = 2;\\n  }\\n  message MPFollowInput\\n  {\\n    required string id = 1;\\n  }\\n\\n  message MPFollowOutput\\n  {\\n    required int32 nothing = 1;\\n    optional MpInfo info =2;\\n  }\\n\\n  message \"+rn+\"\\n  {\\n    required string state = 1;\\n  }\\n\\n  message MCFollowOutput\\n  {\\n    required int32 nothing = 1;\\n    optional MpInfo info =2;\\n  }\\n\\n  message MpInfo\\n  {\\n    required string mpid=1;\\n    required string name = 2;\\n    required string type = 3;\\n    required int64 time=4;\\n    optional string portraitUrl=5;\\n    optional string extra =6;\\n  }\\n\\n  message SearchMpInput\\n  {\\n    required int32 type=1;\\n    required string id=2;\\n  }\\n\\n  message SearchMpOutput\\n  {\\n    required int32 nothing=1;\\n    repeated MpInfo info = 2;\\n  }\\n\\n  message PullMpInput\\n  {\\n    required int64 time=1;\\n    required string mpid=2;\\n  }\\n\\n  message PullMpOutput\\n  {\\n    required int32 status=1;\\n    repeated MpInfo info = 2;\\n  }\\n  message \"+Dt+\"\\n  {\\n    optional string targetId = 1;\\n    optional int64 time = 2;\\n    optional int32 count  = 3;\\n    optional int32 order = 4;\\n    optional string busChannel = 5; //该消息所属会话的业务标识，限制20字符以内\\n  }\\n\\n  message \"+Vt+\"\\n  {\\n    repeated DownStreamMessage list=1;\\n    required int64 syncTime=2;\\n    required int32 hasMsg=3;\\n  }\\n  message \"+cn+\"{\\n    optional int32 order=1;\\n  }\\n\\n  message \"+dn+\"{\\n    repeated string key=1;\\n  }\\n\\n  message \"+ln+\"{\\n    required string key=1;\\n    required string value=2;\\n  }\\n\\n  message RtcUserInfo{\\n    required string userId=1;\\n    repeated \"+ln+\" userData=2; //用户资源信息\\n  }\\n\\n  message \"+Zt+\"{\\n    repeated RtcUserInfo users=1;\\n    optional string token=2;\\n    optional string sessionId=3;\\n    repeated RtcValueInfo roomInfo = 4; //房间key value\\n    repeated RtcKVEntity entries = 5;//直播KV属性对象集合\\n    optional int64 syncTime = 6;//所有属性的最大时间戳（下次拉取KV时用）。\\n    optional int32 offlineKickTime = 7;//server超时踢人时间，默认60s\\n  }\\n  message RtcRoomInfoOutput{\\n    optional string roomId = 1;\\n    repeated \"+ln+\" roomData = 2;\\n    optional int32 userCount = 3;\\n    repeated RtcUserInfo list=4;\\n  }\\n  message \"+zt+\"{\\n    required int32 roomType=1;\\n    optional int32 broadcastType=2;\\n    optional RtcValueInfo extraInnerData = 3;\\n    optional bool needSysChatroom = 4; //是否需要同步聊天室\\n    optional IdentityChangeType identityChangeType = 5; //身份变更类型\\n    optional JoinType joinType = 6; // 加入房间类型\\n    repeated \"+ln+\" innerDatas = 7; //用户内部inner数据，角色或者连麦信息等\\n    repeated \"+ln+\" outerDatas = 8; //用户内部outer数据，自定义数据结构RtcInput。\\n  }\\n  enum JoinType {\\n    KICK = 0; //踢前一个设备\\n    REFUSE = 1; //当前加入拒绝\\n    COEXIST = 2; //两个设备共存\\n  }\\n  message RtcQryInput{\\n    required bool isInterior=1;\\n    required targetType target=2;\\n    repeated string key=3;\\n  }\\n  message \"+on+\"{\\n    repeated \"+ln+\" outInfo=1;\\n  }\\n  message RtcDelDataInput{\\n    repeated string key=1;\\n    required bool isInterior=2;\\n    required targetType target=3;\\n  }\\n  message \"+tn+\"{\\n    required bool interior=1;\\n    required targetType target=2;\\n    repeated string key=3;\\n    optional string objectName=4;\\n    optional string content=5;\\n  }\\n  message \"+$t+\"{\\n    required bool interior=1;\\n    required targetType target=2;\\n    required string key=3;\\n    required string value=4;\\n    optional string objectName=5;\\n    optional string content=6;\\n  }\\n  message \"+en+\" {\\n    repeated \"+ln+\" valueInfo = 1;\\n    required string objectName = 2;\\n    repeated \"+ln+\" content = 3;\\n  }\\n  message RtcOutput\\n  {\\n    optional int32 nothing=1;\\n  }\\n  message \"+sn+\"{\\n    required string rtcToken=1;\\n  }\\n  enum targetType {\\n    ROOM =1 ;\\n    PERSON = 2;\\n  }\\n  message \"+nn+\"{\\n    required targetType target=1;\\n    repeated \"+ln+\" valueInfo=2;\\n    optional string objectName=3;\\n    optional string content=4;\\n  }\\n  message \"+an+\"{\\n    repeated string userId = 1;\\n  }\\n  message \"+un+\"{\\n    repeated RtcUserInfo user = 1;\\n  }\\n  message \"+Mt+\"{\\n    required int32 nothing = 1;\\n  }\\n  message \"+At+\"{\\n    required int64 inboxTime = 1;\\n    required int64 sendboxTime = 2;\\n    required int64 totalUnreadCount = 3;\\n  }\\n  message \"+Gt+\"\\n  {\\n    required ChannelType type = 1;\\n    required int64 msgTime = 2;\\n    required string channelId = 3;\\n  }\\n  message SessionMsgReadOutput\\n  {\\n    optional int32 nothing=1;\\n  }\\n  message \"+Bt+\"\\n  {\\n    repeated SessionInfo sessions = 1;\\n  }\\n  message \"+Ft+\"\\n  {\\n    required ChannelType type = 1;\\n    required string channelId = 2;\\n    optional string busChannel = 3;//所属会话业务标识\\n  }\\n  message \"+Kt+\"\\n  {\\n    optional int32 nothing=1;\\n  }\\n  message \"+Yt+\"\\n  {\\n    optional ChannelType type = 1;\\n    optional string conversationId = 2;\\n    repeated DeleteMsg msgs = 3;\\n    optional string busChannel = 4; //该消息所属会话的业务标识，限制20字符以内\\n  }\\n  message DeleteMsg\\n  {\\n    optional string msgId = 1;\\n    optional int64 msgDataTime = 2;\\n    optional int32 direct = 3;\\n  }\\n  message ChrmKVEntity {\\n    required string key = 1;\\n    required string value = 2;\\n    optional int32 status = 3;\\n    optional int64 timestamp = 4;\\n    optional string uid = 5;\\n  }\\n  message \"+En+\" {\\n    required ChrmKVEntity entry = 1;\\n    optional bool bNotify = 2;\\n    optional UpStreamMessage notification = 3;\\n    optional ChannelType type = 4;\\n  }\\n  message \"+mn+\" {\\n    repeated ChrmKVEntity entry = 1;\\n    optional bool bNotify = 2;\\n    optional UpStreamMessage notification = 3;\\n    optional ChannelType type = 4;\\n  }\\n  message \"+In+\" {\\n    repeated ChrmKVEntity entry = 1;\\n    optional bool bNotify = 2;\\n    optional UpStreamMessage notification = 3;\\n    optional ChannelType type = 4;\\n  }\\n  message \"+Tn+\" {\\n    repeated ChrmKVEntity entries = 1;\\n    optional bool bFullUpdate = 2;\\n    optional int64 syncTime = 3;\\n  }\\n  message \"+Cn+\" {\\n    repeated ChrmKVSOutputEntity errorKeys = 1;\\n  }\\n  message \"+Rn+\"\\n  {\\n    optional string key = 1;\\n    optional int32 errorCode = 2;\\n  }\\n  message \"+Sn+\" {\\n    required int64 timestamp = 1;\\n  }\\n  message \"+Nn+\" {\\n    required int64 version=1;\\n    required string value=2;\\n  }\\n  message \"+On+\" {\\n    required int64 version=1;\\n    required bool reserve=2;\\n  }\\n  message \"+wn+\" {\\n    required int64 version=1;\\n    optional bool reserve=2;\\n  }\\n  message \"+bn+\" {\\n    repeated UserSettingItem items = 1;\\n    required int64 version=2;\\n  }\\n  message UserSettingItem {\\n    required string targetId= 1;\\n    required ChannelType type = 2;\\n    required string key = 4;\\n    required bytes value = 5;\\n    required int64 version=6;\\n    required int32 status=7;\\n    repeated SessionTagItem tags= 8;\\n  }\\n  message \"+An+\" {\\n    required int64 time = 1;\\n  }\\n  message \"+Un+\" {\\n    required int64 version=1;\\n    repeated SessionState state= 2;\\n  }\\n  message \"+Ln+\" {\\n    required ChannelType type = 1;\\n    required string channelId = 2;\\n    optional int64 time = 3;\\n    repeated SessionStateItem stateItem = 4;\\n    optional string busChannel = 5;//该消息所属会话的业务标识\\n  }\\n  message \"+Pn+\" {\\n    required SessionStateType sessionStateType = 1;\\n    required string value = 2;\\n    repeated SessionTagItem tags = 3;\\n  }\\n  enum SessionStateType {\\n    IsSilent = 1;\\n    IsTop = 2;\\n    Tags = 3;\\n  }\\n  message \"+Dn+\" {\\n    required int64 version=1;\\n    repeated SessionState state= 2;\\n  }\\n  message \"+Vn+\" {\\n    required int64 version=1;\\n  }\\n  message \"+kn+\" {\\n    repeated string msgId=1; //已读消息ID\\n    optional string channelId = 2; // 该消息所属会话的业务标识\\n  }\\n  message \"+xn+\" {\\n    repeated string msgId=1; //已读消息ID\\n    optional string channelId = 2; // 该消息所属会话的业务标识\\n  }\\n  message \"+Bn+\" {\\n    required int32 totalMemberNum = 1;//群内总人数\\n    repeated GrpMsgReadUser list = 2;//已读用户列表（list复类型）\\n  }\\n  message \"+Fn+\" {\\n    required int64 readTime = 1;//已读时间\\n    required string userId = 2;//已读用户id\\n  }\\n  message \"+Kn+\" {\\n    required int64 version=1;\\n    repeated SessionTagItem tags=2;\\n  }\\n  message \"+qn+\" {\\n    required string tagId=1;\\n    optional string name=2;\\n    optional int64 createdTime=3;\\n    optional bool isTop=4;\\n  }\\n  message \"+Yn+\" {\\n    required int64 version=1;\\n    repeated SessionTagItem tags=2;\\n  }\\n  message \"+Hn+\" {\\n    repeated string tagId=1;\\n  }\\n  message \"+Mn+\" {\\n    required int64 version=1;\\n    required bool reserve=2;\\n  }\\n  message \"+Gn+' {\\n    required string sdkInfo=1; // 用户集成的 sdk 信息,json 格式 {\"web-rtc\": \"4.0.3.7\"}\\n  }\\n  message '+jn+\"\\n  {\\n    optional int32 nothing=1; //占位\\n  }\\n  message \"+Qn+\" \\n  {\\n    required int32 type= 1;   //(通知类型 1:rtc房间状态KV变更通知)\\n    optional int64 time= 2;   //消息产生时间\\n    optional string roomId=3; //主播房间id\\n  }\\n  message \"+Wn+\"\\n  {\\n    required int64 timestamp = 1;\\n    required string roomId = 2;\\n  }\\n  message \"+Jn+\"\\n  {\\n    repeated RtcKVEntity entries = 1;\\n    optional bool bFullUpdate = 2;\\n    optional int64 syncTime = 3; \\n  }\\n  message RtcKVEntity \\n  {\\n    required string key = 1;\\n    required string value = 2;\\n    optional int32 status = 3;\\n    optional int64 timestamp = 4;\\n    optional string uid = 5;\\n  }\\n  enum IdentityChangeType \\n  {\\n    AnchorToViewer = 1; //1为主播变观众\\n    ViewerToAnchor = 2; //2为观众变主播\\n  }\\n  message \"+zn+\"\\n  {\\n    required string userId = 1;\\n  }\\n  message \"+Zn+\"\\n  {\\n    repeated RtcJoinedInfo info = 1;\\n  }\\n  message RtcJoinedInfo\\n  {\\n    required string deviceId = 1; //设备ID\\n    required string roomId = 2;   //加入的房间ID\\n    optional int64 joinTime = 3;  //加入的时间\\n  }\\n  message \"+Xn+\"\\n  {\\n    required string rtcToken=1;\\n    repeated RtcKVEntity entries = 2;//KV属性对象集合\\n    optional int64 syncTime = 3;//所有属性的最大时间戳（下次拉取KV时用）。\\n  }\\n  message \"+$n+\"\\n  {\\n    required string invitedUserId=1;    //被邀请的人的uid\\n    optional int32  timeoutTime=2;       //邀请超时时间(秒),默认三十秒\\n    required string invitedRoomId=3;    //被邀请的房间\\n    required string inviteInfo=4;       //邀请的信息(包含邀请人,被邀请人,各自userid)客户端定义好.协议栈和server透传\\n    required string inviteSessionId= 5; //客户端保证唯一性(建议roomid_userid_时间戳_随机数)\\n  }\\n  message \"+ei+\"\\n  {\\n    required string invitedUserId=1;   //被邀请的人的uid\\n    required string invitedRoomId=2;   //被邀请的房间\\n    required string inviteInfo=3;      //取消邀请的信息(包含邀请人,被邀请人,各自userid)客户端定义好.协议栈和server透传\\n    required string inviteSessionId=4; //邀请的sessionId,客户端发起邀请时产生\\n  }\\n  message \"+ti+\"\\n  {\\n    required string inviteUserId=1;    //邀请的人的uid\\n    required int32  answerCode=2;      //是否接受连麦邀请.0为拒绝,1为接受\\n    required string inviteRoomId=3;    //邀请的房间\\n    required string inviteSessionId=4; //邀请的sessionId\\n    required string content=5;         //需要转发的content\\n    optional string key=6;             //如果接受的话,需要加这个字段,放在room级别的k和v,新加入房间的能拉取到\\n    optional string value=7;           //如果接受的话,需要加这个字段,放在room级别的k和v,新加入房间的能拉取到\\n  }\\n  message \"+ni+\"\\n  {\\n    required string inviteRoomId=1;    //邀请的房间\\n    required string inviteSessionId=2; //邀请的sessionId\\n    required string inviteContent=3;   //结束连麦的信息(需要透传给房间内其他人)\\n    repeated string inviteRoomKeys=4;  //需要删除连麦的信息的key\\n  }\\n}\\n\";var ui,ci,hi,li,di,fi=(ui=ai,function(e,t){var n,i,r={};return r.ByteBuffer=e,r.c=e,n=e,r.Long=t||null,r.VERSION=\"5.0.1\",r.WIRE_TYPES={},r.WIRE_TYPES.VARINT=0,r.WIRE_TYPES.BITS64=1,r.WIRE_TYPES.LDELIM=2,r.WIRE_TYPES.STARTGROUP=3,r.WIRE_TYPES.ENDGROUP=4,r.WIRE_TYPES.BITS32=5,r.PACKABLE_WIRE_TYPES=[r.WIRE_TYPES.VARINT,r.WIRE_TYPES.BITS64,r.WIRE_TYPES.BITS32],r.TYPES={int32:{name:\"int32\",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:\"uint32\",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:\"sint32\",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:\"int64\",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.ZERO:void 0},uint64:{name:\"uint64\",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.UZERO:void 0},sint64:{name:\"sint64\",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.ZERO:void 0},bool:{name:\"bool\",wireType:r.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:\"double\",wireType:r.WIRE_TYPES.BITS64,defaultValue:0},string:{name:\"string\",wireType:r.WIRE_TYPES.LDELIM,defaultValue:\"\"},bytes:{name:\"bytes\",wireType:r.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:\"fixed32\",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:\"sfixed32\",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:\"fixed64\",wireType:r.WIRE_TYPES.BITS64,defaultValue:r.Long?r.Long.UZERO:void 0},sfixed64:{name:\"sfixed64\",wireType:r.WIRE_TYPES.BITS64,defaultValue:r.Long?r.Long.ZERO:void 0},float:{name:\"float\",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:\"enum\",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},message:{name:\"message\",wireType:r.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:\"group\",wireType:r.WIRE_TYPES.STARTGROUP,defaultValue:null}},r.MAP_KEY_TYPES=[r.TYPES.int32,r.TYPES.sint32,r.TYPES.sfixed32,r.TYPES.uint32,r.TYPES.fixed32,r.TYPES.int64,r.TYPES.sint64,r.TYPES.sfixed64,r.TYPES.uint64,r.TYPES.fixed64,r.TYPES.bool,r.TYPES.string,r.TYPES.bytes],r.ID_MIN=1,r.ID_MAX=536870911,r.convertFieldsToCamelCase=!1,r.populateAccessors=!0,r.populateDefaults=!0,r.Util=function(){var e={};return e.IS_NODE=!(\"object\"!=typeof process||process+\"\"!=\"[object process]\"||process.browser),e.XHR=function(){var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject(\"Msxml2.XMLHTTP\")},function(){return new ActiveXObject(\"Msxml3.XMLHTTP\")},function(){return new ActiveXObject(\"Microsoft.XMLHTTP\")}],n=null;for(e=0;e<t.length;e++){try{n=t[e]()}catch(e){continue}break}if(!n)throw Error(\"XMLHttpRequest is not supported\");return n},e.fetch=function(t,n){if(n&&\"function\"!=typeof n&&(n=null),e.IS_NODE)if(n)g.readFile(t,(function(e,t){n(e?null:\"\"+t)}));else try{return g.readFileSync(t)}catch(e){return null}else{var i=e.XHR();if(i.open(\"GET\",t,!!n),i.setRequestHeader(\"Accept\",\"text/plain\"),\"function\"==typeof i.overrideMimeType&&i.overrideMimeType(\"text/plain\"),!n)return i.send(null),200==i.status||0==i.status&&\"string\"==typeof i.responseText?i.responseText:null;if(i.onreadystatechange=function(){4==i.readyState&&(200==i.status||0==i.status&&\"string\"==typeof i.responseText?n(i.responseText):n(null))},4==i.readyState)return;i.send(null)}},e.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,(function(e,t){return t.toUpperCase()}))},e}(),r.Lang={DELIM:/[\\s\\{\\}=;:\\[\\],'\"\\(\\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\\s/,STRING:/(?:\"([^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\")|(?:'([^'\\\\]*(?:\\\\.[^'\\\\]*)*)')/g,STRING_DQ:/(?:\"([^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\")/g,STRING_SQ:/(?:'([^'\\\\]*(?:\\\\.[^'\\\\]*)*)')/g},r.DotProto=function(e,t){function n(e,n){var i=-1,r=1;if(\"-\"==e.charAt(0)&&(r=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))i=parseInt(e);else if(t.NUMBER_HEX.test(e))i=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error(\"illegal id value: \"+(r<0?\"-\":\"\")+e);i=parseInt(e.substring(1),8)}if(i=0|r*i,!n&&i<0)throw Error(\"illegal id value: \"+(r<0?\"-\":\"\")+e);return i}function i(e){var n=1;if(\"-\"==e.charAt(0)&&(n=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return n*parseInt(e,10);if(t.NUMBER_HEX.test(e))return n*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return n*parseInt(e.substring(1),8);if(\"inf\"===e)return 1/0*n;if(\"nan\"===e)return NaN;if(t.NUMBER_FLT.test(e))return n*parseFloat(e);throw Error(\"illegal number value: \"+(n<0?\"-\":\"\")+e)}function r(e,t,n){void 0===e[t]?e[t]=n:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(n))}var s,o,a={},u=function(e){this.source=e+\"\",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},c=u.prototype;return c._readString=function(){var e,n='\"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;if(n.lastIndex=this.index-1,!(e=n.exec(this.source)))throw Error(\"unterminated string\");return this.index=n.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,e[1]},c.next=function(){var e,n,i,r,s;if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();do{for(e=!1;t.WHITESPACE.test(i=this.source.charAt(this.index));)if(\"\\n\"===i&&++this.line,++this.index===this.source.length)return null;if(\"/\"===this.source.charAt(this.index))if(++this.index,\"/\"===this.source.charAt(this.index)){for(;\"\\n\"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if(\"*\"!==(i=this.source.charAt(this.index)))return\"/\";do{if(\"\\n\"===i&&++this.line,++this.index===this.source.length)return null;n=i,i=this.source.charAt(this.index)}while(\"*\"!==n||\"/\"!==i);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;if(r=this.index,t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(r++)))for(;r<this.source.length&&!t.DELIM.test(this.source.charAt(r));)++r;return('\"'===(s=this.source.substring(this.index,this.index=r))||\"'\"===s)&&(this._stringOpen=s),s},c.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},c.skip=function(e){var t=this.next();if(t!==e)throw Error(\"illegal '\"+t+\"', '\"+e+\"' expected\")},c.omit=function(e){return this.peek()===e&&(this.next(),!0)},c.toString=function(){return\"Tokenizer (\"+this.index+\"/\"+this.source.length+\" at line \"+this.line+\")\"},a.Tokenizer=u,(o=(s=function(e){this.tn=new u(e),this.proto3=!1}).prototype).parse=function(){var e,n={name:\"[ROOT]\",package:null,messages:[],enums:[],imports:[],options:{},services:[]},i=!0;try{for(;e=this.tn.next();)switch(e){case\"package\":if(!i||null!==n.package)throw Error(\"unexpected 'package'\");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error(\"illegal package name: \"+e);this.tn.skip(\";\"),n.package=e;break;case\"import\":if(!i)throw Error(\"unexpected 'import'\");\"public\"===(e=this.tn.peek())&&this.tn.next(),e=this._readString(),this.tn.skip(\";\"),n.imports.push(e);break;case\"syntax\":if(!i)throw Error(\"unexpected 'syntax'\");this.tn.skip(\"=\"),\"proto3\"===(n.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(\";\");break;case\"message\":this._parseMessage(n,null),i=!1;break;case\"enum\":this._parseEnum(n),i=!1;break;case\"option\":this._parseOption(n);break;case\"service\":this._parseService(n);break;case\"extend\":this._parseExtend(n);break;default:throw Error(\"unexpected '\"+e+\"'\")}}catch(e){throw e.message=\"Parse error at line \"+this.tn.line+\": \"+e.message,e}return delete n.name,n},s.parse=function(e){return new s(e).parse()},o._readString=function(){var e,t,n=\"\";do{if(\"'\"!==(t=this.tn.next())&&'\"'!==t)throw Error(\"illegal string delimiter: \"+t);n+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('\"'===e||'\"'===e);return n},o._readValue=function(e){var n=this.tn.peek();if('\"'===n||\"'\"===n)return this._readString();if(this.tn.next(),t.NUMBER.test(n))return i(n);if(t.BOOL.test(n))return\"true\"===n.toLowerCase();if(e&&t.TYPEREF.test(n))return n;throw Error(\"illegal value: \"+n)},o._parseOption=function(e,n){var i,r=this.tn.next(),s=!1;if(\"(\"===r&&(s=!0,r=this.tn.next()),!t.TYPEREF.test(r))throw Error(\"illegal option name: \"+r);i=r,s&&(this.tn.skip(\")\"),i=\"(\"+i+\")\",r=this.tn.peek(),t.FQTYPEREF.test(r)&&(i+=r,this.tn.next())),this.tn.skip(\"=\"),this._parseOptionValue(e,i),n||this.tn.skip(\";\")},o._parseOptionValue=function(e,n){var i=this.tn.peek();if(\"{\"!==i)r(e.options,n,this._readValue(!0));else for(this.tn.skip(\"{\");\"}\"!==(i=this.tn.next());){if(!t.NAME.test(i))throw Error(\"illegal option name: \"+n+\".\"+i);this.tn.omit(\":\")?r(e.options,n+\".\"+i,this._readValue(!0)):this._parseOptionValue(e,n+\".\"+i)}},o._parseService=function(e){var n,i=this.tn.next();if(!t.NAME.test(i))throw Error(\"illegal service name at line \"+this.tn.line+\": \"+i);for(n={name:i,rpc:{},options:{}},this.tn.skip(\"{\");\"}\"!==(i=this.tn.next());)if(\"option\"===i)this._parseOption(n);else{if(\"rpc\"!==i)throw Error(\"illegal service token: \"+i);this._parseServiceRPC(n)}this.tn.omit(\";\"),e.services.push(n)},o._parseServiceRPC=function(e){var n,i,r=\"rpc\",s=this.tn.next();if(!t.NAME.test(s))throw Error(\"illegal rpc service method name: \"+s);if(n=s,i={request:null,response:null,request_stream:!1,response_stream:!1,options:{}},this.tn.skip(\"(\"),\"stream\"===(s=this.tn.next()).toLowerCase()&&(i.request_stream=!0,s=this.tn.next()),!t.TYPEREF.test(s))throw Error(\"illegal rpc service request type: \"+s);if(i.request=s,this.tn.skip(\")\"),\"returns\"!==(s=this.tn.next()).toLowerCase())throw Error(\"illegal rpc service request type delimiter: \"+s);if(this.tn.skip(\"(\"),\"stream\"===(s=this.tn.next()).toLowerCase()&&(i.response_stream=!0,s=this.tn.next()),i.response=s,this.tn.skip(\")\"),\"{\"===(s=this.tn.peek())){for(this.tn.next();\"}\"!==(s=this.tn.next());){if(\"option\"!==s)throw Error(\"illegal rpc service token: \"+s);this._parseOption(i)}this.tn.omit(\";\")}else this.tn.skip(\";\");void 0===e[r]&&(e[r]={}),e[r][n]=i},o._parseMessage=function(e,i){var r=!!i,s=this.tn.next(),o={name:\"\",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!t.NAME.test(s))throw Error(\"illegal \"+(r?\"group\":\"message\")+\" name: \"+s);for(o.name=s,r&&(this.tn.skip(\"=\"),i.id=n(this.tn.next()),o.isGroup=!0),\"[\"===(s=this.tn.peek())&&i&&this._parseFieldOptions(i),this.tn.skip(\"{\");\"}\"!==(s=this.tn.next());)if(t.RULE.test(s))this._parseMessageField(o,s);else if(\"oneof\"===s)this._parseMessageOneOf(o);else if(\"enum\"===s)this._parseEnum(o);else if(\"message\"===s)this._parseMessage(o);else if(\"option\"===s)this._parseOption(o);else if(\"service\"===s)this._parseService(o);else if(\"extensions\"===s)o.extensions=this._parseExtensionRanges();else if(\"reserved\"===s)this._parseIgnored();else if(\"extend\"===s)this._parseExtend(o);else{if(!t.TYPEREF.test(s))throw Error(\"illegal message token: \"+s);if(!this.proto3)throw Error(\"illegal field rule: \"+s);this._parseMessageField(o,\"optional\",s)}return this.tn.omit(\";\"),e.messages.push(o),o},o._parseIgnored=function(){for(;\";\"!==this.tn.peek();)this.tn.next();this.tn.skip(\";\")},o._parseMessageField=function(e,i,r){var s,o,a;if(!t.RULE.test(i))throw Error(\"illegal message field rule: \"+i);if(s={rule:i,type:\"\",name:\"\",options:{},id:0},\"map\"===i){if(r)throw Error(\"illegal type: \"+r);if(this.tn.skip(\"<\"),o=this.tn.next(),!t.TYPE.test(o)&&!t.TYPEREF.test(o))throw Error(\"illegal message field type: \"+o);if(s.keytype=o,this.tn.skip(\",\"),o=this.tn.next(),!t.TYPE.test(o)&&!t.TYPEREF.test(o))throw Error(\"illegal message field: \"+o);if(s.type=o,this.tn.skip(\">\"),o=this.tn.next(),!t.NAME.test(o))throw Error(\"illegal message field name: \"+o);s.name=o,this.tn.skip(\"=\"),s.id=n(this.tn.next()),\"[\"===(o=this.tn.peek())&&this._parseFieldOptions(s),this.tn.skip(\";\")}else if(\"group\"===(r=void 0!==r?r:this.tn.next())){if(a=this._parseMessage(e,s),!/^[A-Z]/.test(a.name))throw Error(\"illegal group name: \"+a.name);s.type=a.name,s.name=a.name.toLowerCase(),this.tn.omit(\";\")}else{if(!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error(\"illegal message field type: \"+r);if(s.type=r,o=this.tn.next(),!t.NAME.test(o))throw Error(\"illegal message field name: \"+o);s.name=o,this.tn.skip(\"=\"),s.id=n(this.tn.next()),\"[\"===(o=this.tn.peek())&&this._parseFieldOptions(s),this.tn.skip(\";\")}return e.fields.push(s),s},o._parseMessageOneOf=function(e){var n,i,r,s=this.tn.next();if(!t.NAME.test(s))throw Error(\"illegal oneof name: \"+s);for(i=s,r=[],this.tn.skip(\"{\");\"}\"!==(s=this.tn.next());)(n=this._parseMessageField(e,\"optional\",s)).oneof=i,r.push(n.id);this.tn.omit(\";\"),e.oneofs[i]=r},o._parseFieldOptions=function(e){this.tn.skip(\"[\");for(var t=!0;\"]\"!==this.tn.peek();)t||this.tn.skip(\",\"),this._parseOption(e,!0),t=!1;this.tn.next()},o._parseEnum=function(e){var i,r={name:\"\",values:[],options:{}},s=this.tn.next();if(!t.NAME.test(s))throw Error(\"illegal name: \"+s);for(r.name=s,this.tn.skip(\"{\");\"}\"!==(s=this.tn.next());)if(\"option\"===s)this._parseOption(r);else{if(!t.NAME.test(s))throw Error(\"illegal name: \"+s);this.tn.skip(\"=\"),i={name:s,id:n(this.tn.next(),!0)},\"[\"===(s=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(\";\"),r.values.push(i)}this.tn.omit(\";\"),e.enums.push(r)},o._parseExtensionRanges=function(){var t,n,r,s=[];do{for(n=[];;){switch(t=this.tn.next()){case\"min\":r=e.ID_MIN;break;case\"max\":r=e.ID_MAX;break;default:r=i(t)}if(n.push(r),2===n.length)break;if(\"to\"!==this.tn.peek()){n.push(r);break}this.tn.next()}s.push(n)}while(this.tn.omit(\",\"));return this.tn.skip(\";\"),s},o._parseExtend=function(e){var n,i=this.tn.next();if(!t.TYPEREF.test(i))throw Error(\"illegal extend reference: \"+i);for(n={ref:i,fields:[]},this.tn.skip(\"{\");\"}\"!==(i=this.tn.next());)if(t.RULE.test(i))this._parseMessageField(n,i);else{if(!t.TYPEREF.test(i))throw Error(\"illegal extend token: \"+i);if(!this.proto3)throw Error(\"illegal field rule: \"+i);this._parseMessageField(n,\"optional\",i)}return this.tn.omit(\";\"),e.messages.push(n),n},o.toString=function(){return\"Parser at line \"+this.tn.line},a.Parser=s,a}(r,r.Lang),r.Reflect=function(t){function i(e,n){if(e&&\"number\"==typeof e.low&&\"number\"==typeof e.high&&\"boolean\"==typeof e.unsigned&&e.low==e.low&&e.high==e.high)return new t.Long(e.low,e.high,void 0===n?e.unsigned:n);if(\"string\"==typeof e)return t.Long.fromString(e,n||!1,10);if(\"number\"==typeof e)return t.Long.fromNumber(e,n||!1);throw Error(\"not convertible to Long\")}function r(e,n){var i=n.readVarint32(),s=7&i,o=i>>>3;switch(s){case t.WIRE_TYPES.VARINT:do{i=n.readUint8()}while(128==(128&i));break;case t.WIRE_TYPES.BITS64:n.offset+=8;break;case t.WIRE_TYPES.LDELIM:i=n.readVarint32(),n.offset+=i;break;case t.WIRE_TYPES.STARTGROUP:r(o,n);break;case t.WIRE_TYPES.ENDGROUP:if(o===e)return!1;throw Error(\"Illegal GROUPEND after unknown group: \"+o+\" (\"+e+\" expected)\");case t.WIRE_TYPES.BITS32:n.offset+=4;break;default:throw Error(\"Illegal wire type in unknown group \"+e+\": \"+s)}return!0}var s,o,a,u,c,h,l,d,f,p,g,_,y,v,E,m,I={},T=function(e,t,n){this.builder=e,this.parent=t,this.name=n,this.className},C=T.prototype;return C.fqn=function(){for(var e=this.name,t=this;null!=(t=t.parent);)e=t.name+\".\"+e;return e},C.toString=function(e){return(e?this.className+\" \":\"\")+this.fqn()},C.build=function(){throw Error(this.toString(!0)+\" cannot be built directly\")},I.T=T,(o=(s=function(e,t,n,i,r){T.call(this,e,t,n),this.className=\"Namespace\",this.children=[],this.options=i||{},this.syntax=r||\"proto2\"}).prototype=Object.create(T.prototype)).getChildren=function(e){var t,n,i;if(null==(e=e||null))return this.children.slice();for(t=[],n=0,i=this.children.length;i>n;++n)this.children[n]instanceof e&&t.push(this.children[n]);return t},o.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof c.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof c.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error(\"Duplicate name in namespace \"+this.toString(!0)+\": \"+e.name);e.name=e.originalName}this.children.push(e)},o.getChild=function(e){var t,n,i=\"number\"==typeof e?\"id\":\"name\";for(t=0,n=this.children.length;n>t;++t)if(this.children[t][i]===e)return this.children[t];return null},o.resolve=function(e,t){var n,i=\"string\"==typeof e?e.split(\".\"):e,r=this,s=0;if(\"\"===i[s]){for(;null!==r.parent;)r=r.parent;s++}do{do{if(!(r instanceof I.Namespace)){r=null;break}if(!((n=r.getChild(i[s]))&&n instanceof I.T&&(!t||n instanceof I.Namespace))){r=null;break}r=n,s++}while(s<i.length);if(null!=r)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=r);return r},o.qn=function(e){var t,n,i=[],r=e;do{i.unshift(r.name),r=r.parent}while(null!==r);for(t=1;t<=i.length;t++)if(n=i.slice(i.length-t),e===this.resolve(n,e instanceof I.Namespace))return n.join(\".\");return e.fqn()},o.build=function(){var e,t,n,i={},r=this.children;for(t=0,n=r.length;n>t;++t)(e=r[t])instanceof s&&(i[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(i,\"$options\",{value:this.buildOpt()}),i},o.buildOpt=function(){var e,t,n,i,r={},s=Object.keys(this.options);for(e=0,t=s.length;t>e;++e)n=s[e],i=this.options[s[e]],r[n]=i;return r},o.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},I.Namespace=s,u=(a=function(e,n,i,r){if(this.type=e,this.resolvedType=n,this.isMapKey=i,this.syntax=r,i&&t.MAP_KEY_TYPES.indexOf(e)<0)throw Error(\"Invalid map key type: \"+e.name)}).prototype,a.defaultFieldValue=function(e){if(\"string\"==typeof e&&(e=t.TYPES[e]),void 0===e.defaultValue)throw Error(\"default value for type \"+e.name+\" is not supported\");return e==t.TYPES.bytes?new n(0):e.defaultValue},u.verifyValue=function(n){var r,s,o,a=function(e,t){throw Error(\"Illegal value for \"+this.toString(!0)+\" of type \"+this.type.name+\": \"+e+\" (\"+t+\")\")}.bind(this);switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return(\"number\"!=typeof n||n==n&&n%1!=0)&&a(typeof n,\"not an integer\"),n>4294967295?0|n:n;case t.TYPES.uint32:case t.TYPES.fixed32:return(\"number\"!=typeof n||n==n&&n%1!=0)&&a(typeof n,\"not an integer\"),n<0?n>>>0:n;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return i(n,!1)}catch(e){a(typeof n,e.message)}else a(typeof n,\"requires Long.js\");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return i(n,!0)}catch(e){a(typeof n,e.message)}else a(typeof n,\"requires Long.js\");case t.TYPES.bool:return\"boolean\"!=typeof n&&a(typeof n,\"not a boolean\"),n;case t.TYPES.float:case t.TYPES.double:return\"number\"!=typeof n&&a(typeof n,\"not a number\"),n;case t.TYPES.string:return\"string\"==typeof n||n&&n instanceof String||a(typeof n,\"not a string\"),\"\"+n;case t.TYPES.bytes:return e.isByteBuffer(n)?n:e.wrap(n);case t.TYPES.enum:for(r=this.resolvedType.getChildren(t.Reflect.Enum.Value),o=0;o<r.length;o++){if(r[o].name==n)return r[o].id;if(r[o].id==n)return r[o].id}if(\"proto3\"===this.syntax)return(\"number\"!=typeof n||n==n&&n%1!=0)&&a(typeof n,\"not an integer\"),(n>4294967295||n<0)&&a(typeof n,\"not in range for uint32\"),n;a(n,\"not a valid enum value\");case t.TYPES.group:case t.TYPES.message:if(n&&\"object\"==typeof n||a(typeof n,\"object expected\"),n instanceof this.resolvedType.clazz)return n;if(n instanceof t.Builder.Message){for(o in s={},n)n.hasOwnProperty(o)&&(s[o]=n[o]);n=s}return new this.resolvedType.clazz(n)}throw Error(\"[INTERNAL] Illegal value for \"+this.toString(!0)+\": \"+n+\" (undefined type \"+this.type+\")\")},u.calculateLength=function(e,i){if(null===i)return 0;var r;switch(this.type){case t.TYPES.int32:return i<0?n.calculateVarint64(i):n.calculateVarint32(i);case t.TYPES.uint32:return n.calculateVarint32(i);case t.TYPES.sint32:return n.calculateVarint32(n.zigZagEncode32(i));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES.float:return 4;case t.TYPES.int64:case t.TYPES.uint64:return n.calculateVarint64(i);case t.TYPES.sint64:return n.calculateVarint64(n.zigZagEncode64(i));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES.enum:return n.calculateVarint32(i);case t.TYPES.double:return 8;case t.TYPES.string:return r=n.calculateUTF8Bytes(i),n.calculateVarint32(r)+r;case t.TYPES.bytes:if(i.remaining()<0)throw Error(\"Illegal value for \"+this.toString(!0)+\": \"+i.remaining()+\" bytes remaining\");return n.calculateVarint32(i.remaining())+i.remaining();case t.TYPES.message:return r=this.resolvedType.calculate(i),n.calculateVarint32(r)+r;case t.TYPES.group:return(r=this.resolvedType.calculate(i))+n.calculateVarint32(e<<3|t.WIRE_TYPES.ENDGROUP)}throw Error(\"[INTERNAL] Illegal value to encode in \"+this.toString(!0)+\": \"+i+\" (unknown type)\")},u.encodeValue=function(e,i,r){var s,o;if(null===i)return r;switch(this.type){case t.TYPES.int32:i<0?r.writeVarint64(i):r.writeVarint32(i);break;case t.TYPES.uint32:r.writeVarint32(i);break;case t.TYPES.sint32:r.writeVarint32ZigZag(i);break;case t.TYPES.fixed32:r.writeUint32(i);break;case t.TYPES.sfixed32:r.writeInt32(i);break;case t.TYPES.int64:case t.TYPES.uint64:r.writeVarint64(i);break;case t.TYPES.sint64:r.writeVarint64ZigZag(i);break;case t.TYPES.fixed64:r.writeUint64(i);break;case t.TYPES.sfixed64:r.writeInt64(i);break;case t.TYPES.bool:\"string\"==typeof i?r.writeVarint32(\"false\"===i.toLowerCase()?0:!!i):r.writeVarint32(i?1:0);break;case t.TYPES.enum:r.writeVarint32(i);break;case t.TYPES.float:r.writeFloat32(i);break;case t.TYPES.double:r.writeFloat64(i);break;case t.TYPES.string:r.writeVString(i);break;case t.TYPES.bytes:if(i.remaining()<0)throw Error(\"Illegal value for \"+this.toString(!0)+\": \"+i.remaining()+\" bytes remaining\");s=i.offset,r.writeVarint32(i.remaining()),r.append(i),i.offset=s;break;case t.TYPES.message:o=(new n).LE(),this.resolvedType.encode(i,o),r.writeVarint32(o.offset),r.append(o.flip());break;case t.TYPES.group:this.resolvedType.encode(i,r),r.writeVarint32(e<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error(\"[INTERNAL] Illegal value to encode in \"+this.toString(!0)+\": \"+i+\" (unknown type)\")}return r},u.decode=function(e,n,i){if(n!=this.type.wireType)throw Error(\"Unexpected wire type for element\");var r,s;switch(this.type){case t.TYPES.int32:return 0|e.readVarint32();case t.TYPES.uint32:return e.readVarint32()>>>0;case t.TYPES.sint32:return 0|e.readVarint32ZigZag();case t.TYPES.fixed32:return e.readUint32()>>>0;case t.TYPES.sfixed32:return 0|e.readInt32();case t.TYPES.int64:return e.readVarint64();case t.TYPES.uint64:return e.readVarint64().toUnsigned();case t.TYPES.sint64:return e.readVarint64ZigZag();case t.TYPES.fixed64:return e.readUint64();case t.TYPES.sfixed64:return e.readInt64();case t.TYPES.bool:return!!e.readVarint32();case t.TYPES.enum:return e.readVarint32();case t.TYPES.float:return e.readFloat();case t.TYPES.double:return e.readDouble();case t.TYPES.string:return e.readVString();case t.TYPES.bytes:if(s=e.readVarint32(),e.remaining()<s)throw Error(\"Illegal number of bytes for \"+this.toString(!0)+\": \"+s+\" required but got only \"+e.remaining());return(r=e.clone()).limit=r.offset+s,e.offset+=s,r;case t.TYPES.message:return s=e.readVarint32(),this.resolvedType.decode(e,s);case t.TYPES.group:return this.resolvedType.decode(e,-1,i)}throw Error(\"[INTERNAL] Illegal decode type\")},u.valueFromString=function(e){if(!this.isMapKey)throw Error(\"valueFromString() called on non-map-key element\");switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return this.verifyValue(parseInt(e));case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return this.verifyValue(e);case t.TYPES.bool:return\"true\"===e;case t.TYPES.string:return this.verifyValue(e);case t.TYPES.bytes:return n.fromBinary(e)}},u.valueToString=function(e){if(!this.isMapKey)throw Error(\"valueToString() called on non-map-key element\");return this.type===t.TYPES.bytes?e.toString(\"binary\"):e.toString()},I.Element=a,(h=(c=function(e,t,n,i,r,o){s.call(this,e,t,n,i,o),this.className=\"Message\",this.extensions=void 0,this.clazz=null,this.isGroup=!!r,this._fields=null,this._fieldsById=null,this._fieldsByName=null}).prototype=Object.create(s.prototype)).build=function(i){var r,s,o,a;if(this.clazz&&!i)return this.clazz;for(r=function(t,i){function r(e,i,s,o){var a,u,c,h,l,d,f;if(null===e||\"object\"!=typeof e)return o&&o instanceof t.Reflect.Enum&&null!==(a=t.Reflect.Enum.getName(o.object,e))?a:e;if(n.isByteBuffer(e))return i?e.toBase64():e.toBuffer();if(t.Long.isLong(e))return s?e.toString():t.Long.fromValue(e);if(Array.isArray(e))return u=[],e.forEach((function(e,t){u[t]=r(e,i,s,o)})),u;if(u={},e instanceof t.Map){for(h=(c=e.entries()).next();!h.done;h=c.next())u[e.keyElem.valueToString(h.value[0])]=r(h.value[1],i,s,e.valueElem.resolvedType);return u}for(f in l=e.$type,d=void 0,e)e.hasOwnProperty(f)&&(u[f]=l&&(d=l.getChild(f))?r(e[f],i,s,d.resolvedType):r(e[f],i,s));return u}var s,o,a=i.getChildren(t.Reflect.Message.Field),u=i.getChildren(t.Reflect.Message.OneOf),c=function(e){var r,s,o,h;for(t.Builder.Message.call(this),r=0,s=u.length;s>r;++r)this[u[r].name]=null;for(r=0,s=a.length;s>r;++r)this[(o=a[r]).name]=o.repeated?[]:o.map?new t.Map(o):null,!o.required&&\"proto3\"!==i.syntax||null===o.defaultValue||(this[o.name]=o.defaultValue);if(arguments.length>0)if(1!==arguments.length||null===e||\"object\"!=typeof e||!(\"function\"!=typeof e.encode||e instanceof c)||Array.isArray(e)||e instanceof t.Map||n.isByteBuffer(e)||e instanceof ArrayBuffer||t.Long&&e instanceof t.Long)for(r=0,s=arguments.length;s>r;++r)void 0!==(h=arguments[r])&&this.$set(a[r].name,h);else this.$set(e)},h=c.prototype=Object.create(t.Builder.Message.prototype);for(h.add=function(e,n,r){var s=i._fieldsByName[e];if(!r){if(!s)throw Error(this+\"#\"+e+\" is undefined\");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+\"#\"+e+\" is not a field: \"+s.toString(!0));if(!s.repeated)throw Error(this+\"#\"+e+\" is not a repeated field\");n=s.verifyValue(n,!0)}return null===this[e]&&(this[e]=[]),this[e].push(n),this},h.$add=h.add,h.set=function(e,n,r){var s,o,a;if(e&&\"object\"==typeof e){for(s in r=n,e)e.hasOwnProperty(s)&&void 0!==(n=e[s])&&this.$set(s,n,r);return this}if(o=i._fieldsByName[e],r)this[e]=n;else{if(!o)throw Error(this+\"#\"+e+\" is not a field: undefined\");if(!(o instanceof t.Reflect.Message.Field))throw Error(this+\"#\"+e+\" is not a field: \"+o.toString(!0));this[o.name]=n=o.verifyValue(n)}return o&&o.oneof&&(a=this[o.oneof.name],null!==n?(null!==a&&a!==o.name&&(this[a]=null),this[o.oneof.name]=o.name):a===e&&(this[o.oneof.name]=null)),this},h.$set=h.set,h.get=function(e,n){if(n)return this[e];var r=i._fieldsByName[e];if(!(r&&r instanceof t.Reflect.Message.Field))throw Error(this+\"#\"+e+\" is not a field: undefined\");if(!(r instanceof t.Reflect.Message.Field))throw Error(this+\"#\"+e+\" is not a field: \"+r.toString(!0));return this[r.name]},h.$get=h.get,s=0;s<a.length;s++)(o=a[s])instanceof t.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t,n,r,s=e.originalName.replace(/(_[a-zA-Z])/g,(function(e){return e.toUpperCase().replace(\"_\",\"\")}));s=s.substring(0,1).toUpperCase()+s.substring(1),t=e.originalName.replace(/([A-Z])/g,(function(e){return\"_\"+e})),n=function(t,n){return this[e.name]=n?t:e.verifyValue(t),this},r=function(){return this[e.name]},null===i.getChild(\"set\"+s)&&(h[\"set\"+s]=n),null===i.getChild(\"set_\"+t)&&(h[\"set_\"+t]=n),null===i.getChild(\"get\"+s)&&(h[\"get\"+s]=r),null===i.getChild(\"get_\"+t)&&(h[\"get_\"+t]=r)}(o);return h.encode=function(t,n){var r,s;\"boolean\"==typeof t&&(n=t,t=void 0),r=!1,t||(t=new e,r=!0),s=t.littleEndian;try{return i.encode(this,t.LE(),n),(r?t.flip():t).LE(s)}catch(e){throw t.LE(s),e}},c.encode=function(e,t,n){return new c(e).encode(t,n)},h.calculate=function(){return i.calculate(this)},h.encodeDelimited=function(e){var t,r=!1;return e||(e=new n,r=!0),t=(new n).LE(),i.encode(this,t).flip(),e.writeVarint32(t.remaining()),e.append(t),r?e.flip():e},h.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},h.toArrayBuffer=h.encodeAB,h.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},h.toBuffer=h.encodeNB,h.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},h.toBase64=h.encode64,h.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},h.toHex=h.encodeHex,h.toRaw=function(e,t){return r(this,!!e,!!t,this.$type)},h.encodeJSON=function(){return JSON.stringify(r(this,!0,!0,this.$type))},c.decode=function(e,t){var r,s;\"string\"==typeof e&&(e=n.wrap(e,t||\"base64\")),r=(e=n.isByteBuffer(e)?e:n.wrap(e)).littleEndian;try{return s=i.decode(e.LE()),e.LE(r),s}catch(t){throw e.LE(r),t}},c.decodeDelimited=function(e,t){var r,s,o;if(\"string\"==typeof e&&(e=n.wrap(e,t||\"base64\")),(e=n.isByteBuffer(e)?e:n.wrap(e)).remaining()<1)return null;if(r=e.offset,s=e.readVarint32(),e.remaining()<s)return e.offset=r,null;try{return o=i.decode(e.slice(e.offset,e.offset+s).LE()),e.offset+=s,o}catch(t){throw e.offset+=s,t}},c.decode64=function(e){return c.decode(e,\"base64\")},c.decodeHex=function(e){return c.decode(e,\"hex\")},c.decodeJSON=function(e){return new c(JSON.parse(e))},h.toString=function(){return i.toString()},Object.defineProperty&&(Object.defineProperty(c,\"$options\",{value:i.buildOpt()}),Object.defineProperty(h,\"$options\",{value:c.$options}),Object.defineProperty(c,\"$type\",{value:i}),Object.defineProperty(h,\"$type\",{value:i})),c}(t,this),this._fields=[],this._fieldsById={},this._fieldsByName={},o=0,a=this.children.length;a>o;o++)if((s=this.children[o])instanceof g||s instanceof c||s instanceof v){if(r.hasOwnProperty(s.name))throw Error(\"Illegal reflect child of \"+this.toString(!0)+\": \"+s.toString(!0)+\" cannot override static property '\"+s.name+\"'\");r[s.name]=s.build()}else if(s instanceof c.Field)s.build(),this._fields.push(s),this._fieldsById[s.id]=s,this._fieldsByName[s.name]=s;else if(!(s instanceof c.OneOf||s instanceof y))throw Error(\"Illegal reflect child of \"+this.toString(!0)+\": \"+this.children[o].toString(!0));return this.clazz=r},h.encode=function(e,t,n){var i,r,s,o,a,u=null;for(s=0,o=this._fields.length;o>s;++s)r=e[(i=this._fields[s]).name],i.required&&null===r?null===u&&(u=i):i.encode(n?r:i.verifyValue(r),t,e);if(null!==u)throw(a=Error(\"Missing at least one required field for \"+this.toString(!0)+\": \"+u)).encoded=t,a;return t},h.calculate=function(e){for(var t,n,i=0,r=0,s=this._fields.length;s>r;++r){if(n=e[(t=this._fields[r]).name],t.required&&null===n)throw Error(\"Missing at least one required field for \"+this.toString(!0)+\": \"+t);i+=t.calculate(n,e)}return i},h.decode=function(e,n,i){var s,o,a,u,c,h,l,d,f,p,g,_;for(n=\"number\"==typeof n?n:-1,c=e.offset,h=new this.clazz;e.offset<c+n||-1===n&&e.remaining()>0;){if(a=(s=e.readVarint32())>>>3,(o=7&s)===t.WIRE_TYPES.ENDGROUP){if(a!==i)throw Error(\"Illegal group end indicator for \"+this.toString(!0)+\": \"+a+\" (\"+(i?i+\" expected\":\"not a group\")+\")\");break}if(u=this._fieldsById[a])u.repeated&&!u.options.packed?h[u.name].push(u.decode(o,e)):u.map?(d=u.decode(o,e),h[u.name].set(d[0],d[1])):(h[u.name]=u.decode(o,e),u.oneof&&(null!==(f=h[u.oneof.name])&&f!==u.name&&(h[f]=null),h[u.oneof.name]=u.name));else switch(o){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:l=e.readVarint32(),e.offset+=l;break;case t.WIRE_TYPES.STARTGROUP:for(;r(a,e););break;default:throw Error(\"Illegal wire type for unknown field \"+a+\" in \"+this.toString(!0)+\"#decode: \"+o)}}for(p=0,g=this._fields.length;g>p;++p)if(null===h[(u=this._fields[p]).name])if(\"proto3\"===this.syntax)h[u.name]=u.defaultValue;else{if(u.required)throw(_=Error(\"Missing at least one required field for \"+this.toString(!0)+\": \"+u.name)).decoded=h,_;t.populateDefaults&&null!==u.defaultValue&&(h[u.name]=u.defaultValue)}return h},I.Message=c,(d=(l=function(e,n,i,r,s,o,a,u,h,l){T.call(this,e,n,o),this.className=\"Message.Field\",this.required=\"required\"===i,this.repeated=\"repeated\"===i,this.map=\"map\"===i,this.keyType=r||null,this.type=s,this.resolvedType=null,this.id=a,this.options=u||{},this.defaultValue=null,this.oneof=h||null,this.syntax=l||\"proto2\",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof c.ExtensionField||(this.name=t.Util.toCamelCase(this.name))}).prototype=Object.create(T.prototype)).build=function(){this.element=new a(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new a(this.keyType,void 0,!0,this.syntax)),\"proto3\"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=a.defaultFieldValue(this.type)},d.verifyValue=function(e,n){var i,r,s;if(n=n||!1,i=function(e,t){throw Error(\"Illegal value for \"+this.toString(!0)+\" of type \"+this.type.name+\": \"+e+\" (\"+t+\")\")}.bind(this),null===e)return this.required&&i(typeof e,\"required\"),\"proto3\"===this.syntax&&this.type!==t.TYPES.message&&i(typeof e,\"proto3 field without field presence cannot be null\"),null;if(this.repeated&&!n){for(Array.isArray(e)||(e=[e]),s=[],r=0;r<e.length;r++)s.push(this.element.verifyValue(e[r]));return s}return this.map&&!n?e instanceof t.Map?e:(e instanceof Object||i(typeof e,\"expected ProtoBuf.Map or raw object for map field\"),new t.Map(this,e)):(!this.repeated&&Array.isArray(e)&&i(typeof e,\"no array expected\"),this.element.verifyValue(e))},d.hasWirePresence=function(e,n){if(\"proto3\"!==this.syntax)return null!==e;if(this.oneof&&n[this.oneof.name]===this.name)return!0;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return 0!==e;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return 0!==e.low||0!==e.high;case t.TYPES.bool:return e;case t.TYPES.float:case t.TYPES.double:return 0!==e;case t.TYPES.string:return e.length>0;case t.TYPES.bytes:return e.remaining()>0;case t.TYPES.enum:return 0!==e;case t.TYPES.message:return null!==e;default:return!0}},d.encode=function(e,i,r){var s,o,a,u,c;if(null===this.type||\"object\"!=typeof this.type)throw Error(\"[INTERNAL] Unresolved type in \"+this.toString(!0)+\": \"+this.type);if(null===e||this.repeated&&0==e.length)return i;try{if(this.repeated)if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(i.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),i.ensureCapacity(i.offset+=1),o=i.offset,s=0;s<e.length;s++)this.element.encodeValue(this.id,e[s],i);a=i.offset-o,(u=n.calculateVarint32(a))>1&&(c=i.slice(o,i.offset),o+=u-1,i.offset=o,i.append(c)),i.writeVarint32(a,o-u)}else for(s=0;s<e.length;s++)i.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e[s],i);else this.map?e.forEach((function(e,r){var s=n.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+n.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);i.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),i.writeVarint32(s),i.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,r,i),i.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,i)}),this):this.hasWirePresence(e,r)&&(i.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e,i))}catch(t){throw Error(\"Illegal value for \"+this.toString(!0)+\": \"+e+\" (\"+t+\")\")}return i},d.calculate=function(e,i){var r,s,o;if(e=this.verifyValue(e),null===this.type||\"object\"!=typeof this.type)throw Error(\"[INTERNAL] Unresolved type in \"+this.toString(!0)+\": \"+this.type);if(null===e||this.repeated&&0==e.length)return 0;r=0;try{if(this.repeated)if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(r+=n.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),o=0,s=0;s<e.length;s++)o+=this.element.calculateLength(this.id,e[s]);r+=n.calculateVarint32(o),r+=o}else for(s=0;s<e.length;s++)r+=n.calculateVarint32(this.id<<3|this.type.wireType),r+=this.element.calculateLength(this.id,e[s]);else this.map?e.forEach((function(e,i){var s=n.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,i)+n.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);r+=n.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),r+=n.calculateVarint32(s),r+=s}),this):this.hasWirePresence(e,i)&&(r+=n.calculateVarint32(this.id<<3|this.type.wireType),r+=this.element.calculateLength(this.id,e))}catch(t){throw Error(\"Illegal value for \"+this.toString(!0)+\": \"+e+\" (\"+t+\")\")}return r},d.decode=function(e,n,i){var r,s,o,u,c,h,l;if(!(!this.map&&e==this.type.wireType||!i&&this.repeated&&this.options.packed&&e==t.WIRE_TYPES.LDELIM||this.map&&e==t.WIRE_TYPES.LDELIM))throw Error(\"Illegal wire type for field \"+this.toString(!0)+\": \"+e+\" (\"+this.type.wireType+\" expected)\");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!i){for(s=n.readVarint32(),s=n.offset+s,o=[];n.offset<s;)o.push(this.decode(this.type.wireType,n,!0));return o}if(this.map){if(u=a.defaultFieldValue(this.keyType),r=a.defaultFieldValue(this.type),s=n.readVarint32(),n.remaining()<s)throw Error(\"Illegal number of bytes for \"+this.toString(!0)+\": \"+s+\" required but got only \"+n.remaining());for((c=n.clone()).limit=c.offset+s,n.offset+=s;c.remaining()>0;)if(e=7&(h=c.readVarint32()),1==(l=h>>>3))u=this.keyElement.decode(c,e,l);else{if(2!==l)throw Error(\"Unexpected tag in map field key/value submessage\");r=this.element.decode(c,e,l)}return[u,r]}return this.element.decode(n,e,this.id)},I.Message.Field=l,(f=function(e,t,n,i,r,s,o){l.call(this,e,t,n,null,i,r,s,o),this.extension}).prototype=Object.create(l.prototype),I.Message.ExtensionField=f,p=function(e,t,n){T.call(this,e,t,n),this.fields=[]},I.Message.OneOf=p,(g=function(e,t,n,i,r){s.call(this,e,t,n,i,r),this.className=\"Enum\",this.object=null}).getName=function(e,t){var n,i,r=Object.keys(e);for(i=0;i<r.length;++i)if(e[n=r[i]]===t)return n;return null},(g.prototype=Object.create(s.prototype)).build=function(e){var n,i,r,s;if(this.object&&!e)return this.object;for(n=new t.Builder.Enum,r=0,s=(i=this.getChildren(g.Value)).length;s>r;++r)n[i[r].name]=i[r].id;return Object.defineProperty&&Object.defineProperty(n,\"$options\",{value:this.buildOpt(),enumerable:!1}),this.object=n},I.Enum=g,(_=function(e,t,n,i){T.call(this,e,t,n),this.className=\"Enum.Value\",this.id=i}).prototype=Object.create(T.prototype),I.Enum.Value=_,(y=function(e,t,n,i){T.call(this,e,t,n),this.field=i}).prototype=Object.create(T.prototype),I.Extension=y,((v=function(e,t,n,i){s.call(this,e,t,n,i),this.className=\"Service\",this.clazz=null}).prototype=Object.create(s.prototype)).build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(e,t){var i,r=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(e,t,n){setTimeout(n.bind(this,Error(\"Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services\")),0)}},s=r.prototype=Object.create(e.Builder.Service.prototype),o=t.getChildren(e.Reflect.Service.RPCMethod);for(i=0;i<o.length;i++)!function(e){s[e.name]=function(i,r){try{try{i=e.resolvedRequestType.clazz.decode(n.wrap(i))}catch(e){if(!(e instanceof TypeError))throw e}if(null===i||\"object\"!=typeof i)throw Error(\"Illegal arguments\");i instanceof e.resolvedRequestType.clazz||(i=new e.resolvedRequestType.clazz(i)),this.rpcImpl(e.fqn(),i,(function(n,i){if(!n){try{i=e.resolvedResponseType.clazz.decode(i)}catch(e){}return i&&i instanceof e.resolvedResponseType.clazz?void r(null,i):void r(Error(\"Illegal response type received in service method \"+t.name+\"#\"+e.name))}r(n)}))}catch(e){setTimeout(r.bind(this,e),0)}},r[e.name]=function(t,n,i){new r(t)[e.name](n,i)},Object.defineProperty&&(Object.defineProperty(r[e.name],\"$options\",{value:e.buildOpt()}),Object.defineProperty(s[e.name],\"$options\",{value:r[e.name].$options}))}(o[i]);return Object.defineProperty&&(Object.defineProperty(r,\"$options\",{value:t.buildOpt()}),Object.defineProperty(s,\"$options\",{value:r.$options}),Object.defineProperty(r,\"$type\",{value:t}),Object.defineProperty(s,\"$type\",{value:t})),r}(t,this)},I.Service=v,((E=function(e,t,n,i){T.call(this,e,t,n),this.className=\"Service.Method\",this.options=i||{}}).prototype=Object.create(T.prototype)).buildOpt=o.buildOpt,I.Service.Method=E,(m=function(e,t,n,i,r,s,o,a){E.call(this,e,t,n,a),this.className=\"Service.RPCMethod\",this.requestName=i,this.responseName=r,this.requestStream=s,this.responseStream=o,this.resolvedRequestType=null,this.resolvedResponseType=null}).prototype=Object.create(E.prototype),I.Service.RPCMethod=m,I}(r),r.Builder=function(e,t,n){function i(e){e.messages&&e.messages.forEach((function(t){t.syntax=e.syntax,i(t)})),e.enums&&e.enums.forEach((function(t){t.syntax=e.syntax}))}var r=function(e){this.ns=new n.Namespace(this,null,\"\"),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},s=r.prototype;return r.isMessage=function(e){return\"string\"==typeof e.name&&void 0===e.values&&void 0===e.rpc},r.isMessageField=function(e){return\"string\"==typeof e.rule&&\"string\"==typeof e.name&&\"string\"==typeof e.type&&void 0!==e.id},r.isEnum=function(e){return\"string\"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},r.isService=function(e){return!(\"string\"!=typeof e.name||\"object\"!=typeof e.rpc||!e.rpc)},r.isExtend=function(e){return\"string\"==typeof e.ref},s.reset=function(){return this.ptr=this.ns,this},s.define=function(e){if(\"string\"!=typeof e||!t.TYPEREF.test(e))throw Error(\"illegal namespace: \"+e);return e.split(\".\").forEach((function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new n.Namespace(this,this.ptr,e)),this.ptr=t}),this),this},s.create=function(t){var i,s,o,a,u;if(!t)return this;if(Array.isArray(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(i=[t];i.length>0;){if(t=i.pop(),!Array.isArray(t))throw Error(\"not a valid namespace: \"+JSON.stringify(t));for(;t.length>0;){if(s=t.shift(),r.isMessage(s)){if(o=new n.Message(this,this.ptr,s.name,s.options,s.isGroup,s.syntax),a={},s.oneofs&&Object.keys(s.oneofs).forEach((function(e){o.addChild(a[e]=new n.Message.OneOf(this,o,e))}),this),s.fields&&s.fields.forEach((function(e){if(null!==o.getChild(0|e.id))throw Error(\"duplicate or invalid field id in \"+o.name+\": \"+e.id);if(e.options&&\"object\"!=typeof e.options)throw Error(\"illegal field options in \"+o.name+\"#\"+e.name);var t=null;if(\"string\"==typeof e.oneof&&!(t=a[e.oneof]))throw Error(\"illegal oneof in \"+o.name+\"#\"+e.name+\": \"+e.oneof);e=new n.Message.Field(this,o,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,s.syntax),t&&t.fields.push(e),o.addChild(e)}),this),u=[],s.enums&&s.enums.forEach((function(e){u.push(e)})),s.messages&&s.messages.forEach((function(e){u.push(e)})),s.services&&s.services.forEach((function(e){u.push(e)})),s.extensions&&(o.extensions=\"number\"==typeof s.extensions[0]?[s.extensions]:s.extensions),this.ptr.addChild(o),u.length>0){i.push(t),t=u,u=null,this.ptr=o,o=null;continue}u=null}else if(r.isEnum(s))o=new n.Enum(this,this.ptr,s.name,s.options,s.syntax),s.values.forEach((function(e){o.addChild(new n.Enum.Value(this,o,e.name,e.id))}),this),this.ptr.addChild(o);else if(r.isService(s))o=new n.Service(this,this.ptr,s.name,s.options),Object.keys(s.rpc).forEach((function(e){var t=s.rpc[e];o.addChild(new n.Service.RPCMethod(this,o,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))}),this),this.ptr.addChild(o);else{if(!r.isExtend(s))throw Error(\"not a valid definition: \"+JSON.stringify(s));if(o=this.ptr.resolve(s.ref,!0))s.fields.forEach((function(t){var i,r,s,a;if(null!==o.getChild(0|t.id))throw Error(\"duplicate extended field id in \"+o.name+\": \"+t.id);if(o.extensions&&(i=!1,o.extensions.forEach((function(e){t.id>=e[0]&&t.id<=e[1]&&(i=!0)})),!i))throw Error(\"illegal extended field id in \"+o.name+\": \"+t.id+\" (not within valid ranges)\");r=t.name,this.options.convertFieldsToCamelCase&&(r=e.Util.toCamelCase(r)),s=new n.Message.ExtensionField(this,o,t.rule,t.type,this.ptr.fqn()+\".\"+r,t.id,t.options),a=new n.Extension(this,this.ptr,t.name,s),s.extension=a,this.ptr.addChild(a),o.addChild(s)}),this);else if(!/\\.?google\\.protobuf\\./.test(s.ref))throw Error(\"extended message \"+s.ref+\" is not defined\")}s=null,o=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},s.import=function(t,n){var r,s,o,a,u,c,h,l,d=\"/\";if(\"string\"==typeof n){if(e.Util.IS_NODE,!0===this.files[n])return this.reset();this.files[n]=!0}else if(\"object\"==typeof n){if(r=n.root,e.Util.IS_NODE,(r.indexOf(\"\\\\\")>=0||n.file.indexOf(\"\\\\\")>=0)&&(d=\"\\\\\"),s=r+d+n.file,!0===this.files[s])return this.reset();this.files[s]=!0}if(t.imports&&t.imports.length>0){for(a=!1,\"object\"==typeof n?(this.importRoot=n.root,a=!0,o=this.importRoot,n=n.file,(o.indexOf(\"\\\\\")>=0||n.indexOf(\"\\\\\")>=0)&&(d=\"\\\\\")):\"string\"==typeof n?this.importRoot?o=this.importRoot:n.indexOf(\"/\")>=0?\"\"===(o=n.replace(/\\/[^\\/]*$/,\"\"))&&(o=\"/\"):n.indexOf(\"\\\\\")>=0?(o=n.replace(/\\\\[^\\\\]*$/,\"\"),d=\"\\\\\"):o=\".\":o=null,u=0;u<t.imports.length;u++)if(\"string\"==typeof t.imports[u]){if(!o)throw Error(\"cannot determine import root\");if(\"google/protobuf/descriptor.proto\"===(c=t.imports[u]))continue;if(c=o+d+c,!0===this.files[c])continue;if(/\\.proto$/i.test(c)&&!e.DotProto&&(c=c.replace(/\\.proto$/,\".json\")),null===(h=e.Util.fetch(c)))throw Error(\"failed to import '\"+c+\"' in '\"+n+\"': file not found\");/\\.json$/i.test(c)?this.import(JSON.parse(h+\"\"),c):this.import(e.DotProto.Parser.parse(h),c)}else n?/\\.(\\w+)$/.test(n)?this.import(t.imports[u],n.replace(/^(.+)\\.(\\w+)$/,(function(e,t,n){return t+\"_import\"+u+\".\"+n}))):this.import(t.imports[u],n+\"_import\"+u):this.import(t.imports[u]);a&&(this.importRoot=null)}return t.package&&this.define(t.package),t.syntax&&i(t),l=this.ptr,t.options&&Object.keys(t.options).forEach((function(e){l.options[e]=t.options[e]})),t.messages&&(this.create(t.messages),this.ptr=l),t.enums&&(this.create(t.enums),this.ptr=l),t.services&&(this.create(t.services),this.ptr=l),t.extends&&this.create(t.extends),this.reset()},s.resolveAll=function(){var i;if(null==this.ptr||\"object\"==typeof this.ptr.type)return this;if(this.ptr instanceof n.Namespace)this.ptr.children.forEach((function(e){this.ptr=e,this.resolveAll()}),this);else if(this.ptr instanceof n.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error(\"illegal type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.type);if(!(i=(this.ptr instanceof n.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error(\"unresolvable type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.type);if(this.ptr.resolvedType=i,i instanceof n.Enum){if(this.ptr.type=e.TYPES.enum,\"proto3\"===this.ptr.syntax&&\"proto3\"!==i.syntax)throw Error(\"proto3 message cannot reference proto2 enum\")}else{if(!(i instanceof n.Message))throw Error(\"illegal type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.type);this.ptr.type=i.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error(\"illegal key type for map field in \"+this.ptr.toString(!0)+\": \"+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error(\"illegal service type in \"+this.ptr.toString(!0));if(!((i=this.ptr.parent.resolve(this.ptr.requestName,!0))&&i instanceof e.Reflect.Message))throw Error(\"Illegal type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.requestName);if(this.ptr.resolvedRequestType=i,!((i=this.ptr.parent.resolve(this.ptr.responseName,!0))&&i instanceof e.Reflect.Message))throw Error(\"Illegal type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.responseName);this.ptr.resolvedResponseType=i}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error(\"illegal object in namespace: \"+typeof this.ptr+\": \"+this.ptr);return this.reset()},s.build=function(e){var t,n,i;if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(t=\"string\"==typeof e?e.split(\".\"):e,n=this.result,i=0;i<t.length;i++){if(!n[t[i]]){n=null;break}n=n[t[i]]}return n},s.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},s.toString=function(){return\"Builder\"},r.Message=function(){},r.Enum=function(){},r.Service=function(){},r}(r,r.Lang,r.Reflect),r.Map=function(e,t){function n(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var i=function(e,n){var i,r,s,o;if(!e.map)throw Error(\"field is not a map\");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,\"size\",{get:function(){return Object.keys(this.map).length}}),n)for(i=Object.keys(n),r=0;r<i.length;r++)s=this.keyElem.valueFromString(i[r]),o=this.valueElem.verifyValue(n[i[r]]),this.map[this.keyElem.valueToString(s)]={key:s,value:o}},r=i.prototype;return r.clear=function(){this.map={}},r.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),n=t in this.map;return delete this.map[t],n},r.entries=function(){var e,t,i=[],r=Object.keys(this.map);for(t=0;t<r.length;t++)i.push([(e=this.map[r[t]]).key,e.value]);return n(i)},r.keys=function(){var e,t=[],i=Object.keys(this.map);for(e=0;e<i.length;e++)t.push(this.map[i[e]].key);return n(t)},r.values=function(){var e,t=[],i=Object.keys(this.map);for(e=0;e<i.length;e++)t.push(this.map[i[e]].value);return n(t)},r.forEach=function(e,t){var n,i,r=Object.keys(this.map);for(i=0;i<r.length;i++)e.call(t,(n=this.map[r[i]]).value,n.key,this)},r.set=function(e,t){var n=this.keyElem.verifyValue(e),i=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(n)]={key:n,value:i},this},r.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));return t in this.map?this.map[t].value:void 0},r.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},i}(0,r.Reflect),r.loadProto=function(e,t,n){return(\"string\"==typeof t||t&&\"string\"==typeof t.file&&\"string\"==typeof t.root)&&(n=t,t=void 0),r.loadJson(r.DotProto.Parser.parse(e),t,n)},r.protoFromString=r.loadProto,r.loadProtoFile=function(e,t,n){if(t&&\"object\"==typeof t?(n=t,t=null):t&&\"function\"==typeof t||(t=null),t)return r.Util.fetch(\"string\"==typeof e?e:e.root+\"/\"+e.file,(function(i){if(null!==i)try{t(null,r.loadProto(i,n,e))}catch(e){t(e)}else t(Error(\"Failed to fetch file\"))}));var i=r.Util.fetch(\"object\"==typeof e?e.root+\"/\"+e.file:e);return null===i?null:r.loadProto(i,n,e)},r.protoFromFile=r.loadProtoFile,r.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=r.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=r.populateAccessors),new r.Builder(e)},r.loadJson=function(e,t,n){return(\"string\"==typeof t||t&&\"string\"==typeof t.file&&\"string\"==typeof t.root)&&(n=t,t=null),t&&\"object\"==typeof t||(t=r.newBuilder()),\"string\"==typeof e&&(e=JSON.parse(e)),t.import(e,n),t.resolveAll(),t},r.loadJsonFile=function(e,t,n){if(t&&\"object\"==typeof t?(n=t,t=null):t&&\"function\"==typeof t||(t=null),t)return r.Util.fetch(\"string\"==typeof e?e:e.root+\"/\"+e.file,(function(i){if(null!==i)try{t(null,r.loadJson(JSON.parse(i),n,e))}catch(e){t(e)}else t(Error(\"Failed to fetch file\"))}));var i=r.Util.fetch(\"object\"==typeof e?e.root+\"/\"+e.file:e);return null===i?null:r.loadJson(JSON.parse(i),n,e)},i=ui,r.loadProto(i,void 0,\"\").build(\"Modules\").probuf}(function(e){function t(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function n(){var e=[],t=[];return function(){return 0===arguments.length?t.join(\"\")+a.apply(String,e):(e.length+arguments.length>1024&&(t.push(a.apply(String,e)),e.length=0),void Array.prototype.push.apply(e,arguments))}}function i(e,t,n,i,r){var s,o,a=8*r-i-1,u=(1<<a)-1,c=u>>1,h=-7,l=n?r-1:0,d=n?-1:1,f=e[t+l];for(l+=d,s=f&(1<<-h)-1,f>>=-h,h+=a;h>0;s=256*s+e[t+l],l+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=i;h>0;o=256*o+e[t+l],l+=d,h-=8);if(0===s)s=1-c;else{if(s===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),s-=c}return(f?-1:1)*o*Math.pow(2,s-i)}function r(e,t,n,i,r,s){var o,a,u,c=8*s-r-1,h=(1<<c)-1,l=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:s-1,p=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+l>=1?d/u:d*Math.pow(2,1-l))*u>=2&&(o++,u/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(t*u-1)*Math.pow(2,r),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,r),o=0));r>=8;e[n+f]=255&a,f+=p,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;e[n+f]=255&o,f+=p,o/=256,c-=8);e[n+f-p]|=128*g}var s,o,a,u,c,h=function(e,t,n){if(void 0===e&&(e=h.DEFAULT_CAPACITY),void 0===t&&(t=h.DEFAULT_ENDIAN),void 0===n&&(n=h.DEFAULT_NOASSERT),!n){if((e|=0)<0)throw RangeError(\"Illegal capacity\");t=!!t,n=!!n}this.buffer=0===e?o:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=n};return h.VERSION=\"5.0.1\",h.LITTLE_ENDIAN=!0,h.BIG_ENDIAN=!1,h.DEFAULT_CAPACITY=16,h.DEFAULT_ENDIAN=h.BIG_ENDIAN,h.DEFAULT_NOASSERT=!1,h.Long=e||null,(s=h.prototype).__isByteBuffer__,Object.defineProperty(s,\"__isByteBuffer__\",{value:!0,enumerable:!1,configurable:!1}),o=new ArrayBuffer(0),a=String.fromCharCode,h.accessor=function(){return Uint8Array},h.allocate=function(e,t,n){return new h(e,t,n)},h.concat=function(e,t,n,i){var r,s,o,a,u,c;for((\"boolean\"==typeof t||\"string\"!=typeof t)&&(i=n,n=t,t=void 0),r=0,o=0,a=e.length;a>o;++o)h.isByteBuffer(e[o])||(e[o]=h.wrap(e[o],t)),(s=e[o].limit-e[o].offset)>0&&(r+=s);if(0===r)return new h(0,n,i);for(c=new h(r,n,i),o=0;a>o;)(s=(u=e[o++]).limit-u.offset)<=0||(c.view.set(u.view.subarray(u.offset,u.limit),c.offset),c.offset+=s);return c.limit=c.offset,c.offset=0,c},h.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},h.type=function(){return ArrayBuffer},h.wrap=function(e,t,n,i){var r,o;if(\"string\"!=typeof t&&(i=n,n=t,t=void 0),\"string\"==typeof e)switch(void 0===t&&(t=\"utf8\"),t){case\"base64\":return h.fromBase64(e,n);case\"hex\":return h.fromHex(e,n);case\"binary\":return h.fromBinary(e,n);case\"utf8\":return h.fromUTF8(e,n);case\"debug\":return h.fromDebug(e,n);default:throw Error(\"Unsupported encoding: \"+t)}if(null===e||\"object\"!=typeof e)throw TypeError(\"Illegal buffer\");if(h.isByteBuffer(e))return(r=s.clone.call(e)).markedOffset=-1,r;if(e instanceof Uint8Array)r=new h(0,n,i),e.length>0&&(r.buffer=e.buffer,r.offset=e.byteOffset,r.limit=e.byteOffset+e.byteLength,r.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)r=new h(0,n,i),e.byteLength>0&&(r.buffer=e,r.offset=0,r.limit=e.byteLength,r.view=e.byteLength>0?new Uint8Array(e):null);else{if(\"[object Array]\"!==Object.prototype.toString.call(e))throw TypeError(\"Illegal buffer\");for((r=new h(e.length,n,i)).limit=e.length,o=0;o<e.length;++o)r.view[o]=e[o]}return r},s.writeBitSet=function(e,t){var n,i,r,s,o,a,u=void 0===t;if(u&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError(\"Illegal BitSet: Not an array\");if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}for(i=t,s=(r=e.length)>>3,o=0,t+=this.writeVarint32(r,t);s--;)n=1&!!e[o++]|(1&!!e[o++])<<1|(1&!!e[o++])<<2|(1&!!e[o++])<<3|(1&!!e[o++])<<4|(1&!!e[o++])<<5|(1&!!e[o++])<<6|(1&!!e[o++])<<7,this.writeByte(n,t++);if(r>o){for(a=0,n=0;r>o;)n|=(1&!!e[o++])<<a++;this.writeByte(n,t++)}return u?(this.offset=t,this):t-i},s.readBitSet=function(e){var t,n,i,r,s,o,a,u=void 0===e;for(u&&(e=this.offset),r=(i=(n=this.readVarint32(e)).value)>>3,s=0,o=[],e+=n.length;r--;)t=this.readByte(e++),o[s++]=!!(1&t),o[s++]=!!(2&t),o[s++]=!!(4&t),o[s++]=!!(8&t),o[s++]=!!(16&t),o[s++]=!!(32&t),o[s++]=!!(64&t),o[s++]=!!(128&t);if(i>s)for(a=0,t=this.readByte(e++);i>s;)o[s++]=!!(1&t>>a++);return u&&(this.offset=e),o},s.readBytes=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+\"+e+\") <= \"+this.buffer.byteLength)}return n=this.slice(t,t+e),i&&(this.offset+=e),n},s.writeBytes=s.append,s.writeInt8=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=1)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},s.writeByte=s.writeInt8,s.readInt8=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}return 128==(128&(t=this.view[e]))&&(t=-(255-t+1)),n&&(this.offset+=1),t},s.readByte=s.readInt8,s.writeUint8=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=1)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},s.writeUInt8=s.writeUint8,s.readUint8=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}return t=this.view[e],n&&(this.offset+=1),t},s.readUInt8=s.readUint8,s.writeInt16=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=2)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},s.writeShort=s.writeInt16,s.readInt16=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+2) <= \"+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e],t|=this.view[e+1]<<8):(t=this.view[e]<<8,t|=this.view[e+1]),32768==(32768&t)&&(t=-(65535-t+1)),n&&(this.offset+=2),t},s.readShort=s.readInt16,s.writeUint16=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=2)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},s.writeUInt16=s.writeUint16,s.readUint16=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+2) <= \"+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e],t|=this.view[e+1]<<8):(t=this.view[e]<<8,t|=this.view[e+1]),n&&(this.offset+=2),t},s.readUInt16=s.readUint16,s.writeInt32=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=255&e>>>24,this.view[t+2]=255&e>>>16,this.view[t+1]=255&e>>>8,this.view[t]=255&e):(this.view[t]=255&e>>>24,this.view[t+1]=255&e>>>16,this.view[t+2]=255&e>>>8,this.view[t+3]=255&e),i&&(this.offset+=4),this},s.writeInt=s.writeInt32,s.readInt32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+4) <= \"+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e+2]<<16,t|=this.view[e+1]<<8,t|=this.view[e],t+=this.view[e+3]<<24>>>0):(t=this.view[e+1]<<16,t|=this.view[e+2]<<8,t|=this.view[e+3],t+=this.view[e]<<24>>>0),t|=0,n&&(this.offset+=4),t},s.readInt=s.readInt32,s.writeUint32=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=255&e>>>24,this.view[t+2]=255&e>>>16,this.view[t+1]=255&e>>>8,this.view[t]=255&e):(this.view[t]=255&e>>>24,this.view[t+1]=255&e>>>16,this.view[t+2]=255&e>>>8,this.view[t+3]=255&e),i&&(this.offset+=4),this},s.writeUInt32=s.writeUint32,s.readUint32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+4) <= \"+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e+2]<<16,t|=this.view[e+1]<<8,t|=this.view[e],t+=this.view[e+3]<<24>>>0):(t=this.view[e+1]<<16,t|=this.view[e+2]<<8,t|=this.view[e+3],t+=this.view[e]<<24>>>0),n&&(this.offset+=4),t},s.readUInt32=s.readUint32,e&&(s.writeInt64=function(t,n){var i,r,s,o=void 0===n;if(o&&(n=this.offset),!this.noAssert){if(\"number\"==typeof t)t=e.fromNumber(t);else if(\"string\"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError(\"Illegal value: \"+t+\" (not an integer or Long)\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return\"number\"==typeof t?t=e.fromNumber(t):\"string\"==typeof t&&(t=e.fromString(t)),(n+=8)>(i=this.buffer.byteLength)&&this.resize((i*=2)>n?i:n),n-=8,r=t.low,s=t.high,this.littleEndian?(this.view[n+3]=255&r>>>24,this.view[n+2]=255&r>>>16,this.view[n+1]=255&r>>>8,this.view[n]=255&r,n+=4,this.view[n+3]=255&s>>>24,this.view[n+2]=255&s>>>16,this.view[n+1]=255&s>>>8,this.view[n]=255&s):(this.view[n]=255&s>>>24,this.view[n+1]=255&s>>>16,this.view[n+2]=255&s>>>8,this.view[n+3]=255&s,n+=4,this.view[n]=255&r>>>24,this.view[n+1]=255&r>>>16,this.view[n+2]=255&r>>>8,this.view[n+3]=255&r),o&&(this.offset+=8),this},s.writeLong=s.writeInt64,s.readInt64=function(t){var n,i,r,s=void 0===t;if(s&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+8) <= \"+this.buffer.byteLength)}return n=0,i=0,this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0,t+=4,i=this.view[t+2]<<16,i|=this.view[t+1]<<8,i|=this.view[t],i+=this.view[t+3]<<24>>>0):(i=this.view[t+1]<<16,i|=this.view[t+2]<<8,i|=this.view[t+3],i+=this.view[t]<<24>>>0,t+=4,n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),r=new e(n,i,!1),s&&(this.offset+=8),r},s.readLong=s.readInt64,s.writeUint64=function(t,n){var i,r,s,o=void 0===n;if(o&&(n=this.offset),!this.noAssert){if(\"number\"==typeof t)t=e.fromNumber(t);else if(\"string\"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError(\"Illegal value: \"+t+\" (not an integer or Long)\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return\"number\"==typeof t?t=e.fromNumber(t):\"string\"==typeof t&&(t=e.fromString(t)),(n+=8)>(i=this.buffer.byteLength)&&this.resize((i*=2)>n?i:n),n-=8,r=t.low,s=t.high,this.littleEndian?(this.view[n+3]=255&r>>>24,this.view[n+2]=255&r>>>16,this.view[n+1]=255&r>>>8,this.view[n]=255&r,n+=4,this.view[n+3]=255&s>>>24,this.view[n+2]=255&s>>>16,this.view[n+1]=255&s>>>8,this.view[n]=255&s):(this.view[n]=255&s>>>24,this.view[n+1]=255&s>>>16,this.view[n+2]=255&s>>>8,this.view[n+3]=255&s,n+=4,this.view[n]=255&r>>>24,this.view[n+1]=255&r>>>16,this.view[n+2]=255&r>>>8,this.view[n+3]=255&r),o&&(this.offset+=8),this},s.writeUInt64=s.writeUint64,s.readUint64=function(t){var n,i,r,s=void 0===t;if(s&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+8) <= \"+this.buffer.byteLength)}return n=0,i=0,this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0,t+=4,i=this.view[t+2]<<16,i|=this.view[t+1]<<8,i|=this.view[t],i+=this.view[t+3]<<24>>>0):(i=this.view[t+1]<<16,i|=this.view[t+2]<<8,i|=this.view[t+3],i+=this.view[t]<<24>>>0,t+=4,n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),r=new e(n,i,!0),s&&(this.offset+=8),r},s.readUInt64=s.readUint64),s.writeFloat32=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e)throw TypeError(\"Illegal value: \"+e+\" (not a number)\");if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,r(this.view,e,t,this.littleEndian,23,4),i&&(this.offset+=4),this},s.writeFloat=s.writeFloat32,s.readFloat32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+4) <= \"+this.buffer.byteLength)}return t=i(this.view,e,this.littleEndian,23,4),n&&(this.offset+=4),t},s.readFloat=s.readFloat32,s.writeFloat64=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e)throw TypeError(\"Illegal value: \"+e+\" (not a number)\");if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=8)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=8,r(this.view,e,t,this.littleEndian,52,8),i&&(this.offset+=8),this},s.writeDouble=s.writeFloat64,s.readFloat64=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+8) <= \"+this.buffer.byteLength)}return t=i(this.view,e,this.littleEndian,52,8),n&&(this.offset+=8),t},s.readDouble=s.readFloat64,h.MAX_VARINT32_BYTES=5,h.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:1<<21>e?3:1<<28>e?4:5},h.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},h.zigZagDecode32=function(e){return 0|e>>>1^-(1&e)},s.writeVarint32=function(e,t){var n,i,r,s=void 0===t;if(s&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}for((t+=i=h.calculateVarint32(e))>(r=this.buffer.byteLength)&&this.resize((r*=2)>t?r:t),t-=i,e>>>=0;e>=128;)n=128|127&e,this.view[t++]=n,e>>>=7;return this.view[t++]=e,s?(this.offset=t,this):i},s.writeVarint32ZigZag=function(e,t){return this.writeVarint32(h.zigZagEncode32(e),t)},s.readVarint32=function(e){var t,n,i,r,s=void 0===e;if(s&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}n=0,i=0;do{if(!this.noAssert&&e>this.limit)throw(r=Error(\"Truncated\")).truncated=!0,r;t=this.view[e++],n<5&&(i|=(127&t)<<7*n),++n}while(0!=(128&t));return i|=0,s?(this.offset=e,i):{value:i,length:n}},s.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return\"object\"==typeof t?t.value=h.zigZagDecode32(t.value):t=h.zigZagDecode32(t),t},e&&(h.MAX_VARINT64_BYTES=10,h.calculateVarint64=function(t){\"number\"==typeof t?t=e.fromNumber(t):\"string\"==typeof t&&(t=e.fromString(t));var n=t.toInt()>>>0,i=t.shiftRightUnsigned(28).toInt()>>>0,r=t.shiftRightUnsigned(56).toInt()>>>0;return 0==r?0==i?n<16384?n<128?1:2:1<<21>n?3:4:i<16384?i<128?5:6:1<<21>i?7:8:r<128?9:10},h.zigZagEncode64=function(t){return\"number\"==typeof t?t=e.fromNumber(t,!1):\"string\"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},h.zigZagDecode64=function(t){return\"number\"==typeof t?t=e.fromNumber(t,!1):\"string\"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},s.writeVarint64=function(t,n){var i,r,s,o,a,u=void 0===n;if(u&&(n=this.offset),!this.noAssert){if(\"number\"==typeof t)t=e.fromNumber(t);else if(\"string\"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError(\"Illegal value: \"+t+\" (not an integer or Long)\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}switch(\"number\"==typeof t?t=e.fromNumber(t,!1):\"string\"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),i=h.calculateVarint64(t),r=t.toInt()>>>0,s=t.shiftRightUnsigned(28).toInt()>>>0,o=t.shiftRightUnsigned(56).toInt()>>>0,(n+=i)>(a=this.buffer.byteLength)&&this.resize((a*=2)>n?a:n),n-=i,i){case 10:this.view[n+9]=1&o>>>7;case 9:this.view[n+8]=9!==i?128|o:127&o;case 8:this.view[n+7]=8!==i?128|s>>>21:127&s>>>21;case 7:this.view[n+6]=7!==i?128|s>>>14:127&s>>>14;case 6:this.view[n+5]=6!==i?128|s>>>7:127&s>>>7;case 5:this.view[n+4]=5!==i?128|s:127&s;case 4:this.view[n+3]=4!==i?128|r>>>21:127&r>>>21;case 3:this.view[n+2]=3!==i?128|r>>>14:127&r>>>14;case 2:this.view[n+1]=2!==i?128|r>>>7:127&r>>>7;case 1:this.view[n]=1!==i?128|r:127&r}return u?(this.offset+=i,this):i},s.writeVarint64ZigZag=function(e,t){return this.writeVarint64(h.zigZagEncode64(e),t)},s.readVarint64=function(t){var n,i,r,s,o,a,u=void 0===t;if(u&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+1) <= \"+this.buffer.byteLength)}if(n=t,i=0,r=0,s=0,o=0,i=127&(o=this.view[t++]),128&o&&(i|=(127&(o=this.view[t++]))<<7,(128&o||this.noAssert&&void 0===o)&&(i|=(127&(o=this.view[t++]))<<14,(128&o||this.noAssert&&void 0===o)&&(i|=(127&(o=this.view[t++]))<<21,(128&o||this.noAssert&&void 0===o)&&(r=127&(o=this.view[t++]),(128&o||this.noAssert&&void 0===o)&&(r|=(127&(o=this.view[t++]))<<7,(128&o||this.noAssert&&void 0===o)&&(r|=(127&(o=this.view[t++]))<<14,(128&o||this.noAssert&&void 0===o)&&(r|=(127&(o=this.view[t++]))<<21,(128&o||this.noAssert&&void 0===o)&&(s=127&(o=this.view[t++]),(128&o||this.noAssert&&void 0===o)&&(s|=(127&(o=this.view[t++]))<<7,128&o||this.noAssert&&void 0===o))))))))))throw Error(\"Buffer overrun\");return a=e.fromBits(i|r<<28,r>>>4|s<<24,!1),u?(this.offset=t,a):{value:a,length:t-n}},s.readVarint64ZigZag=function(t){var n=this.readVarint64(t);return n&&n.value instanceof e?n.value=h.zigZagDecode64(n.value):n=h.zigZagDecode64(n),n}),s.writeCString=function(e,n){var i,r,s,o=void 0===n;if(o&&(n=this.offset),r=e.length,!this.noAssert){if(\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");for(i=0;r>i;++i)if(0===e.charCodeAt(i))throw RangeError(\"Illegal str: Contains NULL-characters\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return r=c.calculateUTF16asUTF8(t(e))[1],n+=r+1,s=this.buffer.byteLength,n>s&&this.resize((s*=2)>n?s:n),n-=r+1,c.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),this.view[n++]=0,o?(this.offset=n,this):r},s.readCString=function(e){var t,i,r,s=void 0===e;if(s&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}return t=e,r=-1,c.decodeUTF8toUTF16(function(){if(0===r)return null;if(e>=this.limit)throw RangeError(\"Illegal range: Truncated data, \"+e+\" < \"+this.limit);return 0===(r=this.view[e++])?null:r}.bind(this),i=n(),!0),s?(this.offset=e,i()):{string:i(),length:e-t}},s.writeIString=function(e,n){var i,r,s,o=void 0===n;if(o&&(n=this.offset),!this.noAssert){if(\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}if(r=n,i=c.calculateUTF16asUTF8(t(e),this.noAssert)[1],n+=4+i,s=this.buffer.byteLength,n>s&&this.resize((s*=2)>n?s:n),n-=4+i,this.littleEndian?(this.view[n+3]=255&i>>>24,this.view[n+2]=255&i>>>16,this.view[n+1]=255&i>>>8,this.view[n]=255&i):(this.view[n]=255&i>>>24,this.view[n+1]=255&i>>>16,this.view[n+2]=255&i>>>8,this.view[n+3]=255&i),n+=4,c.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),n!==r+4+i)throw RangeError(\"Illegal range: Truncated data, \"+n+\" == \"+(n+4+i));return o?(this.offset=n,this):n-r},s.readIString=function(e){var t,n,i,r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+4) <= \"+this.buffer.byteLength)}return t=e,n=this.readUint32(e),i=this.readUTF8String(n,h.METRICS_BYTES,e+=4),e+=i.length,r?(this.offset=e,i.string):{string:i.string,length:e-t}},h.METRICS_CHARS=\"c\",h.METRICS_BYTES=\"b\",s.writeUTF8String=function(e,n){var i,r,s,o=void 0===n;if(o&&(n=this.offset),!this.noAssert){if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return r=n,i=c.calculateUTF16asUTF8(t(e))[1],n+=i,s=this.buffer.byteLength,n>s&&this.resize((s*=2)>n?s:n),n-=i,c.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),o?(this.offset=n,this):n-r},s.writeString=s.writeUTF8String,h.calculateUTF8Chars=function(e){return c.calculateUTF16asUTF8(t(e))[0]},h.calculateUTF8Bytes=function(e){return c.calculateUTF16asUTF8(t(e))[1]},h.calculateString=h.calculateUTF8Bytes,s.readUTF8String=function(e,t,i){var r,s,o,a,u;if(\"number\"==typeof t&&(i=t,t=void 0),(r=void 0===i)&&(i=this.offset),void 0===t&&(t=h.METRICS_CHARS),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal length: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof i||i%1!=0)throw TypeError(\"Illegal offset: \"+i+\" (not an integer)\");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+i+\" (+0) <= \"+this.buffer.byteLength)}if(o=0,a=i,t===h.METRICS_CHARS){if(s=n(),c.decodeUTF8(function(){return e>o&&i<this.limit?this.view[i++]:null}.bind(this),(function(e){++o,c.UTF8toUTF16(e,s)})),o!==e)throw RangeError(\"Illegal range: Truncated data, \"+o+\" == \"+e);return r?(this.offset=i,s()):{string:s(),length:i-a}}if(t===h.METRICS_BYTES){if(!this.noAssert){if(\"number\"!=typeof i||i%1!=0)throw TypeError(\"Illegal offset: \"+i+\" (not an integer)\");if((i>>>=0)<0||i+e>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+i+\" (+\"+e+\") <= \"+this.buffer.byteLength)}if(u=i+e,c.decodeUTF8toUTF16(function(){return u>i?this.view[i++]:null}.bind(this),s=n(),this.noAssert),i!==u)throw RangeError(\"Illegal range: Truncated data, \"+i+\" == \"+u);return r?(this.offset=i,s()):{string:s(),length:i-a}}throw TypeError(\"Unsupported metrics: \"+t)},s.readString=s.readUTF8String,s.writeVString=function(e,n){var i,r,s,o,a=void 0===n;if(a&&(n=this.offset),!this.noAssert){if(\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}if(s=n,i=c.calculateUTF16asUTF8(t(e),this.noAssert)[1],r=h.calculateVarint32(i),n+=r+i,o=this.buffer.byteLength,n>o&&this.resize((o*=2)>n?o:n),n-=r+i,n+=this.writeVarint32(i,n),c.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),n!==s+i+r)throw RangeError(\"Illegal range: Truncated data, \"+n+\" == \"+(n+i+r));return a?(this.offset=n,this):n-s},s.readVString=function(e){var t,n,i,r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}return t=e,n=this.readVarint32(e),i=this.readUTF8String(n.value,h.METRICS_BYTES,e+=n.length),e+=i.length,r?(this.offset=e,i.string):{string:i.string,length:e-t}},s.append=function(e,t,n){var i,r,s;if((\"number\"==typeof t||\"string\"!=typeof t)&&(n=t,t=void 0),(i=void 0===n)&&(n=this.offset),!this.noAssert){if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return e instanceof h||(e=h.wrap(e,t)),(r=e.limit-e.offset)<=0||((n+=r)>(s=this.buffer.byteLength)&&this.resize((s*=2)>n?s:n),n-=r,this.view.set(e.view.subarray(e.offset,e.limit),n),e.offset+=r,i&&(this.offset+=r)),this},s.appendTo=function(e,t){return e.append(this,t),this},s.assert=function(e){return this.noAssert=!e,this},s.capacity=function(){return this.buffer.byteLength},s.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},s.clone=function(e){var t=new h(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},s.compact=function(e,t){var n,i,r;if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}return 0===e&&t===this.buffer.byteLength?this:0==(n=t-e)?(this.buffer=o,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this):(i=new ArrayBuffer(n),(r=new Uint8Array(i)).set(this.view.subarray(e,t)),this.buffer=i,this.view=r,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=n,this)},s.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}if(e===t)return new h(0,this.littleEndian,this.noAssert);var n=t-e,i=new h(n,this.littleEndian,this.noAssert);return i.offset=0,i.limit=n,i.markedOffset>=0&&(i.markedOffset-=e),this.copyTo(i,0,e,t),i},s.copyTo=function(e,t,n,i){var r,s,o;if(!this.noAssert&&!h.isByteBuffer(e))throw TypeError(\"Illegal target: Not a ByteBuffer\");if(t=(s=void 0===t)?e.offset:0|t,n=(r=void 0===n)?this.offset:0|n,i=void 0===i?this.limit:0|i,t<0||t>e.buffer.byteLength)throw RangeError(\"Illegal target range: 0 <= \"+t+\" <= \"+e.buffer.byteLength);if(n<0||i>this.buffer.byteLength)throw RangeError(\"Illegal source range: 0 <= \"+n+\" <= \"+this.buffer.byteLength);return 0==(o=i-n)?e:(e.ensureCapacity(t+o),e.view.set(this.view.subarray(n,i),t),r&&(this.offset+=o),s&&(e.offset+=o),this)},s.ensureCapacity=function(e){var t=this.buffer.byteLength;return e>t?this.resize((t*=2)>e?t:e):this},s.fill=function(e,t,n){var i=void 0===t;if(i&&(t=this.offset),\"string\"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(t>>>=0,\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(n>>>=0,t<0||t>n||n>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+t+\" <= \"+n+\" <= \"+this.buffer.byteLength)}if(t>=n)return this;for(;n>t;)this.view[t++]=e;return i&&(this.offset=t),this},s.flip=function(){return this.limit=this.offset,this.offset=0,this},s.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+0) <= \"+this.buffer.byteLength)}return this.markedOffset=e,this},s.order=function(e){if(!this.noAssert&&\"boolean\"!=typeof e)throw TypeError(\"Illegal littleEndian: Not a boolean\");return this.littleEndian=!!e,this},s.LE=function(e){return this.littleEndian=void 0===e||!!e,this},s.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},s.prepend=function(e,t,n){var i,r,s,o,a;if((\"number\"==typeof t||\"string\"!=typeof t)&&(n=t,t=void 0),(i=void 0===n)&&(n=this.offset),!this.noAssert){if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return e instanceof h||(e=h.wrap(e,t)),(r=e.limit-e.offset)<=0||((s=r-n)>0?(o=new ArrayBuffer(this.buffer.byteLength+s),(a=new Uint8Array(o)).set(this.view.subarray(n,this.buffer.byteLength),r),this.buffer=o,this.view=a,this.offset+=s,this.markedOffset>=0&&(this.markedOffset+=s),this.limit+=s,n+=s):new Uint8Array(this.buffer),this.view.set(e.view.subarray(e.offset,e.limit),n-r),e.offset=e.limit,i&&(this.offset-=r)),this},s.prependTo=function(e,t){return e.prepend(this,t),this},s.printDebug=function(e){\"function\"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+\"\\n-------------------------------------------------------------------\\n\"+this.toDebug(!0))},s.remaining=function(){return this.limit-this.offset},s.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},s.resize=function(e){var t,n;if(!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal capacity: \"+e+\" (not an integer)\");if((e|=0)<0)throw RangeError(\"Illegal capacity: 0 <= \"+e)}return this.buffer.byteLength<e&&(t=new ArrayBuffer(e),(n=new Uint8Array(t)).set(this.view),this.buffer=t,this.view=n),this},s.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},s.skip=function(e){if(!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal length: \"+e+\" (not an integer)\");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError(\"Illegal length: 0 <= \"+this.offset+\" + \"+e+\" <= \"+this.buffer.byteLength);return this.offset=t,this},s.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}var n=this.clone();return n.offset=e,n.limit=t,n},s.toBuffer=function(e){var t,n=this.offset,i=this.limit;if(!this.noAssert){if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: Not an integer\");if(n>>>=0,\"number\"!=typeof i||i%1!=0)throw TypeError(\"Illegal limit: Not an integer\");if(i>>>=0,n<0||n>i||i>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+n+\" <= \"+i+\" <= \"+this.buffer.byteLength)}return e||0!==n||i!==this.buffer.byteLength?n===i?o:(t=new ArrayBuffer(i-n),new Uint8Array(t).set(new Uint8Array(this.buffer).subarray(n,i),0),t):this.buffer},s.toArrayBuffer=s.toBuffer,s.toString=function(e,t,n){if(void 0===e)return\"ByteBufferAB(offset=\"+this.offset+\",markedOffset=\"+this.markedOffset+\",limit=\"+this.limit+\",capacity=\"+this.capacity()+\")\";switch(\"number\"==typeof e&&(n=t=e=\"utf8\"),e){case\"utf8\":return this.toUTF8(t,n);case\"base64\":return this.toBase64(t,n);case\"hex\":return this.toHex(t,n);case\"binary\":return this.toBinary(t,n);case\"debug\":return this.toDebug();case\"columns\":return this.toColumns();default:throw Error(\"Unsupported encoding: \"+e)}},u=function(){var e,t,n={},i=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],r=[];for(e=0,t=i.length;t>e;++e)r[i[e]]=e;return n.encode=function(e,t){for(var n,r;null!==(n=e());)t(i[63&n>>2]),r=(3&n)<<4,null!==(n=e())?(t(i[63&((r|=15&n>>4)|15&n>>4)]),r=(15&n)<<2,null!==(n=e())?(t(i[63&(r|3&n>>6)]),t(i[63&n])):(t(i[63&r]),t(61))):(t(i[63&r]),t(61),t(61))},n.decode=function(e,t){function n(e){throw Error(\"Illegal character code: \"+e)}for(var i,s,o;null!==(i=e());)if(void 0===(s=r[i])&&n(i),null!==(i=e())&&(void 0===(o=r[i])&&n(i),t(s<<2>>>0|(48&o)>>4),null!==(i=e()))){if(void 0===(s=r[i])){if(61===i)break;n(i)}if(t((15&o)<<4>>>0|(60&s)>>2),null!==(i=e())){if(void 0===(o=r[i])){if(61===i)break;n(i)}t((3&s)<<6>>>0|o)}}},n.test=function(e){return/^(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=)?$/.test(e)},n}(),s.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||e>t)throw RangeError(\"begin, end\");var i;return u.encode(function(){return t>e?this.view[e++]:null}.bind(this),i=n()),i()},h.fromBase64=function(e,n){if(\"string\"!=typeof e)throw TypeError(\"str\");var i=new h(e.length/4*3,n),r=0;return u.decode(t(e),(function(e){i.view[r++]=e})),i.limit=r,i},h.btoa=function(e){return h.fromBinary(e).toBase64()},h.atob=function(e){return h.fromBase64(e).toBinary()},s.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||e>t)throw RangeError(\"begin, end\");if(e===t)return\"\";for(var n=[],i=[];t>e;)n.push(this.view[e++]),n.length>=1024&&(i.push(String.fromCharCode.apply(String,n)),n=[]);return i.join(\"\")+String.fromCharCode.apply(String,n)},h.fromBinary=function(e,t){if(\"string\"!=typeof e)throw TypeError(\"str\");for(var n,i=0,r=e.length,s=new h(r,t);r>i;){if((n=e.charCodeAt(i))>255)throw RangeError(\"illegal char code: \"+n);s.view[i++]=n}return s.limit=r,s},s.toDebug=function(e){for(var t,n=-1,i=this.buffer.byteLength,r=\"\",s=\"\",o=\"\";i>n;){if(-1!==n&&(r+=(t=this.view[n])<16?\"0\"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(s+=t>32&&t<127?String.fromCharCode(t):\".\")),++n,e&&n>0&&n%16==0&&n!==i){for(;r.length<51;)r+=\" \";o+=r+s+\"\\n\",r=s=\"\"}r+=n===this.offset&&n===this.limit?n===this.markedOffset?\"!\":\"|\":n===this.offset?n===this.markedOffset?\"[\":\"<\":n===this.limit?n===this.markedOffset?\"]\":\">\":n===this.markedOffset?\"'\":e||0!==n&&n!==i?\" \":\"\"}if(e&&\" \"!==r){for(;r.length<51;)r+=\" \";o+=r+s+\"\\n\"}return e?o:r},h.fromDebug=function(e,t,n){for(var i,r,s=e.length,o=new h(0|(s+1)/3,t,n),a=0,u=0,c=!1,l=!1,d=!1,f=!1,p=!1;s>a;){switch(i=e.charAt(a++)){case\"!\":if(!n){if(l||d||f){p=!0;break}l=d=f=!0}o.offset=o.markedOffset=o.limit=u,c=!1;break;case\"|\":if(!n){if(l||f){p=!0;break}l=f=!0}o.offset=o.limit=u,c=!1;break;case\"[\":if(!n){if(l||d){p=!0;break}l=d=!0}o.offset=o.markedOffset=u,c=!1;break;case\"<\":if(!n){if(l){p=!0;break}l=!0}o.offset=u,c=!1;break;case\"]\":if(!n){if(f||d){p=!0;break}f=d=!0}o.limit=o.markedOffset=u,c=!1;break;case\">\":if(!n){if(f){p=!0;break}f=!0}o.limit=u,c=!1;break;case\"'\":if(!n){if(d){p=!0;break}d=!0}o.markedOffset=u,c=!1;break;case\" \":c=!1;break;default:if(!n&&c){p=!0;break}if(r=parseInt(i+e.charAt(a++),16),!n&&(isNaN(r)||r<0||r>255))throw TypeError(\"Illegal str: Not a debug encoded string\");o.view[u++]=r,c=!0}if(p)throw TypeError(\"Illegal str: Invalid symbol at \"+a)}if(!n){if(!l||!f)throw TypeError(\"Illegal str: Missing offset or limit\");if(u<o.buffer.byteLength)throw TypeError(\"Illegal str: Not a debug encoded string (is it hex?) \"+u+\" < \"+s)}return o},s.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}for(var n,i=new Array(t-e);t>e;)(n=this.view[e++])<16?i.push(\"0\",n.toString(16)):i.push(n.toString(16));return i.join(\"\")},h.fromHex=function(e,t,n){var i,r,s,o,a;if(!n){if(\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");if(e.length%2!=0)throw TypeError(\"Illegal str: Length not a multiple of 2\")}for(r=e.length,s=new h(0|r/2,t),o=0,a=0;r>o;o+=2){if(i=parseInt(e.substring(o,o+2),16),!n&&(!isFinite(i)||i<0||i>255))throw TypeError(\"Illegal str: Contains non-hex characters\");s.view[a++]=i}return s.limit=a,s},c=function(){var e={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var n=null;for(\"number\"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<128?t(127&n):n<2048?(t(192|31&n>>6),t(128|63&n)):n<65536?(t(224|15&n>>12),t(128|63&n>>6),t(128|63&n)):(t(240|7&n>>18),t(128|63&n>>12),t(128|63&n>>6),t(128|63&n)),n=null},decodeUTF8:function(e,t){for(var n,i,r,s,o=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name=\"TruncatedError\",t.bytes=e,t};null!==(n=e());)if(0==(128&n))t(n);else if(192==(224&n))null===(i=e())&&o([n,i]),t((31&n)<<6|63&i);else if(224==(240&n))(null===(i=e())||null===(r=e()))&&o([n,i,r]),t((15&n)<<12|(63&i)<<6|63&r);else{if(240!=(248&n))throw RangeError(\"Illegal starting byte: \"+n);(null===(i=e())||null===(r=e())||null===(s=e()))&&o([n,i,r,s]),t((7&n)<<18|(63&i)<<12|(63&r)<<6|63&s)}},UTF16toUTF8:function(e,t){for(var n,i=null;null!==(n=null!==i?i:e());)n>=55296&&n<=57343&&null!==(i=e())&&i>=56320&&i<=57343?(t(1024*(n-55296)+i-56320+65536),i=null):t(n);null!==i&&t(i)},UTF8toUTF16:function(e,t){var n=null;for(\"number\"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<=65535?t(n):(t(55296+((n-=65536)>>10)),t(n%1024+56320)),n=null},encodeUTF16toUTF8:function(t,n){e.UTF16toUTF8(t,(function(t){e.encodeUTF8(t,n)}))},decodeUTF8toUTF16:function(t,n){e.decodeUTF8(t,(function(t){e.UTF8toUTF16(t,n)}))},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,n=0;null!==(t=e());)n+=t<128?1:t<2048?2:t<65536?3:4;return n},calculateUTF16asUTF8:function(t){var n=0,i=0;return e.UTF16toUTF8(t,(function(e){++n,i+=e<128?1:e<2048?2:e<65536?3:4})),[n,i]}};return e}(),s.toUTF8=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}var i;try{c.decodeUTF8toUTF16(function(){return t>e?this.view[e++]:null}.bind(this),i=n())}catch(n){if(e!==t)throw RangeError(\"Illegal range: Truncated data, \"+e+\" != \"+t)}return i()},h.fromUTF8=function(e,n,i){if(!i&&\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");var r=new h(c.calculateUTF16asUTF8(t(e),!0)[1],n,i),s=0;return c.encodeUTF16toUTF8(t(e),(function(e){r.view[s++]=e})),r.limit=s,r},h}(ci=function(){function e(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function t(e){return!0===(e&&e.__isLong__)}function n(e,t){var n,i,s;return t?(s=(e>>>=0)>=0&&e<256)&&(i=u[e])?i:(n=r(e,(0|e)<0?-1:0,!0),s&&(u[e]=n),n):(s=(e|=0)>=-128&&e<128)&&(i=a[e])?i:(n=r(e,e<0?-1:0,!1),s&&(a[e]=n),n)}function i(e,t){if(isNaN(e)||!isFinite(e))return t?g:p;if(t){if(e<0)return g;if(e>=l)return m}else{if(-d>=e)return I;if(e+1>=d)return E}return e<0?i(-e,t).neg():r(0|e%h,0|e/h,t)}function r(t,n,i){return new e(t,n,i)}function s(e,t,n){var r,o,a,u,h,l,d;if(0===e.length)throw Error(\"empty string\");if(\"NaN\"===e||\"Infinity\"===e||\"+Infinity\"===e||\"-Infinity\"===e)return p;if(\"number\"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||n>36)throw RangeError(\"radix\");if((r=e.indexOf(\"-\"))>0)throw Error(\"interior hyphen\");if(0===r)return s(e.substring(1),t,n).neg();for(o=i(c(n,8)),a=p,u=0;u<e.length;u+=8)h=Math.min(8,e.length-u),l=parseInt(e.substring(u,u+h),n),h<8?(d=i(c(n,h)),a=a.mul(d).add(i(l))):a=(a=a.mul(o)).add(i(l));return a.unsigned=t,a}function o(t){return t instanceof e?t:\"number\"==typeof t?i(t):\"string\"==typeof t?s(t):r(t.low,t.high,t.unsigned)}var a,u,c,h,l,d,f,p,g,_,y,v,E,m,I,T;return e.prototype.__isLong__,Object.defineProperty(e.prototype,\"__isLong__\",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t,a={},u={},e.fromInt=n,e.fromNumber=i,e.fromBits=r,c=Math.pow,e.fromString=s,e.fromValue=o,d=(l=(h=4294967296)*h)/2,f=n(16777216),p=n(0),e.ZERO=p,g=n(0,!0),e.UZERO=g,_=n(1),e.ONE=_,y=n(1,!0),e.UONE=y,v=n(-1),e.NEG_ONE=v,E=r(-1,2147483647,!1),e.MAX_VALUE=E,m=r(-1,-1,!0),e.MAX_UNSIGNED_VALUE=m,I=r(0,-2147483648,!1),e.MIN_VALUE=I,(T=e.prototype).toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},T.toString=function(e){var t,n,r,s,o,a,u,h;if((e=e||10)<2||e>36)throw RangeError(\"radix\");if(this.isZero())return\"0\";if(this.isNegative())return this.eq(I)?(t=i(e),r=(n=this.div(t)).mul(t).sub(this),n.toString(e)+r.toInt().toString(e)):\"-\"+this.neg().toString(e);for(s=i(c(e,6),this.unsigned),o=this,a=\"\";;){if(u=o.div(s),h=(o.sub(u.mul(s)).toInt()>>>0).toString(e),(o=u).isZero())return h+a;for(;h.length<6;)h=\"0\"+h;a=\"\"+h+a}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){var e,t;if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return t(e)||(e=o(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.compare=function(e){if(t(e)||(e=o(e)),this.eq(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(_)},T.neg=T.negate,T.add=function(e){var n,i,s,a,u,c,h,l,d,f,p;return t(e)||(e=o(e)),n=this.high>>>16,i=65535&this.high,s=this.low>>>16,a=65535&this.low,u=e.high>>>16,c=65535&e.high,h=e.low>>>16,l=0,d=0,f=0,p=0,f+=(p+=a+(65535&e.low))>>>16,d+=(f+=s+h)>>>16,l+=(d+=i+c)>>>16,l+=n+u,r((f&=65535)<<16|(p&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},T.subtract=function(e){return t(e)||(e=o(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){var n,s,a,u,c,h,l,d,g,_,y,v;return this.isZero()?p:(t(e)||(e=o(e)),e.isZero()?p:this.eq(I)?e.isOdd()?I:p:e.eq(I)?this.isOdd()?I:p:this.isNegative()?e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg():e.isNegative()?this.mul(e.neg()).neg():this.lt(f)&&e.lt(f)?i(this.toNumber()*e.toNumber(),this.unsigned):(n=this.high>>>16,s=65535&this.high,a=this.low>>>16,u=65535&this.low,c=e.high>>>16,h=65535&e.high,l=e.low>>>16,g=0,_=0,y=0,v=0,y+=(v+=u*(d=65535&e.low))>>>16,_+=(y+=a*d)>>>16,y&=65535,_+=(y+=u*l)>>>16,g+=(_+=s*d)>>>16,_&=65535,g+=(_+=a*l)>>>16,_&=65535,g+=(_+=u*h)>>>16,g+=n*d+s*l+a*h+u*c,r((y&=65535)<<16|(v&=65535),(g&=65535)<<16|(_&=65535),this.unsigned)))},T.mul=T.multiply,T.divide=function(e){var n,r,s,a,u,h,l;if(t(e)||(e=o(e)),e.isZero())throw Error(\"division by zero\");if(this.isZero())return this.unsigned?g:p;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return y;s=g}else{if(this.eq(I))return e.eq(_)||e.eq(v)?I:e.eq(I)?_:(n=this.shr(1).div(e).shl(1)).eq(p)?e.isNegative()?_:v:(r=this.sub(e.mul(n)),s=n.add(r.div(e)));if(e.eq(I))return this.unsigned?g:p;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=p}for(r=this;r.gte(e);){for(n=Math.max(1,Math.floor(r.toNumber()/e.toNumber())),u=(a=Math.ceil(Math.log(n)/Math.LN2))<=48?1:c(2,a-48),l=(h=i(n)).mul(e);l.isNegative()||l.gt(r);)l=(h=i(n-=u,this.unsigned)).mul(e);h.isZero()&&(h=_),s=s.add(h),r=r.sub(l)}return s},T.div=T.divide,T.modulo=function(e){return t(e)||(e=o(e)),this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.not=function(){return r(~this.low,~this.high,this.unsigned)},T.and=function(e){return t(e)||(e=o(e)),r(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return t(e)||(e=o(e)),r(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return t(e)||(e=o(e)),r(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?r(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):r(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?r(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):r(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){var n;return t(e)&&(e=e.toInt()),0==(e&=63)?this:(n=this.high,e<32?r(this.low>>>e|n<<32-e,n>>>e,this.unsigned):r(32===e?n:n>>>e-32,0,this.unsigned))},T.shru=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?r(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:r(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,255&t>>>8,255&t>>>16,255&t>>>24,255&e,255&e>>>8,255&e>>>16,255&e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[255&e>>>24,255&e>>>16,255&e>>>8,255&e,255&t>>>24,255&t>>>16,255&t>>>8,255&t]},e}()),ci));fi.getModule=function(e){var t=new fi[e];return t.getArrayData=function(){var e=t.toArrayBuffer();return e=$(e)?[].slice.call(new Int8Array(e)):e},t};var pi,gi=\"pgMsgP\",_i=\"chatMsg\",yi=\"pcMsgP\",vi={PRIVATE:\"ppMsgS\",GROUP:\"pgMsgS\",CHATROOM:\"chatMsgS\"},Ei=\"delMsg\",mi=\"joinChrm\",Ii=\"joinChrmR\",Ti=\"exitChrm\",Ci=\"setKV\",Ri=\"delKV\",Si=\"setKVS\",Ni=\"delKVS\",Oi=\"qryRelationR\",wi=\"delRelation\",bi=\"setSeAtt\",Mi={PRIVATE:\"cleanPMsg\",GROUP:\"cleanGMsg\",CUSTOMER_SERVICE:\"cleanCMsg\",SYSTEM:\"cleanSMsg\"},Ai=\"qryPMsg\",Ui=\"qryGMsg\",Li=\"qryCHMsg\",Pi=\"qryCMsg\",Di=\"qrySMsg\",Vi=((hi={})[\"ppMsgP\"]=j.PRIVATE,hi[gi]=j.GROUP,hi[_i]=j.CHATROOM,hi[yi]=j.CUSTOMER_SERVICE,hi),ki=((li={})[j.PRIVATE]=Ai,li[j.GROUP]=Ui,li[j.CHATROOM]=Li,li[j.CUSTOMER_SERVICE]=Pi,li[j.SYSTEM]=Di,li),xi=((di={})[j.PRIVATE]=Mi.PRIVATE,di[j.GROUP]=Mi.GROUP,di[j.CUSTOMER_SERVICE]=Mi.CUSTOMER_SERVICE,di[j.SYSTEM]=Mi.SYSTEM,di),Bi=\"1\",Fi=\"0\",Ki=1,qi=2,Yi=3,Hi=function(){function e(e){this._codec=\"websocket\"===e?fi:ri,this._connectType=e}return e.prototype.decodeByPBName=function(e,t,n){var i,r=this,s=e,o=((i={})[bt]=r._formatSyncMessages,i[wt]=r._formatReceivedMessage,i[Nt]=r._formatSentMessage,i[Vt]=r._formatHistoryMessages,i[xt]=r._formatConversationList,i[Jt]=r._formatChatRoomInfos,i[Zt]=r._formatRTCUserList,i[on]=r._formatRTCData,i[Tn]=r._formatChatRoomKVList,i[bn]=r._formatUserSetting,i[Un]=r._formatConversationStatus,i[Bn]=r._formatGrpReadReceiptQryResp,i[On]=r._formatSetUserSettingOutput,i[Mn]=r._formatUserSettingNotification,i[Jn]=r._formatRTCRoomKVList,i[sn]=r._formatRTCAuidenceJoinRoomData,i[Zn]=r._formatRTCJoinedUserInfo,i)[t];try{s=e.length>0&&r._codec[t].decode(e),ne(s)&&(s=function(e){for(var t in e)ne(e[t])&&(e[t]=nt(e[t]));return e}(s)),ie(o)&&(s=o.call(this,s,n))}catch(n){pe.error(\"PB parse error\\n\",n,e,t)}return s},e.prototype._readBytes=function(e){var t=e.offset,n=e.buffer,i=e.limit;if(t)try{var r=$(n)?new Uint8Array(n):n;return Ct.readUTF(r.subarray(t,i))}catch(e){pe.info(\"readBytes error\\n\",e)}return e},e.prototype._formatBytes=function(e){var t=this._readBytes(e);try{t=JSON.parse(t)}catch(e){pe.info(\"formatBytes error\\n\",e)}return t||e},e.prototype._formatSyncMessages=function(e,t){t=t||{};var n=this,i=e.list,r=e.syncTime,s=e.finished;return(re(s)||null===s)&&(e.finished=!0),e.syncTime=nt(r),e.list=ht(i,(function(e){return n._formatReceivedMessage(e,t)})),e},e.prototype._formatReceivedMessage=function(e,t){var n=(t=t||{}).currentUserId,r=t.connectedTime,s=e.content,o=e.fromUserId,a=e.type,u=e.groupId,c=e.status,h=e.dataTime,l=e.classname,d=e.msgId,f=e.extraContent,p=e.pushContent,g=e.pushExt,_=e.configFlag,y=(e.direction||ye.RECEIVE)===ye.SEND,v=function(e){var t=i.READ;return{isPersited:!!(16&e),isCounted:!!(32&e),isMentioned:!!(64&e),disableNotification:!!(512&e),receivedStatus:t=2&e?i.RETRIEVED:t,canIncludeExpansion:!!(1024&e)}}(c),E=v.isPersited,m=v.isCounted,I=v.isMentioned,T=v.disableNotification,C=v.receivedStatus,R=v.canIncludeExpansion,S=[j.GROUP,j.CHATROOM,j.RTC_ROOM].indexOf(a)>-1?u:o,N=y?n:o,w=nt(h),b=w<r,M=a===j.CHATROOM,A=this._formatBytes(s),U={};if(g&&(U=ot(g.pushConfigs,g.pushId)),A.user){var L=A.user,P=L.portrait,D=L.portraitUri,V=P||D;V&&(A.user.portrait=A.user.portraitUri=V)}var k,x=O(O({},U),{pushTitle:null==g?void 0:g.title,pushContent:p,pushData:p,disablePushTitle:!!_&&Boolean(4&_),forceShowDetailContent:!!_&&Boolean(8&_),templateId:null==g?void 0:g.templateId}),B=y?ye.SEND:ye.RECEIVE;return M&&o===n&&(B=ye.SEND),f&&(k={},k=vt(f)),{conversationType:a,targetId:S,senderUserId:N,messageType:l,messageUId:d,isPersited:E,isCounted:m,isMentioned:I,sentTime:w,isOffLineMessage:b,messageDirection:B,receivedTime:Et.getTime(),disableNotification:T,receivedStatus:C,canIncludeExpansion:R,content:A,expansion:k,configFlag:_,pushConfig:x,channelId:e.busChannel||\"\"}},e.prototype._formatSentMessage=function(e,t){var n,i=e.content,r=e.classname,s=e.sessionId,o=e.msgId,a=e.extraContent,u=e.pushExt,c=e.pushContent,h=e.configFlag,l=t.signal,d=t.currentUserId,f=l.date,p=l.topic,g=l.targetId,_=function(e){return{isPersited:!!(1&e),isCounted:!!(2&e),disableNotification:!!(32&e),canIncludeExpansion:!!(64&e)}}(s),y=_.isPersited,v=_.isCounted,E=_.disableNotification,m=_.canIncludeExpansion,I=Vi[p]||j.PRIVATE,T=ft(vi,p),C=this._formatBytes(i),R=g;r===Re.RECALL&&(I=C.conversationType||I,R=C.targetId||g),a&&(n={},n=vt(a));var S={};u&&(S=ot(u.pushConfigs,u.pushId));var N=O(O({},S),{pushTitle:null==u?void 0:u.title,pushContent:c,pushData:c,disablePushTitle:!!h&&Boolean(4&h),forceShowDetailContent:!!h&&Boolean(8&h),templateId:null==u?void 0:u.templateId});return{conversationType:I,targetId:R,messageType:r,messageUId:o,isPersited:y,isCounted:v,isStatusMessage:T,senderUserId:d,content:this._formatBytes(i),sentTime:1e3*f,receivedTime:Et.getTime(),messageDirection:ye.SEND,isOffLineMessage:!1,disableNotification:E,canIncludeExpansion:m,expansion:n,pushConfig:N,channelId:e.busChannel||\"\"}},e.prototype._formatHistoryMessages=function(e,t){var n=this,i=t.conversation||{},r=e.list,s=e.hasMsg,o=i.targetId,a=nt(e.syncTime),u=[];return ct(r,(function(e){var i=n._formatReceivedMessage(e,t);i.targetId=o,u.push(i)}),{isReverse:!0}),{syncTime:a,list:u,hasMore:!!s}},e.prototype._formatConversationList=function(e,t){var n=this,i=e.info,r=t.afterDecode||function(){};return(i=ht(i,(function(e){var i=e.msg,s=e.userId,o=e.type,a=e.unreadCount,u=e.busChannel,c=null;i&&((c=n._formatReceivedMessage(i,t)).targetId=s);var h={targetId:s,conversationType:o,unreadMessageCount:a,latestMessage:c,channelId:u||\"\"};return r(h)||h})))||[]},e.prototype._formatSetUserSettingOutput=function(e){return e},e.prototype._formatChatRoomInfos=function(e){var t=e.userTotalNums,n=e.userInfos;return{userCount:t,userInfos:ht(n,(function(e){var t=e.id,n=e.time;return{id:t,time:nt(n)}}))}},e.prototype._formatChatRoomKVList=function(e){var t=e.entries,n=e.bFullUpdate,i=e.syncTime;return{kvEntries:t=ht(t=t||[],(function(e){var t=e.key,n=e.value,i=e.status,r=e.timestamp,s=e.uid,o=function(e){return{isAutoDelete:!!(1&e),isOverwrite:!!(2&e),type:4&e?Ue.DELETE:Ue.UPDATE}}(i);return{key:t,value:n,isAutoDelete:o.isAutoDelete,isOverwrite:o.isOverwrite,type:o.type,userId:s,timestamp:nt(r)}})),isFullUpdate:n,syncTime:i}},e.prototype._formatUserSetting=function(e){var t=this,n=e.items,i=e.version,r={};return ct(n||[],(function(e){var n=e.key,i=e.version,s=e.value;e.version=nt(i),e.value=t._readBytes(s),\"Tag\"===n&&e.tags.forEach((function(e){e.createdTime=nt(e.createdTime),e.tagName=e.name})),r[n]=e})),{settings:r,version:i}},e.prototype._formatConversationStatus=function(e){var t=e.state,n=[];return ct(t,(function(e){var t=e.type,i=e.channelId,r=e.time,s=e.stateItem,o=e.busChannel,a=Ne.CLOSE,u=!1,c=[];ct(s,(function(e){var t=e.sessionStateType,n=e.value,i=e.tags;switch(t){case Ki:a=n===Bi?Ne.OPEN:Ne.CLOSE;break;case qi:u=n===Bi;break;case Yi:c=i}})),n.push({conversationType:t,type:t,targetId:i,notificationStatus:a,isTop:u,updatedTime:nt(r),tags:c,channelId:o||\"\"})})),n},e.prototype._formatRTCUserList=function(e){var t=e.users,n=e.token,i=e.sessionId,r=e.roomInfo,s=e.entries,o={};return ct(t,(function(e){var t=e.userId,n=e.userData,i={};ct(n,(function(e){var t=e.key,n=e.value;i[t]=n})),o[t]=i})),{users:o,token:n,sessionId:i,roomInfo:r,kvEntries:s}},e.prototype._formatRTCData=function(e){var t=e.outInfo,n={};return ct(t,(function(e){n[e.key]=e.value})),n},e.prototype._formatRTCRoomInfo=function(e){var t=e.roomId,n=e.userCount,i=e.roomData,r={id:t,total:n};return ct(i,(function(e){r[e.key]=e.value})),r},e.prototype._formatGrpReadReceiptQryResp=function(e){var t=e.totalMemberNum,n=e.list;return n.forEach((function(e){e.readTime=nt(e.readTime)})),{totalMemberCount:t,list:n}},e.prototype._formatUserSettingNotification=function(e){return e},e.prototype._formatRTCRoomKVList=function(e){var t=e.entries,n=e.bFullUpdate,i=e.syncTime;return{kvEntries:t=(t=t||[]).map((function(e){var t=e.timestamp;return Object.assign(e,{timestamp:nt(t)})})),isFullUpdate:n,syncTime:i}},e.prototype._formatRTCAuidenceJoinRoomData=function(e){return e},e.prototype._formatRTCJoinedUserInfo=function(e){return(e.info||[]).map((function(e){return{deviceId:e.deviceId,roomId:e.roomId,joinTime:nt(e.joinTime)}}))},e.prototype.encodeServerConfParams=function(){var e=this._codec.getModule(Mt);return e.setNothing(1),e.getArrayData()},e.prototype._getUpMsgModule=function(e,t){var n,i,r,s=\"comet\"===this._connectType,o=(e.conversationType,t.messageType),a=t.isMentioned,u=t.mentionedType,c=t.mentionedUserIdList,h=t.content,l=t.pushContent,d=t.pushData,f=t.directionalUserIdList,p=t.isFilerWhiteBlacklist,g=t.isVoipPush,_=t.canIncludeExpansion,y=t.expansion,v=t.pushConfig,E=t.channelId;j.GROUP;var m=this._codec.getModule(Nt),I=function(e){var t=e.isStatusMessage,n=e.isPersited,i=e.isCounted;t&&(n=i=!1);var r=0;return n&&(r|=1),i&&(r|=2),e.isMentioned&&(r|=4),e.disableNotification&&(r|=32),e.canIncludeExpansion&&(r|=64),r}(t),T=v||{},C=T.pushTitle,R=T.pushContent,S=T.pushData,N=T.iOSConfig,O=T.androidConfig,w=T.templateId,b=T.disablePushTitle,M=T.forceShowDetailContent,A=0;m.setSessionId(I),a&&h&&(h.mentionedInfo={userIdList:(null===(n=h.mentionedInfo)||void 0===n?void 0:n.userIdList)||c||[],type:(null===(i=h.mentionedInfo)||void 0===i?void 0:i.type)||u||we.ALL,mentionedContent:(null===(r=h.mentionedInfo)||void 0===r?void 0:r.mentionedContent)||\"\"});var U=R||l||\"\",L=S||d||\"\";if(U&&m.setPushText(U),L&&m.setAppData(L),f&&m.setUserId(f),A|=g?1:0,A|=p?2:0,A|=b?4:0,A|=M?8:0,m.setConfigFlag(A),m.setClassname(o),h.user&&h.user.portraitUri&&(h.user.portrait=h.user.portraitUri),m.setContent(JSON.stringify(h)),_&&y){var P={};ct(y,(function(e,t){P[t]={v:e}})),m.setExtraContent(JSON.stringify(P))}if(v){var D=this._codec.getModule(Ot);if(C&&D.setTitle(C),N&&O){var V=st(N,O);D.setPushConfigs(V)}(null==O?void 0:O.notificationId)&&D.setPushId(null==O?void 0:O.notificationId),D.setTemplateId(w||\"\"),m.setPushExt(s?D.getArrayData():D)}return re(E)||m.setBusChannel(E),m},e.prototype.encodeUpMsg=function(e,t){return this._getUpMsgModule(e,t).getArrayData()},e.prototype.encodeSyncMsg=function(e){var t=e.sendboxTime,n=e.inboxTime,i=this._codec.getModule(Ut);return i.setIspolling(!1),i.setIsPullSend(!0),i.setSendBoxSyncTime(t),i.setSyncTime(n),i.getArrayData()},e.prototype.encodeChrmSyncMsg=function(e,t){e=e||0,t=t||0;var n=this._codec.getModule(Lt);return n.setCount(t),n.setSyncTime(e),n.getArrayData()},e.prototype.encodeGetHistoryMsg=function(e,t){var n=t.count,i=t.order,r=t.timestamp,s=t.channelId,o=this._codec.getModule(Dt);return o.setTargetId(e),o.setTime(r),o.setCount(n),o.setOrder(i),o.setBusChannel(s||\"\"),o.getArrayData()},e.prototype.encodeGetConversationList=function(e){var t=(e=e||{}).count,n=e.startTime,i=this._codec.getModule(kt);return i.setType(1),i.setCount(t),i.setStartTime(n),i.getArrayData()},e.prototype.encodeOldConversationList=function(e){var t=(e=e||{}).count,n=e.type,i=e.startTime,r=e.order;t=t||0,i=i||0,r=r||0;var s=this._codec.getModule(kt);return s.setType(n),s.setCount(t),s.setStartTime(i),s.setOrder(r),s.getArrayData()},e.prototype.encodeRemoveOldConversationList=function(e){var t=(e=e||{}).conversationType,n=e.channelId,i=this._codec.getModule(qt);return i.setType(t),i.setBusChannel(n),i.getArrayData()},e.prototype.encodeRemoveConversationList=function(e){var t=this,n=this._codec.getModule(Bt),i=[];return ct(e,(function(e){var n=e.conversationType,r=e.targetId,s=t._codec.getModule(Ft);s.setType(n),s.setChannelId(r),i.push(s)})),n.setSessions(i),n.getArrayData()},e.prototype.encodeDeleteMessages=function(e,t,n,i){var r=this._codec.getModule(Yt),s=[];return ct(n,(function(e){s.push({msgId:e.messageUId,msgDataTime:e.sentTime,direct:e.messageDirection})})),r.setType(e),r.setConversationId(t),r.setMsgs(s),r.setBusChannel(i),r.getArrayData()},e.prototype.encodeClearMessages=function(e,t,n){var i=this._codec.getModule(Ht);return t=t||(new Date).getTime(),i.setDataTime(t),i.setTargetId(e),i.setBusChannel(n),i.getArrayData()},e.prototype.encodeClearUnreadCount=function(e,t){var n=e.conversationType,i=e.targetId,r=t.timestamp,s=this._codec.getModule(Gt);return r=r||+new Date,s.setType(n),s.setChannelId(i),s.setMsgTime(r),s.getArrayData()},e.prototype.encodeJoinOrQuitChatRoom=function(){var e=this._codec.getModule(jt);return e.setNothing(1),e.getArrayData()},e.prototype.encodeGetChatRoomInfo=function(e,t){var n=this._codec.getModule(Wt);return n.setCount(e),n.setOrder(t),n.getArrayData()},e.prototype.encodeGetFileToken=function(e,t,n,i){var r=this._codec.getModule(fn);return r.setType(e),r.setKey(t),r.setHttpMethod(n),r.setQueryString(i),r.getArrayData()},e.prototype.encodeGetFileUrl=function(e,t,n,i){var r=this._codec.getModule(e);return r.setType(t),r.setKey(n),i&&r.setFileName(i),r.getArrayData()},e.prototype.encodeModifyChatRoomKV=function(e,t,n){var i=\"comet\"===this._connectType,r=this._codec.getModule(En),s=t.key,o=t.value,a=t.notificationExtra,u=t.isSendNotification,c=t.type||Ue.UPDATE,h=mt(t,c),l={key:s,value:o||\"\",uid:n};if(re(h)||(l.status=h),r.setEntry(l),u){var d={conversationType:j.CHATROOM,targetId:e},f={key:s,value:o,extra:a,type:c},p=this._getUpMsgModule(d,{messageType:Re.CHRM_KV_NOTIFY,content:f,isPersited:!1,isCounted:!1});i?r.setNotification(p.getArrayData()):r.setNotification(p),r.setBNotify(!0),r.setType(j.CHATROOM)}return r.getArrayData()},e.prototype.encodeModifyChatRoomKVS=function(e,t,n){this._connectType;var i=this._codec.getModule(mn),r=t.entries,s=t.type||Ue.UPDATE,o=mt(t,s),a=[];return r.forEach((function(e){var t={key:e.key,value:e.value||\"\",uid:n};re(o)||(t.status=o),a.push(t)})),i.setEntry(a),i.getArrayData()},e.prototype.encodePullChatRoomKV=function(e){var t=this._codec.getModule(Sn);return t.setTimestamp(e),t.getArrayData()},e.prototype.encodePullUserSetting=function(e){var t=this._codec.getModule(wn);return t.setVersion(e),t.getArrayData()},e.prototype.encodeGetConversationStatus=function(e){var t=this._codec.getModule(An);return t.setTime(e),t.getArrayData()},e.prototype.encodeSetConversationStatus=function(e){var t=this,n=\"comet\"===this._connectType,i=this._codec.getModule(Dn),r=Et.getTime(),s=[];return ct(e,(function(e){var i=t._codec.getModule(Ln),o=e.conversationType,a=e.targetId,u=e.notificationStatus,c=e.isTop,h=e.channelId,l=[];i.setType(o),i.setChannelId(a),i.setTime(r),i.setBusChannel(h);var d=u===Ne.OPEN,f={};re(u)||(f[Ki]=d),re(c)||(f[qi]=c),ct(f,(function(e,i){if(!re(e)){var r=t._codec.getModule(Pn);e=e?Bi:Fi,r.setSessionStateType(Number(i)),r.setValue(e);var s=n?r.getArrayData():r;l.push(s)}})),i.setStateItem(l);var p=n?i.getArrayData():i;s.push(p)})),i.setVersion(r),i.setState(s),i.getArrayData()},e.prototype.encodeReadReceipt=function(e,t){var n=this._codec.getModule(kn);return n.setMsgId(e),t&&n.setChannelId(t),n.getArrayData()},e.prototype.encodeCreateTag=function(e,t){var n=this,i=\"comet\"===this._connectType,r=this._codec.getModule(Kn),s=[];return e.forEach((function(e){var t=n._codec.getModule(qn);t.setTagId(e.tagId),t.setName(e.tagName),s.push(i?t.getArrayData():t)})),r.setTags(s),r.setVersion(t),r.getArrayData()},e.prototype.encodeMessageReader=function(e,t){var n=this._codec.getModule(kn);return n.setMsgId(e),t&&n.setChannelId(t),n.getArrayData()},e.prototype.encodeRemoveTag=function(e,t){var n=this,i=\"comet\"===this._connectType,r=this._codec.getModule(Yn),s=[];return e.forEach((function(e){var t=n._codec.getModule(qn);t.setTagId(e),s.push(i?t.getArrayData():t)})),r.setTags(s),r.setVersion(t),r.getArrayData()},e.prototype.encodeDisConversationTag=function(e){var t=this._codec.getModule(Hn);return t.setTagId(e),t.getArrayData()},e.prototype.encodeUpdateConversationTag=function(e,t){var n=this,i=\"comet\"===this._connectType,r=this._codec.getModule(Dn),s=[];return t.forEach((function(t){var r=n._codec.getModule(Ln),o=n._codec.getModule(Pn),a=[];e.forEach((function(e){var t=n._codec.getModule(qn);t.setTagId(e.tagId),re(e.isTop)||t.setIsTop(e.isTop),a.push(i?t.getArrayData():t)})),o.setSessionStateType(Yi),o.setValue(JSON.stringify(a)),o.setTags(a),r.setType(t.conversationType),r.setChannelId(t.targetId),r.setTime(Date.now()),r.setStateItem([i?o.getArrayData():o]),s.push(i?r.getArrayData():r)})),r.setState(s),r.setVersion(Et.getTime()),r.getArrayData()},e.prototype.encodeReportSDKInfo=function(e){var t=this._codec.getModule(Gn);return t.setSdkInfo(e),t.getArrayData()},e.prototype.encodeJoinRTCRoom=function(e,t,n,i,r){var s=this,o=\"comet\"===this._connectType,a=this._codec.getModule(zt);if(e=e||0,a.setRoomType(e),re(t)||a.setBroadcastType(t),re(n)||a.setJoinType(n),i){var u=[],c=this._codec.getModule(ln);for(var h in i)c.setKey(h),c.setValue(i[h]),o?u.push(c.getArrayData()):u.push(c);a.setInnerDatas(u)}if(r){var l=[];Object.keys(r).forEach((function(e){var t=s._codec.getModule(ln);t.setKey(e),t.setValue(r[e]),o?l.push(t.getArrayData()):l.push(t)})),a.setOuterDatas(l)}return a.getArrayData()},e.prototype.encodeQuitRTCRoom=function(){return this._codec.getModule(Xt).getArrayData()},e.prototype.encodeSetRTCData=function(e,t,n,i,r){var s=this._codec.getModule($t);if(s.setInterior(n),s.setTarget(i),s.setKey(e),s.setValue(t),r){r.name&&s.setObjectName(r.name);var o=r.content;o&&(ne(o)&&(o=JSON.stringify(o)),s.setContent(o))}return s.getArrayData()},e.prototype.encodeUserSetRTCData=function(e,t,n,i){var r=this,s=\"comet\"===this._connectType,o=this._codec.getModule(en);o.setObjectName(n);var a=this._codec.getModule(ln);a.setKey(e.name),a.setValue(e.content),s?o.setContent(a.getArrayData()):o.setContent(a);var u=[];return[\"uris\",\"mcu_uris\"].forEach((function(e){var n=r._codec.getModule(ln);n.setKey(e);var o=\"uris\"===e?t:i;n.setValue(o),s?u.push(n.getArrayData()):u.push(n)})),o.setValueInfo(u),o.getArrayData()},e.prototype.encodeUserSetRTCCDNUris=function(e,t){this._connectType;var n=this._codec.getModule(en);n.setObjectName(e);var i=this._codec.getModule(ln);return i.setKey(\"cdn_uris\"),i.setValue(t),n.setValueInfo(i),n.getArrayData()},e.prototype.encodeGetRTCData=function(e,t,n){var i=this._codec.getModule(tn);return i.setInterior(t),i.setTarget(n),i.setKey(e),i.getArrayData()},e.prototype.encodeRemoveRTCData=function(e,t,n,i){var r=this._codec.getModule(tn);r.setInterior(t),r.setTarget(n),r.setKey(e);var s=(i=i||{}).name,o=i.content;return!re(s)&&r.setObjectName(s),re(o)||(ne(o)&&(o=JSON.stringify(o)),r.setContent(o)),r.getArrayData()},e.prototype.encodeSetRTCOutData=function(e,t,n){var i=this._codec.getModule(nn);i.setTarget(t),X(e)||(e=[e]),ct(e,(function(t,n){t.key=t.key?t.key.toString():t.key,t.value=t.value?t.value.toString():t.value,e[n]=t})),i.setValueInfo(e);var r=(n=n||{}).name,s=n.content;return!re(r)&&i.setObjectName(r),re(s)||(ne(s)&&(s=JSON.stringify(s)),i.setContent(s)),i.getArrayData()},e.prototype.ecnodeGetRTCOutData=function(e){var t=this._codec.getModule(an);return t.setUserId(e),t.getArrayData()},e.prototype.encodeSetRTCState=function(e){var t=this._codec.getModule(rn);return t.setState(e),t.getArrayData()},e.prototype.encodeGetRTCRoomInfo=function(){var e=this._codec.getModule(cn);return e.setOrder(2),e.getArrayData()},e.prototype.encodeSetRTCUserInfo=function(e,t){var n=this._codec.getModule(ln);return n.setKey(e),n.setValue(t),n.getArrayData()},e.prototype.encodeRemoveRTCUserInfo=function(e){var t=this._codec.getModule(dn);return t.setKey(e),t.getArrayData()},e.prototype.encodeIdentityChangeInfo=function(e,t,n){void 0===n&&(n=!1);var i=this._codec.getModule(zt);return i.setRoomType(De.LIVE),t&&i.setBroadcastType(t),i.setIdentityChangeType(e),i.setNeedSysChatroom(n),i.getArrayData()},e.prototype.encodePullRTCRoomKV=function(e,t){var n=this._codec.getModule(Wn);return n.setTimestamp(t),n.setRoomId(e),n.getArrayData()},e.prototype.encodeQueryUserJoinedInfo=function(e){var t=this._codec.getModule(zn);return t.setUserId(e),t.getArrayData()},e.prototype.encodeRequestRoomPK=function(e){var t=e.invitedRoomId,n=e.invitedUserId,i=e.inviteSessionId,r=e.inviteTimeout,s=e.inviteInfo,o=this._codec.getModule($n);return o.setInvitedRoomId(t),o.setInvitedUserId(n),o.setInviteSessionId(i),o.setTimeoutTime(r),o.setInviteInfo(s),o.getArrayData()},e.prototype.encodeCancelRoomPK=function(e){var t=e.invitedRoomId,n=e.invitedUserId,i=e.inviteSessionId,r=e.inviteInfo,s=this._codec.getModule(ei);return s.setInvitedRoomId(t),s.setInvitedUserId(n),s.setInviteSessionId(i),s.setInviteInfo(r),s.getArrayData()},e.prototype.encodeResponseRoomPK=function(e){var t=e.inviteUserId,n=e.inviteRoomId,i=e.inviteSessionId,r=e.content,s=e.key,o=e.value,a=e.agree?1:0,u=this._codec.getModule(ti);return u.setInviteUserId(t),u.setInviteRoomId(n),u.setInviteSessionId(i),u.setContent(r),u.setKey(s),u.setValue(o),u.setAnswerCode(a),u.getArrayData()},e.prototype.encodeEndRoomPK=function(e){var t=e.endRoomId,n=e.sessionId,i=e.content,r=e.keys,s=this._codec.getModule(ni);return s.setInviteRoomId(t),s.setInviteSessionId(n),s.setInviteContent(i),s.setInviteRoomKeys(r),s.getArrayData()},e}(),Gi=function(e,t){this._watcher=t,this.codec=new Hi(e)},ji=function(e,t){return e&&t?t+\"_\"+e:e||Date.now()},Qi=function(){function e(e){this.header=e,this._name=null,this.lengthSize=0,this.messageId=0,this.timestamp=0,this.syncMsg=!1,this.identifier=\"\"}return e.prototype.getIdentifier=function(){var e=this.messageId,t=this.identifier;return ji(e,t)},e.prototype.read=function(e,t,n){this.readMessage(e,t,n)},e.prototype.readMessage=function(e,t,n){return{stream:e,length:t}},e}(),Wi=function(){function e(e){this.lengthSize=0,this.messageId=0,this.topic=\"\",this.targetId=\"\",this.identifier=\"\",this._header=new Tt(e,!1,Qe.AT_MOST_ONCE,!1)}return e.prototype.getIdentifier=function(){var e=this.messageId,t=this.identifier;return ji(e,t)},e.prototype.write=function(e){var t=this.getHeaderFlag();e.write(t),this.writeMessage(e)},e.prototype.setHeaderQos=function(e){this._header.qos=e},e.prototype.getHeaderFlag=function(){return this._header.encode()},e.prototype.getLengthSize=function(){return this.lengthSize},e.prototype.getBufferData=function(){var e=new St;this.write(e);var t=e.getBytesArray();return new Int8Array(t)},e.prototype.getCometData=function(){var e=this.data||{};return JSON.stringify(e)},e}(),Ji=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=Je.CONN_ACK,t.status=null,t.userId=null,t.timestamp=0,t}return N(t,e),t.prototype.readMessage=function(e,n,i){if(e.readByte(),this.status=+e.readByte(),n<=t.MESSAGE_LENGTH)return{stream:e,length:n};if(i===Ze.V4){var r=e.readByte();1&r&&(this.userId=e.readUTF()),2&r&&e.readUTF(),4&r&&(this.timestamp=e.readLong()),8&r&&(this.messageId=e.read2Byte())}else{this.userId=e.readUTF();var s=e.readUTF();pe.debug(\"server sessionId -> \"+s),this.timestamp=e.readLong()}return{stream:e,length:n}},t.MESSAGE_LENGTH=2,t}(Qi),zi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=Je.DISCONNECT,t.status=0,t}return N(t,e),t.prototype.readMessage=function(e,t){return e.readByte(),this.status=+e.readByte(),{stream:e,length:t}},t.MESSAGE_LENGTH=2,t}(Qi),Zi=function(e){function t(){var t=e.call(this,We.PING_REQ)||this;return t._name=Je.PING_REQ,t}return N(t,e),t.prototype.writeMessage=function(e){},t}(Wi),Xi=function(e){function t(t){var n=e.call(this,t)||this;return n._name=Je.PING_RESP,n}return N(t,e),t}(Qi),$i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.messageId=0,t}return N(t,e),t.prototype.readMessage=function(e,t){var n=256*e.readByte()+e.readByte();return this.messageId=parseInt(n.toString(),10),{stream:e,length:t}},t}(Qi),er=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.messageId=0,t}return N(t,e),t.prototype.writeMessage=function(e){var t=this.messageId,n=255&t,i=(65280&t)>>8;e.write(i),e.write(n)},t}(Wi),tr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=Je.PUBLISH,t.topic=\"\",t.targetId=\"\",t.syncMsg=!1,t.identifier=ze.PUB,t}return N(t,e),t.prototype.readMessage=function(t,n){return this.date=t.readInt(),this.topic=t.readUTF(),this.targetId=t.readUTF(),e.prototype.readMessage.call(this,t,n),this.data=t.readAll(),{stream:t,length:n}},t}($i),nr=function(e){function t(t,n,i){var r=e.call(this,We.PUBLISH)||this;return r._name=Je.PUBLISH,r.syncMsg=!1,r.identifier=ze.PUB,r.topic=t,r.data=J(n)?Ct.writeUTF(n):n,r.targetId=i,r}return N(t,e),t.prototype.writeMessage=function(t){t.writeUTF(this.topic),t.writeUTF(this.targetId),e.prototype.writeMessage.call(this,t),t.write(this.data)},t}(er),ir=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=Je.PUB_ACK,t.status=0,t.date=0,t.millisecond=0,t.messageUId=\"\",t.timestamp=0,t.identifier=ze.PUB,t.topic=\"\",t.targetId=\"\",t}return N(t,e),t.prototype.readMessage=function(t,n){return e.prototype.readMessage.call(this,t,n),this.date=t.readInt(),this.status=256*t.readByte()+t.readByte(),this.millisecond=256*t.readByte()+t.readByte(),this.timestamp=1e3*this.date+this.millisecond,this.messageUId=t.readUTF(),{stream:t,length:n}},t}($i),rr=function(e){function t(t){var n=e.call(this,We.PUB_ACK)||this;return n._name=Je.PUB_ACK,n.status=0,n.date=0,n.millisecond=0,n.messageUId=\"\",n.timestamp=0,n.messageId=t,n}return N(t,e),t.prototype.writeMessage=function(t){e.prototype.writeMessage.call(this,t)},t}(er),sr=function(e){function t(t,n,i){var r=e.call(this,We.QUERY)||this;return r.name=Je.QUERY,r.identifier=ze.QUERY,r.topic=t,r.data=J(n)?Ct.writeUTF(n):n,r.targetId=i,r}return N(t,e),t.prototype.writeMessage=function(t){t.writeUTF(this.topic),t.writeUTF(this.targetId),e.prototype.writeMessage.call(this,t),t.write(this.data)},t}(er),or=function(e){function t(t){var n=e.call(this,We.QUERY_CONFIRM)||this;return n._name=Je.QUERY_CON,n.messageId=t,n}return N(t,e),t}(er),ar=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name=Je.QUERY_ACK,t.status=0,t.identifier=ze.QUERY,t.topic=\"\",t.targetId=\"\",t}return N(t,e),t.prototype.readMessage=function(t,n){return e.prototype.readMessage.call(this,t,n),this.date=t.readInt(),this.status=256*t.readByte()+t.readByte(),this.data=t.readAll(),{stream:t,length:n}},t}($i),ur=function(e){var t,n=e.type;switch(n){case We.CONN_ACK:t=new Ji(e);break;case We.PUBLISH:(t=new tr(e)).syncMsg=e.syncMsg;break;case We.PUB_ACK:t=new ir(e);break;case We.QUERY_ACK:t=new ar(e);break;case We.SUB_ACK:case We.UNSUB_ACK:case We.PING_RESP:t=new Xi(e);break;case We.DISCONNECT:t=new zi(e);break;default:t=new Qi(e),pe.error(\"No support for deserializing \"+n+\" messages\")}return t};!function(e){e[e.ppMsgP=1]=\"ppMsgP\",e[e.ppMsgN=2]=\"ppMsgN\",e[e.ppMsgS=3]=\"ppMsgS\",e[e.pgMsgP=4]=\"pgMsgP\",e[e.chatMsg=5]=\"chatMsg\",e[e.pcMsgP=6]=\"pcMsgP\",e[e.qryPMsg=7]=\"qryPMsg\",e[e.qryGMsg=8]=\"qryGMsg\",e[e.qryCHMsg=9]=\"qryCHMsg\",e[e.qryCMsg=10]=\"qryCMsg\",e[e.qrySMsg=11]=\"qrySMsg\",e[e.recallMsg=12]=\"recallMsg\",e[e.prMsgS=13]=\"prMsgS\",e[e.rrMsg=14]=\"rrMsg\",e[e.rrList=15]=\"rrList\",e[e.s_ntf=16]=\"s_ntf\",e[e.s_msg=17]=\"s_msg\",e[e.s_stat=18]=\"s_stat\",e[e.s_cmd=19]=\"s_cmd\",e[e.s_us=20]=\"s_us\",e[e.pullUS=21]=\"pullUS\",e[e.pgMsgS=22]=\"pgMsgS\",e[e.chatMsgS=23]=\"chatMsgS\",e[e.qrySessionsAtt=24]=\"qrySessionsAtt\",e[e.pullMsg=25]=\"pullMsg\",e[e.qrySessions=26]=\"qrySessions\",e[e.delSessions=27]=\"delSessions\",e[e.delMsg=28]=\"delMsg\",e[e.updRRTime=29]=\"updRRTime\",e[e.chrmPull=30]=\"chrmPull\",e[e.joinChrm=31]=\"joinChrm\",e[e.joinChrmR=32]=\"joinChrmR\",e[e.exitChrm=33]=\"exitChrm\",e[e.queryChrmI=34]=\"queryChrmI\",e[e.setKV=35]=\"setKV\",e[e.delKV=36]=\"delKV\",e[e.pullKV=37]=\"pullKV\",e[e.qryRelation=38]=\"qryRelation\",e[e.delRelation=39]=\"delRelation\",e[e.pullSeAtts=40]=\"pullSeAtts\",e[e.setSeAtt=41]=\"setSeAtt\",e[e.qnTkn=42]=\"qnTkn\",e[e.qnUrl=43]=\"qnUrl\",e[e.aliUrl=44]=\"aliUrl\",e[e.s3Url=45]=\"s3Url\",e[e.stcUrl=46]=\"stcUrl\",e[e.cleanPMsg=47]=\"cleanPMsg\",e[e.cleanGMsg=48]=\"cleanGMsg\",e[e.cleanCMsg=49]=\"cleanCMsg\",e[e.cleanSMsg=50]=\"cleanSMsg\",e[e.rtcRJoin_data=51]=\"rtcRJoin_data\",e[e.rtcRExit=52]=\"rtcRExit\",e[e.rtcPing=53]=\"rtcPing\",e[e.rtcSetData=54]=\"rtcSetData\",e[e.rtc_ntf=55]=\"rtc_ntf\",e[e.viewerJoinR=56]=\"viewerJoinR\",e[e.viewerExitR=57]=\"viewerExitR\",e[e.rtcPullKv=58]=\"rtcPullKv\",e[e.rtcIdentityChange=59]=\"rtcIdentityChange\",e[e.userSetData=60]=\"userSetData\",e[e.rtcQryData=61]=\"rtcQryData\",e[e.rtcDelData=62]=\"rtcDelData\",e[e.rtcSetOutData=63]=\"rtcSetOutData\",e[e.rtcQryUserOutData=64]=\"rtcQryUserOutData\",e[e.rtcToken=65]=\"rtcToken\",e[e.rtcUserState=66]=\"rtcUserState\",e[e.rtcRInfo=67]=\"rtcRInfo\",e[e.rtcUData=68]=\"rtcUData\",e[e.rtcUPut=69]=\"rtcUPut\",e[e.rtcUDel=70]=\"rtcUDel\",e[e.rtcUList=71]=\"rtcUList\",e[e.rtcQueryJoined=72]=\"rtcQueryJoined\",e[e.addSeTag=73]=\"addSeTag\",e[e.delSeTag=74]=\"delSeTag\",e[e.addTag=75]=\"addTag\",e[e.delTag=76]=\"delTag\",e[e.disTag=77]=\"disTag\",e[e.reportsdk=78]=\"reportsdk\",e[e.rtcInvite=79]=\"rtcInvite\",e[e.rtcCancelInvite=80]=\"rtcCancelInvite\",e[e.rtcInviteAnswer=81]=\"rtcInviteAnswer\",e[e.rtcEndInvite=82]=\"rtcEndInvite\"}(pi||(pi={}));var cr,hr=pi,lr=function(e,t,n,i){return w(void 0,void 0,void 0,(function(){var r;return b(this,(function(s){return r=0,e.forEach((function(s){return w(void 0,void 0,void 0,(function(){var o,a;return b(this,(function(u){switch(u.label){case 0:return o=t+\"://\"+s+\"/ping?r=\"+(h=9999,(c=1e3)+Math.floor(Math.random()*(h-c))),pe.debug(\"start ping\",o),[4,n.httpReq({url:o,timeout:5e3})];case 1:return a=u.sent(),pe.debug(\"end ping\",r,o,a.status),r++,i({finished:r===e.length,code:a.status,host:s}),[2]}var c,h}))}))})),[2]}))}))},dr=function(e,t,n,i,r,s,o,a){return e+\"://\"+t+\"/websocket?appId=\"+n+\"&token=\"+encodeURIComponent(i)+\"&sdkVer=\"+s+\"&pid=\"+o+\"&apiVer=\"+(r.isFromUniapp?\"uniapp\":\"normal\")+(r.connectPlatform?\"&platform=\"+r.connectPlatform:\"\")+(a?\"&protocolVer=\"+a:\"\")},fr=function(e){return[hr.ppMsgS,hr.pgMsgS,hr.chatMsgS].map((function(e){return hr[e]})).indexOf(e)>=0};!function(e){e[e.REDIRECT=0]=\"REDIRECT\",e[e.OTHER_DEVICE_LOGIN=1]=\"OTHER_DEVICE_LOGIN\",e[e.BLOCK=2]=\"BLOCK\",e[e.REMOTE_CLOSE=3]=\"REMOTE_CLOSE\",e[e.LOGOUT=4]=\"LOGOUT\",e[e.BLOCK_NEW=5]=\"BLOCK_NEW\",e[e.REDIRECT_NEW=6]=\"REDIRECT_NEW\"}(cr||(cr={}));var pr,gr=function(e,t){pe.info(\"websocket send -> messageId: \"+e.messageId+\" topic: \"+e.topic);var n=e.getBufferData();t.send(n.buffer)},_r=function(e){function t(t,n){var i=e.call(this,\"websocket\",n)||this;return i._runtime=t,i._socket=null,i._messageIds={},i._syncMessageIds={},i._failedCount=0,i.ALLOW_FAILED_TIMES=2,i._timer=null,i._idCount=0,i._generateMessageId=function(){return i._idCount>=65535&&(i._idCount=0),++i._idCount},i}return N(t,e),t.prototype.connect=function(e,t,n,i,r,s){return w(this,void 0,void 0,(function(){var o=this;return b(this,(function(a){return[2,new Promise((function(a){var u=[],c=0,h=!1,l=!1,d=function(){return w(o,void 0,void 0,(function(){var n;return b(this,(function(o){switch(o.label){case 0:return 0===u.length||h?[2]:(h=!0,[4,this._connect(e,t,u.shift(),i,r,s)]);case 1:if((n=o.sent())===Ee.SUCCESS)this._checkAlive(),a(n);else if(n===Te.REDIRECT)a(n);else{if(l&&0===u.length)return a(yt(n)),[2];h=!1,d()}return[2]}}))}))};r=x(r),o._watcher.status(Ie.CONNECTING),lr(n,i,o._runtime,(function(e){var t=e.code,n=e.finished,i=e.host;l=n,200===t&&(u.push(i),c++,d()),n&&0===c&&(pe.error(\"No valid websocket server hosts!\"),a(Ee.RC_SOCKET_NOT_CREATED))}))}))]}))}))},t.prototype._connect=function(e,t,n,i,r,s){return w(this,void 0,void 0,(function(){var o,a,u,c,h,l=this;return b(this,(function(d){switch(d.label){case 0:return o=i.replace(\"http\",\"ws\"),a=dr(o,n,e,t,this._runtime,r,\"\",s),pe.debug(\"conenct start -> \"+a),this.sendConnectTime=Date.now(),u=this._runtime.createWebSocket(a),c=function(e){l._timer&&(clearTimeout(l._timer),l._timer=null),l._socket===u&&(l._socket=null,l._watcher.status(e))},[4,new Promise((function(e){u.onMessage((function(t){if(\"[object ArrayBuffer]\"===Object.prototype.toString.call(t)){var n=function(e,t){var n=new Uint8Array(e),i=new Rt(n),r=i.readByte(),s=new Tt(r),o=ur(s);return o.read(i,n.length-1,t),o}(t,s);if(n instanceof Xi&&l._pingResolve)return l._pingResolve(Ee.SUCCESS),void(l._pingResolve=void 0);if(n instanceof Ji)return pe.debug(\"recv connect ack -> \"+n.status),n.status!==Te.ACCEPTED?(pe.warn(\"connect failed: \"+n.status),void e(n.status)):(pe.info(\"connect success -> \"+a),l.connectedTime=n.timestamp,l.userId=n.userId||\"\",l._idCount=n.messageId,void e(Ee.SUCCESS));if(n instanceof zi){var i=n.status;switch(pe.warn(\"recv disconnect signal -> status: \"+i),i){case cr.BLOCK_NEW:case cr.BLOCK:l._watcher.status(Ie.BLOCKED);break;case cr.OTHER_DEVICE_LOGIN:l._watcher.status(Ie.KICKED_OFFLINE_BY_OTHER_CLIENT);break;case cr.REDIRECT_NEW:case cr.REDIRECT:l._watcher.status(Ie.REDIRECT);break;default:l._watcher.status(Ie.DISCONNECT_BY_SERVER)}}else l._onReceiveSignal(n)}else pe.error(\"Socket received invalid data:\",t)})),u.onClose((function(t,n){for(var i in pe.warn(\"websocket closed! code:\",t,\"reason:\",n),c(Ie.CONNECTION_CLOSED),l._messageIds){var r=l._messageIds[i];delete l._messageIds[i],r(Ee.RC_NET_CHANNEL_INVALID)}e(t)})),u.onError((function(t){var n;for(var i in pe.error(\"websocket error!\",null===(n=t)||void 0===n?void 0:n.stack),c(Ie.WEBSOCKET_ERROR),l._messageIds){var r=l._messageIds[i];delete l._messageIds[i],r(Ee.RC_NET_CHANNEL_INVALID)}e(Ee.NETWORK_ERROR)})),u.onOpen((function(){return pe.debug(\"websocket open =>\",a)})),setTimeout((function(){e(Ee.TIMEOUT)}),5e3)}))];case 1:return(h=d.sent())===Ee.SUCCESS?this._socket=u:(pe.warn(\"connect result -> code: \"+h+\", url: \"+a),u.close()),[2,h]}}))}))},t.prototype._checkAlive=function(){var e;return w(this,void 0,void 0,(function(){var t,n=this;return b(this,(function(i){switch(i.label){case 0:return this._socket?(pe.debug(\"send ping ->\"),this.sendOnly(new Zi),[4,new Promise((function(e){n._pingResolve=e,n._timer&&clearTimeout(n._timer),n._timer=setTimeout((function(){n._pingResolve=void 0,e(Ee.TIMEOUT)}),15e3)}))]):[2];case 1:return(t=i.sent())!==Ee.SUCCESS?(this._failedCount+=1,pe.warn(\"ping failed count: \"+this._failedCount+\", code: \"+t),this._failedCount>=this.ALLOW_FAILED_TIMES?(this._failedCount=0,pe.warn(\"ping timeout, close current websocket to reconnect!\"),null===(e=this._socket)||void 0===e||e.close(),this._watcher.status(Ie.NETWORK_UNAVAILABLE)):this._checkAlive(),[2]):(pe.debug(\"recv pong <-\"),this._failedCount=0,setTimeout((function(){return n._checkAlive()}),15e3),[2])}}))}))},t.prototype._onReceiveSignal=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a=this;return b(this,(function(u){switch(u.label){case 0:return t=e.messageId,e.header&&e.header.qos!==Qe.AT_MOST_ONCE&&(e instanceof tr&&!e.syncMsg&&(pe.info(\"send pubAck -> \"+t+\" \"+e.topic),this.sendOnly(new rr(t))),e instanceof ar&&(pe.info(\"send queryCon -> \"+t+\" \"+e.topic),this.sendOnly(new or(t)))),t>0&&(e instanceof ir||e instanceof ar)&&(pe.info(\"recv ack -> messageId: \"+t+\" \"+e.topic),(n=this._messageIds[t])&&(n(e),delete this._messageIds[t]),(i=this._syncMessageIds[t])&&(delete this._syncMessageIds[t],i(e))),e instanceof tr?(r=e.syncMsg,s=e.topic,pe.info(\"recv PublishReader -> messageId: \"+t+\" \"+s),s===hr[hr.userSetData]?[2]:!r||fr(s)?(this._watcher.signal(e),[2]):[4,new Promise((function(e){a._syncMessageIds[t]=e}))]):[3,2];case 1:o=u.sent(),delete this._syncMessageIds[t],this._watcher.signal(e,o),u.label=2;case 2:return[2]}}))}))},t.prototype.sendOnly=function(e){this._socket&&((e instanceof nr||e instanceof sr)&&(e.messageId=this._generateMessageId()),gr(e,this._socket))},t.prototype.send=function(e,t,n,i){return void 0===i&&(i=3e4),w(this,void 0,void 0,(function(){var r,s,o,a=this;return b(this,(function(u){switch(u.label){case 0:return this._socket?(r=this._generateMessageId(),e.messageId=r,gr(e,this._socket),[4,new Promise((function(e){a._messageIds[r]=e,setTimeout((function(){a._messageIds[r]&&delete a._messageIds[r],e()}),i)}))]):[3,2];case 1:return(s=u.sent())?s instanceof ar||s instanceof ir?(o=t&&s.data?this.codec.decodeByPBName(s.data,t,n):s,0!==s.status?(pe.warn(\"send failed -> message: \"+r+\", respPBName: \"+t+\", status: \"+s.status),[2,{code:s.status,data:t&&s.data?o:null}]):[2,{code:Ee.SUCCESS,data:o}]):[2,{code:s}]:(pe.warn(\"send timeout -> message: \"+r+\", respPBName: \"+t+\", timeout: \"+i),[2,{code:Ee.TIMEOUT}]);case 2:return[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.close=function(){this._socket&&(this._socket.close(),this._socket=null,this._watcher.status(Ie.DISCONNECTED))},t}(Gi);!function(e){e.GET=\"GET\",e.POST=\"POST\"}(pr||(pr={}));var yr=function(e){function t(t,n){var i=e.call(this,\"comet\",n)||this;return i._runtime=t,i._messageIds={},i._syncMessageIds={},i._idCount=0,i._generateMessageId=function(){return++i._idCount},i._pid=encodeURIComponent((new Date).getTime()+Math.random()+\"\"),i}return N(t,e),t.prototype.handleCometRes=function(e){var t=this;if(200!==e.status&&202!==e.status)return!1;var n=J(e.data)?JSON.parse(e.data):e.data;return n?!X(n)||(ct(n,(function(e){return w(t,void 0,void 0,(function(){var t,n,i,r,s,o,a,u,c,h,l,d=this;return b(this,(function(f){switch(f.label){case 0:if((t=e.sessionid)&&(this._sessionid=t),n=function(e){var t=e.headerCode,n=new Tt(t),i=ur(n);for(var r in e)i[r]=e[r];return i}(e),i=n.messageId,r=n._header,s=n.status,n.identifier,o=r&&r.qos!==Qe.AT_MOST_ONCE,i&&n.getIdentifier&&((a=this._messageIds[i])&&a(n),this._syncMessageIds[i]&&this._syncMessageIds[i](n)),o&&(n instanceof tr&&!n.syncMsg&&(u=new rr(i),this.sendOnly(u)),n instanceof ar&&(u=new or(i),this.sendOnly(u))),n instanceof zi){switch(s){case cr.OTHER_DEVICE_LOGIN:this._watcher.status(Ie.KICKED_OFFLINE_BY_OTHER_CLIENT);break;case cr.BLOCK:case cr.BLOCK_NEW:this._watcher.status(Ie.BLOCKED);break;case cr.REDIRECT_NEW:case cr.REDIRECT:this._watcher.status(Ie.REDIRECT);break;default:this._watcher.status(Ie.DISCONNECT_BY_SERVER)}return[2]}return n instanceof tr?(c=n.syncMsg,h=n.topic,!c||fr(h)?(this._watcher.signal(n),[2,!1]):[4,new Promise((function(e){d._syncMessageIds[i]=e}))]):[3,2];case 1:l=f.sent(),delete this._syncMessageIds[i],this._watcher.signal(n,l),f.label=2;case 2:return[2]}}))}))})),!0):(pe.error(\"received data is not a validJson\",n),!1)},t.prototype._startPullSignal=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r;return b(this,(function(s){switch(s.label){case 0:return t=(new Date).getTime(),n=e+\"://\"+this._domain+\"/pullmsg.js?sessionid=\"+this._sessionid+\"&timestrap=\"+t+\"&pid=\"+this._pid,[4,this._runtime.httpReq({url:n,body:{pid:this._pid},timeout:45e3})];case 1:return i=s.sent(),r=this.handleCometRes(i),this._isDisconnected||(r?this._startPullSignal(e):(this._isDisconnected=!0,this._watcher.status(Ie.NETWORK_UNAVAILABLE))),[2]}}))}))},t.prototype.connect=function(e,t,n,i,r,s){return w(this,void 0,void 0,(function(){var s,o,a,u,c=this;return b(this,(function(h){return r=x(r),this._protocol=i,this._isDisconnected=!1,this._watcher.status(Ie.CONNECTING),s=[],o=0,a=!1,u=!1,[2,new Promise((function(h){var l=function(){return w(c,void 0,void 0,(function(){var n;return b(this,(function(o){switch(o.label){case 0:return 0===s.length||a?[2]:(a=!0,[4,this._connect(e,t,s.shift(),i,r)]);case 1:if((n=o.sent())===Ee.SUCCESS)this._startPullSignal(i),h(n);else if(n===Te.REDIRECT)h(n);else{if(u&&0===s.length)return h(yt(n)),[2];a=!1,l()}return[2]}}))}))};c._watcher.status(Ie.CONNECTING),lr(n,i,c._runtime,(function(e){var t=e.code,n=e.finished,i=e.host;u=n,200===t&&(s.push(i),o++,l()),n&&0===o&&(pe.error(\"No valid websocket server hosts!\"),h(Ee.RC_SOCKET_NOT_CREATED))}))}))]}))}))},t.prototype._connect=function(e,t,n,i,r){return w(this,void 0,void 0,(function(){var s,o,a,u;return b(this,(function(c){switch(c.label){case 0:return s=function(e){return 200!==e.status&&202!==e.status?(pe.error(\"handle comet res -> res: \"+JSON.stringify(e||{})),!1):!!e.data&&(function(e){if(ne(e))return!0;var t=!1;try{var n=JSON.parse(e);t=JSON.stringify(n)===e}catch(e){t=!1}return t}(e.data)?ne(e.data)?e.data:JSON.parse(e.data):(pe.error(\"received data is not a validJson\",e.data),!1))},o=dr(i,n,e,t,this._runtime,r,this._pid),this.sendConnectTime=Date.now(),pe.debug(\"conenct start -> \"+o),[4,this._runtime.httpReq({url:o,body:{pid:this._pid},timeout:5e3})];case 1:return a=c.sent(),u=s(a),this._domain=n,u&&0===u.status?(this._sessionid=u.sessionid,this.userId=u.userId,this.connectedTime=u.timestamp):pe.warn(\"connect result -> code: \"+(null==u?void 0:u.status)+\", url: \"+o),[2,null==u?void 0:u.status]}}))}))},t.prototype.sendCometData=function(e,t){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a,u,c,h;return b(this,(function(l){switch(l.label){case 0:return n=(t=this)._domain,i=t._sessionid,r=t._pid,s=e.messageId,o=e.topic,a=e.targetId,e.identifier,u=e.getHeaderFlag(),c=o?this._protocol+\"://\"+n+\"/websocket?messageid=\"+s+\"&header=\"+u+\"&sessionid=\"+i+\"&topic=\"+o+\"&targetid=\"+a+\"&pid=\"+r:this._protocol+\"://\"+n+\"/websocket?messageid=\"+s+\"&header=\"+u+\"&sessionid=\"+i+\"&pid=\"+r,[4,this._runtime.httpReq({url:c,method:pr.POST,body:e.getCometData()})];case 1:return h=l.sent(),this.handleCometRes(h),[2]}}))}))},t.prototype.sendOnly=function(e){this.sendCometData(e)},t.prototype.send=function(e,t,n,i){return void 0===i&&(i=3e4),w(this,void 0,void 0,(function(){var r,s,o,a=this;return b(this,(function(u){switch(u.label){case 0:return r=this._generateMessageId(),e.messageId=r,this.sendCometData(e),[4,new Promise((function(e){a._messageIds[r]=e,setTimeout((function(){delete a._messageIds[r],e()}),i)}))];case 1:return(s=u.sent())?(o=t&&s.data?this.codec.decodeByPBName(s.data,t,n):s,0!==s.status?[2,{code:s.status,data:t&&s.data?o:null}]:[2,{code:Ee.SUCCESS,data:o}]):[2,{code:Ee.TIMEOUT}]}}))}))},t.prototype.close=function(){this._isDisconnected=!0,this._watcher.status(Ie.DISCONNECTED)},t}(Gi),vr=function(e,t,n){this.runtime=e,this._watcher=t,this._options=n,this.currentUserId=\"\",this._appkey=this._options.appkey,this._apiVer=this._options.apiVersion,this.navi=this._createNavi()},Er=function(e){return[\"navi\",e].join(\"_\")},mr=function(){function e(e,t){this._runtime=e,this._options=t,this._naviInfo=null,this._appkey=this._options.appkey,this._apiVersion=x(this._options.apiVersion)}return e.prototype.getInfo=function(e,t,n,i){return w(this,void 0,void 0,(function(){var r,s;return b(this,(function(o){switch(o.label){case 0:return n&&this._clear(e),(r=function(e,t,n){var i,r,s=Er(e);try{var o=n.getItem(s);r=o?JSON.parse(o):[]}catch(e){r=[]}var a=Date.now();return r.length>0&&(r=r.filter((function(e){return a-e.timestamp<72e5}))),0===r.length?n.removeItem(s):n.setItem(s,JSON.stringify(r)),(null===(i=r.find((function(e){return e.token===t})))||void 0===i?void 0:i.naviInfo)||null}(this._appkey,e,this._runtime.localStorage))?(this._naviInfo=r,[2,r]):(s=this._options.navigators.slice(),t.length&&t.forEach((function(e){s.indexOf(e)<0&&s.unshift(e)})),[4,this._reqNavi(s,this._appkey,e,i)]);case 1:return(r=o.sent())?(this._naviInfo=r,this.setNaviInfo2Cache(e,r),[2,r]):[2,r]}}))}))},e.prototype.setNaviInfo2Cache=function(e,t){this._naviInfo=t,function(e,t,n,i){var r,s=Er(e);try{var o=i.getItem(s);r=o?JSON.parse(o):[]}catch(e){r=[]}var a=Date.now();r.length>0&&(r=r.filter((function(e){return a-e.timestamp<72e5&&t!==e.token}))),r.push({timestamp:a,naviInfo:n,token:t}),i.setItem(s,JSON.stringify(r))}(this._appkey,e,t,this._runtime.localStorage)},e.prototype.getInfoFromCache=function(e){return this._naviInfo},e.prototype._clear=function(e){!function(e,t,n){var i,r=Er(e);try{var s=n.getItem(r);i=s?JSON.parse(s):[]}catch(e){i=[]}var o=Date.now();i.length>0&&(i=i.filter((function(e){return o-e.timestamp<72e5&&t!==e.token}))),0===i.length?n.removeItem(r):n.setItem(r,JSON.stringify(i))}(this._appkey,e,this._runtime.localStorage)},e}(),Ir=function(e,t,n){return[e,t,n].join(\"_\")},Tr=function(){function e(e,t){this._runtime=e,this._appkey=t,this._users={}}return e.prototype._getMemData=function(e){return this._users[e]||(this._users[e]={inboxTime:0,outboxTime:0})},e.prototype.setInboxTime=function(e,t){var n=this._getMemData(t);if(!(n.inboxTime>e)){n.inboxTime=e;var i=Ir(\"inbox\",this._appkey,t);this._runtime.localStorage.setItem(i,e.toString())}},e.prototype.getInboxTime=function(e){var t=this._getMemData(e);if(0===t.inboxTime){var n=Ir(\"inbox\",this._appkey,e);t.inboxTime=parseInt(this._runtime.localStorage.getItem(n))||0}return t.inboxTime},e.prototype.setOutboxTime=function(e,t){var n=this._getMemData(t);if(!(n.outboxTime>=e)){n.outboxTime=e;var i=Ir(\"outbox\",this._appkey,t);this._runtime.localStorage.setItem(i,e.toString())}},e.prototype.getOutboxTime=function(e){var t=this._getMemData(e);if(0===t.outboxTime){var n=Ir(\"outbox\",this._appkey,e);t.outboxTime=parseInt(this._runtime.localStorage.getItem(n))||0}return t.outboxTime},e}(),Cr={_caches:{},set:function(e,t){this._caches[e]=t},get:function(e){return this._caches[e]||0},clear:function(e){this._caches[e]=0}},Rr=function(){function e(e,t){this._kvCaches={},this._chatroomId=e,this._currentUserId=t}return e.prototype._add=function(e){var t=e.key;e.isDeleted=!1,this._kvCaches[t]=e},e.prototype._remove=function(e){var t=e.key,n=this._kvCaches[t];n&&(n.isDeleted=!0,this._kvCaches[t]=n)},e.prototype._setEntry=function(e,t){var n=e.key,i=e.type,r=e.isOverwrite,s=e.userId,o=this._getSetUserId(n),a=i===Ue.DELETE,u=o===s,c=!this._isExisted(n),h=a?this._remove:this._add;(t||r||u||c)&&h.call(this,e)},e.prototype.getValue=function(e){var t=this._kvCaches[e]||{};return t.isDeleted?null:t.value},e.prototype.getAllValue=function(){var e={};for(var t in this._kvCaches)this._kvCaches[t].isDeleted||(e[t]=this._kvCaches[t].value);return e},e.prototype._getSetUserId=function(e){return(this._kvCaches[e]||{}).userId},e.prototype._isExisted=function(e){var t=this._kvCaches[e]||{},n=t.value,i=t.isDeleted;return n&&!i},e.prototype.setEntries=function(e){var t=this,n=e.kvEntries,i=e.isFullUpdate;n=n||[],(i=i||!1)&&this.clear(),n.forEach((function(e){t._setEntry(e,i)})),pe.debug(\"end setEntries\")},e.prototype.clear=function(){this._kvCaches={}},e}(),Sr=function(){function e(e){this._pullQueue=[],this._isPulling=!1,this._storeCaches={},this._engine=e}return e.prototype._startPull=function(){return w(this,void 0,void 0,(function(){var e,t,n,i,r,s,o;return b(this,(function(a){switch(a.label){case 0:return this._isPulling||0===this._pullQueue.length?[2]:(this._isPulling=!0,e=this._pullQueue.splice(0,1)[0],t=e.chrmId,n=e.timestamp,(i=Cr.get(t))>n?(this._isPulling=!1,this._startPull(),[2]):[4,this._engine.pullChatroomEntry(t,i)]);case 1:return r=a.sent(),s=r.code,o=r.data,this._isPulling=!1,s===Ee.SUCCESS?(Cr.set(t,o.syncTime||0),this._startPull()):this._startPull(),[2]}}))}))},e.prototype.reset=function(e){Cr.clear(e);var t=this._storeCaches[e];t&&t.clear()},e.prototype.pullEntry=function(e,t){this._pullQueue.push({chrmId:e,timestamp:t}),this._startPull()},e.prototype.setLocal=function(e,t,n){var i=this._storeCaches[e];ae(i)||(i=new Rr(e,n)),i.setEntries(t),this._storeCaches[e]=i},e.prototype.getValue=function(e,t){var n=this._storeCaches[e];return n?n.getValue(t):null},e.prototype.getAll=function(e){var t=this._storeCaches[e],n={};return t&&(n=t.getAllValue()),n},e}(),Nr=function(){function e(e,t,n,i){this._runtime=e,this._appkey=t,this._userId=n,this._canJoinMulipleChrm=i,this._sessionKey=\"\",this._joinedChrmsInfo={},this._sessionKey=\"sync-chrm-\"+this._appkey+\"-\"+this._userId}return e.prototype.set=function(e,t){void 0===t&&(t=10),!this._canJoinMulipleChrm&&(this._joinedChrmsInfo={}),this._joinedChrmsInfo[e]=t,this._runtime.sessionStorage.setItem(this._sessionKey,JSON.stringify(this._joinedChrmsInfo))},e.prototype.get=function(){var e,t;try{t=this._runtime.sessionStorage.getItem(this._sessionKey),e=JSON.parse(t||\"{}\")}catch(n){pe.error(\"parse rejoined chrm infos error -> \"+t),e={}}return e},e.prototype.remove=function(e){delete this._joinedChrmsInfo[e],ae(this._joinedChrmsInfo)?this._runtime.sessionStorage.setItem(this._sessionKey,JSON.stringify(this._joinedChrmsInfo)):this.clear()},e.prototype.clear=function(){this._joinedChrmsInfo={},this._runtime.sessionStorage.removeItem(this._sessionKey)},e}(),Or=\"converStatusChanged\",wr=function(){function e(e,t,n){this._eventEmitter=new ge,this._pullQueue=[],this._isPulling=!1,this._storage=T(e.runtime),this._appkey=t,this._currentUserId=n,this._engine=e,this._storagePullTimeKey=\"con-s-\"+t+\"-\"+n}return e.prototype._set=function(e){var t=this;if(!re(e)&&Array.isArray(e)){var n=this._storage.get(this._storagePullTimeKey)||0,i=e.length;e.forEach((function(e,r){var s=e.updatedTime||0;n=s>n?s:n,e.conversationType=e.type,t._eventEmitter.emit(Or,{statusItem:e,isLastPull:r===i-1})})),this._storage.set(this._storagePullTimeKey,n)}},e.prototype._startPull=function(){return w(this,void 0,void 0,(function(){var e,t,n,i;return b(this,(function(r){switch(r.label){case 0:return this._isPulling||0===this._pullQueue.length?[2]:(this._isPulling=!0,e=this._pullQueue.splice(0,1)[0],[4,this._engine.pullConversationStatus(e)]);case 1:return t=r.sent(),n=t.code,i=t.data,n===Ee.SUCCESS?(this._isPulling=!1,this._set(i),this._startPull()):this._startPull(),[2]}}))}))},e.prototype.pull=function(e){var t=this._storage.get(this._storagePullTimeKey)||0;(e>t||0===e)&&(this._pullQueue.push(t),this._startPull())},e.prototype.watch=function(e){this._eventEmitter.on(Or,(function(t){e(t)}))},e.prototype.unwatch=function(){this._eventEmitter.off(Or,(function(e){}))},e}(),br={c:{keyName:\"unreadMessageCount\",defaultVal:0},hm:{keyName:\"hasMentioned\",defaultVal:!1},m:{keyName:\"mentionedInfo\",defaultVal:null},t:{keyName:\"lastUnreadTime\",defaultVal:0},nc:{keyName:\"notificationStatus\",defaultVal:2},to:{keyName:\"isTop\",defaultVal:!1},tg:{keyName:\"tags\",defaultVal:{}},mc:{keyName:\"unreadMentionedCount\",defaultVal:0}},Mr={};for(var Ar in br){var Ur=br[Ar].keyName;Mr[Ur]=Ar}var Lr,Pr=function(){function e(e,t,n){this._appkey=t,this._currentUserId=n;var i=\"con-\"+t+\"-\"+n;this.storage=new R(e,i),this._localStore=new R(e,\"CONVER-\"+t+\"-\"+n)}return e.prototype._getStoreKey=function(e,t,n){return n+\"_\"+e+\"_\"+t},e.prototype._getConOptionByKey=function(e){var t=(e=e||\"\").split(\"_\");if(t.length>=2){var n=t.shift(),i=t.shift(),r=t.join(\"_\");return{conversationType:Number(i),targetId:r,channelId:n}}return{conversationType:j.PRIVATE,targetId:\"\",channelId:\"\"}},e.prototype.updateMentionedData=function(e){var t=this,n=e.conversationType,i=e.targetId,r=e.messageType,s=e.isMentioned,o=e.content,a=e.senderUserId,u=e.channelId,c=this._getStoreKey(n,i,u),h=this._localStore.get(c)||{},l=Mr.mentionedInfo,d=Mr.hasMentioned,f=h[l]||{},p=f.userIdList||[],g=o.mentionedInfo;if(g){if(s&&n===j.GROUP)(g.userIdList||[]).forEach((function(e){e===t._currentUserId&&p.indexOf(a)<0&&p.push(a)})),g.type===we.ALL&&p.indexOf(a)<0&&p.push(a);if(r===Re.RECALL&&n===j.GROUP){var _=p.indexOf(a);_>=0&&p.splice(_,1)}g={userIdList:p,type:(null==g?void 0:g.type)||f.type},0!==p.length?(h[l]=g,h[d]=!0):(delete h[l],delete h[d]),ae(h)?this._localStore.set(c,h):this._localStore.remove(c)}},e.prototype.set=function(e,t,n,i){var r=this._getStoreKey(e,t,i),s=this._localStore.get(r)||{};for(var o in n){var a=Mr[o],u=n[o];if(!re(a)&&!re(u)&&\"hasMentioned\"!==o&&\"MentionedInfo\"!==o){if(u===br[a].defaultVal||\"tags\"===o&&!ae(u))delete s[a];else if(\"tags\"===o){var c=u;for(var h in c)c[h].isTop||delete c[h].isTop;s[a]=u}else s[a]=u;s.c||(delete s.t,delete s.hm,delete s.m,delete s.mc)}}ae(s)?this._localStore.set(r,s):this._localStore.remove(r)},e.prototype.get=function(e,t,n){void 0===n&&(n=\"\");var i=this._getStoreKey(e,t,n),r=this._localStore.get(i)||{},s={};for(var o in br){var a=br[o],u=a.keyName,c=a.defaultVal;s[u]=r[o]||pt(c)}return s},e.prototype.getValue=function(e){var t=this._localStore.getValues()||{},n=[];for(var i in t){var r=this._getConOptionByKey(i),s={conversationType:r.conversationType,targetId:r.targetId,channelId:r.channelId},o=t[i];for(var a in o){var u=br[a],c=u.keyName,h=u.defaultVal;s[c]=o[a]||pt(h)}s=e?e(s):s,n.push(s)}return n},e.prototype.getValueForTag=function(){var e=this._localStore.getValues()||{},t={};for(var n in e){var i=this._getConOptionByKey(n),r=i.conversationType,s=i.targetId,o={},a=e[n];for(var u in a){var c=br[u],h=c.keyName,l=c.defaultVal;o[h]=a[u]||pt(l)}for(var d in o.tags){re(t[d])&&(t[d]=[]);var f=Object.assign({},o,{conversationType:r,targetId:s});delete f.tags,t[d].push(f)}}return t},e.prototype.adaptOldStore=function(){try{var e=this.storage.getValues();if(0===Object.keys(e).length)return;for(var t in e){var n=\"_\"+t;this._localStore.set(n,e[t])}}catch(e){pe.error(\"adaptOldStore error: \"+e.message)}},e}(),Dr=[j.PRIVATE,j.GROUP,j.SYSTEM,j.PUBLIC_SERVICE,j.APP_PUBLIC_SERVICE],Vr=\"conversationChanged\",kr=\"conTagStatusChanged\",xr=function(){function e(e,t,n,i,r){var s=this;this._updatedConversations={},this._conTagStatusChanged=!1,this._eventEmitter=new ge,this._draftMap={},this._appkey=t,this._loginUserId=n,this._store=new Pr(e.runtime,t,n),this._statusManager=new wr(e,t,n),this._statusManager.watch((function(e){var t=e.statusItem,n=e.isLastPull;s.addStatus(t,n)})),this._eventEmitter.on(Vr,(function(e){i(e)})),this._eventEmitter.on(kr,(function(){r()}))}return e.prototype._calcUnreadCount=function(e,t){var n=e.content,i=e.messageType,r=e.sentTime,s=e.isCounted,o=e.messageDirection,a=e.senderUserId,u=o===ye.SEND&&a===this._loginUserId,c=i===Re.RECALL,h=ne(n),l=!1,d={},f=t.lastUnreadTime||0,p=t.unreadMessageCount||0;if(f>r||u)return{hasChanged:l,localConversation:t,updateItems:d};(s&&(t.unreadMessageCount=p+1,t.lastUnreadTime=r,l=!0),c&&h)&&(f>=n.sentTime&&p&&(t.unreadMessageCount=p-1,l=!0));return l&&(d.unreadMessageCount={val:t.unreadMessageCount,time:r}),{hasChanged:l,localConversation:t,updateItems:d}},e.prototype._calcMentionedInfo=function(e,t){var n=e.content,i=(e.messageDirection,e.isMentioned),r=e.sentTime;ye.SEND;var s=ne(n),o=!1,a={};return i&&s&&n.mentionedInfo&&(t.hasMentioned=!0,o=!0,a.hasMentioned={val:!0,time:r},a.mentionedInfo={val:n.mentionedInfo,time:r}),{hasChanged:o,localConversation:t,updateItems:a}},e.prototype._calcMentionedCount=function(e,t){var n=e.content,i=e.messageDirection,r=!1;if(e.isMentioned&&i===ye.RECEIVE&&(null==n?void 0:n.mentionedInfo)){var s=n.mentionedInfo,o=s.type,a=s.userIdList;if(o===we.ALL||(a||[]).includes(this._loginUserId)){r=!0;var u=t.unreadMentionedCount||0;t.unreadMentionedCount=u+1}}return{hasChanged:r,localConversation:t}},e.prototype._setUpdatedConversation=function(e){if(ne(e)){var t=e.conversationType,n=e.targetId,i=e.channelId,r=t+\"_\"+n,s=this._store.get(t,n,i)||{};this._updatedConversations[r]=Object.assign(s,e)}},e.prototype._setConTagStatusChanged=function(e,t,n,i){var r=(this._store.get(e,t,i)||{}).tags||{};if(Object.keys(r).length===Object.keys(n).length){for(var s in r)if(!n[s]||r[s].isTop!==n[s].isTop)return void(this._conTagStatusChanged=!0)}else this._conTagStatusChanged=!0},e.prototype.addStatus=function(e,t){var n=e.conversationType,i=e.targetId,r=e.updatedTime,s=e.notificationStatus,o=e.isTop,a=e.tags,u=e.channelId,c={},h={};re(s)||(h.notificationStatus={time:r,val:s}),re(o)||(h.isTop={time:r,val:o}),re(a)||(h.tags={time:r,val:a},null==a||a.forEach((function(e){c[e.tagId]={isTop:e.isTop}}))),this._setConTagStatusChanged(n,i,c,u),this._store.set(n,i,{notificationStatus:s,isTop:o,tags:c},u),this._setUpdatedConversation({conversationType:n,targetId:i,updatedItems:h,channelId:u}),t&&this._notifyConversationChanged()},e.prototype._notifyConversationChanged=function(){var e=[];for(var t in this._updatedConversations)e.push(this._updatedConversations[t]);0!==e.length&&(this._eventEmitter.emit(Vr,e),this._updatedConversations={},this._conTagStatusChanged&&(this._eventEmitter.emit(kr),this._conTagStatusChanged=!1))},e.prototype.setConversationCacheByMessage=function(e,t){var n=this,i=e.conversationType,r=e.isPersited,s=e.targetId,o=e.channelId;if(Dr.indexOf(i)>=0){var a=!1,u=this._store.get(i,s,o),c={};if([this._calcUnreadCount,this._calcMentionedInfo,this._calcMentionedCount].forEach((function(t){var i=t.call(n,e,u),r=i.hasChanged,s=i.localConversation,o=i.updateItems;a=a||r,c=O(O({},c),o),u=pt(s)})),a&&this._store.set(i,s,u,o),this._store.updateMentionedData(e),r){var h=this._store.get(i,s,o);h.updatedItems=O({latestMessage:{time:e.sentTime,val:e}},c),h.latestMessage=e;var l=Object.assign(h,{conversationType:i,targetId:s,channelId:o});this._setUpdatedConversation(l)}(a||r)&&this._notifyConversationChanged()}},e.prototype.get=function(e,t,n){return void 0===n&&(n=\"\"),this._store.get(e,t,n)},e.prototype.getAllUnreadCount=function(e,t,n){var i=this._store.getValue(),r=0;return i.forEach((function(e){var i=e.unreadMessageCount,s=e.notificationStatus,o=e.conversationType;i=i||0,(n||1!==s)&&(t.length>0?t.includes(Number(o))&&(r+=Number(i)):r+=Number(i))})),r},e.prototype.getUnreadCountByTag=function(e,t){var n=this._store.getValueForTag()[e]||[],i=0;return n.forEach((function(e){var n=e.unreadMessageCount,r=e.notificationStatus;(t||1!==r)&&(n=n||0,i+=Number(n))})),i},e.prototype.getUnreadCount=function(e,t,n){return this._store.get(e,t,n).unreadMessageCount||0},e.prototype.clearUnreadCount=function(e,t,n,i){void 0===i&&(i=!0);var r=this._store.get(e,t,n),s=r.unreadMessageCount,o=r.hasMentioned,a={};if(s&&(r.unreadMessageCount=0,a.unreadMessageCount={val:0,time:Date.now()}),o&&(r.hasMentioned=!1,r.unreadMentionedCount=0,r.mentionedInfo=void 0,a.hasMentioned={val:!1,time:Date.now()},a.mentionedInfo={val:void 0,time:Date.now()}),this._store.set(e,t,r,n),i&&0!==Object.keys(a).length){var u=Object.assign(r,{conversationType:e,targetId:t,channelId:n,updatedItems:a});this._setUpdatedConversation(u),this._notifyConversationChanged()}},e.prototype.clearAllUnreadCount=function(){var e=this;this._store.getValue().forEach((function(t){t.unreadMessageCount&&(t.unreadMessageCount=0,e._store.set(t.conversationType,t.targetId,t,t.channelId))}))},e.prototype.startPullConversationStatus=function(e){this._statusManager.pull(e)},e.prototype.setDraft=function(e,t,n,i){var r=e+\"_\"+t+\"_\"+i;this._draftMap[r]=n},e.prototype.getDraft=function(e,t,n){var i=e+\"_\"+t+\"_\"+n;return this._draftMap[i]},e.prototype.clearDraft=function(e,t,n){var i=e+\"_\"+t+\"_\"+n;delete this._draftMap[i]},e.prototype.addTagStatus=function(e,t,n,i){void 0===i&&(i=\"\");var r=this._store.get(e,t,i).tags;r=Object.assign(r,n),this._store.set(e,t,{tags:r},i)},e.prototype.deleteTagStatus=function(e,t,n,i){void 0===i&&(i=\"\");var r=this._store.get(e,t,i).tags;n.forEach((function(e){delete r[e]})),this._store.set(e,t,{tags:r},i)},e.prototype.getConversationListForTag=function(){return this._store.getValueForTag()},e.prototype.getBlockConversationList=function(){return this._store.getValue().filter((function(e){return e.notificationStatus===Ne.OPEN})).map((function(e){return{conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId}}))},e.prototype.getTopConversationList=function(){return(this._store.getValue()||{}).filter((function(e){return e.isTop})).map((function(e){return{conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId}}))},e.prototype.adaptOldStore=function(){this._store.adaptOldStore()},e.prototype.getUnreadMentionedCount=function(e,t,n){return void 0===e&&(e=\"\"),this.get(t,n,e).unreadMentionedCount||0},e.prototype.getAllUnreadMentionedCount=function(){var e=this._store.getValue(),t=0;return e.forEach((function(e){var n=e.unreadMentionedCount;n=n||0,t+=Number(n)})),t},e.prototype.getAllConversationState=function(){return this._store.getValue().filter((function(e){return e.unreadMessageCount||e.unreadMentionedCount})).map((function(e){return{conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId,unreadCount:e.unreadMessageCount||0,unreadMentionedCount:e.unreadMentionedCount||0}}))},e}(),Br=function(){function e(e,t,n,i){this._pullQueue=[],this._isPulling=!1,this._storageTagKey=\"tag-\"+t+\"-\"+n,this._storagePullTimeKey=\"us-s-\"+t+\"-\"+n,this._storage=T(e.runtime),this._engine=e,this._tagWatcherFunc=i}return e.prototype._updateTag=function(e){var t=e.tags,n={};t.forEach((function(e){n[e.tagId]={tagName:e.tagName,createdTime:e.createdTime}})),this._storage.set(this._storageTagKey,n),this._tagWatcherFunc()},e.prototype.addTag=function(e,t){var n=this._storage.get(this._storageTagKey)||{};e.forEach((function(e){var t,i=(null===(t=n[e.tagId])||void 0===t?void 0:t.createdTime)||e.createdTime||0;n[e.tagId]={tagName:e.tagName,createdTime:i}})),this._storage.set(this._storageTagKey,n),this._storage.set(this._storagePullTimeKey,t)},e.prototype.deleteTag=function(e,t){var n=this._storage.get(this._storageTagKey)||{};e.forEach((function(e){delete n[e]})),this._storage.set(this._storageTagKey,n),this._storage.set(this._storagePullTimeKey,t)},e.prototype.getTagsInfo=function(){return this._storage.get(this._storageTagKey)||{}},e.prototype.getTags=function(){var e=this._storage.get(this._storageTagKey)||{},t=[];for(var n in e)t.push({tagId:n,tagName:e[n].tagName,createdTime:e[n].createdTime,conversationCount:0});return t.sort((function(e,t){return(e.createdTime||0)-(t.createdTime||0)}))},e.prototype.getTagById=function(e){var t=this._storage.get(this._storageTagKey)||{};return t[e]?{tagId:e,tagName:t[e].tagName,createdTime:t[e].createdTime,conversationCount:0}:null},e.prototype._startPull=function(){return w(this,void 0,void 0,(function(){var e,t,n,i,r,s,o,a;return b(this,(function(u){switch(u.label){case 0:return this._isPulling||0===this._pullQueue.length?[2]:(this._isPulling=!0,e=this._pullQueue.splice(0,1)[0],[4,this._engine.pullUserSettings(e)]);case 1:return t=u.sent(),n=t.code,i=t.data,n!==Ee.SUCCESS||re(i)?(this._isPulling=!1,this._startPull()):(s=(r=i).settings,o=r.version,a=s.Tag,re(a)||this._updateTag(a),this._storage.set(this._storagePullTimeKey,o),this._isPulling=!1,this._startPull()),[2]}}))}))},e.prototype.pullUserSettings=function(e){var t=this._storage.get(this._storagePullTimeKey)||0;(e>t||0===e)&&(this._pullQueue.push(t),this._startPull())},e.prototype.getVersion=function(){return this._storage.get(this._storagePullTimeKey)||0},e}(),Fr=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._miniConnectUrl=\"\",i._connectType=n.connectionType,i}return N(t,e),t.prototype._formatJSONPUrl=function(e,t,n,i){return e+\"/\"+(this._runtime.isSupportSocket()&&\"websocket\"===this._connectType?\"navi\":\"cometnavi\")+\".js?appId=\"+n+\"&token=\"+encodeURIComponent(t)+\"&callBack=\"+i+\"&v=\"+this._apiVersion+\"&r=\"+Date.now()},t.prototype.getInfo=function(t,n,i){var r;return w(this,void 0,void 0,(function(){var s;return b(this,(function(o){return this._runtime.useNavi||(s=void 0,s=this._runtime.isSupportSocket()&&\"websocket\"===this._connectType?c.join(\",\"):h.join(\",\"),this._miniConnectUrl=(null===(r=this._options.miniCMPProxy)||void 0===r?void 0:r.length)?this._options.miniCMPProxy.join(\",\"):s||\"\",n=[]),[2,e.prototype.getInfo.call(this,t,n,i)]}))}))},t.prototype._reqNavi=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a,u,c,h,l;return b(this,(function(d){switch(d.label){case 0:i=\"getServerEndpoint\",r=0,s=e.length,d.label=1;case 1:return r<s?(o=this._formatJSONPUrl(e[r],n,t,i),pe.debug(\"req navi => \"+o),[4,this._runtime.httpReq({url:o,timeout:1e4,dataType:\"text\"})]):[3,4];case 2:if(200!==(a=d.sent()).status)return 403===a.status?pe.error(\"request navi error: \"+Ee.RC_CONN_USER_OR_PASSWD_ERROR):401===a.status&&pe.error(\"request navi error: \"+Ee.RC_CONN_APP_BLOCKED_OR_DELETED),[3,3];try{return u=a.data.match(/{[\\d\\D]+}/),0===(c=u&&u[0]?u[0]:\"\").indexOf('{\\\\\"code\\\\\":')&&(c=JSON.parse('\"'+c+'\"')),l=JSON.parse(c),h=/^https/.test(o)?\"https\":\"http\",l.protocol=h,this._runtime.useNavi||(l.server=\"\",l.backupServer=this._miniConnectUrl,l.logSwitch=0),[2,l]}catch(e){pe.error(\"parse navi err =>\",e)}d.label=3;case 3:return r+=1,[3,1];case 4:return this._runtime.useNavi?[2,null]:[2,l={code:200,protocol:\"https\",server:\"\",voipCallInfo:\"\",kvStorage:0,openHttpDNS:!1,historyMsg:!1,chatroomMsg:!1,uploadServer:\"https://upload.qiniup.com\",bosAddr:\"https://gz.bcebos.com\",location:\"\",monitor:0,joinMChrm:!1,openMp:0,openUS:0,grpMsgLimit:0,isFormatted:0,gifSize:2048,logSwitch:0,logPolicy:\"\",compDays:0,msgAck:\"\",activeServer:\"\",qnAddr:\"\",extkitSwitch:0,alone:!1,voipServer:\"\",offlinelogserver:\"\",backupServer:this._miniConnectUrl}]}}))}))},t}(mr),Kr=function(){function e(e){this._pullQueue=[],this._isPulling=!1,this._pullTime=0,this._engine=e}return e.prototype._startPull=function(){return w(this,void 0,void 0,(function(){var e,t,n,i,r,s,o;return b(this,(function(a){switch(a.label){case 0:return this._isPulling||0===this._pullQueue.length?[2]:(this._isPulling=!0,e=this._pullQueue.splice(0,1)[0],t=e.roomId,n=e.timestamp,(i=this._pullTime)>n?(this._isPulling=!1,this._startPull(),[2]):[4,this._engine.pullRTCRoomEntry(t,i)]);case 1:return r=a.sent(),s=r.code,o=r.data,s===Ee.SUCCESS?(this._isPulling=!1,this._pullTime=o.syncTime||0,this._startPull()):this._startPull(),[2]}}))}))},e.prototype.pullEntry=function(e,t){this._pullQueue.push({roomId:e,timestamp:t}),this._startPull()},e.prototype.reset=function(){this._pullTime=0,this._isPulling=!1},e}(),qr=function(e,t){return[\"send_msg\",e,t].join(\"_\")},Yr=function(){function e(e,t){this._runtime=e,this._appkey=t,this._sendMessageMap={},this._userId=\"\"}return e.prototype.init=function(e){this._userId=e;var t=qr(this._appkey,e);this._sendMessageMap=this._getLocalInfo(t)},e.prototype._getLocalInfo=function(e){var t=this._runtime.localStorage.getItem(e);try{return t?JSON.parse(t):{}}catch(e){return{}}},e.prototype.setMessage=function(e,t){this._sendMessageMap[e]=t;var n=qr(this._appkey,this._userId),i=this._getLocalInfo(n);i[e]=t,this._runtime.localStorage.setItem(n,JSON.stringify(i))},e.prototype.getSendMessageMap=function(){return this._sendMessageMap},e.prototype.removeByUID=function(e){delete this._sendMessageMap[e]},e.prototype.removeByTimestamp=function(e){var t=qr(this._appkey,this._userId),n=this._getLocalInfo(t);Object.keys(n).forEach((function(t){n[t]<e&&delete n[t]})),this._runtime.localStorage.setItem(t,JSON.stringify(n))},e}(),Hr=function(e){var t=\"RCDeviceId\",n=T(e),i=\"\",r=n.get(t);return r?i=r:(i=H(),n.set(t,i)),i};(Lr={})[j.PRIVATE]=hr.qryPMsg,Lr[j.GROUP]=hr.qryGMsg,Lr[j.CHATROOM]=hr.qryCHMsg,Lr[j.CUSTOMER_SERVICE]=hr.qryCMsg,Lr[j.SYSTEM]=hr.qrySMsg;var Gr=[hr[hr.recallMsg],hr[hr.ppMsgS],hr[hr.pgMsgS],hr[hr.ppMsgP],hr[hr.pgMsgP],hr[hr.chatMsg],hr[hr.pcMsgP],hr[hr.prMsgS]],jr=function(e,t,n,r,s,o){return{conversationType:e,targetId:t,senderUserId:o,messageDirection:ye.SEND,isCounted:!!n.isCounted,isMentioned:!!n.isMentioned,content:n.content,messageType:n.messageType,isOffLineMessage:!1,isPersited:!!n.isPersited,messageUId:r,sentTime:s,receivedTime:0,disableNotification:!!n.disableNotification,isStatusMessage:!!n.isStatusMessage,canIncludeExpansion:!!n.canIncludeExpansion,expansion:n.canIncludeExpansion?n.expansion:null,receivedStatus:i.UNREAD,pushConfig:n.pushConfig,channelId:n.channelId}},Qr=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r._customMessageType={},r._reconnectTimer=-1,r._pullOfflineFinished=!1,r._connectedTime=0,r._localConnectedTime=0,r._pullingMsg=!1,r._pullQueue=[],r._chrmsQueue={},r._latestSyncTimestamp=0,r._intervalTimer=-1,r._letterbox=new Tr(t,i.appkey),r._sendMessageStore=new Yr(t,i.appkey),r._chrmEntryHandler=new Sr(r),r}return N(t,e),t.prototype._createNavi=function(){return new Fr(this.runtime,this._options)},t.prototype.getConnectedTime=function(){return this._connectedTime},t.prototype.connect=function(e,t){return w(this,void 0,void 0,(function(){var n,i,r,s,o,a=this;return b(this,(function(u){switch(u.label){case 0:return n=[],this._naviInfo=t,t.server?n.push(t.server):pe.warn(\"navi.server is invalid\"),(i=t.backupServer)&&i.split(\",\").forEach((function(e){n.indexOf(e)<0&&n.push(e)})),0===n.length?(pe.error(\"navi invaild.\",n),[2,Ee.UNKNOWN]):(r=this.runtime.createDataChannel({status:function(i){a._connectionStatusHandler(i,e,n,t.protocol)},signal:this._signalHandler.bind(this)},this._options.connectionType),s=Ze.V3,1===t.openAnti&&(s=Ze.V4),[4,r.connect(this._appkey,e,n,t.protocol,this._apiVer,s)]);case 1:return(o=u.sent())===Ee.SUCCESS?(this._channel=r,this.currentUserId=r.userId,this._connectedTime=r.connectedTime,this._localConnectedTime=Math.floor((Date.now()+r.sendConnectTime)/2),this._watcher.status(Ie.CONNECTED),this._pullOfflineFinished=!1,this._conversationManager=new xr(this,this._appkey,this.currentUserId,this._watcher.conversation,this._watcher.conversationTag),this._conversationManager.startPullConversationStatus(0),this._userSettingManager=new Br(this,this._appkey,this.currentUserId,this._watcher.tag),this._userSettingManager.pullUserSettings(0),this._sendMessageStore.init(this.currentUserId),this._conversationManager.adaptOldStore(),this._rtcKVManager=new Kr(this),this._joinedChrmManager=new Nr(this.runtime,this._appkey,this.currentUserId,t.joinMChrm),this._startSyncInterval()):r.close(),[2,o]}}))}))},t.prototype._connectionStatusHandler=function(e,t,n,i){if(pe.warn(\"connection status changed:\",e),e!==Ie.CONNECTING)if(e!==Ie.CONNECTED){if(this._channel&&e!==Ie.DISCONNECTED)return e===Ie.BLOCKED||e===Ie.KICKED_OFFLINE_BY_OTHER_CLIENT||e===Ie.DISCONNECT_BY_SERVER?(this.disconnect(),void this._watcher.status(e)):void(e!==Ie.REDIRECT?(this._watcher.status(e),this._try2Reconnect(t,n,i)):this._watcher.status(e));this._watcher.status(e)}else this._watcher.status(e);else this._watcher.status(e)},t.prototype._try2Reconnect=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r=this;return b(this,(function(s){switch(s.label){case 0:return this._channel?(i=Ze.V3,1===this._naviInfo.openAnti&&(i=Ze.V4),[4,this._channel.connect(this._appkey,e,t,n,this._apiVer,i)]):[2];case 1:return s.sent()===Ee.SUCCESS?(this._pullOfflineFinished=!1,this._startSyncInterval(),this._watcher.status(Ie.CONNECTED),this._rejoinChrm(),pe.__insertLogIntoDatabase(),[2]):(this._watcher.status(Ie.WEBSOCKET_UNAVAILABLE),this._reconnectTimer=setTimeout((function(){r._reconnectTimer=-1,r._try2Reconnect(e,t,n)}),5e3),[2])}}))}))},t.prototype._signalHandler=function(e,t){var n=e.syncMsg,i=e.topic;if(n)this._receiveSyncMsg(e,t);else{var r=hr[i];if(r)switch(r){case hr.s_ntf:pe.info(\"recv s_ntf -> signal.messageId: \"+e.messageId),this._pullMsg(e);break;case hr.s_msg:this._receiveMsg(e);break;case hr.s_cmd:this._receiveStateNotify(e);break;case hr.s_us:this._receiveSettingNotify(e);break;case hr.rtc_ntf:this._receiveRtcKv(e)}else pe.error(\"unknown topic:\",i)}},t.prototype._receiveStateNotify=function(e){var t,n=null===(t=this._channel)||void 0===t?void 0:t.codec.decodeByPBName(e.data,Pt),i=n.time,r=n.type,s=n.chrmId;switch(r){case 2:this._chrmEntryHandler.pullEntry(s,i);break;case 3:this._conversationManager.startPullConversationStatus(i);break;case 4:this._chrmEntryHandler.reset(s),this._watcher.chatroom({chatroomDestroyed:e.targetId})}},t.prototype._receiveSettingNotify=function(e){var t,n=(null===(t=this._channel)||void 0===t?void 0:t.codec.decodeByPBName(e.data,Mn)).version;this._userSettingManager.pullUserSettings(n)},t.prototype._receiveRtcKv=function(e){var t,n=null===(t=this._channel)||void 0===t?void 0:t.codec.decodeByPBName(e.data,Qn),i=n.time,r=n.type,s=n.roomId;switch(r){case 1:this._rtcKVManager.pullEntry(s,i)}},t.prototype._receiveMessageExpansion=function(e){var t=e.content,n=t.put,i=t.del,r=t.mid;n&&this._watcher.expansion({updatedExpansion:{messageUId:r,expansion:n}}),i&&this._watcher.expansion({deletedExpansion:{messageUId:r,deletedKeys:i}})},t.prototype._receiveSyncMsg=function(e,t){var n;if(Gr.includes(e.topic)){var i=null===(n=this._channel)||void 0===n?void 0:n.codec.decodeByPBName(e.data,Nt,{currentUserId:this.currentUserId,signal:e});i=this._handleMsgProperties(i),t&&(i.sentTime=t.timestamp,i.messageUId=t.messageUId),this._pullingMsg?this._pullQueue.push((null==t?void 0:t.timestamp)||i.sentTime):(t&&this._sendMessageStore.setMessage(t.messageUId,t.timestamp),i.messageType!==Re.EXPANSION_NOTIFY?(i.messageType===Re.SYNC_READ_STATUS&&this._conversationManager.clearUnreadCount(i.conversationType,i.targetId,i.channelId),this._conversationManager.setConversationCacheByMessage(i,!0),this._watcher.batchMessage([i])):this._receiveMessageExpansion(i))}},t.prototype._pullMsg=function(e){if(this._channel){var t=this._channel.codec.decodeByPBName(e.data,Pt),n=t.type,i=t.chrmId,r=t.time;if(pe.info(\"s_ntf -> type: \"+n+\", chrmId: \"+i+\", time: \"+r),2===n){var s=this._chrmsQueue[i];if(!s)return;s.queue.push(r),this._pullChrmMsg(i)}else this._pullQueue.push(r),this._syncMsg()}},t.prototype._startSyncInterval=function(){var e=this;this._stopSyncInterval();this._intervalTimer=setInterval((function(){Date.now()-e._latestSyncTimestamp>=18e4&&e._syncMsg()}),3e4),this._latestSyncTimestamp=Date.now(),this._syncMsg()},t.prototype._stopSyncInterval=function(){-1!==this._intervalTimer&&(clearInterval(this._intervalTimer),this._intervalTimer=-1)},t.prototype._syncMsg=function(){return w(this,void 0,void 0,(function(){var e,t,n,i,r,s,o,a,u,c,h,l,d,f,p=this;return b(this,(function(g){switch(g.label){case 0:return this._pullingMsg?[2]:this._channel?(this._pullingMsg=!0,e=this._letterbox.getOutboxTime(this.currentUserId),t=this._letterbox.getInboxTime(this.currentUserId),pe.info(\"pullMsg -> sendboxTime: \"+e+\", inboxTime: \"+t),n=this._channel.codec.encodeSyncMsg({sendboxTime:e,inboxTime:t}),i=new sr(hr[hr.pullMsg],n,this.currentUserId),[4,this._channel.send(i,bt,{connectedTime:this._channel.connectedTime,currentUserId:this.currentUserId})]):(this._pullingMsg=!1,[2]);case 1:return r=g.sent(),s=r.code,o=r.data,this._latestSyncTimestamp=Date.now(),s!==Ee.SUCCESS||!o||re(o.finished)||re(o.list)||re(o.syncTime)?(pe.warn(\"pullMsg failed -> code:\",s,\", data: \",o),this._pullingMsg=!1,[2]):(a=o.list,u=o.finished,c=o.syncTime,pe.info(\"pullMsg success -> syncTime: \"+c+\", finished: \"+u),h=0,l=[],a.forEach((function(e){if(e.messageDirection===ye.SEND&&(h=Math.max(e.sentTime,h),p._sendMessageStore.getSendMessageMap()[e.messageUId]))return void p._sendMessageStore.removeByUID(e.messageUId);if(e.messageType!==Re.EXPANSION_NOTIFY){if(e.messageType===Re.SYNC_READ_STATUS){if(e.senderUserId!==p.currentUserId)return;p._conversationManager.clearUnreadCount(e.conversationType,e.targetId,e.channelId)}var t=p._handleMsgProperties(e);p._conversationManager.setConversationCacheByMessage(t,!0),l.push(t)}else p._receiveMessageExpansion(e)})),this._watcher.batchMessage(l),this._letterbox.setInboxTime(c,this.currentUserId),this._letterbox.setOutboxTime(h,this.currentUserId),this._sendMessageStore.removeByTimestamp(h),this._pullingMsg=!1,d=this._pullQueue.filter((function(e){return e>c})),this._pullQueue.length=0,(f=this._pullQueue).push.apply(f,d),u&&!this._pullOfflineFinished&&(this._pullOfflineFinished=!0,this._watcher.pullFinished()),(!u||d.length>0)&&this._syncMsg(),[2])}}))}))},t.prototype._receiveMsg=function(e){if(this._channel&&!this._pullingMsg)if(this._pullQueue.length>0)this._syncMsg();else{var t=this._channel.codec.decodeByPBName(e.data,wt,{currentUserId:this.currentUserId,connectedTime:this._channel.connectedTime});(t=this._handleMsgProperties(t)).senderUserId===this.currentUserId&&this._sendMessageStore.setMessage(t.messageUId,t.sentTime),t.isStatusMessage||t.senderUserId===this.currentUserId||this._letterbox.setInboxTime(t.sentTime,this.currentUserId),t.messageType!==Re.EXPANSION_NOTIFY?t.messageType===Re.SYNC_READ_STATUS&&t.senderUserId!==this.currentUserId||(this._conversationManager.setConversationCacheByMessage(t,!0),this._watcher.batchMessage([t])):this._receiveMessageExpansion(t)}},t.prototype._handleMsgProperties=function(e,t){void 0===t&&(t=!1);var n,i=e.messageType,r=e.isCounted,s=e.isPersited,o=e.isStatusMessage,a=i in E,u=i in this._customMessageType;if(n=a?O(O({},E[i]),{isStatusMessage:I.includes(i)}):u?this._customMessageType[i]:{isCounted:!se(r)&&r,isPersited:!se(s)&&s,isStatusMessage:!1},Object.assign(e,n),t&&!re(o)&&(e.isStatusMessage=o),!t){var c=e.content.user;if(c){var h=c.portrait,l=c.portraitUri,d=h||l;d&&(c.portrait=c.portraitUri=d)}}return e},t.prototype.getHistoryMessage=function(e,t,n,i,r,s){return void 0===s&&(s=\"\"),w(this,void 0,void 0,(function(){var o,a,u,c,h,l,d,f,p;return b(this,(function(g){switch(g.label){case 0:return a=(o=this).currentUserId,u=o._channel,c=ki[e]||Ai,h=1===i&&0===n,u?(l=u.codec.encodeGetHistoryMsg(t,{timestamp:n,count:h?2:i,order:r,channelId:s}),[4,u.send(new sr(c,l,a),Vt,{currentUserId:a,connectedTime:u.connectedTime,conversation:{targetId:t}})]):[3,2];case 1:return d=g.sent(),(f=d.code)!==Ee.SUCCESS?[2,{code:f}]:(p=d.data,h&&2===p.list.length&&(p.hasMore=!0,0===r?p.list.shift():p.list.pop()),[2,{code:f,data:{list:p.list,hasMore:p.hasMore}}]);case 2:return[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.reportSDKInfo=function(e){var t=this.currentUserId,n=this._channel;if(n){pe.info(\"reportSDKInfo ->\",e);var i=n.codec.encodeReportSDKInfo(JSON.stringify(e)),r=new sr(hr[hr.reportsdk],i,t);n.send(r).then((function(e){var t=e.code;t!==Ee.SUCCESS&&pe.warn(\"reportSDKInfo failed -> code: \"+t)}))}},t.prototype.deleteRemoteMessage=function(e,t,n,i){return w(this,void 0,void 0,(function(){var r,s,o,a,u,c,h;return b(this,(function(l){switch(l.label){case 0:return s=(r=this).currentUserId,(o=r._channel)?(a=o.codec.encodeDeleteMessages(e,t,n,i),u=new sr(Ei,a,s),[4,o.send(u)]):[3,2];case 1:return c=l.sent(),h=c.code,Ee.SUCCESS,[2,h];case 2:return[2,Ee.RC_NET_CHANNEL_INVALID]}}))}))},t.prototype.deleteRemoteMessageByTimestamp=function(e,t,n,i){return w(this,void 0,void 0,(function(){var r,s,o,a,u,c,h,l;return b(this,(function(d){switch(d.label){case 0:return s=(r=this).currentUserId,(o=r._channel)?(a=o.codec.encodeClearMessages(t,n,i),u=xi[e],c=new sr(u,a,s),[4,o.send(c)]):[3,2];case 1:return h=d.sent(),l=h.code,Ee.SUCCESS,[2,l];case 2:return[2,Ee.RC_NET_CHANNEL_INVALID]}}))}))},t.prototype.getConversationList=function(e,t,n,i,r){return void 0===e&&(e=300),w(this,void 0,void 0,(function(){var r,s,o,a,u,c,h,l,d=this;return b(this,(function(f){switch(f.label){case 0:return s=(r=this).currentUserId,o=r._channel,t=t||j.PRIVATE,o?(a=o.codec.encodeOldConversationList({count:e,type:t,startTime:n,order:i}),u=new sr(Oi,a,s),[4,o.send(u,xt,{currentUserId:s,connectedTime:o.connectedTime,afterDecode:function(e){var t=e.conversationType,n=e.targetId,i=e.channelId,r=d._conversationManager.get(t,n,i);return Object.assign(e,r),e}})]):[3,2];case 1:return c=f.sent(),h=c.code,l=c.data,h!==Ee.SUCCESS?[2,{code:h}]:[2,{code:h,data:l}];case 2:return[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.removeConversation=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a;return b(this,(function(u){switch(u.label){case 0:return(i=this._channel)?(r=i.codec.encodeRemoveOldConversationList({conversationType:e,channelId:n,targetId:t}),s=new sr(wi,r,t),[4,i.send(s)]):[3,2];case 1:return o=u.sent(),pe.info(\"RemoveConversation =>\",o),a=o.code,Ee.SUCCESS,[2,a];case 2:return[2,Ee.RC_NET_CHANNEL_INVALID]}}))}))},t.prototype.getConversation=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a,u;return b(this,(function(c){switch(c.label){case 0:return(i=this._conversationManager.get(e,t,n))?[4,this.getHistoryMessage(e,t,0,1,0)]:[2,{code:Ee.CONVER_GET_ERROR}];case 1:return r=c.sent(),s=r.code,o=r.data,s!==Ee.SUCCESS?[2,{code:Ee.CONVER_GET_ERROR}]:(a=(null==o?void 0:o.list[0])||null,u={conversationType:e,targetId:t,channelId:n,unreadMessageCount:i.unreadMessageCount||0,latestMessage:a,notificationStatus:i.notificationStatus||Ne.CLOSE,isTop:i.isTop||!1,lastUnreadTime:i.lastUnreadTime||0,unreadMentionedCount:i.unreadMentionedCount||0},[2,{code:Ee.SUCCESS,data:u}])}}))}))},t.prototype.getAllConversationUnreadCount=function(e,t,n){var i=this._conversationManager.getAllUnreadCount(e,t,n);return Promise.resolve({code:Ee.SUCCESS,data:i})},t.prototype.getConversationUnreadCount=function(e,t,n){var i=this._conversationManager.getUnreadCount(e,t,n);return Promise.resolve({code:Ee.SUCCESS,data:i})},t.prototype.clearConversationUnreadCount=function(e,t,n){return this._conversationManager.clearUnreadCount(e,t,n,!1),Promise.resolve(Ee.SUCCESS)},t.prototype.clearAllUnreadCount=function(){return this._conversationManager.clearAllUnreadCount(),Promise.resolve(Ee.SUCCESS)},t.prototype.getFirstUnreadMessage=function(e,t){throw new Error(\"Method not implemented.\")},t.prototype.saveConversationMessageDraft=function(e,t,n,i){return this._conversationManager.setDraft(e,t,n,i),Promise.resolve(Ee.SUCCESS)},t.prototype.getConversationMessageDraft=function(e,t,n){var i=this._conversationManager.getDraft(e,t,n);return Promise.resolve({code:Ee.SUCCESS,data:i})},t.prototype.clearConversationMessageDraft=function(e,t,n){return this._conversationManager.clearDraft(e,t,n),Promise.resolve(Ee.SUCCESS)},t.prototype.pullConversationStatus=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a,u;return b(this,(function(c){switch(c.label){case 0:return n=(t=this)._channel,i=t.currentUserId,n?(r=n.codec.encodeGetConversationStatus(e),s=new sr(hr[hr.pullSeAtts],r,i),[4,n.send(s,Un)]):[3,2];case 1:return o=c.sent(),a=o.code,u=o.data,a!==Ee.SUCCESS?[2,{code:a}]:[2,{code:a,data:u}];case 2:return[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}}))}))},t.prototype.batchSetConversationStatus=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a,u,c,h=this;return b(this,(function(l){switch(l.label){case 0:return n=(t=this).currentUserId,(i=t._channel)?(r=i.codec.encodeSetConversationStatus(e),s=new sr(bi,r,n),[4,i.send(s,Vn)]):[3,2];case 1:return o=l.sent(),a=o.code,u=o.data,a===Ee.SUCCESS?(c=u,e.forEach((function(e){h._conversationManager.addStatus(O(O({},e),{updatedTime:c.version}),!0)})),[2,a]):[2,a];case 2:return[2,Ee.RC_NET_CHANNEL_INVALID]}}))}))},t.prototype._joinChrm=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a,u,c;return b(this,(function(h){switch(h.label){case 0:return(i=this._channel)?(r=i.codec.encodeJoinOrQuitChatRoom(),s=new sr(n?Ii:mi,r,e),[4,i.send(s,Qt)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return o=h.sent(),a=o.code,u=o.data,a===Ee.SUCCESS&&(c=u.joinTime,this._chrmsQueue[e]||(this._chrmsQueue[e]={pulling:!1,queue:[],timestamp:0}),this._pullChrmMsg(e,t,c),this._naviInfo.kvStorage&&this._chrmEntryHandler.pullEntry(e,0),this._joinedChrmManager.set(e,t)),[2,a]}}))}))},t.prototype._rejoinChrm=function(){return w(this,void 0,void 0,(function(){var e,t,n,i,r,s;return b(this,(function(o){switch(o.label){case 0:for(n in e=this._joinedChrmManager.get(),t=[],e)t.push(n);i=0,o.label=1;case 1:return i<t.length?(r=t[i],[4,this._joinChrm(r,e[r]||10,!0)]):[3,4];case 2:(s=o.sent())===Ee.SUCCESS?this._watcher.chatroom({rejoinedRoom:{chatroomId:r,count:e[r]}}):this._watcher.chatroom({rejoinedRoom:{chatroomId:r,errorCode:s}}),o.label=3;case 3:return i++,[3,1];case 4:return[2]}}))}))},t.prototype._pullChrmMsg=function(e,t,n){return void 0===t&&(t=10),void 0===n&&(n=0),w(this,void 0,void 0,(function(){var i,r,s,o,a,u,c,h,l,d,f,p;return b(this,(function(g){switch(g.label){case 0:return this._channel?(i=this._chrmsQueue[e],r=i.pulling,s=i.timestamp,r?[2]:(i.pulling=!0,o=this._channel.codec.encodeChrmSyncMsg(s,t),a=new sr(hr[hr.chrmPull],o,e),[4,this._channel.send(a,bt,{connectedTime:this._channel.connectedTime,currentUserId:this.currentUserId})])):[2];case 1:return u=g.sent(),c=u.code,h=u.data,i.pulling=!1,c===Ee.SUCCESS&&h?(l=h.list,d=h.syncTime,f=h.finished,i.timestamp=n?Math.max(d,n):d,i.queue=i.queue.filter((function(e){return e>d})),p=[],l.forEach((function(e){e.sentTime<s||p.push(e)})),this._watcher.batchMessage(p),(!f||i.queue.length>0)&&this._pullChrmMsg(e),[2]):(pe.warn(\"pull chatroom msg failed, code:\",c,\", data:\",h),[2])}}))}))},t.prototype.joinChatroom=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return[2,this._joinChrm(e,t,!1)]}))}))},t.prototype.joinExistChatroom=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return[2,this._joinChrm(e,t,!0)]}))}))},t.prototype.quitChatroom=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s;return b(this,(function(o){switch(o.label){case 0:return(t=this._channel)?(n=t.codec.encodeJoinOrQuitChatRoom(),i=new sr(Ti,n,e),[4,t.send(i)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return r=o.sent(),(s=r.code)===Ee.SUCCESS&&(delete this._chrmsQueue[e],this._chrmEntryHandler.reset(e),this._joinedChrmManager.remove(e)),[2,s]}}))}))},t.prototype.getChatroomInfo=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a,u;return b(this,(function(c){switch(c.label){case 0:return(i=this._channel)?(r=i.codec.encodeGetChatRoomInfo(t,n),s=new sr(hr[hr.queryChrmI],r,e),[4,i.send(s,Jt)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return o=c.sent(),a=o.code,u=o.data,a!==Ee.SUCCESS?[2,{code:a}]:[2,{code:a,data:u}]}}))}))},t.prototype.getChatroomHistoryMessages=function(e,t,n,i){return w(this,void 0,void 0,(function(){var r,s,o,a,u,c;return b(this,(function(h){switch(h.label){case 0:return(r=this._channel)?(s=r.codec.encodeGetHistoryMsg(e,{timestamp:t,count:n,order:i}),o=new sr(Li,s,e),[4,r.send(o,Vt,{conversation:{targetId:e}})]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return a=h.sent(),u=a.code,c=a.data,u!==Ee.SUCCESS?[2,{code:u}]:[2,{code:u,data:{list:c.list,hasMore:c.hasMore}}]}}))}))},t.prototype._modifyChatroomKV=function(e,t){return w(this,void 0,void 0,(function(){var n,i,r,s,o,a,u,c;return b(this,(function(h){switch(h.label){case 0:return i=(n=this)._channel,r=n.currentUserId,i?(s=i.codec.encodeModifyChatRoomKV(e,t,r),o=t.type===Ue.UPDATE?Ci:Ri,a=new sr(o,s,e),[4,i.send(a)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return u=h.sent(),(c=u.code)===Ee.SUCCESS?(this._chrmEntryHandler.setLocal(e,{kvEntries:[t],syncTime:(new Date).getTime()},r),[2,c]):[2,c]}}))}))},t.prototype._modifyChatroomKVS=function(e,t){return w(this,void 0,void 0,(function(){var n,i,r,s,o,a,u,c,h,l,d,f;return b(this,(function(p){switch(p.label){case 0:return i=(n=this)._channel,r=n.currentUserId,i?(s=i.codec.encodeModifyChatRoomKVS(e,t,r),o=t.type===Ue.UPDATE?Si:Ni,a=new sr(o,s,e),[4,i.send(a,Cn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return u=p.sent(),c=u.code,-1!==[Ee.SUCCESS,Ee.CHATROOM_KV_STORE_NOT_ALL_SUCCESS].indexOf(c)&&(l=[],delete(d=Object.assign({},t)).entries,t.entries.forEach((function(e){l.push(Object.assign({},e,d))})),c===Ee.CHATROOM_KV_STORE_NOT_ALL_SUCCESS&&(f=u.data,pe.warn(\"设置失败的属性：\",f.errorKeys),h=f.errorKeys,f&&Array.isArray(f.errorKeys)&&f.errorKeys.forEach((function(e){var t=l.findIndex((function(t){return e.key===t.key}));-1!==t&&l.splice(t,1)}))),pe.warn(\"设置成功的属性：\",l),this._chrmEntryHandler.setLocal(e,{kvEntries:l,syncTime:(new Date).getTime()},r)),[2,{code:c,data:h}]}}))}))},t.prototype.setChatroomEntry=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return t.type=Ue.UPDATE,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKV(e,t)]}))}))},t.prototype.setChatroomEntries=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return t.type=Ue.UPDATE,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKVS(e,t)]}))}))},t.prototype.forceSetChatroomEntry=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return t.type=Ue.UPDATE,t.isOverwrite=!0,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKV(e,t)]}))}))},t.prototype.removeChatroomEntry=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return t.type=Ue.DELETE,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKV(e,t)]}))}))},t.prototype.removeChatroomEntries=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return t.type=Ue.DELETE,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKVS(e,t)]}))}))},t.prototype.forceRemoveChatroomEntry=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return t.type=Ue.DELETE,t.isOverwrite=!0,t.userId=t.userId||this.currentUserId,[2,this._modifyChatroomKV(e,t)]}))}))},t.prototype.getChatroomEntry=function(e,t){return w(this,void 0,void 0,(function(){var n,i,r,s,o,a,u;return b(this,(function(c){switch(c.label){case 0:return(n=this._chrmEntryHandler.getValue(e,t))?[2,Promise.resolve({code:Ee.SUCCESS,data:n})]:[3,1];case 1:return(i=this._channel)?(r=i.codec.encodePullChatRoomKV(0),s=new sr(hr[hr.pullKV],r,e),[4,i.send(s,Tn)]):[2,Promise.reject({code:Ee.RC_NET_CHANNEL_INVALID})];case 2:return o=c.sent(),(a=o.data||{})&&a.kvEntries&&a.kvEntries.length&&void 0!==(u=a.kvEntries.find((function(e){return e.key===t})))?[2,Promise.resolve({code:Ee.SUCCESS,data:null==u?void 0:u.value})]:[2,Promise.resolve({code:Ee.CHATROOM_KEY_NOT_EXIST})]}}))}))},t.prototype.getAllChatroomEntry=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a;return b(this,(function(u){switch(u.label){case 0:return(t=this._chrmEntryHandler.getAll(e))&&Object.keys(t).length?[2,Promise.resolve({code:Ee.SUCCESS,data:t})]:[3,1];case 1:return(n=this._channel)?(i={},r=n.codec.encodePullChatRoomKV(0),s=new sr(hr[hr.pullKV],r,e),[4,n.send(s,Tn)]):[2,Promise.reject({code:Ee.RC_NET_CHANNEL_INVALID})];case 2:return o=u.sent(),(a=o.data||{})&&a.kvEntries&&a.kvEntries.length&&a.kvEntries.forEach((function(e){e.key&&(i[e.key]=e.value||\"\")})),[2,Promise.resolve({code:Ee.SUCCESS,data:i})]}}))}))},t.prototype.pullChatroomEntry=function(e,t){return w(this,void 0,void 0,(function(){var n,i,r,s,o,a,u,c,h,l;return b(this,(function(d){switch(d.label){case 0:return i=(n=this)._channel,r=n.currentUserId,i?(s=i.codec.encodePullChatRoomKV(t),o=new sr(hr[hr.pullKV],s,e),[4,i.send(o,Tn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return a=d.sent(),u=a.code,c=a.data,u===Ee.SUCCESS?(pe.info(\"Pull success ChrmKV, \"+JSON.stringify(a)),this._chrmEntryHandler.setLocal(e,c,r),pe.info(\"Save into cache success!\"),h=c.kvEntries,l=[],h.length>0&&(h.forEach((function(t){var n=t.key,i=t.value,r=t.type,s=t.timestamp;l.push({key:n,value:i,type:r,timestamp:s,chatroomId:e})})),this._watcher.chatroom({updatedEntries:l})),[2,{code:u,data:c}]):[2,{code:u}]}}))}))},t.prototype.sendMessage=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a,u,c,h,l,d;return b(this,(function(f){switch(f.label){case 0:return this._channel?(n=function(e,t){return\"RC:SRSMsg\"===e.messageType&&Object.assign(e,{directionalUserIdList:[t]}),e}(n,this.currentUserId),n=this._handleMsgProperties(n,!0),i=!![j.PRIVATE,j.GROUP].includes(e)&&n.isStatusMessage,r=i?function(e){var t;return(t={},t[j.PRIVATE]=hr.ppMsgS,t[j.GROUP]=hr.pgMsgS,t)[e]}(e):function(e){var t;return(t={},t[j.PRIVATE]=hr.ppMsgP,t[j.GROUP]=hr.pgMsgP,t[j.CHATROOM]=hr.chatMsg,t[j.CUSTOMER_SERVICE]=hr.pcMsgP,t[j.RTC_ROOM]=hr.prMsgS,t)[e]}(e)||hr.ppMsgP,i&&(n.isPersited=!1,n.isCounted=!1),s=this._channel.codec.encodeUpMsg({conversationType:e,targetId:t},n),(o=new nr(hr[r],s,t)).setHeaderQos(Qe.AT_LEAST_ONCE),i?(this._channel.sendOnly(o),[2,{code:Ee.SUCCESS,data:jr(e,t,O({},n),\"\",0,this.currentUserId)}]):(a=Date.now()-this._localConnectedTime+this._connectedTime,u=jr(e,t,O({},n),\"\",a,this.currentUserId),[4,this._channel.send(o)])):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return c=f.sent(),h=c.code,l=c.data,h!==Ee.SUCCESS?[2,{code:h,data:u}]:(d=l,this._sendMessageStore.setMessage(d.messageUId,d.timestamp),u.sentTime=d.timestamp,u.messageUId=d.messageUId,this._conversationManager.setConversationCacheByMessage(u,!0),[2,{code:Ee.SUCCESS,data:u}])}}))}))},t.prototype.recallMsg=function(e,t,n,i,r){var s;return w(this,void 0,void 0,(function(){var o,a,u,c,h,l,d,f,p,g;return b(this,(function(_){switch(_.label){case 0:return this._channel?(o=r.user,a={content:{conversationType:e,targetId:t,messageUId:n,sentTime:i,user:o},messageType:\"RC:RcCmd\",disableNotification:null==r?void 0:r.disableNotification,pushConfig:null==r?void 0:r.pushConfig,pushContent:(null===(s=r.pushConfig)||void 0===s?void 0:s.pushContent)||r.pushContent||\"\",channelId:r.channelId},u=hr[hr.recallMsg],c=this._channel.codec.encodeUpMsg({conversationType:e,targetId:t},a),(h=new nr(u,c,this.currentUserId)).setHeaderQos(Qe.AT_LEAST_ONCE),[4,this._channel.send(h)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return l=_.sent(),d=l.code,f=l.data,d!==Ee.SUCCESS?[2,{code:d}]:(p=f,this._sendMessageStore.setMessage(p.messageUId,p.timestamp),g=jr(e,t,O(O({},a),{isPersited:!0}),p.messageUId,p.timestamp,this.currentUserId),this._conversationManager.setConversationCacheByMessage(g,!0),[2,{code:Ee.SUCCESS,data:g}])}}))}))},t.prototype.sendReadReceiptMessage=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r;return b(this,(function(s){switch(s.label){case 0:return this._channel?(i=this._channel.codec.encodeReadReceipt(t,n),r=new sr(hr[hr.rrMsg],i,e),[4,this._channel.send(r)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return[2,s.sent()]}}))}))},t.prototype.getMessageReader=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r;return b(this,(function(s){switch(s.label){case 0:return this._channel?(i=this._channel.codec.encodeMessageReader(t,n),r=new sr(hr[hr.rrList],i,e),[4,this._channel.send(r,Bn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return[2,s.sent()]}}))}))},t.prototype.pullUserSettings=function(e){return w(this,void 0,void 0,(function(){var t,n;return b(this,(function(i){return this._channel?(t=this._channel.codec.encodePullUserSetting(e),n=new sr(hr[hr.pullUS],t,this.currentUserId),[2,this._channel.send(n,bn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.getFileToken=function(e,t,n,i){return w(this,void 0,void 0,(function(){var r,s,o,a,u,c;return b(this,(function(h){switch(h.label){case 0:return this._channel?(r=i&&\"uploads\"!==i?t||\"\":it(e,t),s=this._channel.codec.encodeGetFileToken(e,r,n||\"\",i||\"\"),o=new sr(hr[hr.qnTkn],s,this.currentUserId),[4,this._channel.send(o,pn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return a=h.sent(),u=a.code,c=a.data,c=Object.assign(c,{fileName:r}),u===Ee.SUCCESS?[2,{code:u,data:c}]:[2,{code:u}]}}))}))},t.prototype.getFileUrl=function(e,t,n,i){return w(this,void 0,void 0,(function(){var r,s,o,a,u,c,h,l,d;return b(this,(function(f){switch(f.label){case 0:return this._channel?(r=\"\",s=\"\",o=\"\",t===Me.QINIU?(s=gn,o=yn):(s=_n,o=vn),r=t===Me.QINIU?hr[hr.qnUrl]:t===Me.AWS?hr[hr.s3Url]:t===Me.STC?hr[hr.stcUrl]:hr[hr.aliUrl],a=this._channel.codec.encodeGetFileUrl(s,e,n,i),u=new sr(r,a,this.currentUserId),[4,this._channel.send(u,o)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return c=f.sent(),h=c.code,l=c.data,d=l,h===Ee.SUCCESS?[2,{code:h,data:d}]:[2,{code:h}]}}))}))},t.prototype.disconnect=function(){-1!==this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=-1),this._channel&&(this._channel.close(),this._channel=void 0),this._pullQueue.length=0,this._stopSyncInterval()},t.prototype.destroy=function(){throw new Error(\"JSEngine's method not implemented.\")},t.prototype.registerMessageType=function(e,t,n,i,r){this._customMessageType[e]={isPersited:t,isCounted:n,isStatusMessage:r}},t.prototype.getServerTime=function(){return Date.now()-this._localConnectedTime+this._connectedTime},t.prototype.getCurrentUserId=function(){return this.currentUserId},t.prototype.createTag=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a;return b(this,(function(u){switch(u.label){case 0:return this._channel?(t=this._userSettingManager.getVersion(),n=this._channel.codec.encodeCreateTag([e],t),i=new sr(hr[hr.addSeTag],n,this.currentUserId),[4,this._channel.send(i,On)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return r=u.sent(),s=r.code,o=r.data,s!==Ee.SUCCESS?[2,{code:s}]:(a=o.version,this._userSettingManager.addTag([O(O({},e),{createdTime:a})],a),[2,{code:Ee.SUCCESS,data:o}])}}))}))},t.prototype.removeTag=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a;return b(this,(function(u){switch(u.label){case 0:return this._channel?(t=this._userSettingManager.getVersion(),n=this._channel.codec.encodeRemoveTag([e],t),i=new sr(hr[hr.delSeTag],n,this.currentUserId),[4,this._channel.send(i,On)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return r=u.sent(),s=r.code,o=r.data,s!==Ee.SUCCESS?[2,{code:s}]:(a=o.version,this._userSettingManager.deleteTag([e],a),[2,{code:Ee.SUCCESS}])}}))}))},t.prototype.updateTag=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a;return b(this,(function(u){switch(u.label){case 0:return this._channel?(t=this._userSettingManager.getVersion(),n=this._channel.codec.encodeCreateTag([e],t),i=new sr(hr[hr.addSeTag],n,this.currentUserId),[4,this._channel.send(i,On)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return r=u.sent(),s=r.code,o=r.data,s!==Ee.SUCCESS?[2,{code:s}]:(a=o.version,this._userSettingManager.addTag([e],a),[2,{code:Ee.SUCCESS,data:o}])}}))}))},t.prototype.getTagList=function(){return w(this,void 0,void 0,(function(){var e,t;return b(this,(function(n){return e=this._userSettingManager.getTags(),t=this._conversationManager.getConversationListForTag(),e.forEach((function(e){e.conversationCount=t[e.tagId]?t[e.tagId].length:0})),[2,{code:Ee.SUCCESS,data:e}]}))}))},t.prototype.addTagForConversations=function(e,t){return w(this,void 0,void 0,(function(){var n,i,r,s,o=this;return b(this,(function(a){switch(a.label){case 0:return this._channel?this._userSettingManager.getTagById(e)?(n=this._channel.codec.encodeUpdateConversationTag([{tagId:e}],t),i=new sr(hr[hr.addTag],n,this.currentUserId),[4,this._channel.send(i)]):[2,{code:Ee.TAG_NOT_EXIST}]:[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return(r=a.sent().code)!==Ee.SUCCESS?[2,{code:r}]:((s={})[e]={},t.forEach((function(e){o._conversationManager.addTagStatus(e.conversationType,e.targetId,s,e.channelId)})),[2,{code:Ee.SUCCESS}])}}))}))},t.prototype.removeTagForConversations=function(e,t){return w(this,void 0,void 0,(function(){var n,i,r,s=this;return b(this,(function(o){switch(o.label){case 0:return this._channel?(n=this._channel.codec.encodeUpdateConversationTag([{tagId:e}],t),i=new sr(hr[hr.delTag],n,this.currentUserId),[4,this._channel.send(i)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return(r=o.sent().code)!==Ee.SUCCESS?[2,{code:r}]:(t.forEach((function(t){s._conversationManager.deleteTagStatus(t.conversationType,t.targetId,[e],t.channelId)})),[2,{code:Ee.SUCCESS}])}}))}))},t.prototype.removeTagsForConversation=function(e,t){return w(this,void 0,void 0,(function(){var n,i,r,s,o,a,u;return b(this,(function(c){switch(c.label){case 0:return this._channel?(n=e.conversationType,i=e.targetId,r=e.channelId,s=t.map((function(e){return{tagId:e}})),o=this._channel.codec.encodeUpdateConversationTag(s,[e]),a=new sr(hr[hr.delTag],o,this.currentUserId),[4,this._channel.send(a)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return(u=c.sent().code)!==Ee.SUCCESS?[2,{code:u}]:(this._conversationManager.deleteTagStatus(n,i,t,r),[2,{code:Ee.SUCCESS}])}}))}))},t.prototype.getConversationListByTag=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a,u,c,h,l;return b(this,(function(d){switch(d.label){case 0:return r=(i=this).currentUserId,(s=i._channel)?(o=s.codec.encodeOldConversationList({count:n,type:j.PRIVATE,startTime:t}),a=new sr(Oi,o,r),[4,s.send(a,xt,{currentUserId:r,connectedTime:s.connectedTime})]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return u=d.sent(),c=u.code,h=u.data,l=this._conversationHasTagFilter(e,h),pe.info(\"GetConversationListByTag\",l),c!==Ee.SUCCESS?[2,{code:c}]:[2,{code:c,data:l}]}}))}))},t.prototype._conversationHasTagFilter=function(e,t){var n=this,i=[],r=[];function s(e,t){return e.latestMessage&&t.latestMessage?e.latestMessage.sentTime-t.latestMessage.sentTime:0}return t.forEach((function(t){var s=t.conversationType,o=t.targetId,a=t.channelId,u=n._conversationManager.get(s,o,a),c=u.hasMentioned,h=u.mentionedInfo,l=u.lastUnreadTime,d=u.notificationStatus,f=u.isTop,p=u.tags,g=u.unreadMessageCount,_=p&&p[e];if(_){var y=O(O({},t),{hasMentioned:c,mentionedInfo:h,lastUnreadTime:l,notificationStatus:d,isTop:f,unreadMessageCount:g});_.isTop?i.push(O(O({},y),{isTopInTag:!0})):r.push(O(O({},y),{isTopInTag:!1}))}})),M(M([],i.sort(s)),r.sort(s))},t.prototype.getUnreadCountByTag=function(e,t){return w(this,void 0,void 0,(function(){var n;return b(this,(function(i){return this._channel?(n=this._conversationManager.getUnreadCountByTag(e,t),[2,{code:Ee.SUCCESS,data:n}]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.setConversationStatusInTag=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a,u,c,h,l,d;return b(this,(function(f){switch(f.label){case 0:return this._channel?(i=t.targetId,r=t.conversationType,s=t.channelId,o=n.isTop,a=[{tagId:e,isTop:o}],(u=this._conversationManager.get(r,i,s)).tags&&Object.hasOwnProperty.call(u.tags,e)?(c=this._channel.codec.encodeUpdateConversationTag(a,[t]),h=new sr(hr[hr.addTag],c,this.currentUserId),[4,this._channel.send(h)]):[2,{code:Ee.NO_TAG_IN_CONVER}]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return(l=f.sent().code)!==Ee.SUCCESS?[2,{code:l}]:((d={})[e]={},o&&(d[e].isTop=!0),this._conversationManager.addTagStatus(r,i,d,s),[2,{code:Ee.SUCCESS}])}}))}))},t.prototype.getTagsForConversation=function(e){var t;return w(this,void 0,void 0,(function(){var n,i,r,s;return b(this,(function(o){if(!this._channel)return[2,{code:Ee.RC_NET_CHANNEL_INVALID}];if(n=this._conversationManager.get(e.conversationType,e.targetId,e.channelId),i=this._userSettingManager.getTagsInfo(),r=[],n.tags)for(s in n.tags)r.push({tagId:s,tagName:null===(t=i[s])||void 0===t?void 0:t.tagName});return[2,{code:Ee.SUCCESS,data:r}]}))}))},t.prototype.getBlockConversationList=function(){var e=this._conversationManager.getBlockConversationList();return Promise.resolve({code:Ee.SUCCESS,data:e})},t.prototype.getTopConversationList=function(){var e=this._conversationManager.getTopConversationList();return Promise.resolve({code:Ee.SUCCESS,data:e})},t.prototype.getUnreadMentionedCount=function(e){var t=this._conversationManager.getUnreadMentionedCount(e.channelId,e.conversationType,e.targetId);return Promise.resolve({code:Ee.SUCCESS,data:t})},t.prototype.getAllUnreadMentionedCount=function(){var e=this._conversationManager.getAllUnreadMentionedCount();return Promise.resolve({code:Ee.SUCCESS,data:e})},t.prototype.getAllConversationState=function(){return Promise.resolve({code:Ee.SUCCESS,data:this._conversationManager.getAllConversationState()})},t.prototype.joinRTCRoom=function(e,t,n,i,r,s){return w(this,void 0,void 0,(function(){var o,a;return b(this,(function(u){return this._channel?(o=this._channel.codec.encodeJoinRTCRoom(t,n,i,r,s),a=new sr(hr[hr.rtcRJoin_data],o,e),[2,this._channel.send(a,Zt)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.quitRTCRoom=function(e){return w(this,void 0,void 0,(function(){var t,n;return b(this,(function(i){switch(i.label){case 0:return this._channel?(t=this._channel.codec.encodeQuitRTCRoom(),n=new sr(hr[hr.rtcRExit],t,e),[4,this._channel.send(n)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,i.sent().code]}}))}))},t.prototype.rtcPing=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r;return b(this,(function(s){switch(s.label){case 0:return this._channel?(i=this._channel.codec.encodeJoinRTCRoom(t,n),r=new sr(hr[hr.rtcPing],i,e),[4,this._channel.send(r)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,s.sent().code]}}))}))},t.prototype.getRTCRoomInfo=function(e){return w(this,void 0,void 0,(function(){var t,n;return b(this,(function(i){return this._channel?(t=this._channel.codec.encodeGetRTCRoomInfo(),n=new sr(hr[hr.rtcRInfo],t,e),[2,this._channel.send(n,hn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.getRTCUserInfoList=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s;return b(this,(function(o){switch(o.label){case 0:return this._channel?(t=this._channel.codec.encodeGetRTCRoomInfo(),n=new sr(hr[hr.rtcUData],t,e),[4,this._channel.send(n,Zt)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return i=o.sent(),r=i.code,s=i.data,[2,{code:r,data:s?{users:s.users}:s}]}}))}))},t.prototype.setRTCUserInfo=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r;return b(this,(function(s){switch(s.label){case 0:return this._channel?(i=this._channel.codec.encodeSetRTCUserInfo(t,n),r=new sr(hr[hr.rtcUPut],i,e),[4,this._channel.send(r)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,s.sent().code]}}))}))},t.prototype.removeRTCUserInfo=function(e,t){return w(this,void 0,void 0,(function(){var n,i;return b(this,(function(r){switch(r.label){case 0:return this._channel?(n=this._channel.codec.encodeRemoveRTCUserInfo(t),i=new nr(hr[hr.rtcUDel],n,e),[4,this._channel.send(i)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,r.sent().code]}}))}))},t.prototype.setRTCData=function(e,t,n,i,r,s){return w(this,void 0,void 0,(function(){var o,a;return b(this,(function(u){switch(u.label){case 0:return this._channel?(o=this._channel.codec.encodeSetRTCData(t,n,i,r,s),a=new nr(hr[hr.rtcSetData],o,e),[4,this._channel.send(a)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,u.sent().code]}}))}))},t.prototype.setRTCTotalRes=function(e,t,n,i,r){return w(this,void 0,void 0,(function(){var s,o;return b(this,(function(a){switch(a.label){case 0:return this._channel?(s=this._channel.codec.encodeUserSetRTCData(t,n,i,r),o=new sr(hr[hr.userSetData],s,e),[4,this._channel.send(o)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,a.sent().code]}}))}))},t.prototype.setRTCCDNUris=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r;return b(this,(function(s){switch(s.label){case 0:return this._channel?(i=this._channel.codec.encodeUserSetRTCCDNUris(t,n),r=new sr(hr[hr.userSetData],i,e),[4,this._channel.send(r)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,s.sent().code]}}))}))},t.prototype.getRTCData=function(e,t,n,i){if(!this._channel)return Promise.resolve({code:Ee.RC_NET_CHANNEL_INVALID});var r=this._channel.codec.encodeGetRTCData(t,n,i),s=new sr(hr[hr.rtcQryData],r,e);return this._channel.send(s,on)},t.prototype.removeRTCData=function(e,t,n,i,r){return w(this,void 0,void 0,(function(){var s,o;return b(this,(function(a){switch(a.label){case 0:return this._channel?(s=this._channel.codec.encodeRemoveRTCData(t,n,i,r),o=new nr(hr[hr.rtcDelData],s,e),[4,this._channel.send(o)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,a.sent().code]}}))}))},t.prototype.setRTCOutData=function(e,t,n,i){throw new Error(\"JSEngine's method not implemented.\")},t.prototype.getRTCOutData=function(e,t){throw new Error(\"JSEngine's method not implemented.\")},t.prototype.getRTCToken=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r;return b(this,(function(s){return this._channel?(i=this._channel.codec.encodeJoinRTCRoom(t,n),r=new sr(hr[hr.rtcToken],i,e),[2,this._channel.send(r,sn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}]}))}))},t.prototype.setRTCState=function(e,t){return w(this,void 0,void 0,(function(){var n,i;return b(this,(function(r){switch(r.label){case 0:return this._channel?(n=this._channel.codec.encodeSetRTCState(t),i=new sr(hr[hr.rtcUserState],n,e),[4,this._channel.send(i)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return[2,r.sent().code]}}))}))},t.prototype.getRTCUserInfo=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(e){throw new Error(\"Method not implemented.\")}))}))},t.prototype.getRTCUserList=function(e){if(!this._channel)return Promise.resolve({code:Ee.RC_NET_CHANNEL_INVALID});var t=this._channel.codec.encodeGetRTCRoomInfo(),n=new sr(hr[hr.rtcUList],t,e);return this._channel.send(n,Zt)},t.prototype.joinLivingRoomAsAudience=function(e,t,n){return void 0===t&&(t=De.LIVE),w(this,void 0,void 0,(function(){var i,r,s,o,a,u,c,h;return b(this,(function(l){switch(l.label){case 0:return this._channel?(i=this._channel.codec.encodeJoinRTCRoom(t,n),r=new sr(hr[hr.viewerJoinR],i,e),[4,this._channel.send(r,Xn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return s=l.sent(),o=s.code,a=s.data,o!==Ee.SUCCESS?[2,{code:o}]:(c=(u=a).rtcToken,h=u.entries,[2,{code:o,data:{token:c,kvEntries:h}}])}}))}))},t.prototype.quitLivingRoomAsAudience=function(e){return w(this,void 0,void 0,(function(){var t,n,i;return b(this,(function(r){switch(r.label){case 0:return this._channel?(t=this._channel.codec.encodeQuitRTCRoom(),n=new sr(hr[hr.viewerExitR],t,e),[4,this._channel.send(n)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return i=r.sent().code,this._rtcKVManager.reset(),[2,i]}}))}))},t.prototype.rtcIdentityChange=function(e,t,n){return w(this,void 0,void 0,(function(){var i,r,s,o,a;return b(this,(function(u){switch(u.label){case 0:return this._channel?(i=this._channel.codec.encodeIdentityChangeInfo(t,n),r=new sr(hr[hr.rtcIdentityChange],i,e),[4,this._channel.send(r,Zt)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return s=u.sent(),o=s.code,a=s.data,o!==Ee.SUCCESS?[2,{code:o}]:[2,{code:o,data:a}]}}))}))},t.prototype.pullRTCRoomEntry=function(e,t){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a,u,c;return b(this,(function(h){switch(h.label){case 0:return n=(t=this)._channel,i=t.currentUserId,n?(pe.info(\"audience in room start pull KV\"),r=n.codec.encodePullRTCRoomKV(e,0),s=new sr(hr[hr.rtcPullKv],r,i),[4,n.send(s,Jn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return o=h.sent(),a=o.code,u=o.data,pe.info(\"audience in room end pull KV, code: \"+a+\", data: \"+JSON.stringify(u||{})),a===Ee.SUCCESS?(c=u.kvEntries,this._watcher.onRTCDataChange(c,e),[2,{code:a,data:u}]):[2,{code:a}]}}))}))},t.prototype.getRTCJoinedUserInfo=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a,u;return b(this,(function(c){switch(c.label){case 0:return n=(t=this)._channel,i=t.currentUserId,n?(r=n.codec.encodeQueryUserJoinedInfo(e),s=new sr(hr[hr.rtcQueryJoined],r,i),[4,n.send(s,Zn)]):[2,{code:Ee.RC_NET_CHANNEL_INVALID}];case 1:return o=c.sent(),a=o.code,u=o.data,a===Ee.SUCCESS?[2,{code:a,data:u}]:[2,{code:a}]}}))}))},t.prototype.getDeviceId=function(){return Hr(this.runtime)},t.prototype.requestRoomPK=function(e){return w(this,void 0,void 0,(function(){var t,n,i;return b(this,(function(r){switch(r.label){case 0:return this._channel?(t=this._channel.codec.encodeRequestRoomPK(e),n=new sr(hr[hr.rtcInvite],t,e.roomId),[4,this._channel.send(n)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return i=r.sent().code,this._rtcKVManager.reset(),[2,i]}}))}))},t.prototype.cancelRoomPK=function(e){return w(this,void 0,void 0,(function(){var t,n,i;return b(this,(function(r){switch(r.label){case 0:return this._channel?(t=this._channel.codec.encodeCancelRoomPK(e),n=new sr(hr[hr.rtcCancelInvite],t,e.roomId),[4,this._channel.send(n)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return i=r.sent().code,this._rtcKVManager.reset(),[2,i]}}))}))},t.prototype.responseRoomPK=function(e){return w(this,void 0,void 0,(function(){var t,n,i;return b(this,(function(r){switch(r.label){case 0:return this._channel?(t=this._channel.codec.encodeResponseRoomPK(e),n=new sr(hr[hr.rtcInviteAnswer],t,e.roomId),[4,this._channel.send(n)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return i=r.sent().code,this._rtcKVManager.reset(),[2,i]}}))}))},t.prototype.endRoomPK=function(e){return w(this,void 0,void 0,(function(){var t,n,i;return b(this,(function(r){switch(r.label){case 0:return this._channel?(t=this._channel.codec.encodeEndRoomPK(e),n=new sr(hr[hr.rtcEndInvite],t,e.roomId),[4,this._channel.send(n)]):[2,Ee.RC_NET_CHANNEL_INVALID];case 1:return i=r.sent().code,this._rtcKVManager.reset(),[2,i]}}))}))},t.prototype.callExtra=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return Promise.resolve({code:Ee.EXTRA_METHOD_UNDEFINED})},t.prototype.getConversationListWithAllChannel=function(){throw new Error(\"Method not implemented.\")},t.prototype.getConversationListWithAllChannelByPage=function(e,t){throw new Error(\"Method not implemented.\")},t.prototype.clearConversations=function(){throw new Error(\"Method not implemented.\")},t.prototype.setUserStatusListener=function(e,t){throw new Error(\"Method not implemented.\")},t.prototype.setUserStatus=function(e){throw new Error(\"Method not implemented.\")},t.prototype.subscribeUserStatus=function(e){throw new Error(\"Method not implemented.\")},t.prototype.getUserStatus=function(e){throw new Error(\"Method not implemented.\")},t.prototype.addToBlacklist=function(e){throw new Error(\"Method not implemented.\")},t.prototype.removeFromBlacklist=function(e){throw new Error(\"Method not implemented.\")},t.prototype.getBlacklist=function(){throw new Error(\"Method not implemented.\")},t.prototype.getBlacklistStatus=function(e){throw new Error(\"Method not implemented.\")},t.prototype.insertMessage=function(e,t,n){throw new Error(\"Method not implemented.\")},t.prototype.deleteMessages=function(e){throw new Error(\"Method not implemented.\")},t.prototype.deleteMessagesByTimestamp=function(e,t,n,i,r){throw new Error(\"Method not implemented.\")},t.prototype.clearMessages=function(e,t,n){throw new Error(\"Method not implemented.\")},t.prototype.getMessage=function(e){throw new Error(\"Method not implemented.\")},t.prototype.setMessageContent=function(e,t,n){throw new Error(\"Method not implemented.\")},t.prototype.setMessageSearchField=function(e,t,n){throw new Error(\"Method not implemented.\")},t.prototype.searchConversationByContent=function(e,t,n,i){throw new Error(\"Method not implemented.\")},t.prototype.searchMessageByContent=function(e,t,n,i,r,s){throw new Error(\"Method not implemented.\")},t.prototype.getUnreadMentionedMessages=function(e,t){throw new Error(\"Method not implemented.\")},t.prototype.setMessageSentStatus=function(e,t){throw new Error(\"Method not implemented.\")},t.prototype.setMessageReceivedStatus=function(e,t){throw new Error(\"Method not implemented.\")},t.prototype.clearUnreadCountByTimestamp=function(e,t,n,i){throw new Error(\"Method not implemented.\")},t.prototype.getConversationNotificationStatus=function(e,t,n){var i=this._conversationManager.get(e,t,n);return i?Promise.resolve({code:Ee.SUCCESS,data:i.notificationStatus}):Promise.resolve({code:Ee.CONVER_GET_ERROR})},t.prototype.getRemoteHistoryMessages=function(e,t,n,i,r,s){return this.getHistoryMessage(e,t,n,i,r,s)},t}(vr),Wr=function(){function e(e){this._context=e}return e.prototype.__getContext=function(){return this._context},e.prototype.getNaviInfo=function(){return this._context.getInfoFromCache()},e.prototype.getCoreVersion=function(){return this._context.coreVersion},e.prototype.getAPIVersion=function(){return this._context.apiVersion},e.prototype.getAppkey=function(){return this._context.appkey},e.prototype.getCurrentId=function(){return this._context.getCurrentUserId()},e.prototype.getConnectionStatus=function(){return this._context.getConnectionStatus()},e.prototype.getDeviceId=function(){return this._context.getDeviceId()},e.prototype.sendMessage=function(e,t,n){return this._context.sendMessage(e,t,n)},e.prototype.registerMessageType=function(e,t,n,i){void 0===i&&(i=[]),this._context.registerMessageType(e,t,n,i)},e.prototype.getServerTime=function(){return this._context.getServerTime()},e.prototype.getRTCJoinedUserInfo=function(e){return this._context.getRTCJoinedUserInfo(e)},e}(),Jr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return N(t,e),t.prototype.getNaviInfo=function(){return this._context.getInfoFromCache()},t.prototype.joinRTCRoom=function(e,t,n,i,r,s){return this._context.joinRTCRoom(e,t,n,i,r,s)},t.prototype.quitRTCRoom=function(e){return this._context.quitRTCRoom(e)},t.prototype.rtcPing=function(e,t,n){return this._context.rtcPing(e,t,n)},t.prototype.getRTCRoomInfo=function(e){return this._context.getRTCRoomInfo(e)},t.prototype.getRTCUserInfoList=function(e){return this._context.getRTCUserInfoList(e)},t.prototype.getRTCUserInfo=function(e){return this._context.getRTCUserInfo(e)},t.prototype.setRTCUserInfo=function(e,t,n){return this._context.setRTCUserInfo(e,t,n)},t.prototype.removeRTCUserInfo=function(e,t){return this._context.removeRTCUserInfo(e,t)},t.prototype.setRTCData=function(e,t,n,i,r,s){return this._context.setRTCData(e,t,n,i,r,s)},t.prototype.setRTCTotalRes=function(e,t,n,i,r){return this._context.setRTCTotalRes(e,t,n,i,r)},t.prototype.setRTCCDNUris=function(e,t,n){return this._context.setRTCCDNUris(e,t,n)},t.prototype.getRTCData=function(e,t,n,i){return this._context.getRTCData(e,t,n,i)},t.prototype.removeRTCData=function(e,t,n,i,r){return this._context.removeRTCData(e,t,n,i,r)},t.prototype.setRTCOutData=function(e,t,n,i){return this._context.setRTCOutData(e,t,n,i)},t.prototype.getRTCOutData=function(e,t){return this._context.getRTCOutData(e,t)},t.prototype.getRTCToken=function(e,t,n){return this._context.getRTCToken(e,t,n)},t.prototype.setRTCState=function(e,t){return this._context.setRTCState(e,t)},t.prototype.getRTCUserList=function(e){return this._context.getRTCUserList(e)},t.prototype.joinLivingRoomAsAudience=function(e,t,n){return this._context.joinLivingRoomAsAudience(e,t,n)},t.prototype.quitLivingRoomAsAudience=function(e){return this._context.quitLivingRoomAsAudience(e)},t.prototype.rtcIdentityChange=function(e,t,n){return this._context.rtcIdentityChange(e,t,n)},t.prototype.requestRoomPK=function(e){return this._context.requestRoomPK(e)},t.prototype.cancelRoomPK=function(e){return this._context.cancelRoomPK(e)},t.prototype.responseRoomPK=function(e){return this._context.responseRoomPK(e)},t.prototype.endRoomPK=function(e){return this._context.endRoomPK(e)},t}(Wr),zr=function(){function e(){}return e.compress=function(e){for(var t=this,n={},i=0;i<e.length-1;i++){var r=e.charAt(i)+e.charAt(i+1);n.hasOwnProperty(r)?n[r].push(i):n[r]=[i]}for(var s=[],o=[],a=function(){if(o.length>0){var e=o.join(\"\");if(o=[],e.length>26){var n=t.numberEncode(e.length),i=String.fromCharCode(t.dataType.NormalExt|n.length);s.push(i+n)}else{var r=String.fromCharCode(t.dataType.Normal|e.length);s.push(r)}s.push(e)}},u=0;u<e.length;){var c=t.indexOf(n,e,u);if(c.length<2)o.push(e.charAt(u++));else if(c.length<4)o.push(e.substr(u,c.length)),u+=c.length;else{var h=t.numberEncode(u-c.offset),l=t.numberEncode(c.length);if(h.length+l.length>=c.length)o.push(e.substr(u,c.length)),u+=c.length;else{a();var d=String.fromCharCode(t.dataType.Compressed|h.length<<2|l.length);s.push(d+h+l),u+=c.length}}}a();var f=t.numberEncode(e.length),p=String.fromCharCode(t.dataType.Tail|f.length);return s.push(p+f),s.join(\"\")},e.uncompress=function(e){var t=this,n=0,i=\"\";e:do{var r=e.charCodeAt(n++),s=r&t.dataType.Mark,o=15&r,a=void 0;switch(s){case t.dataType.Compressed:var u=o>>2,c=3&o;if(0===u||0===c)throw new Error(\"Data parsing error,at \"+n);var h=t.numberDecode(e.substr(n,u)),l=t.numberDecode(e.substr(n+=u,c));if((h=i.length-h)+l>i.length)throw new Error(\"Data parsing error,at \"+n);n+=c,i+=i.substr(h,l);break;case t.dataType.Tail:if((a=t.numberDecode(e.substr(n,o)))!==i.length)throw console.log(i.length),console.log(a),new Error(\"Data parsing error,at \"+n);n+=o;break e;case t.dataType.NormalExt:a=t.numberDecode(e.substr(n,o)),i+=e.substr(n+=o,a),n+=a;break;case t.dataType.Normal:i+=e.substr(n,o),n+=o;break;case t.dataType.Mark:if(o>10)throw new Error(\"Data parsing error,at \"+n);i+=e.substr(n,16+o),n+=16+o;break;default:throw new Error(\"Data parsing error,at \"+n+\" header:\"+s)}}while(n<e.length);return i},e.indexOf=function(e,t,n){var i={length:0,offset:-1};if(t.length,n>=t.length-1)return i;var r=e[t.charAt(n)+t.charAt(n+1)];if(r[0]===n)return i;for(var s=t.length-n,o=0,a=r.length;o<a;o++){var u=r[o],c=n-u;if(!(c>this.max)){var h=Math.min(s,c);if(h<=i.length)break;if(!(i.length>2&&t.charAt(u+i.length-1)!==t.charAt(n+i.length-1))){for(var l=2,d=l;d<h&&t.charAt(u+d)===t.charAt(n+d);d++)l++;l>=i.length&&(i.length=l,i.offset=u)}}}return i},e.numberEncode=function(e){var t=this,n=[],i=0;do{i=e%t.scale,n.push(t.chars.charAt(i)),e=(e-i)/t.scale}while(e>0);return n.join(\"\")},e.numberDecode=function(e){for(var t=0,n=0,i=e.length-1;i>=0;i--){if(-1===(n=this.chars.indexOf(e.charAt(i))))throw new Error('decode number error, data is \"'+e+'\"');t=t*this.scale+n}return t},e.dataType={Tail:48,Compressed:64,NormalExt:80,Normal:96,Mark:112},e.chars=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\",e.scale=e.chars.length,e.max=238327,e}(),Zr=1,Xr=!1,$r=\"undefined\"!=typeof location&&\"https://\"===location.protocol?\"https://\":\"http://\",es=function(){function e(e){this.info=e,this.logUrl=\"logcollection.ronghub.com\",this.level=1,this.itv=30,this.times=5,this.deviceId=\"\",this.deviceInfo=\"\",this.logSwitch=0,this.logUrl=e.logPolicy.url||this.logUrl,this.level=e.logPolicy.level||this.level,this.itv=e.logPolicy.itv||this.itv,this.times=e.logPolicy.times||this.times,this.deviceId=Hr(e.runtime),this.logSwitch=e.logSwitch;var t=_t(e.runtime);this.deviceInfo=t.type+\"|\"+t.version+\"|\"+fe.sessionId,this.startReport()}return e.init=function(t){return Xr=!0,e._instance||(e._instance=new e(t)),e._instance},e.getInstance=function(){return e._instance},e.prototype.startReport=function(){var e=this;if(this.logSwitch&&Xr){var t=this.itv*Math.pow(2,Zr-1);Zr<this.times&&Zr++,setTimeout((function(){e.reportRealtimeLog()}),1e3*t)}},e.prototype.reportRealtimeLog=function(){var e=this,t=fe.realTimeLogList.filter((function(t){return t.level<=e.level}));if(0!==t.length){var n=zr.compress(t.map((function(e){return e.content})).join(\"\")),i=\"\"+$r+this.logUrl+\"?version=\"+this.info.version+\"&appkey=\"+this.info.appkey+\"&userId=\"+this.info.userId+\"&deviceId=\"+this.deviceId+\"&deviceInfo=\"+this.deviceInfo+\"&platform=Web\";this.info.runtime.httpReq({method:\"POST\",url:i,body:n}).then((function(t){pe.__clearRealTimeLog(),pe.debug(\"report real-time log success\");var n=t.data;n&&(n=JSON.parse(n),e.itv=n.nextTime,e.level=n.level,e.logSwitch=n.logSwitch,Zr=1),e.startReport()})).catch((function(t){pe.debug(\"report real-time log error -> \"+t),e.startReport()}))}else this.startReport()},e.prototype.reportFullLog=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a,u,c,h,l=this;return b(this,(function(d){switch(d.label){case 0:return t=e.startTime,n=e.endTime,i=e.platform,r=e.logId,s=e.uri,o=q.getInstance(),pe.debug(\"received report log msg, \"+i.toLowerCase(),o),\"web\"===i.toLowerCase()&&o?t>n?(pe.warn(\"report error: The start time(\"+t+\") cannot be greater than the end time(\"+t+\")\"),[2]):[4,pe.__insertLogIntoDatabase()]:[2];case 1:return d.sent(),[4,o.getRangeData(B,\"time\",t,n)];case 2:return a=(a=d.sent()).filter((function(e){return!e.userId||e.userId===l.info.userId})),u=zr.compress(a.map((function(e){return e.content})).join(\"\")||\"no data\"),5e3,c=1,(h=function(){if(!(c>3)&&Xr){var e=s||l.logUrl,t=\"\"+$r+e+\"?version=\"+l.info.version+\"&appkey=\"+l.info.appkey+\"&userId=\"+l.info.userId+\"&logId=\"+r+\"&deviceId=\"+l.deviceId+\"&deviceInfo=\"+l.deviceInfo+\"&platform=Web\",n=5e3*(c-1);c++,setTimeout((function(){Xr&&l.info.runtime.httpReq({url:t,method:\"POST\",body:u}).then((function(){pe.debug(\"report full log success!\")})).catch((function(e){h(),pe.warn(\"report full log error -> \"+e)}))}),n)}})(),[2]}}))}))},e.prototype.distroy=function(){Zr=1,Xr=!1},e}();function ts(e){return Object.assign({},e)}var ns,is=function(){function e(e,t){var n;this._runtime=e,this._token=\"\",this._pluginContextQueue=[],this._pluginInstanseMap={},this.coreVersion=\"5.1.2\",this._versionInfo={},this._typingInfo={},this._isInternalConnected=!1,this._connectionStatus=Ie.DISCONNECTED,this._canRedirectConnect=!1,this._watcher={message:void 0,batchMessage:void 0,conversationState:void 0,chatroomState:void 0,connectionState:void 0,rtcInnerWatcher:void 0,expansion:void 0,tag:void 0,conversationTagChanged:void 0,pullFinished:void 0,onConnecting:void 0,onConnected:void 0,onDisconnect:void 0,onSuspend:void 0,readReceiptReceived:void 0,messageReceiptRequest:void 0,messageReceiptResponse:void 0,typingState:void 0,messageBlocked:void 0},this._typingInternalTimer=-1,this._typingExpireTime=2e3,this._typingChangedList=[],this.getChatRoomHistoryMessages=this.getChatroomHistoryMessages,this._options=Object.assign({},t),this.appkey=this._options.appkey,this.apiVersion=this._options.apiVersion,this._options.typingExpireTime&&(this._options.typingExpireTime<2e3?this._typingExpireTime=2e3:this._options.typingExpireTime>6e3?this._typingExpireTime=6e3:this._typingExpireTime=this._options.typingExpireTime),this._options.navigators=this._options.navigators.filter((function(e){return/^https?:\\/\\//.test(e)})),this._options.navigators=this._options.navigators.map((function(e){return e.replace(/\\/$/g,\"\")})),0===this._options.navigators.length&&(n=this._options.navigators).push.apply(n,u);var i={status:this._connectionStatusListener.bind(this),batchMessage:this._batchMessageReceiver.bind(this),chatroom:this._chatroomInfoListener.bind(this),conversation:this._conversationInfoListener.bind(this),expansion:this._expansionInfoListener.bind(this),tag:this._tagListener.bind(this),conversationTag:this._conversationTagListener.bind(this),onRTCDataChange:this._rtcDataChange.bind(this),pullFinished:this._pullFinishedListener.bind(this)};this._engine=gt()?new RCCppEngine(e,i,this._options):new Qr(e,i,this._options)}return e.init=function(t,n){return pe.setLogLevel(n.logLevel),pe.setLogStdout(n.logStdout),(n.indexDBSwitch||re(n.indexDBSwitch))&&q.init(),pe.debug(\"APIContext.init =>\",n.appkey,n.navigators),this._context?(pe.error(\"Repeat initialize!\"),this._context):(pe.warn(\"RCEngine Commit:\",\"efd1b7f44d2517ab9a2fab003c298184d1f06fca\"),this._context=new e(t,n),pe.__insertLogIntoDatabase(),this._context)},e.destroy=function(){this._context&&(this._context._destroy(),this._context=void 0)},e.prototype.install=function(e,t){if(this._pluginInstanseMap[e.tag])return pe.warn(\"Repeat install plugin: \"+e.tag),this._pluginInstanseMap[e.tag];var n=\"RCRTC\"===e.tag?new Jr(this):new Wr(this),i=null;try{if(!e.verify(this._runtime))return null;i=e.setup(n,this._runtime,t)}catch(e){pe.error(\"install plugin error!\\n\",e)}return[\"RCRTC\",\"RCCall\"].includes(e.tag)&&e.version&&e.name&&(this._versionInfo[e.name]=e.version),i&&this._pluginContextQueue.push(n),i&&(this._pluginInstanseMap[e.tag]=i),i},e.prototype._handleRedirect=function(){return w(this,void 0,void 0,(function(){var e,t=this;return b(this,(function(n){switch(n.label){case 0:return pe.debug(\"_handleRedirct\",this._token),[4,this.connect(this._token,!0)];case 1:return(e=n.sent().code)!==Ee.SUCCESS&&this._canRedirectConnect&&(this._handleSuspend(e),setTimeout((function(){t._handleRedirect()}),5e3)),[2]}}))}))},e.prototype._connectionStatusListener=function(e){var t;return w(this,void 0,void 0,(function(){return b(this,(function(n){return e===Ie.REDIRECT?(this._canRedirectConnect=!0,this._handleSuspend(e),this._handleRedirect()):e===Ie.BLOCKED||e===Ie.KICKED_OFFLINE_BY_OTHER_CLIENT||e===Ie.DISCONNECT_BY_SERVER?(this._canRedirectConnect=!1,this._handleDisconnect(e)):e===Ie.CONNECTING?this._handleConnecting():e===Ie.CONNECTED?this._handleConnected():e===Ie.DISCONNECTED?this._handleDisconnect(e):e===Ie.NETWORK_UNAVAILABLE&&this._handleSuspend(e),this._connectionStatus=e,(null===(t=this._watcher.rtcInnerWatcher)||void 0===t?void 0:t.status)&&this._watcher.rtcInnerWatcher.status(e),this._pluginContextQueue.forEach((function(t){t.onconnectionstatechange&&t.onconnectionstatechange(e)})),this._watcher.connectionState&&this._watcher.connectionState(e),[2]}))}))},e.prototype._handleConnecting=function(){this._watcher.onConnecting&&this._watcher.onConnecting()},e.prototype._handleConnected=function(){this._watcher.onConnected&&this._watcher.onConnected()},e.prototype._handleDisconnect=function(e){this._watcher.onDisconnect&&this._watcher.onDisconnect(e)},e.prototype._handleSuspend=function(e){this._watcher.onSuspend&&this._watcher.onSuspend(e)},e.prototype._messageReceiver=function(e,t,n){var i,r,s;if((e.conversationType===j.RTC_ROOM||Object.prototype.hasOwnProperty.call(qe,e.messageType))&&this._watcher.rtcInnerWatcher&&this._watcher.rtcInnerWatcher.message)this._watcher.rtcInnerWatcher.message(ts(e));else if(-1===[\"RC:ChrmJoinNtf\",\"RC:ChrmQuitNtf\"].indexOf(e.messageType)||\"function\"!=typeof this._watcher.chatroomState){if(\"RC:ChrmMemChange\"!==e.messageType){if(e.messageType!==Re.TYPING_STATUS||(this._addTypingInfo(ts(e)),!this._watcher.typingState))if(e.messageType!==Re.LOG_COMMAND||\"rongcloudsystem\"!==e.senderUserId)if(e.messageType!==Re.INTERCEPT){if(!this._pluginContextQueue.some((function(t){if(!t.onmessage)return!1;try{return t.onmessage(ts(e))}catch(e){return pe.error(\"plugin error =>\",e),!1}})))if(this._watcher.message&&this._watcher.message(ts(e),t,n),\"RC:ReadNtf\"!==e.messageType)if(\"RC:RRReqMsg\"!==e.messageType){if(\"RC:RRRspMsg\"!==e.messageType)return e;var o=null===(s=e.content)||void 0===s?void 0:s.receiptMessageDic;o&&Array.isArray(o[this._engine.currentUserId])&&\"function\"==typeof this._watcher.messageReceiptResponse&&this._watcher.messageReceiptResponse({conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId},e.senderUserId,o[this._engine.currentUserId])}else\"function\"==typeof this._watcher.messageReceiptRequest&&this._watcher.messageReceiptRequest({conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId},e.content.messageUId,e.senderUserId);else\"function\"==typeof this._watcher.readReceiptReceived&&this._watcher.readReceiptReceived({conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId},e.content.messageUId,e.content.lastMessageSendTime)}else this._MessageBlockedListener({conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId||\"\",blockType:e.content.interceptType,blockedMessageUId:e.content.msgUId});else{var a=e.content,u=a.startTime,c=a.endTime,h=a.platform,l=a.logId,d=a.uri,f=a.packageName,p={startTime:parseInt(u),endTime:parseInt(c),platform:h,logId:l,uri:d,packageName:f};null===(r=es.getInstance())||void 0===r||r.reportFullLog(p)}}else if(\"function\"==typeof this._watcher.chatroomState){var g={};Array.isArray(e.content.userList)&&e.content.userList.forEach((function(e){g[e.userId]=e.status})),this._watcher.chatroomState({userChange:{users:g,chatroomId:e.targetId}})}}else this._watcher.chatroomState({userChange:{users:(i={},i[e.senderUserId]=\"RC:ChrmQuitNtf\"===e.messageType?Pe.QUIT:Pe.JOIN,i),chatroomId:e.targetId}})},e.prototype._batchMessageReceiver=function(e,t,n){var i=this,r=[];e.forEach((function(e){var s=i._messageReceiver(e,t,n);s&&r.push(s)})),r.length&&this._watcher.batchMessage&&this._watcher.batchMessage(r)},e.prototype._chatroomInfoListener=function(e){this._watcher.chatroomState&&this._watcher.chatroomState(e)},e.prototype._conversationInfoListener=function(e){this._watcher.conversationState&&this._watcher.conversationState(e)},e.prototype._expansionInfoListener=function(e){this._watcher.expansion&&this._watcher.expansion(e)},e.prototype._tagListener=function(){this._watcher.tag&&this._watcher.tag()},e.prototype._conversationTagListener=function(){this._watcher.conversationTagChanged&&this._watcher.conversationTagChanged()},e.prototype._typingStatusListener=function(e){this._watcher.typingState&&this._watcher.typingState(e)},e.prototype._pullFinishedListener=function(){this._watcher.pullFinished&&this._watcher.pullFinished()},e.prototype._MessageBlockedListener=function(e){this._watcher.messageBlocked&&this._watcher.messageBlocked(e)},e.prototype._rtcDataChange=function(e,t){this._pluginContextQueue.forEach((function(n){n.onrtcdatachange&&n.onrtcdatachange(e,t)}))},e.prototype.assignWatcher=function(e){var t=this;Object.keys(this._watcher).forEach((function(n){if(Object.prototype.hasOwnProperty.call(e,n)){var i=e[n];t._watcher[n]=ie(i)||ne(i)?i:void 0}}))},e.prototype.resetWatcher=function(){var e=this;Object.keys(this._watcher).forEach((function(t){e._watcher[t]=void 0}))},e.prototype._addTypingInfo=function(e){var t=e.senderUserId,n=e.conversationType,i=e.targetId,r=e.content,s=e.channelId,o=r.typingContentType,a=n+\"#\"+i+\"#\"+(s||\"\");this._typingInfo[a]||(this._typingInfo[a]=[]);var u=this._typingInfo[a].findIndex((function(e){return e.userId===t}));u>=0&&this._typingInfo[a][u].messageType===o?this._typingInfo[a][u].timestamp=Date.now():(u>=0&&this._typingInfo[a].splice(u,1),this._typingInfo[a].push({userId:t,messageType:o,timestamp:Date.now()}),this._typingChangedList.includes(a)||this._typingChangedList.push(a),this._startCheckTypingInfo())},e.prototype._startCheckTypingInfo=function(){var e=this;-1===this._typingInternalTimer&&0!==Object.keys(this._typingInfo).length&&(this._typingInternalTimer=setInterval((function(){for(var t in e._typingInfo){var n=e._typingInfo[t].length;e._typingInfo[t]=e._typingInfo[t].filter((function(t){return Date.now()-t.timestamp<e._typingExpireTime})),e._typingInfo[t].length===n||e._typingChangedList.includes(t)||e._typingChangedList.push(t),0===e._typingInfo[t].length&&delete e._typingInfo[t]}if(e._typingChangedList.length>0){var i=e._typingChangedList.map((function(t){return{conversationType:Number(t.split(\"#\")[0]),targetId:t.split(\"#\")[1],channelId:t.split(\"#\")[2],list:e._typingInfo[t]||[]}}));e._typingStatusListener(i),e._typingChangedList=[]}0===Object.keys(e._typingInfo).length&&(clearInterval(e._typingInternalTimer),e._typingInternalTimer=-1)}),500))},e.prototype.getConnectedTime=function(){return this._engine.getConnectedTime()},e.prototype.getServerTime=function(){return this._engine.getServerTime()},e.prototype.getDeviceId=function(){return this._engine.getDeviceId()},e.prototype.getCurrentUserId=function(){return this._engine.currentUserId},e.prototype.getConnectionStatus=function(){return this._connectionStatus},Object.defineProperty(e.prototype,\"token\",{get:function(){return this._token},enumerable:!1,configurable:!0}),e.prototype.connect=function(e,t,n){return void 0===t&&(t=!1),w(this,void 0,void 0,(function(){var i,r,s,o,a,u;return b(this,(function(c){switch(c.label){case 0:return this._connectionStatus===Ie.CONNECTED?[2,{code:Ee.SUCCESS,userId:this._engine.currentUserId}]:this._connectionStatus===Ie.CONNECTING?[2,{code:Ee.BIZ_ERROR_CONNECTING}]:\"string\"!=typeof e||0===e.length?[2,{code:Ee.RC_CONN_USER_OR_PASSWD_ERROR}]:(this._token=e,i=e.split(\"@\"),r=i[1],s=r?r.split(\";\").map((function(e){return/^https?:/.test(e)?e:\"https://\"+e})):[],[4,this._engine.navi.getInfo(this._getTokenWithoutNavi(),s,t,this._options.checkCA)]);case 1:return(o=c.sent())?1===(null==o?void 0:o.type)?[2,{code:Ee.PACKAGE_ENVIRONMENT_ERROR}]:(a=je.getInfo(),[4,this._engine.connect(this._getTokenWithoutNavi(),o,n)]):[2,{code:Ee.RC_NAVI_RESOURCE_ERROR}];case 2:return u=c.sent(),pe.__insertLogIntoDatabase(),u!==Te.REDIRECT?[3,4]:(this._connectionStatus=Ie.REDIRECT,[4,this.connect(e,!0)]);case 3:return[2,c.sent()];case 4:return u===Ee.SUCCESS&&(pe.info(\"connect success, userId: \"+this._engine.currentUserId),1!==(null==o?void 0:o.type)&&this._engine.reportSDKInfo&&this._engine.reportSDKInfo(a),es.init({runtime:this._runtime,logSwitch:(null==o?void 0:o.logSwitch)||0,logPolicy:JSON.parse((null==o?void 0:o.logPolicy)||\"{}\"),appkey:this.appkey,version:this.apiVersion,userId:this._engine.currentUserId}),fe.init(this._engine.currentUserId),this._isInternalConnected=!0),u!==Ee.SUCCESS||gt()||1===o.openUS&&this._pullUserSettings(),u!==Ee.SUCCESS&&(this._connectionStatus=Ie.CONNECTION_CLOSED),[2,{code:u,userId:this._engine.currentUserId}]}}))}))},e.prototype._pullUserSettings=function(){return w(this,void 0,void 0,(function(){return b(this,(function(e){return[2]}))}))},e.prototype.disconnect=function(){var e;return this._isInternalConnected=!1,clearInterval(this._typingInternalTimer),this._typingInternalTimer=-1,this._typingInfo={},null===(e=es.getInstance())||void 0===e||e.distroy(),pe.__insertLogIntoDatabase(),fe.reset(),this._engine.disconnect(),this._pluginContextQueue.forEach((function(e){if(e.ondisconnect)try{e.ondisconnect()}catch(e){pe.error(\"plugin error =>\",e)}})),Promise.resolve()},e.prototype.reconnect=function(e){return this._isInternalConnected?Promise.resolve({code:Ee.CAN_NOT_RECONNECT}):this.connect(this._getTokenWithoutNavi(),!1,e)},e.prototype._getTokenWithoutNavi=function(){return this._token.replace(/@.+$/,\"@\")},e.prototype.getInfoFromCache=function(){return this._engine.navi.getInfoFromCache(this._getTokenWithoutNavi())},e.prototype.registerMessageType=function(e,t,n,i,r){void 0===i&&(i=[]),void 0===r&&(r=!1),this._engine.registerMessageType(e,t,n,i,r)},e.prototype.sendMessage=function(e,t,n,i){var r=this.getInfoFromCache();if(1===((null==r?void 0:r.grpRRVer)||0)&&n.messageType===Re.READ_RECEIPT_RESPONSE)return Promise.resolve({code:Ee.READ_RECEIPT_ERROR});var s=JSON.stringify(n.content);return V(s)>131072?Promise.resolve({code:Ee.RC_MSG_CONTENT_EXCEED_LIMIT}):this._engine.sendMessage(e,t,n,i)},e.prototype.sendExpansionMessage=function(e){return w(this,void 0,void 0,(function(){var t,n,i,r,s,o,a,u,c,h,l,d,f,p;return b(this,(function(g){switch(g.label){case 0:if(t=e.channelId,n=e.conversationType,i=e.targetId,r=e.messageUId,s=e.keys,o=e.expansion,a=e.removeAll,!e.canIncludeExpansion)return[2,{code:Ee.MESSAGE_KV_NOT_SUPPORT}];if(u=!1,c=!1,h=!1,ne(o))for(d in l=Object.keys(o).length,u=l>20,o)if(f=o[d],c=J(d)&&!/^[A-Za-z0-9_=+-]+$/.test(d),(h=d.length>32||f.length>4096)||c)break;return u||h?[2,{code:Ee.EXPANSION_LIMIT_EXCEET}]:c?[2,{code:Ee.BIZ_ERROR_INVALID_PARAMETER}]:(p={mid:r},o&&(p.put=o),s&&(p.del=s),a&&(p.removeAll=1),[4,this._engine.sendMessage(n,i,{content:p,messageType:Re.EXPANSION_NOTIFY,channelId:t})]);case 1:return[2,{code:g.sent().code}]}}))}))},e.prototype.sendReadReceiptMessage=function(e,t,n){return w(this,void 0,void 0,(function(){var i;return b(this,(function(r){return i=this.getInfoFromCache(),0===((null==i?void 0:i.grpRRVer)||0)?[2,{code:Ee.READ_RECEIPT_ERROR,data:\"The read receipt switch is not on, please call the sendMessage method!\"}]:[2,this._engine.sendReadReceiptMessage(e,t,n)]}))}))},e.prototype.getMessageReader=function(e,t,n){return w(this,void 0,void 0,(function(){var i;return b(this,(function(r){return i=this.getInfoFromCache(),0===((null==i?void 0:i.grpRRVer)||0)?[2,{code:Ee.READ_RECEIPT_ERROR}]:[2,this._engine.getMessageReader(e,t,n)]}))}))},e.prototype._destroy=function(){var e;this._isInternalConnected=!1,this._watcher={batchMessage:void 0,message:void 0,conversationState:void 0,chatroomState:void 0,connectionState:void 0,rtcInnerWatcher:void 0,expansion:void 0,tag:void 0,conversationTagChanged:void 0,typingState:void 0,pullFinished:void 0,onConnecting:void 0,onConnected:void 0,onDisconnect:void 0,onSuspend:void 0},this._engine.disconnect(),this._pluginContextQueue.forEach((function(e){if(e.ondestroy)try{e.ondestroy()}catch(e){pe.error(\"plugin error =>\",e)}})),this._pluginContextQueue.length=0,this._pluginInstanseMap={},null===(e=es.getInstance())||void 0===e||e.distroy(),fe.reset()},e.prototype.getHistoryMessage=function(e,t,n,i,r,s,o){return void 0===n&&(n=0),void 0===i&&(i=20),void 0===r&&(r=0),void 0===s&&(s=\"\"),void 0===o&&(o=\"\"),this._engine.getHistoryMessage(e,t,n,i,r,s,o||\"\")},e.prototype.getConversationList=function(e,t,n,i,r){return void 0===e&&(e=300),void 0===r&&(r=\"\"),this._engine.getConversationList(e,t,n,i,r)},e.prototype.getConversation=function(e,t,n){return this._engine.getConversation(e,t,n)},e.prototype.removeConversation=function(e,t,n){return void 0===n&&(n=\"\"),this._engine.removeConversation(e,t,n)},e.prototype.clearUnreadCount=function(e,t,n){return void 0===n&&(n=\"\"),this._engine.clearConversationUnreadCount(e,t,n)},e.prototype.clearAllUnreadCount=function(){return this._engine.clearAllUnreadCount()},e.prototype.getUnreadCount=function(e,t,n){return void 0===n&&(n=\"\"),this._engine.getConversationUnreadCount(e,t,n)},e.prototype.getTotalUnreadCount=function(e,t,n){return this._engine.getAllConversationUnreadCount(e,t&&t.length>0?t:[j.PRIVATE,j.GROUP,j.SYSTEM,j.PUBLIC_SERVICE],!!n)},e.prototype.getFirstUnreadMessage=function(e,t,n){return void 0===n&&(n=\"\"),this._engine.getFirstUnreadMessage(e,t,n)},e.prototype.setConversationStatus=function(e,t,n,i,r){void 0===r&&(r=\"\");var s=[{conversationType:e,targetId:t,isTop:n,notificationStatus:i,channelId:r}];return this._engine.batchSetConversationStatus(s)},e.prototype.saveConversationMessageDraft=function(e,t,n,i){return void 0===i&&(i=\"\"),this._engine.saveConversationMessageDraft(e,t,n,i)},e.prototype.getConversationMessageDraft=function(e,t,n){return void 0===n&&(n=\"\"),this._engine.getConversationMessageDraft(e,t,n)},e.prototype.clearConversationMessageDraft=function(e,t,n){return void 0===n&&(n=\"\"),this._engine.clearConversationMessageDraft(e,t,n)},e.prototype.recallMessage=function(e,t,n,i,r){return this._engine.recallMsg(e,t,n,i,r)},e.prototype.deleteRemoteMessage=function(e,t,n,i){return void 0===i&&(i=\"\"),this._engine.deleteRemoteMessage(e,t,n,i)},e.prototype.deleteRemoteMessageByTimestamp=function(e,t,n,i){return void 0===i&&(i=\"\"),this._engine.deleteRemoteMessageByTimestamp(e,t,n,i)},e.prototype.joinChatroom=function(e,t){return void 0===t&&(t=10),this._engine.joinChatroom(e,t)},e.prototype.joinExistChatroom=function(e,t){return void 0===t&&(t=10),this._engine.joinExistChatroom(e,t)},e.prototype.quitChatroom=function(e){return this._engine.quitChatroom(e)},e.prototype.getChatroomInfo=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this._engine.getChatroomInfo(e,t,n)},e.prototype.setChatroomEntry=function(e,t){var n=t.key,i=t.value;return at(n)&&ut(i)?this._engine.setChatroomEntry(e,t):Promise.resolve(Ee.BIZ_ERROR_INVALID_PARAMETER)},e.prototype.setChatroomEntries=function(e,t){for(var n=0;n<t.entries.length;n++){var i=t.entries[n],r=i.key,s=i.value;if(!at(r)||!ut(s))return Promise.resolve({code:Ee.BIZ_ERROR_INVALID_PARAMETER})}return this._engine.setChatroomEntries(e,t)},e.prototype.forceSetChatroomEntry=function(e,t){var n=t.key,i=t.value;return at(n)&&ut(i)?this._engine.forceSetChatroomEntry(e,t):Promise.resolve(Ee.BIZ_ERROR_INVALID_PARAMETER)},e.prototype.removeChatroomEntry=function(e,t){var n=t.key;return at(n)?this._engine.removeChatroomEntry(e,t):Promise.resolve(Ee.BIZ_ERROR_INVALID_PARAMETER)},e.prototype.removeChatroomEntries=function(e,t){for(var n=0;n<t.entries.length;n++){var i=t.entries[n].key;if(!at(i))return Promise.resolve({code:Ee.BIZ_ERROR_INVALID_PARAMETER})}return this._engine.removeChatroomEntries(e,t)},e.prototype.forceRemoveChatroomEntry=function(e,t){var n=t.key;return at(n)?this._engine.forceRemoveChatroomEntry(e,t):Promise.resolve(Ee.BIZ_ERROR_INVALID_PARAMETER)},e.prototype.getChatroomEntry=function(e,t){return this._engine.getChatroomEntry(e,t)},e.prototype.getAllChatroomEntries=function(e){return this._engine.getAllChatroomEntry(e)},e.prototype.getChatroomHistoryMessages=function(e,t,n,i){return void 0===t&&(t=20),void 0===n&&(n=0),void 0===i&&(i=0),this._engine.getChatroomHistoryMessages(e,i,t,n)},e.prototype.getFileToken=function(e,t,n,i){return w(this,void 0,void 0,(function(){var r,s,o,a,u,c,h;return b(this,(function(l){switch(l.label){case 0:return r=this.getInfoFromCache(),s=(null==r?void 0:r.bosAddr)||\"\",o=(null==r?void 0:r.uploadServer)||\"\",a=(null==r?void 0:r.ossConfig)||\"\",[4,this._engine.getFileToken(e,t,n,i)];case 1:return u=l.sent(),c=u.code,h=u.data,c===Ee.SUCCESS?[2,Promise.resolve(Object.assign(h,{bos:s,qiniu:o,ossConfig:a}))]:[2,Promise.reject(c)]}}))}))},e.prototype.getFileUrl=function(e,t,n,i,r){return void 0===r&&(r=Me.QINIU),w(this,void 0,void 0,(function(){var s,o,a;return b(this,(function(u){switch(u.label){case 0:return(null==i?void 0:i.isBosRes)?[2,Promise.resolve(i)]:[4,this._engine.getFileUrl(e,r,t,n)];case 1:return s=u.sent(),o=s.code,a=s.data,o===Ee.SUCCESS?[2,Promise.resolve(a)]:[2,Promise.reject(o)]}}))}))},e.prototype.createTag=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.createTag(e)]}))}))},e.prototype.removeTag=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.removeTag(e)]}))}))},e.prototype.updateTag=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.updateTag(e)]}))}))},e.prototype.getTagList=function(){return w(this,void 0,void 0,(function(){return b(this,(function(e){return[2,this._engine.getTagList()]}))}))},e.prototype.addTagForConversations=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return t.length>1e3?[2,Promise.reject(Ee.CONVER_OUT_LIMIT_ERROR)]:[2,this._engine.addTagForConversations(e,t)]}))}))},e.prototype.removeTagForConversations=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return[2,this._engine.removeTagForConversations(e,t)]}))}))},e.prototype.removeTagsForConversation=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return[2,this._engine.removeTagsForConversation(e,t)]}))}))},e.prototype.getConversationListByTag=function(e,t,n,i){return w(this,void 0,void 0,(function(){return b(this,(function(r){return[2,this._engine.getConversationListByTag(e,t,n,i)]}))}))},e.prototype.getUnreadCountByTag=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return[2,this._engine.getUnreadCountByTag(e,t)]}))}))},e.prototype.setConversationStatusInTag=function(e,t,n){return w(this,void 0,void 0,(function(){return b(this,(function(i){return[2,this._engine.setConversationStatusInTag(e,t,n)]}))}))},e.prototype.getTagsForConversation=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.getTagsForConversation(e)]}))}))},e.prototype.getBlockConversationList=function(){return this._engine.getBlockConversationList()},e.prototype.getTopConversationList=function(){return this._engine.getTopConversationList()},e.prototype.getUnreadMentionedCount=function(e){return this._engine.getUnreadMentionedCount(e)},e.prototype.getAllUnreadMentionedCount=function(){return this._engine.getAllUnreadMentionedCount()},e.prototype.getAllConversationState=function(){return this._engine.getAllConversationState()},e.prototype.callExtra=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this._engine).callExtra.apply(t,M([e],n))},e.prototype.clearConversations=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){switch(n.label){case 0:return[4,this._engine.clearConversations(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.setUserStatusListener=function(e,t){return this._engine.setUserStatusListener(e,(function(e){try{t(e)}catch(e){pe.error(e)}}))},e.prototype.addToBlacklist=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.addToBlacklist(e)]}))}))},e.prototype.removeFromBlacklist=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.removeFromBlacklist(e)]}))}))},e.prototype.getBlacklist=function(){return w(this,void 0,void 0,(function(){return b(this,(function(e){return[2,this._engine.getBlacklist()]}))}))},e.prototype.getBlacklistStatus=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.getBlacklistStatus(e)]}))}))},e.prototype.insertMessage=function(e,t,n){return w(this,void 0,void 0,(function(){return b(this,(function(i){return[2,this._engine.insertMessage(e,t,n)]}))}))},e.prototype.deleteMessages=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.deleteMessages(e)]}))}))},e.prototype.deleteMessagesByTimestamp=function(e,t,n,i,r){return void 0===r&&(r=\"\"),w(this,void 0,void 0,(function(){return b(this,(function(s){return[2,this._engine.deleteMessagesByTimestamp(e,t,n,i,r)]}))}))},e.prototype.clearMessages=function(e,t,n){return void 0===n&&(n=\"\"),w(this,void 0,void 0,(function(){return b(this,(function(i){return[2,this._engine.clearMessages(e,t,n)]}))}))},e.prototype.getMessage=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.getMessage(e)]}))}))},e.prototype.setMessageContent=function(e,t,n){return w(this,void 0,void 0,(function(){return b(this,(function(i){return[2,this._engine.setMessageContent(e,t,n)]}))}))},e.prototype.setMessageSearchField=function(e,t,n){return w(this,void 0,void 0,(function(){return b(this,(function(i){return[2,this._engine.setMessageSearchField(e,t,n)]}))}))},e.prototype.setMessageSentStatus=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return[2,this._engine.setMessageSentStatus(e,t)]}))}))},e.prototype.setMessageReceivedStatus=function(e,t){return w(this,void 0,void 0,(function(){return b(this,(function(n){return[2,this._engine.setMessageReceivedStatus(e,t)]}))}))},e.prototype.setUserStatus=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.setUserStatus(e)]}))}))},e.prototype.subscribeUserStatus=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.subscribeUserStatus(e)]}))}))},e.prototype.getUserStatus=function(e){return w(this,void 0,void 0,(function(){return b(this,(function(t){return[2,this._engine.getUserStatus(e)]}))}))},e.prototype.searchConversationByContent=function(e,t,n,i){return void 0===t&&(t=[]),void 0===n&&(n=\"\"),w(this,void 0,void 0,(function(){return b(this,(function(r){return[2,this._engine.searchConversationByContent(e,t,n,i)]}))}))},e.prototype.searchMessageByContent=function(e,t,n,i,r,s,o){return void 0===o&&(o=\"\"),w(this,void 0,void 0,(function(){return b(this,(function(a){return[2,this._engine.searchMessageByContent(e,t,n,i,r,s,o)]}))}))},e.prototype.getUnreadMentionedMessages=function(e,t,n){return void 0===n&&(n=\"\"),this._engine.getUnreadMentionedMessages(e,t,n)},e.prototype.clearUnreadCountByTimestamp=function(e,t,n,i){return void 0===i&&(i=\"\"),this._engine.clearUnreadCountByTimestamp(e,t,n,i)},e.prototype.getConversationNotificationStatus=function(e,t,n){return void 0===n&&(n=\"\"),this._engine.getConversationNotificationStatus(e,t,n)},e.prototype.getRemoteHistoryMessages=function(e,t,n,i,r,s){return this._engine.getRemoteHistoryMessages(e,t,n,i,r,s)},e.prototype.getConversationListWithAllChannel=function(){return this._engine.getConversationListWithAllChannel()},e.prototype.getConversationListWithAllChannelByPage=function(e,t){return this._engine.getConversationListWithAllChannelByPage(e,t)},e.prototype.joinRTCRoom=function(e,t,n,i,r,s){return this._engine.joinRTCRoom(e,t,n,i,r,s)},e.prototype.quitRTCRoom=function(e){return this._engine.quitRTCRoom(e)},e.prototype.rtcPing=function(e,t,n){return this._engine.rtcPing(e,t,n)},e.prototype.getRTCRoomInfo=function(e){return this._engine.getRTCRoomInfo(e)},e.prototype.getRTCUserInfoList=function(e){return this._engine.getRTCUserInfoList(e)},e.prototype.getRTCUserInfo=function(e){return this._engine.getRTCUserInfo(e)},e.prototype.setRTCUserInfo=function(e,t,n){return this._engine.setRTCUserInfo(e,t,n)},e.prototype.removeRTCUserInfo=function(e,t){return this._engine.removeRTCUserInfo(e,t)},e.prototype.setRTCData=function(e,t,n,i,r,s){return this._engine.setRTCData(e,t,n,i,r,s)},e.prototype.setRTCTotalRes=function(e,t,n,i,r){return void 0===r&&(r=\"\"),this._engine.setRTCTotalRes(e,t,n,i,r)},e.prototype.setRTCCDNUris=function(e,t,n){return this._engine.setRTCCDNUris(e,t,n)},e.prototype.getRTCData=function(e,t,n,i){return this._engine.getRTCData(e,t,n,i)},e.prototype.removeRTCData=function(e,t,n,i,r){return this._engine.removeRTCData(e,t,n,i,r)},e.prototype.setRTCOutData=function(e,t,n,i){return this._engine.setRTCOutData(e,t,n,i)},e.prototype.getRTCOutData=function(e,t){return this._engine.getRTCOutData(e,t)},e.prototype.getRTCToken=function(e,t,n){return this._engine.getRTCToken(e,t,n)},e.prototype.setRTCState=function(e,t){return this._engine.setRTCState(e,t)},e.prototype.getRTCUserList=function(e){return this._engine.getRTCUserList(e)},e.prototype.joinLivingRoomAsAudience=function(e,t,n){return this._engine.joinLivingRoomAsAudience(e,t,n)},e.prototype.quitLivingRoomAsAudience=function(e){return this._engine.quitLivingRoomAsAudience(e)},e.prototype.rtcIdentityChange=function(e,t,n){return this._engine.rtcIdentityChange(e,t,n)},e.prototype.getRTCJoinedUserInfo=function(e){return this._engine.getRTCJoinedUserInfo(e)},e.prototype.requestRoomPK=function(e){return this._engine.requestRoomPK(e)},e.prototype.cancelRoomPK=function(e){return this._engine.cancelRoomPK(e)},e.prototype.responseRoomPK=function(e){return this._engine.responseRoomPK(e)},e.prototype.endRoomPK=function(e){return this._engine.endRoomPK(e)},e}();!function(e){e[e.add=1]=\"add\",e[e.update=2]=\"update\",e[e.delete=3]=\"delete\"}(ns||(ns={}));var rs=\"5.1.2\";\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./node_modules/@rongcloud/engine/dist/index.esm.js?");

/***/ }),

/***/ "./node_modules/@rongcloud/imlib-next/dist/index.esm.js":
/*!**************************************************************!*\
  !*** ./node_modules/@rongcloud/imlib-next/dist/index.esm.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ConnectionStatus\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConnectionStatus),\n/* harmony export */   \"ConversationType\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConversationType),\n/* harmony export */   \"ErrorCode\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode),\n/* harmony export */   \"LogLevel\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.LogLevel),\n/* harmony export */   \"MentionedType\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.MentionedType),\n/* harmony export */   \"MessageBlockType\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.MessageBlockType),\n/* harmony export */   \"MessageDirection\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.MessageDirection),\n/* harmony export */   \"NotificationStatus\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.NotificationStatus),\n/* harmony export */   \"ReceivedStatus\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ReceivedStatus),\n/* harmony export */   \"UploadMethod\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod),\n/* harmony export */   \"BaseMessage\": () => (/* binding */ Ze),\n/* harmony export */   \"CombineMessage\": () => (/* binding */ ct),\n/* harmony export */   \"ConnectType\": () => (/* binding */ An),\n/* harmony export */   \"Events\": () => (/* binding */ U),\n/* harmony export */   \"FileMessage\": () => (/* binding */ ut),\n/* harmony export */   \"GIFMessage\": () => (/* binding */ dt),\n/* harmony export */   \"HQVoiceMessage\": () => (/* binding */ rt),\n/* harmony export */   \"ImageMessage\": () => (/* binding */ at),\n/* harmony export */   \"LocationMessage\": () => (/* binding */ gt),\n/* harmony export */   \"MessageType\": () => (/* binding */ Pn),\n/* harmony export */   \"ReferenceMessage\": () => (/* binding */ ft),\n/* harmony export */   \"RichContentMessage\": () => (/* binding */ mt),\n/* harmony export */   \"SightMessage\": () => (/* binding */ it),\n/* harmony export */   \"TextMessage\": () => (/* binding */ st),\n/* harmony export */   \"VoiceMessage\": () => (/* binding */ lt),\n/* harmony export */   \"__addSDKVersion\": () => (/* binding */ Ce),\n/* harmony export */   \"addConversationsToTag\": () => (/* binding */ On),\n/* harmony export */   \"addEventListener\": () => (/* binding */ he),\n/* harmony export */   \"addTag\": () => (/* binding */ Tn),\n/* harmony export */   \"clearAllMessagesUnreadStatus\": () => (/* binding */ _e),\n/* harmony export */   \"clearEventListeners\": () => (/* binding */ Se),\n/* harmony export */   \"clearHistoryMessages\": () => (/* binding */ an),\n/* harmony export */   \"clearMessages\": () => (/* binding */ vn),\n/* harmony export */   \"clearMessagesUnreadStatus\": () => (/* binding */ Me),\n/* harmony export */   \"clearTextMessageDraft\": () => (/* binding */ Re),\n/* harmony export */   \"clearUnreadCountByTimestamp\": () => (/* binding */ Sn),\n/* harmony export */   \"connect\": () => (/* binding */ de),\n/* harmony export */   \"deleteLocalMessagesByTimestamp\": () => (/* binding */ pn),\n/* harmony export */   \"deleteMessages\": () => (/* binding */ on),\n/* harmony export */   \"disconnect\": () => (/* binding */ le),\n/* harmony export */   \"forceRemoveChatRoomEntry\": () => (/* binding */ Je),\n/* harmony export */   \"forceSetChatRoomEntry\": () => (/* binding */ je),\n/* harmony export */   \"getAllChatRoomEntries\": () => (/* binding */ Qe),\n/* harmony export */   \"getAllConversationState\": () => (/* binding */ He),\n/* harmony export */   \"getAllUnreadMentionedCount\": () => (/* binding */ De),\n/* harmony export */   \"getBlockedConversationList\": () => (/* binding */ be),\n/* harmony export */   \"getChatRoomEntry\": () => (/* binding */ Ye),\n/* harmony export */   \"getChatRoomInfo\": () => (/* binding */ Ve),\n/* harmony export */   \"getChatroomHistoryMessages\": () => (/* binding */ $e),\n/* harmony export */   \"getConnectionStatus\": () => (/* binding */ ge),\n/* harmony export */   \"getConversationList\": () => (/* binding */ Te),\n/* harmony export */   \"getConversationNotificationStatus\": () => (/* binding */ xe),\n/* harmony export */   \"getConversationsFromTagByPage\": () => (/* binding */ Un),\n/* harmony export */   \"getCurrentUserId\": () => (/* binding */ me),\n/* harmony export */   \"getFileToken\": () => (/* binding */ Bt),\n/* harmony export */   \"getFileUrl\": () => (/* binding */ qt),\n/* harmony export */   \"getFirstUnreadMessage\": () => (/* binding */ ln),\n/* harmony export */   \"getHistoryMessages\": () => (/* binding */ Jt),\n/* harmony export */   \"getMessage\": () => (/* binding */ fn),\n/* harmony export */   \"getMessageReader\": () => (/* binding */ un),\n/* harmony export */   \"getRemoteHistoryMessages\": () => (/* binding */ Yt),\n/* harmony export */   \"getServerTime\": () => (/* binding */ fe),\n/* harmony export */   \"getTags\": () => (/* binding */ Nn),\n/* harmony export */   \"getTagsFromConversation\": () => (/* binding */ Rn),\n/* harmony export */   \"getTextMessageDraft\": () => (/* binding */ ye),\n/* harmony export */   \"getTopConversationList\": () => (/* binding */ Pe),\n/* harmony export */   \"getTotalUnreadCount\": () => (/* binding */ Oe),\n/* harmony export */   \"getUnreadCount\": () => (/* binding */ we),\n/* harmony export */   \"getUnreadCountByTag\": () => (/* binding */ xn),\n/* harmony export */   \"getUnreadMentionedCount\": () => (/* binding */ Le),\n/* harmony export */   \"getUnreadMentionedMessages\": () => (/* binding */ mn),\n/* harmony export */   \"init\": () => (/* binding */ ce),\n/* harmony export */   \"insertMessage\": () => (/* binding */ gn),\n/* harmony export */   \"installPlugin\": () => (/* binding */ ue),\n/* harmony export */   \"joinChatRoom\": () => (/* binding */ Be),\n/* harmony export */   \"joinExistChatRoom\": () => (/* binding */ qe),\n/* harmony export */   \"onceEventListener\": () => (/* binding */ pe),\n/* harmony export */   \"quitChatRoom\": () => (/* binding */ Fe),\n/* harmony export */   \"recallMessage\": () => (/* binding */ nn),\n/* harmony export */   \"registerMessageType\": () => (/* binding */ dn),\n/* harmony export */   \"removeChatRoomEntries\": () => (/* binding */ We),\n/* harmony export */   \"removeChatRoomEntry\": () => (/* binding */ Xe),\n/* harmony export */   \"removeConversation\": () => (/* binding */ Ee),\n/* harmony export */   \"removeConversationsFromTag\": () => (/* binding */ wn),\n/* harmony export */   \"removeEventListener\": () => (/* binding */ ve),\n/* harmony export */   \"removeEventListeners\": () => (/* binding */ Ie),\n/* harmony export */   \"removeMessageExpansionForKey\": () => (/* binding */ sn),\n/* harmony export */   \"removeTag\": () => (/* binding */ En),\n/* harmony export */   \"removeTagFromConversations\": () => (/* binding */ _n),\n/* harmony export */   \"removeTagsFromConversation\": () => (/* binding */ Mn),\n/* harmony export */   \"saveTextMessageDraft\": () => (/* binding */ Ne),\n/* harmony export */   \"searchConversationByContent\": () => (/* binding */ In),\n/* harmony export */   \"searchMessages\": () => (/* binding */ hn),\n/* harmony export */   \"sendFileMessage\": () => (/* binding */ Kt),\n/* harmony export */   \"sendHQVoiceMessage\": () => (/* binding */ Xt),\n/* harmony export */   \"sendImageMessage\": () => (/* binding */ jt),\n/* harmony export */   \"sendMessage\": () => (/* binding */ Ft),\n/* harmony export */   \"sendReadReceiptMessage\": () => (/* binding */ Qt),\n/* harmony export */   \"sendReadReceiptRequest\": () => (/* binding */ $t),\n/* harmony export */   \"sendReadReceiptResponse\": () => (/* binding */ Zt),\n/* harmony export */   \"sendReadReceiptResponseV2\": () => (/* binding */ en),\n/* harmony export */   \"sendSightMessage\": () => (/* binding */ Wt),\n/* harmony export */   \"sendSyncReadStatusMessage\": () => (/* binding */ tn),\n/* harmony export */   \"sendTextMessage\": () => (/* binding */ Vt),\n/* harmony export */   \"sendTypingStatusMessage\": () => (/* binding */ cn),\n/* harmony export */   \"setChatRoomEntries\": () => (/* binding */ Ke),\n/* harmony export */   \"setChatRoomEntry\": () => (/* binding */ ze),\n/* harmony export */   \"setConversationNotificationStatus\": () => (/* binding */ Ue),\n/* harmony export */   \"setConversationToTop\": () => (/* binding */ Ae),\n/* harmony export */   \"setConversationToTopInTag\": () => (/* binding */ bn),\n/* harmony export */   \"setMessageReceivedStatus\": () => (/* binding */ Cn),\n/* harmony export */   \"updateMessageExpansion\": () => (/* binding */ rn),\n/* harmony export */   \"updateTag\": () => (/* binding */ yn)\n/* harmony export */ });\n/* harmony import */ var _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @rongcloud/engine */ \"./node_modules/@rongcloud/engine/dist/index.esm.js\");\n\n/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */var y=function(e,t){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},y(e,t)};var N=function(){return N=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},N.apply(this,arguments)};function R(e,t,n,o){return new(n||(n=Promise))((function(a,r){function i(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))}function O(e,t){var n,o,a,r,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},\"function\"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError(\"Generator is already executing.\");for(;i;)try{if(n=1,o&&(a=2&r[0]?o.return:r[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,o=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==r[0]&&2!==r[0])){i=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){i.label=r[1];break}if(6===r[0]&&i.label<a[1]){i.label=a[1],a=r;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(r);break}a[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(e){r=[6,e],o=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var w=new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.Logger(\"RCIM\"),M=function(){return!(\"undefined\"==typeof uni||!function(e){for(var t=[\"canIUse\",\"getSystemInfo\"],n=0,o=t.length;n<o;n++)if(!e[t[n]])return!1;return!0}(uni))},_=M();var U,x={tag:\"browser\",httpReq:function(e){var t=e.method||_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.HttpMethod.GET,n=e.timeout||6e4,r=e.headers,i=e.query,s=e.body,c=(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.appendUrl)(e.url,i);return new Promise((function(e){var o,a=(o=\"undefined\"!=typeof XMLHttpRequest&&\"withCredentials\"in new XMLHttpRequest,\"undefined\"!=typeof XMLHttpRequest&&o?new XMLHttpRequest:\"undefined\"!=typeof XDomainRequest?new XDomainRequest:new ActiveXObject(\"Microsoft.XMLHTTP\")),i=\"[object XDomainRequest]\"===Object.prototype.toString.call(a);if(a.open(t,c),r&&a.setRequestHeader)for(var u in r)a.setRequestHeader(u,r[u]);if(i){a.timeout=n,a.onload=function(){e({data:a.responseText,status:a.status||200})},a.onerror=function(){e({status:a.status||0})},a.ontimeout=function(){e({status:a.status||0})};var d=\"object\"==typeof s?JSON.stringify(s):s;a.send(d)}else a.onreadystatechange=function(){4===a.readyState&&e({data:a.responseText,status:a.status})},a.onerror=function(){e({status:a.status||0})},setTimeout((function(){return e({status:a.status||0})}),n),a.send(s)}))},localStorage:null===window||void 0===window?void 0:window.localStorage,sessionStorage:null===window||void 0===window?void 0:window.sessionStorage,isSupportSocket:function(){var e=\"undefined\"!=typeof WebSocket;return e||w.warn(\"websocket not support\"),e},useNavi:!0,connectPlatform:\"\",isFromUniapp:_,createWebSocket:function(e,t){var n=new WebSocket(e,t);return n.binaryType=\"arraybuffer\",{onClose:function(e){n.onclose=function(t){var n=t.code,o=t.reason;e(n,o)}},onError:function(e){n.onerror=e},onMessage:function(e){n.onmessage=function(t){e(t.data)}},onOpen:function(e){n.onopen=e},send:function(e){n.send(e)},close:function(e,t){n.close(e,t)}}},createDataChannel:function(e,o){return this.isSupportSocket()&&\"websocket\"===o?new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.WebSocketChannel(this,e):new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CometChannel(this,e)}},b=M(),A=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return wx[e].apply(wx,t)}catch(e){w.error(e)}}},P={setItem:A(\"setStorageSync\"),getItem:A(\"getStorageSync\"),removeItem:A(\"removeStorageSync\"),clear:A(\"clearStorageSync\")},L={tag:\"wechat\",httpReq:function(e){var t=e.method||_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.HttpMethod.GET,n=e.timeout||6e4,i=e.headers,s=e.query,c=e.body,u=(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.appendUrl)(e.url,s);return new Promise((function(e){wx.request({url:u,method:t,headers:i,timeout:n,data:c,success:function(t){e({data:t.data,status:t.statusCode})},fail:function(){e({status:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:P,sessionStorage:P,isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:\"MiniProgram\",isFromUniapp:b,createWebSocket:function(e,t){var n=wx.connectSocket({url:e,protocols:t});return{onClose:function(e){n.onClose((function(t){e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){e(t.data)}))},onOpen:function(e){n.onOpen(e)},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(e,o){return\"websocket\"===o?new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.WebSocketChannel(this,e):new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CometChannel(this,e)}},D=M(),H=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return my[e].apply(my,t)}catch(e){w.error(e)}}},k={setItem:H(\"setStorageSync\"),getItem:H(\"getStorageSync\"),removeItem:H(\"removeStorageSync\"),clear:H(\"clearStorageSync\")},G={tag:\"alipay\",httpReq:function(e){var t=e.method||_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.HttpMethod.GET,n=e.timeout||6e4,i=e.headers,s=e.query,c=e.body,u=(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.appendUrl)(e.url,s),d=e.dataType||\"json\";return new Promise((function(e){my.request({url:u,method:t,headers:i,timeout:n,data:c,dataType:d,success:function(t){e({data:t.data,status:t.status})},fail:function(){e({status:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:k,sessionStorage:k,isSupportSocket:function(){return!1},useNavi:!1,connectPlatform:\"MiniProgram\",isFromUniapp:D,createDataChannel:function(e,o){return\"websocket\"===o?new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.WebSocketChannel(this,e):new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CometChannel(this,e)}},B=M(),q=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return console.log(\"tt\",tt),tt[e].apply(tt,t)}catch(e){w.error(e)}}},F={setItem:q(\"setStorageSync\"),getItem:q(\"getStorageSync\"),removeItem:q(\"removeStorageSync\"),clear:q(\"clearStorageSync\")},V={tag:\"toutiao\",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:\"MiniProgram\",isFromUniapp:B,localStorage:F,sessionStorage:F,httpReq:function(e){return new Promise((function(t,n){tt.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(e){console.log(\"调用成功\",e.data);var n=(null==e?void 0:e.data)||{},o={data:JSON.stringify(n),status:e.statusCode};t(o)},fail:function(e){console.log(\"调用失败\",e.errMsg),n({data:e.errMsg})}})}))},createWebSocket:function(e,t){var n=tt.connectSocket({url:e,protocols:t});return{onOpen:function(e){n.onOpen(e)},onClose:function(e){n.onClose((function(t){return e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){return e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){return e(t.data)}))},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(e,o){return\"websocket\"===o?new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.WebSocketChannel(this,e):new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CometChannel(this,e)}},z=M(),K=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return console.log(\"swan\",swan),swan[e].apply(swan,t)}catch(e){w.error(e)}}},j={setItem:K(\"setStorageSync\"),getItem:K(\"getStorageSync\"),removeItem:K(\"removeStorageSync\"),clear:K(\"clearStorageSync\")},X={tag:\"baidu\",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:\"MiniProgram\",isFromUniapp:z,localStorage:j,sessionStorage:j,httpReq:function(e){return new Promise((function(t,n){swan.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(e){console.log(\"调用成功\",e.data);var n=(null==e?void 0:e.data)||{},o={data:JSON.stringify(n),status:e.statusCode};t(o)},fail:function(e){console.log(\"调用失败\",e.errorCode),n({data:e.errorCode})}})}))},createWebSocket:function(e,t){var n=swan.connectSocket({url:e,protocols:t});return{onOpen:function(e){n.onOpen(e)},onClose:function(e){n.onClose((function(t){return e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){return e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){return e(t.data)}))},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(e,o){return\"websocket\"===o?new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.WebSocketChannel(this,e):new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CometChannel(this,e)}},W=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return uni[e].apply(uni,t)}catch(e){w.error(e)}}},J={setItem:W(\"setStorageSync\"),getItem:W(\"getStorageSync\"),removeItem:W(\"removeStorageSync\"),clear:W(\"clearStorageSync\")},Y={tag:\"uniapp\",httpReq:function(e){var t=e.method||_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.HttpMethod.GET,n=e.timeout||6e4,i=e.headers,s=e.query,c=e.body,u=(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.appendUrl)(e.url,s);return new Promise((function(e){uni.request({url:u,method:t,headers:i,timeout:n,data:c,success:function(t){e({data:t.data,status:t.statusCode})},fail:function(){e({status:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:J,sessionStorage:J,isSupportSocket:function(){return!0},useNavi:!0,connectPlatform:\"\",isFromUniapp:!0,createWebSocket:function(e,t){var n={complete:function(){},url:e,protocols:t},o=uni.connectSocket(n);return{onClose:function(e){o.onClose((function(t){e(t.code,t.reason)}))},onError:function(e){o.onError((function(t){e(t.errMsg)}))},onMessage:function(e){o.onMessage((function(t){e(t.data)}))},onOpen:function(e){o.onOpen(e)},send:function(e){o.send({data:e})},close:function(e,t){o.close({code:e,reason:t})}}},createDataChannel:function(e,o){return\"websocket\"===o?new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.WebSocketChannel(this,e):new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CometChannel(this,e)}},Q=function(e){return e&&e.canIUse&&e.getSystemInfo},$=\"undefined\"!=typeof uni&&Q(uni)?function(){switch(process.env.VUE_APP_PLATFORM){case\"app-plus\":return Y;case\"mp-baidu\":return X;case\"mp-toutiao\":return V;case\"mp-alipay\":return G;case\"mp-weixin\":return L;default:return x}}():\"undefined\"!=typeof wx&&Q(wx)?L:\"undefined\"!=typeof my&&Q(my)?G:\"undefined\"!=typeof tt&&Q(tt)?V:\"undefined\"!=typeof swan&&Q(swan)?X:x;function Z(e){var t=e.conversationType,n=e.channelId,o=e.messageType,a=e.content,r=e.senderUserId,s=e.targetId,c=e.sentTime,u=e.receivedTime,d=e.messageUId,l=e.messageDirection,g=e.isPersited,f=e.isCounted,m=e.isOffLineMessage,h=e.canIncludeExpansion,p=e.expansion,v=e.receivedStatus,I=e.disableNotification,S=e.isMentioned,C=e.isStatusMessage,T=e.readReceiptInfo,E=e.pushConfig,y=e.messageId;return v||(v=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ReceivedStatus.UNREAD),{messageType:o,channelId:n||\"\",content:a,senderUserId:r,targetId:s,conversationType:t,sentTime:c,receivedTime:u,messageUId:d,messageDirection:l,isPersited:g,isCounted:f,isOffLineMessage:m,isMentioned:S,disableNotification:I,isStatusMessage:C,canIncludeExpansion:h,expansion:p,receivedStatus:v,readReceiptInfo:T,pushConfig:E,messageId:y}}!function(e){e.CONNECTING=\"CONNECTING\",e.CONNECTED=\"CONNECTED\",e.DISCONNECT=\"DISCONNECT\",e.SUSPEND=\"SUSPEND\",e.MESSAGES=\"MESSAGES\",e.READ_RECEIPT_RECEIVED=\"READ_RECEIPT_RECEIVED\",e.MESSAGE_RECEIPT_REQUEST=\"MESSAGE_RECEIPT_REQUEST\",e.MESSAGE_RECEIPT_RESPONSE=\"MESSAGE_RECEIPT_RESPONSE\",e.CONVERSATION=\"CONVERSATION\",e.CHATROOM=\"CHATROOM\",e.EXPANSION=\"EXPANSION\",e.PULL_OFFLINE_MESSAGE_FINISHED=\"PULL_OFFLINE_MESSAGE_FINISHED\",e.TAG=\"TAG\",e.CONVERSATION_TAG=\"CONVERSATION_TAG\",e.TYPING_STATUS=\"TYPING_STATUS\",e.MESSAGE_BLOCKED=\"MESSAGE_BLOCKED\"}(U||(U={}));var ee,te=function(e){function t(n){var o=e.call(this)||this;if(t.imClient)return w.error(\"Please do not repeatedly perform the init method\"),t.imClient;(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.navigators\",n.navigators,(function(e){return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(0===e.length||e.every(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isHttpUrl))}));var a=null==n?void 0:n.connectType;return a?_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CONNECTION_TYPE.WEBSOCKET!==a&&_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CONNECTION_TYPE.COMET!==a&&(w.warn(\"RongIMLib connectionType must be \"+_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CONNECTION_TYPE.WEBSOCKET+\" or \"+_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CONNECTION_TYPE.COMET),a=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CONNECTION_TYPE.WEBSOCKET):a=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.CONNECTION_TYPE.WEBSOCKET,o._context=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.APIContext.init($,{appkey:n.appkey,apiVersion:\"5.1.2\",navigators:n.navigators||[],miniCMPProxy:n.customCMP||[],connectionType:a,logLevel:n.logLevel,logStdout:n.logStdout,indexDBSwitch:n.indexDBSwitch,checkCA:n.checkCA}),o.watch(),t.imClient=o,o}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Class extends value \"+String(t)+\" is not a constructor or null\");function n(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),Object.defineProperty(t.prototype,\"context\",{get:function(){if(!this._context)throw new Error(\"Please perform the init method!\");return this._context},enumerable:!1,configurable:!0}),t.prototype.watch=function(){var e=this,t={onConnecting:function(){e.emit(U.CONNECTING)},onConnected:function(){e.emit(U.CONNECTED)},onDisconnect:function(t){e.emit(U.DISCONNECT,t)},onSuspend:function(t){e.emit(U.SUSPEND,t)},batchMessage:function(t){e.emit(U.MESSAGES,{messages:t.map((function(e){return Z(e)}))})},typingState:function(t){e.emit(U.TYPING_STATUS,{status:t})},readReceiptReceived:function(t,n,o){e.emit(U.READ_RECEIPT_RECEIVED,{conversation:t,messageUId:n,sentTime:o})},messageReceiptRequest:function(t,n,o){e.emit(U.MESSAGE_RECEIPT_REQUEST,{conversation:t,messageUId:n,senderUserId:o})},messageReceiptResponse:function(t,n,o){e.emit(U.MESSAGE_RECEIPT_RESPONSE,{conversation:t,receivedUserId:n,messageUIdList:o})},conversationState:function(t){var n=t.map((function(e){return{conversation:{conversationType:e.conversationType,latestMessage:e.latestMessage?Z(e.latestMessage):null,targetId:e.targetId,unreadMessageCount:e.unreadMessageCount,hasMentioned:e.hasMentioned,mentionedInfo:e.mentionedInfo,lastUnreadTime:e.lastUnreadTime,notificationStatus:e.notificationStatus,isTop:e.isTop,channelId:e.channelId,unreadMentionedCount:e.unreadMentionedCount},updatedItems:e.updatedItems}}));e.emit(U.CONVERSATION,{conversationList:n})},chatroomState:function(t){e.emit(U.CHATROOM,t)},expansion:function(t){e.emit(U.EXPANSION,t)},pullFinished:function(){e.emit(U.PULL_OFFLINE_MESSAGE_FINISHED)},tag:function(){e.emit(U.TAG)},conversationTagChanged:function(){e.emit(U.CONVERSATION_TAG)},messageBlocked:function(t){e.emit(U.MESSAGE_BLOCKED,t)}};this.context.assignWatcher(t)},t}(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.EventEmitter),ne={TIMEOUT:{code:-1,msg:\"Network timeout\"},SDK_INTERNAL_ERROR:{code:-2,msg:\"SDK internal error\"},PARAMETER_ERROR:{code:-3,msg:\"Please check the parameters, the {param} expected a value of {expect} but received {current}\"},REJECTED_BY_BLACKLIST:{code:405,msg:\"Blacklisted by the other party\"},SEND_TOO_FAST:{code:20604,msg:\"Sending messages too quickly\"},NOT_IN_GROUP:{code:22406,msg:\"Not in group\"},FORBIDDEN_IN_GROUP:{code:22408,msg:\"Forbbiden from speaking in the group\"},NOT_IN_CHATROOM:{code:23406,msg:\"Not in chatRoom\"},FORBIDDEN_IN_CHATROOM:{code:23408,msg:\"Forbbiden from speaking in the chatRoom\"},KICKED_FROM_CHATROOM:{code:23409,msg:\"Kicked out and forbbiden from joining the chatRoom\"},CHATROOM_NOT_EXIST:{code:23410,msg:\"ChatRoom does not exist\"},CHATROOM_IS_FULL:{code:23411,msg:\"ChatRoom members exceeded\"},PARAMETER_INVALID_CHATROOM:{code:23412,msg:\"Invalid chatRoom parameters\"},ROAMING_SERVICE_UNAVAILABLE_CHATROOM:{code:23414,msg:\"ChatRoom message roaming service is not open, Please go to the developer to open this service\"},RECALLMESSAGE_PARAMETER_INVALID:{code:25101,msg:\"Invalid recall message parameter\"},ROAMING_SERVICE_UNAVAILABLE_MESSAGE:{code:25102,msg:\"Single group chat roaming service is not open, Please go to the developer to open this service\"},PUSHSETTING_PARAMETER_INVALID:{code:26001,msg:\"Invalid push parameter\"},OPERATION_BLOCKED:{code:20605,msg:\"Operation is blocked\"},OPERATION_NOT_SUPPORT:{code:20606,msg:\"Operation is not supported\"},MSG_BLOCKED_SENSITIVE_WORD:{code:21501,msg:\"The sent message contains sensitive words\"},REPLACED_SENSITIVE_WORD:{code:21502,msg:\"Sensitive words in the message have been replaced\"},NOT_CONNECTED:{code:30001,msg:\"Please connect successfully first\"},NAVI_REQUEST_ERROR:{code:30007,msg:\"Navigation http request failed\"},CMP_REQUEST_ERROR:{code:30010,msg:\"CMP sniff http request failed\"},CONN_APPKEY_FAKE:{code:31002,msg:\"Your appkey is fake\"},CONN_MINI_SERVICE_NOT_OPEN:{code:31003,msg:\"Mini program service is not open, Please go to the developer to open this service\"},CONN_ACK_TIMEOUT:{code:31e3,msg:\"Connection ACK timeout\"},CONN_TOKEN_INCORRECT:{code:31004,msg:\"Your token is not valid or expired\"},CONN_NOT_AUTHRORIZED:{code:31005,msg:\"AppKey and Token do not match\"},CONN_REDIRECTED:{code:31006,msg:\"Connection redirection\"},CONN_APP_BLOCKED_OR_DELETED:{code:31008,msg:\"AppKey is banned or deleted\"},CONN_USER_BLOCKED:{code:31009,msg:\"User blocked\"},CONN_DOMAIN_INCORRECT:{code:31012,msg:\"Connect domain error, Please check the set security domain\"},ROAMING_SERVICE_UNAVAILABLE:{code:33007,msg:\"Roaming service cloud is not open, Please go to the developer to open this service\"},RC_CONNECTION_EXIST:{code:34001,msg:\"Connection already exists\"},CHATROOM_KV_EXCEED:{code:23423,msg:\"ChatRoom KV setting exceeds maximum\"},CHATROOM_KV_OVERWRITE_INVALID:{code:23424,msg:\"ChatRoom KV already exists\"},CHATROOM_KV_STORE_NOT_OPEN:{code:23426,msg:\"ChatRoom KV storage service is not open, Please go to the developer to open this service\"},CHATROOM_KEY_NOT_EXIST:{code:23427,msg:\"ChatRoom key does not exist\"},MSG_KV_NOT_SUPPORT:{code:34008,msg:\"The message cannot be extended\"},SEND_MESSAGE_KV_FAIL:{code:34009,msg:\"Sending RC expansion message fail\"},EXPANSION_LIMIT_EXCEET:{code:34010,msg:\"The message expansion size is beyond the limit\"},ILLGAL_PARAMS:{code:33003,msg:\"Incorrect parameters passed in while calling the interface\"},UPLOAD_FILE_FAILED:{code:35020,msg:\"File upload failed\"},CHATROOM_KV_STORE_NOT_ALL_SUCCESS:{code:23428,msg:\"Chatroom kv store not all success\"},CHATROOM_KV_STORE_OUT_LIMIT:{code:23429,msg:\"Chatroom kv's length is out of limit\"},TAG_EXISTS:{code:33101,msg:\"The tag already exists\"},TAG_NOT_EXIST:{code:33100,msg:\"The tag does not exist\"},NOT_SUPPORT:{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:\"The method is not supported in a browser!\"}},oe={},ae={};for(var re in ne){var ie=ne[re],se=ie.code;oe[se]=re,ae[se]=ie}ne.ROAMING_SERVICE_UNAVAILABLE.code;var ce=function(e){ee=ee||new te(e)};function ue(e,t){return null==ee?void 0:ee.context.install(e,t)}function de(e,t){return R(this,void 0,void 0,(function(){var n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"token\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),w.warn(\"RongIMLib Version: 5.1.2, Commit: 5f8c7ef795a4271181ff3bc26e8b9003e3693988\"),[4,ee.context.connect(e,!1,t)];case 1:return(n=o.sent()).code===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n.code,data:{userId:n.userId}}]:[2,{code:n.code,msg:oe[n.code]}]}}))}))}function le(){return ee.context.disconnect()}function ge(){return ee.context.getConnectionStatus()}function fe(){return ee.context.getServerTime()}function me(){return ee.context.getCurrentUserId()}function he(e,t,n){ee.on(e,t,n)}function pe(e,t,n){ee.once(e,t,n)}function ve(e,t,n){ee.off(e,t,n)}function Ie(e){ee.removeAll(e)}function Se(){ee.clear()}function Ce(e,t){_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.VersionManage.add(e,t)}function Te(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i;return O(this,(function(s){switch(s.label){case 0:return w.debug(\"get conversation list ->\"),[4,te.imClient.context.getConversationList(null==e?void 0:e.count,void 0,null==e?void 0:e.startTime,null==e?void 0:e.order,t)];case 1:return n=s.sent(),o=n.code,a=n.data,o===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&a?(i=a.map((function(e){return function(e){var t=e.conversationType,n=e.targetId,o=e.latestMessage,a=e.unreadMessageCount,r=e.hasMentioned,i=e.mentionedInfo,s=e.lastUnreadTime,c=e.notificationStatus,u=e.isTop,d=e.channelId,l=e.unreadMentionedCount;return{conversationType:t,targetId:n,latestMessage:o&&Z(o),unreadMessageCount:a,hasMentioned:r,mentionedInfo:r?{type:null==i?void 0:i.type,userIdList:null==i?void 0:i.userIdList}:void 0,lastUnreadTime:s,notificationStatus:c,isTop:u,channelId:d,unreadMentionedCount:l}}(e)})),[2,{code:0,data:i}]):(w.warn(\"get conversation list fail ->\"+o+\":\"+oe[o]),[2,{code:o,msg:oe[o]}])}}))}))}function Ee(e){return R(this,void 0,void 0,(function(){var t,n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),[4,te.imClient.context.removeConversation(e.conversationType,e.targetId,e.channelId)];case 1:return t=o.sent(),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"destroy conversation ->\"+n),t!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"destroy conversation fail ->\"+t+\":\"+oe[t]+\",\"+n),[2,{code:t,msg:oe[t]}]):[2,{code:t}]}}))}))}function ye(e){return R(this,void 0,void 0,(function(){var t,n,o,a;return O(this,(function(i){switch(i.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),[4,te.imClient.context.getConversationMessageDraft(e.conversationType,e.targetId,e.channelId)];case 1:return t=i.sent(),n=t.code,o=t.data,a=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"get draft ->\"+a),n===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n,data:o||\"\"}]:(w.warn(\"get draft fail ->\"+n+\":\"+oe[n]+\",\"+a),[2,{code:n,msg:oe[n]}])}}))}))}function Ne(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"draft\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"set draft ->\"+n),[4,te.imClient.context.saveConversationMessageDraft(e.conversationType,e.targetId,t,e.channelId)];case 1:return(o=a.sent())===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:o}]:(w.warn(\"set draft fail ->\"+o+\":\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}])}}))}))}function Re(e){return R(this,void 0,void 0,(function(){var t,n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),t=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"delete draft  ->\"+t),[4,te.imClient.context.clearConversationMessageDraft(e.conversationType,e.targetId,e.channelId)];case 1:return(n=o.sent())===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n}]:(w.warn(\"delete draft fail ->\"+n+\":\"+oe[n]+\",\"+t),[2,{code:n,msg:oe[n]}])}}))}))}function Oe(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c,u;return O(this,(function(d){switch(d.label){case 0:if(w.debug(\"get total unread count -> ConversationType:\"+JSON.stringify(t)+\" includeMuted:\"+e),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"includeMuted\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN,!1),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversationTypes\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.ARRAY,!1),t)for(n=0,o=t;n<o.length;n++)a=o[n],(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversationType\",a,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType);return[4,te.imClient.context.getTotalUnreadCount(\"\",t,e)];case 1:return i=d.sent(),c=i.code,u=i.data,c===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:c,data:u}]:(w.warn(\"getTotalUnreadCount fail ->\"+c+\":\"+oe[c]),[2,{code:c,msg:oe[c]}])}}))}))}function we(e){return R(this,void 0,void 0,(function(){var t,n,o,a;return O(this,(function(i){switch(i.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),[4,te.imClient.context.getUnreadCount(e.conversationType,e.targetId,e.channelId)];case 1:return t=i.sent(),n=t.code,o=t.data,a=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"get unreadCount ->\"+a),n===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n,data:o}]:(w.warn(\"get unreadCount fail ->\"+n+\":\"+oe[n]+\",\"+a),[2,{code:n,msg:oe[n]}])}}))}))}function Me(e){return R(this,void 0,void 0,(function(){var t,n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),[4,te.imClient.context.clearUnreadCount(e.conversationType,e.targetId,e.channelId)];case 1:return t=o.sent(),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"clear unreadMsgNum ->\"+n),t!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"clear unreadMsgNum fail ->\"+t+\":\"+oe[t]+\",\"+n),[2,{code:t,msg:oe[t]}]):[2,{code:t}]}}))}))}function _e(){return R(this,void 0,void 0,(function(){return O(this,(function(e){switch(e.label){case 0:return[4,te.imClient.context.clearAllUnreadCount()];case 1:return[2,{code:e.sent()}]}}))}))}function Ue(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"notificationStatus\",t,(function(e){return 1===e||2===e}),!0),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"set conversation status ->\"+n),[4,te.imClient.context.setConversationStatus(e.conversationType,e.targetId,void 0,t,e.channelId)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"set conversation status fail ->\"+o+\":\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:o}]}}))}))}function xe(e){return R(this,void 0,void 0,(function(){var t,n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),w.info(\"getConversationNotificationStatus ->targetId:\"+e.targetId+\",conversationType:\"+e.conversationType),[4,te.imClient.context.getConversationNotificationStatus(e.conversationType,e.targetId,e.channelId)];case 1:return t=a.sent(),n=t.code,o=t.data,n===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n,data:o}]:(w.warn(\"getConversationNotificationStatus ->code:\"+n+\",targetId:\"+e.targetId),[2,{code:n,msg:oe[n]}])}}))}))}function be(){return R(this,void 0,void 0,(function(){var e,t,n;return O(this,(function(o){switch(o.label){case 0:return[4,te.imClient.context.getBlockConversationList()];case 1:return e=o.sent(),t=e.code,n=e.data,[2,{code:t,data:n}]}}))}))}function Ae(e,t){return void 0===t&&(t=!0),R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.type\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidConversationType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"set conversation status ->\"+n),[4,te.imClient.context.setConversationStatus(e.conversationType,e.targetId,t,void 0,e.channelId)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"set conversation status fail ->\"+o+\":\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:o}]}}))}))}function Pe(){return R(this,void 0,void 0,(function(){var e,t,n;return O(this,(function(o){switch(o.label){case 0:return[4,te.imClient.context.getTopConversationList()];case 1:return e=o.sent(),t=e.code,n=e.data,[2,{code:t,data:n}]}}))}))}function Le(e){return R(this,void 0,void 0,(function(){return O(this,(function(t){return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),w.debug(\"getUnreadMentionedCount\"+e.targetId+\",channelId:\"+e.channelId),[2,te.imClient.context.getUnreadMentionedCount(e)]}))}))}function De(){return R(this,void 0,void 0,(function(){return O(this,(function(e){return w.debug(\"getAllUnreadMentionedCount\"),[2,te.imClient.context.getAllUnreadMentionedCount()]}))}))}function He(){return R(this,void 0,void 0,(function(){return O(this,(function(e){return[2,te.imClient.context.getAllConversationState()]}))}))}var ke=function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.key\",e.key,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.value\",e.value,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.isAutoDelete\",e.isAutoDelete,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.isSendNotification\",e.isSendNotification,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.notificationExtra\",e.notificationExtra,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING)},Ge=function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.key\",e.key,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.isSendNotification\",e.isSendNotification,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.notificationExtra\",e.notificationExtra,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING)};function Be(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.count\",t.count,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),n=\"id:\"+e,w.debug(\"join chatroom ->\"+n),[4,te.imClient.context.joinChatroom(e,t.count)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"join chatroom fail ->code+:\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:o}]}}))}))}function qe(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.count\",t.count,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),n=\"id:\"+e,w.debug(\"join exist chatroom ->\"+n),[4,te.imClient.context.joinExistChatroom(e,t.count)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"join exist chatroom fail ->code:\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:o}]}}))}))}function Fe(e){return R(this,void 0,void 0,(function(){var t,n;return O(this,(function(o){switch(o.label){case 0:return t=\"id:\"+e,w.debug(\"quit chatroom ->\"+t),[4,te.imClient.context.quitChatroom(e)];case 1:return(n=o.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"quit chatroom fail ->code+:\"+oe[n]+\",\"+t),[2,{code:n,msg:oe[n]}]):[2,{code:n}]}}))}))}function Ve(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i;return O(this,(function(c){switch(c.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.count\",t.count,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.order\",t.order,(function(e){return[0,1,2].includes(e)})),n=\"id:\"+e,w.debug(\"get chatroom info ->\"+n),[4,te.imClient.context.getChatroomInfo(e,t.count,t.order)];case 1:return o=c.sent(),a=o.code,i=o.data,a===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&i?[2,{code:a,data:i}]:(w.warn(\"get chatroom info fail ->code+:\"+oe[a]+\",\"+n),[2,{code:a,msg:oe[a]}])}}))}))}function ze(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),ke(t),n=\"id:\"+e,w.debug(\"set chatroom entry->\"+n),[4,te.imClient.context.setChatroomEntry(e,t)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"set chatroom entry fail ->code+:\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:o}]}}))}))}function Ke(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i;return O(this,(function(c){switch(c.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),function(e){e.entries.forEach((function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"entry.key\",e.key,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"entry.value\",e.value,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0)})),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.isAutoDelete\",e.isAutoDelete,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.notificationExtra\",e.notificationExtra,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING)}(t),t.entries.length>10?[2,ne.CHATROOM_KV_STORE_OUT_LIMIT]:(n=\"id:\"+e,w.debug(\"set chatroom entry->\"+n),[4,te.imClient.context.setChatroomEntries(e,t)]);case 1:return o=c.sent(),a=o.code,i=o.data,a!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"set chatroom entry fail ->code+:\"+oe[a]+\",\"+n),[2,{code:a,msg:oe[a],data:i}]):[2,{code:a}]}}))}))}function je(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),ke(t),n=\"id:\"+e,w.debug(\"force set chatroom entry ->\"+n),[4,te.imClient.context.forceSetChatroomEntry(e,t)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"force set chatroom entry fail ->code+:\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:o}]}}))}))}function Xe(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),Ge(t),n=\"id:\"+e,w.debug(\"remove chatroom entry->\"+n),[4,te.imClient.context.removeChatroomEntry(e,t)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"remove chatroom entry fail ->code+:\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:o}]}}))}))}function We(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c;return O(this,(function(u){switch(u.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),function(e){e.entries.forEach((function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"key\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0)})),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.notificationExtra\",e.notificationExtra,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING)}(t),n=\"id:\"+e,w.debug(\"remove chatroom entry->\"+n),(o=Object.assign({},t)).entries=t.entries.map((function(e){return{key:e}})),[4,te.imClient.context.removeChatroomEntries(e,o)];case 1:return a=u.sent(),i=a.code,c=a.data,i!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"remove chatroom entry fail ->code+:\"+oe[i]+\",\"+n),[2,{code:i,msg:oe[i],data:c}]):[2,{code:i}]}}))}))}function Je(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),Ge(t),n=\"id:\"+e,w.debug(\"force remove chatroom entry ->\"+n),[4,te.imClient.context.forceRemoveChatroomEntry(e,t)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"force remove chatroom entry fail ->code+:\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:o}]}}))}))}function Ye(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i;return O(this,(function(c){switch(c.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"key\",t,(function(e){return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isString)(e)&&/[\\w+=-]+/.test(e)&&e.length<=128}),!0),n=\"id:\"+e,w.debug(\"get chatroom entry->\"+n),[4,te.imClient.context.getChatroomEntry(e,t)];case 1:return o=c.sent(),a=o.code,i=o.data,a===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&i?[2,{code:a,data:i}]:(w.warn(\"get chatroom entry fail ->code+:\"+oe[a]+\",\"+n),[2,{code:a,msg:oe[a]}])}}))}))}function Qe(e){return R(this,void 0,void 0,(function(){var t,n,o,a;return O(this,(function(i){switch(i.label){case 0:return t=\"id:\"+e,w.debug(\"get all chatroom entries->\"+t),[4,te.imClient.context.getAllChatroomEntries(e)];case 1:return n=i.sent(),o=n.code,a=n.data,o===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&a?[2,{code:o,data:a}]:(w.warn(\"get all chatroom entries fail ->code+:\"+oe[o]+\",\"+t),[2,{code:o,msg:oe[o]}])}}))}))}function $e(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c;return O(this,(function(u){switch(u.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.timestamp\",t.timestamp,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.count\",t.count,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.order\",t.order,(function(e){return 0===e||1===e})),n=\"id:\"+e,w.debug(\"get chatroom history message->\"+n),[4,te.imClient.context.getChatRoomHistoryMessages(e,t.count,t.order,t.timestamp)];case 1:return o=u.sent(),a=o.code,i=o.data,a===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&i?(c=i.list.map((function(e){return Z(e)})),[2,{code:a,data:{list:c,hasMore:!!i.hasMore}}]):(w.warn(\"get chatroom history message fail ->code+:\"+oe[a]+\",\"+n),[2,{code:a,msg:oe[a]}])}}))}))}var Ze=function(e,t,n,o){void 0===n&&(n=!0),void 0===o&&(o=!0),this.messageType=e,this.content=t,this.isPersited=n,this.isCounted=o};function et(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0);return function(o){return new Ze(e,o,t,n)}}var nt,ot,at=et(\"RC:ImgMsg\"),rt=et(\"RC:HQVCMsg\"),it=et(\"RC:SightMsg\"),st=et(\"RC:TxtMsg\"),ct=et(\"RC:CombineMsg\"),ut=et(\"RC:FileMsg\"),dt=et(\"RC:GIFMsg\"),lt=et(\"RC:VcMsg\"),gt=et(\"RC:LBSMsg\"),ft=et(\"RC:ReferenceMsg\"),mt=et(\"RC:ImgTextMsg\"),ht={qiniu:function(e,t,n,o){var a,r=\"https://\"+t.uploadHost.qiniu;a=St()+pt[0][1]||r,pt.shift();var i=new XMLHttpRequest;i.upload&&t.support_options&&(i.upload.onprogress=function(e){n.onProgress(e.loaded,e.total)});i.onreadystatechange=function(){if(4===i.readyState){var a=i.responseText||\"{}\";(a=JSON.parse(a)).filename=t.uniqueValue,a.uploadMethod=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod?_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod.QINIU:\"\",200===i.status?n.onCompleted(a):pt.length?ht[pt[0][0]](e,t,n,o):n.onError(\"upload fail\")}},t.isChunk&&(a=function(e,t){var n=\"\";It(t,(function(e,t){\"token\"!==e&&(n+=(n?\"&\":\"\")+encodeURIComponent(e)+\"=\"+encodeURIComponent(t))})),n&&(e+=(e.indexOf(\"?\")>0?\"&\":\"?\")+n);return e}(a+=\"/mkblk/\"+e.size,t.multi_parmas));i.open(t.method,a,!0),n.onOpen(i),t.stream&&i.setRequestHeader(\"authorization\",\"UpToken \"+t.multi_parmas.token);It(t.headers,(function(e,t){i.setRequestHeader(e,t)})),i.send(e)},baidu:function(e,t,n,o){if(console.log(o,t),o.size>vt)throw new Error(\"the file size is over 5GB!\");var a=t||{};t=t||ot;var r=new XMLHttpRequest,i=St();if(!a.uploadHost.bos&&!a.bosUploadPath)return;var s=i+pt[0][1]+a.bosUploadPath;pt.shift();var c=a.bosHeader||{},u={filename:t.uniqueValue||o.uniqueName,name:o.name,downloadUrl:s,isBosRes:!0};r.upload&&t.support_options&&(r.upload.onprogress=function(e){n.onProgress(e.loaded,e.total,!0)});r.onreadystatechange=function(){if(4===r.readyState){var a=r.responseText||\"{}\";if((a=JSON.parse(a)).filename=t.uniqueValue,200===r.status){n.onCompleted(u,!0)}else pt.length?ht[pt[0][0]](e,t,n,o):n.onError(\"upload fail\")}},r.open(t.method,s,!0),r.setRequestHeader(\"authorization\",c.bosToken),r.setRequestHeader(\"x-bce-date\",c.bosDate),r.send(o)},aliyun:function(e,t,n,o){if(o.size>vt)throw new Error(\"the file size is over 5GB!\");const a=new FormData;a.set(\"file\",e.get(\"file\")),a.set(\"key\",e.get(\"key\")),a.set(\"token\",e.get(\"token\"));const r=pt[0][1];pt.shift(),e=e||nt,t=(t=t||{})||ot;var i=new XMLHttpRequest,s=St()+t.ossBucketName+\".\"+r;i.upload&&t.support_options&&(i.upload.onprogress=function(e){n.onProgress(e.loaded,e.total)});i.onreadystatechange=function(){if(4===i.readyState){var e=i.responseText||\"{}\";(e=JSON.parse(e)).name=t.uniqueValue,e.filename=t.uploadFileName,e.uploadMethod=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod?_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod.ALI:\"\",200===i.status?n.onCompleted(e):pt.length?ht[pt[0][0]](a,t,n,o):n.onError(\"upload fail\")}},i.open(t.method,s,!0),console.log(\"ali:url\",s);var c=t.aliHeader||{};e.set(\"OSSAccessKeyId\",c.osskeyId),e.set(\"policy\",c.ossPolicy),e.set(\"Signature\",c.ossSign),e.set(\"success_action_status\",200),e.delete(\"key\"),e.append(\"key\",t.uploadFileName),e.delete(\"file\"),e.append(\"file\",o),i.send(e)},s3:function(e,t,n,o){var a=new FormData,r=new XMLHttpRequest,i=St();const s=pt[0][1];var c=i+t.s3BucketName+\".\"+s;console.log(\"uploadS3:url\",c),pt.shift(),r.upload&&t.support_options&&(r.upload.onprogress=function(e){n.onProgress(e.loaded,e.total)});r.onreadystatechange=function(){if(4===r.readyState){var a=r.responseText||\"{}\";if((a=JSON.parse(a)).name=t.uniqueValue,a.filename=t.uploadFileName,a.uploadMethod=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod.AWS,console.log(\"UploadMethod:\",_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod),200===r.status||204===r.status)n.onCompleted(a);else if(pt.length){const a=new FormData;a.set(\"file\",e.get(\"file\")),a.set(\"key\",e.get(\"key\")),a.set(\"token\",e.get(\"token\")),ht[pt[0][0]](a,t,n,o)}else n.onError(\"upload fail\")}},r.open(t.method,c,!0);var u=t?t.s3Header:{},d=o&&o.type;\"text/html\"===d?a.set(\"Content-Disposition\",\"inline;\"):a.set(\"Content-Disposition\",\"attachment;\");a.set(\"Content-Type\",d),a.set(\"x-amz-credential\",u.s3Credential),a.set(\"x-amz-algorithm\",u.s3Algorithm),a.set(\"x-amz-date\",u.s3Date),a.set(\"policy\",u.s3Policy),a.set(\"x-amz-signature\",u.s3Signature),a.set(\"key\",t.uploadFileName),a.set(\"file\",o),r.send(a)},stc:function(e,t,n,o){new FormData;var a=new XMLHttpRequest;St();var r=\"https://\"+pt[0][1]+\"/\"+t.stcBucketName+\"/\"+t.uploadFileName;pt.shift(),a.upload&&t.support_options&&(a.upload.onprogress=function(e){n.onProgress(e.loaded,e.total)});a.onreadystatechange=function(){if(4===a.readyState){var r=a.responseText||\"{}\";if((r=JSON.parse(r)).name=t.uniqueValue,r.filename=t.uploadFileName,r.uploadMethod=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod?_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod.STC:\"\",200===a.status||204===a.status)n.onCompleted(r);else if(pt.length){const a=new FormData;a.set(\"file\",e.get(\"file\")),a.set(\"key\",e.get(\"key\")),a.set(\"token\",e.get(\"token\")),ht[pt[0][0]](a,t,n,o)}else n.onError(\"upload fail\")}},a.open(\"PUT\",r,!0);var i=t?t.stcHeader:{};a.setRequestHeader(\"Content-Type\",o.type),\"text/html\"===o.type?a.setRequestHeader(\"Content-Disposition\",\"inline;\"):a.setRequestHeader(\"Content-Disposition\",\"attachment;\");a.setRequestHeader(\"Authorization\",i.stcAuthorization),a.setRequestHeader(\"x-amz-content-sha256\",i.stcContentSha256),a.setRequestHeader(\"x-amz-date\",i.stcDate),a.send(o)}},pt=[],vt=5368709120;function It(e,t){for(var n in e)t(n,e[n])}function St(){var e=\"https://\";return\"http:\"!==location.protocol&&\"file:\"!==location.protocol||(e=\"http://\"),e}function Ct(e,t,n){var o,a,r=e&&e.type||\"text/plain\",i=r.indexOf(\"image\")>-1?1:4,s=Math.ceil(e.size/t.stc_chunk_size),c=t&&JSON.parse(t.ossConfig?t.ossConfig:\"\");Array.isArray(c)||(c=[]);var u=c.find((e=>Object.keys(e).includes(\"stc\"))),d=\"uploads\";te.imClient.getFileToken(i,o,\"POST\",d).then((function(e){o=e.fileName,a=\"https://\"+u.stc+\"/\"+t.stcBucketName+\"/\"+o,console.log(\"uploadStcMultipart:url\",a);var i=new XMLHttpRequest;i.open(\"POST\",a+\"?\"+d,!0),\"text/html\"===r?i.setRequestHeader(\"Content-Disposition\",\"inline;\"):i.setRequestHeader(\"Content-Disposition\",\"attacshment;\"),i.setRequestHeader(\"Authorization\",e&&e.stcAuthorization),i.setRequestHeader(\"x-amz-content-sha256\",e&&e.stcContentSha256),i.setRequestHeader(\"x-amz-date\",e&&e.stcDate),i.setRequestHeader(\"Content-Type\",r),i.send(),i.onreadystatechange=function(e){if(4===i.readyState){var t=i.response.match(/(?:<UploadId>)(\\S*?)(?:<\\/UploadId>)/);console.log(\"uploadId\",t),200===i.status||204===i.status?function(e){for(var t=[],n=1;n<=s;n++)t.push(m(e,n));f(e,t)}(Array.isArray(t)&&t[1]):n.onError(\"uploadStcMultipart:did not get uploadId\")}}}),(function(e){n.onError(\"uploadStcMultipart:\"+e)}));var l=[],g=new Map;function f(c,u){u&&Array.isArray(u)&&0!==u.length&&Promise.all(u).then((()=>{var u=\"uploadId=\"+c;if(g.size===s)te.imClient.context.getFileToken(i,o,\"POST\",u).then((function(o){console.log(\"onSuccess\",o),console.log(\"onSuccess:uploadId\",c);var i=new XMLHttpRequest;i.open(\"POST\",a+\"?\"+u,!0),i.setRequestHeader(\"Authorization\",o&&o.stcAuthorization),i.setRequestHeader(\"x-amz-content-sha256\",o&&o.stcContentSha256),i.setRequestHeader(\"x-amz-date\",o&&o.stcDate),i.setRequestHeader(\"Content-Type\",r);var s=\"<CompleteMultipartUpload xmlns='http://s3.amazonaws.com/doc/2006-03-01/'>\",d=Array.from(g.keys()||[]).sort(((e,t)=>e-t));console.log(\"keys\",d),d.map((e=>{s+=`<Part><ETag>${g.get(e)}</ETag><PartNumber>${e}</PartNumber></Part>`})),s+=\"</CompleteMultipartUpload>\",i.send(s),console.log(\"xml\",s),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||204===i.status){var o={};o.name=e.name,o.filename=t.uploadFileName,o.uploadMethod=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.UploadMethod.STC,n.onCompleted(o)}else n.onError(\"uploadStcMultipart:upload does not end\")}}),(function(e){n.onError(\"uploadStcMultipart:\"+e)}));else{var d=[];for(var h of l)d.push(m(c,h));f(c,d)}}),(e=>{console.error(e),n.onError(\"uploadStcMultipart: chunkFiles upload failed and those will reupload\");var t=[];for(var o of l)t.push(m(c,o));f(c,t)}))}function m(n,s){return new Promise(((c,u)=>{var d=\"partNumber=\"+s+\"&uploadId=\"+n;te.imClient.context.getFileToken(i,o,\"PUT\",d).then((function(n){console.log(\"signature \"+s+\" onSuccess\",n);var o=e&&e.slice((s-1)*t.stc_chunk_size,s*t.stc_chunk_size);console.log(\"fileChunk:size\",o.size);var i=new XMLHttpRequest;i.open(\"PUT\",a+\"?\"+d,!0),i.setRequestHeader(\"Authorization\",n&&n.stcAuthorization),i.setRequestHeader(\"x-amz-content-sha256\",n&&n.stcContentSha256),i.setRequestHeader(\"x-amz-date\",n&&n.stcDate),i.setRequestHeader(\"Content-Type\",r),i.send(o),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||204===i.status){var e=i.getResponseHeader(\"etag\");console.log(\"etag:\"+s,e),g.set(s,e),c(e)}else l.includes(s)||l.push(s),u(s)}}),(function(e){console.log(\"getETags:签名验证失败\"),l.includes(s)||l.push(s),u(s)}))}))}}var Tt={form:function(e,t){var n=new FormData;if(t.unique_key){var o=e.name.substr(e.name.lastIndexOf(\".\")),a=Et()+o;n.append(t.unique_key,a),t.uniqueValue=a}return n.append(t.file_data_name,e),yt(t.multi_parmas,(function(e,t){n.append(e,t)})),n},json:function(e,t){var n={};if(t.unique_key){var o=e.name.substr(e.name.lastIndexOf(\".\")),a=Et()+o;n[t.unique_key]=a,t.uniqueValue=a}return n[t.file_data_name]=e,yt(t.multi_parmas,(function(e,t){n[e]=t})),JSON.stringify(n)},data:function(e,t){return e}};function Et(){var e=(new Date).getTime();return\"xxxxxx4xxxyxxxxxxx\".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(\"x\"===t?n:3&n|8).toString(16)}))}function yt(e,t){for(var n in e)t(n,e[n])}var Nt,Rt=0;function Ot(e){this.options=function(e){var t={domain:\"\",method:\"POST\",file_data_name:\"file\",unique_key:\"key\",base64_size:4194304,chunk_size:4194304,bos_chunk_size:4294967296,stc_chunk_size:10485760,headers:{},multi_parmas:{},query:{},support_options:!0,data:Tt.form,genUId:Et};if(!e||!e.domain)throw new Error(\"domain is null\");for(var n in e)t[n]=e[n];return t}(e),this.setOptions=function(e){var t=this;yt(e,(function(e,n){t.options[e]=n}))},console.log(\"options\",e),this.upload=function(e,t){if(e){var n=this;!function(e,t,n){if(nt=e,ot=t,pt=[],t.ossConfig){const e=JSON.parse(t.ossConfig);let n,o,a=\"\";const r=[];e.forEach((e=>{const t=Number(e.p)-1;for(const i in e)\"aliyun\"===i&&(a=e[i]),\"s3\"===i&&(n=e[i]),\"stc\"===i&&(o=e[i]),\"p\"!==i&&(r[t]=[i,e[i]])})),r.forEach((function(e){e&&pt.push(e)})),e.length!==pt.length&&(pt=[[\"qiniu\",t.domain],[\"baidu\",t.uploadHost.bos],[\"aliyun\",a],[\"s3\",n],[\"stc\",o]])}else pt=[[\"qiniu\",t.domain],[\"baidu\",t.uploadHost.bos]];var o;if(t.ossConfig){var a=t&&JSON.parse(t.ossConfig);Array.isArray(a)||(a=[]),o=a.find((e=>Object.keys(e).includes(\"stc\")))}if(o&&1===parseInt(o.p)&&e.size>=4194304)Ct(e,t,n);else{var r=t.data(e,t);ht[pt[0][0]](r,t,n,e)}}(e,this.options,{onProgress:function(e,n,o){if(Nt=e,o){Nt=Rt+e/n*(n-Rt)}else Rt=Nt;t.onProgress(Nt,n)},onCompleted:function(e){t.onCompleted(e)},onError:function(e){t.onError(e)},onOpen:function(e){n.xhr=e}})}else t.onError(\"upload file is null.\")},this.cancel=function(){this.xhr&&this.xhr.abort()}}var wt={init:function(e){return new Ot(e)},dataType:Tt,resize:function(e,t,n){e.type;var o=document.createElement(\"canvas\"),a=new FileReader;a.readAsDataURL(e),a.onload=function(e){var a=e.target.result,r=new Image;r.src=a;var i=r.width,s=r.height,c=function(e,t){var n=1,o=e.width,a=t.maxWidth||0;a>0&&o>a&&(n=a/o);var r=e.height,i=t.maxHeight||0;if(i>0&&r>i){var s=i/r;n=Math.min(n,s)}var c=t.maxSize||0,u=Math.ceil(e.size/1e3);if(u>c){var d=c/u;n=Math.min(n,d)}return n}({width:i,height:s,size:e.total},t),u=a;c<1&&(u=function(e,t,n){o.width=t,o.height=n,o.getContext(\"2d\").drawImage(e,0,0,t,n);var a=\"image/jpg\";return o.toDataURL(a)}(r,i*c,s*c)),n(u)}}};const Mt=function(e,t,n){var o=document.createElement(\"canvas\"),a=o.getContext(\"2d\"),r=new Image;r.onload=function(){var i=function(e,t,n){var o,a,r,i=e<t,s=0,c=0;return(i?t/e:e/t)>n.scale?(i?(a=100,c=((r=t/(o=e/100))-n.maxHeight)/2):(r=100,s=((a=e/(o=t/100))-n.maxWidth)/2),{w:a,h:r,x:-s,y:-c}):(i?(o=t/n.maxHeight,r=n.maxHeight,a=e/o):(o=e/n.maxWidth,a=n.maxWidth,r=t/o),{w:a,h:r,x:-s,y:-c})}(r.width,r.height,t);o.width=i.w>t.maxWidth?t.maxWidth:i.w,o.height=i.h>t.maxHeight?t.maxHeight:i.h,a.drawImage(r,i.x,i.y,i.w,i.h);try{var s=o.toDataURL(e.type,t.quality),c=new RegExp(\"^data:image/[^;]+;base64,\");s=s.replace(c,\"\"),n(s)}catch(e){throw new Error(e)}},r.src=\"string\"==typeof e?\"data:image/jpg;base64,\"+e:function(e){var t=window.URL||window.webkitURL;return t?t.createObjectURL(e):\"\"}(e)},_t=function(e,t){var n=e.file,o=e.compress;Mt(n,o,t)},Ut=function(e,t){if(e.getToken)e.getToken((function(n,o){o=o||{},e.multi_parmas||(e.multi_parmas={}),e.multi_parmas.token=n,e.uploadHost||(e.uploadHost={}),e.uploadHost.bos=o.bos,e.ossConfig=o.ossConfig,e.bosHeader||(e.bosHeader={}),e.bosHeader.bosDate=o.bosDate,e.bosHeader.bosToken=o.bosToken,e.bosUploadPath=o.path,e.aliHeader={},e.aliHeader.osskeyId=o.osskeyId,e.aliHeader.ossPolicy=o.ossPolicy,e.aliHeader.ossSign=o.ossSign,e.ossBucketName=o.ossBucketName,e.uploadFileName=o.fileName,e.s3Header={},e.s3Header.s3Credential=o.s3Credential,e.s3Header.s3Algorithm=o.s3Algorithm,e.s3Header.s3Date=o.s3Date,e.s3Header.s3Policy=o.s3Policy,e.s3Header.s3Signature=o.s3Signature,e.s3BucketName=o.s3BucketName,e.stcHeader={},e.stcHeader.stcAuthorization=o.stcAuthorization,e.stcHeader.stcContentSha256=o.stcContentSha256,e.stcHeader.stcDate=o.stcDate,e.stcBucketName=o.stcBucketName,e.headers||(e.headers={}),e.base64&&(e.headers[\"Content-type\"]=\"application/octet-stream\",e.headers.Authorization=\"UpToken \"+n),console.log(\"data\",o);var a=wt.init(e);t(a)}));else{e.headers||(e.headers={}),e.base64&&(e.headers[\"Content-type\"]=\"application/octet-stream\");var n=wt.init(e);t(n)}};var xt,bt,At=function(e,t,n){t.upload(e.file,{onError:function(e){n.onError(e)},onProgress:function(e,t){n.onProgress(e,t)},onCompleted:function(t){t.filename||(t.filename=t.hash);var o=e.compressThumbnail||_t;e.compress?o(e,(function(e){t.thumbnail=e,n.onCompleted(t)})):n.onCompleted(t)}})},Pt=function(e){var t=this;this.instance=e,this.upload=function(e,n){At({file:e},t.instance,n)},this.cancel=function(){t.instance.cancel()}},Lt=function(e,t){var n=this;this.cfg=t,this.instance=e,this.upload=function(e,t){var o={file:e,compress:n.cfg};At(o,n.instance,t)},this.cancel=function(){n.instance.cancel()}},Dt=function(e,t){Ut(e,(function(n){var o={maxHeight:e.maxHeight||160,maxWidth:e.maxWidth||160,quality:e.quality||.5,scale:e.scale||2.4},a=new Lt(n,o);t(a)}))},Ht=function(e,t){Ut(e,(function(e){var n=new Pt(e);t(n)}))},kt=Dt;wt.dataType;function Gt(e){return xt=xt||new AudioContext,new Promise((function(t,n){xt.decodeAudioData(e,(function(e){t({duration:e.duration,length:e.length})}),n)}))}function Bt(e,t,n,o){return new Promise((function(a){te.imClient.context.getFileToken(e,t,n,o).then((function(e){a({code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS,data:e})})).catch((function(e){a({code:e,msg:oe[e]})}))}))}function qt(e,t,n,o,a){return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"fileType\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isValidFileType,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"filename\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"saveName\",n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"serverType\",a,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),new Promise((function(i){te.imClient.context.getFileUrl(e,t,n,o,a).then((function(e){i({code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS,data:e})})).catch((function(e){i({code:e})}))}))}function Ft(e,t,n){return R(this,void 0,void 0,(function(){var o,a,c,u,d,l,g,f,h;return O(this,(function(p){switch(p.label){case 0:return n=n||{},t instanceof Ze==!1?(w.warn(\"send message fail -> message parameter is not an instance of BaseMessage\"),[2,ne.ILLGAL_PARAMS]):((0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",null==e?void 0:e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),o=e.conversationType,a=e.targetId,c=e.channelId,u=\"conversationType:\"+o+\",targetId:\"+a,w.debug(\"send message  ->\"+u),(d=Object.assign(n,t)).channelId=c||\"\",[4,te.imClient.context.sendMessage(o,a,d)]);case 1:return l=p.sent(),g=l.code,f=l.data,g===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(h=Z(f),[2,{code:g,data:h}]):(w.warn(\"send message fail ->\"+g+\":\"+oe[g]+\",\"+u),[2,{code:g,msg:oe[g],data:Z({isMentioned:!!n.isMentioned,content:t.content,messageType:t.messageType,isPersited:t.isPersited||!1,isCounted:t.isCounted||!1,disableNotification:!!(null==n?void 0:n.disableNotification),canIncludeExpansion:!!(null==n?void 0:n.canIncludeExpansion),expansion:(null==n?void 0:n.expansion)||null,conversationType:o,targetId:a,channelId:c||\"\",senderUserId:te.imClient.context.getCurrentUserId(),messageUId:\"\",messageDirection:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.MessageDirection.SEND,isOffLineMessage:!1,sentTime:(null==f?void 0:f.sentTime)||0,receivedTime:0,isStatusMessage:n.isStatusMessage||!1,receivedStatus:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ReceivedStatus.UNREAD})}])}}))}))}function Vt(e,t,n){return Ft(e,new st(t),n)}function zt(e,t){return function(n,o,a,i){return new Promise((function(s){var c;!function(e,t,n,o){var a,r=this;if(void 0===t&&(t=_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.FILE),a=t===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.IMAGE?_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.IMAGE:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.FILE,!bt){bt=\"upload.qiniup.com\";var i=te.imClient.context.getInfoFromCache();if(i&&i.ossConfig)try{var s=JSON.parse(i.ossConfig).find((function(e){return void 0!==e.qiniu}));s&&(bt=s.qiniu)}catch(e){}}var c=N({domain:bt,getToken:function(e){te.imClient.context.getFileToken(a).then((function(t){e(t.token,t)})).catch((function(e){n.onFail(e)}))}},o);(a===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.IMAGE?kt:Ht)(c,(function(o){o.upload(e,{onProgress:function(e,t){var o,a=Math.floor(e/t*100);null===(o=n.onProgress)||void 0===o||o.call(n,a)},onCompleted:function(o){return R(r,void 0,void 0,(function(){var r=this;return O(this,(function(i){return qt(a,o.filename,o.name,o,o.uploadMethod).then((function(i){return R(r,void 0,void 0,(function(){var r,s;return O(this,(function(c){return 0!==i.code?(n.onFail(i),[2]):((r=i.data).type=e.type,r.name=o.name||o.filename,t===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.AUDIO?(\"function\"==typeof e.arrayBuffer?e.arrayBuffer().then(Gt).then((function(e){Object.assign(r,e),n.onSuccess(r)}),(function(){n.onSuccess(r)})):((s=new FileReader).onload=function(){s.result?Gt(s.result).then((function(e){Object.assign(r,e),n.onSuccess(r)}),(function(){n.onSuccess(r)})):n.onSuccess(r)},s.onerror=function(){r.duration=0,n.onSuccess(r)},s.readAsArrayBuffer(e)),[2]):(a===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.IMAGE&&(r.thumbnail=o.thumbnail),n.onSuccess(r),[2]))}))}))})).catch((function(e){n.onFail(e)})),[2]}))}))},onError:function(e){n.onFail(e)}})}))}(o.file,e,{onProgress:null==a?void 0:a.onProgress,onSuccess:function(e){var r,c=(null===(r=null==a?void 0:a.onComplete)||void 0===r?void 0:r.call(a,{url:e.downloadUrl}))||t(e,o);Ft(n,c,i).then(s)},onFail:function(e){s({code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.UPLOAD_FILE_FAILED,msg:e||_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.UPLOAD_FILE_FAILED]})}},(null===(c=i)||void 0===c?void 0:c.thumbnailConfig)||{})}))}}var Kt=zt(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.FILE,(function(e,t){return new ut({name:e.name,size:t.file.size,type:t.file.type,fileUrl:e.downloadUrl,user:t.user,extra:t.extra})})),jt=zt(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.IMAGE,(function(e,t){return new at({content:e.thumbnail,imageUri:e.downloadUrl,user:t.user,extra:t.extra})})),Xt=zt(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.AUDIO,(function(e,t){return new rt({remoteUrl:e.downloadUrl,duration:e.duration,type:e.type,user:t.user,extra:t.extra})})),Wt=zt(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.SIGHT,(function(e,t){return new it({sightUrl:e.downloadUrl,content:t.thumbnail,duration:t.duration,size:t.file.size||e.size,name:t.name||e.name,user:t.user,extra:t.extra})}));function Jt(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c;return O(this,(function(u){switch(u.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.timestamp\",null==t?void 0:t.timestamp,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.count\",null==t?void 0:t.count,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.order\",null==t?void 0:t.order,(function(e){return 0===e||1===e})),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",null==e?void 0:e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"get history message ->\"+n),[4,te.imClient.context.getHistoryMessage(e.conversationType,e.targetId,null==t?void 0:t.timestamp,null==t?void 0:t.count,null==t?void 0:t.order,null==e?void 0:e.channelId)];case 1:return o=u.sent(),a=o.code,i=o.data,a===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&i?(c=i.list.map((function(e){return Z(e)})),[2,{code:a,data:{list:c,hasMore:i.hasMore}}]):(w.warn(\"get history message fail ->\"+a+\":\"+oe[a]+\",\"+n),[2,{code:a,msg:oe[a]}])}}))}))}function Yt(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c;return O(this,(function(u){switch(u.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.timestamp\",null==t?void 0:t.timestamp,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.count\",null==t?void 0:t.count,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.order\",null==t?void 0:t.order,(function(e){return 0===e||1===e})),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",null==e?void 0:e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"get history message ->\"+n),[4,te.imClient.context.getRemoteHistoryMessages(e.conversationType,e.targetId,(null==t?void 0:t.timestamp)||0,(null==t?void 0:t.count)||20,(null==t?void 0:t.order)||0,e.channelId||\"\")];case 1:return o=u.sent(),a=o.code,i=o.data,a===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&i?(c=i.list.map((function(e){return Z(e)})),[2,{code:a,data:{list:c,hasMore:i.hasMore}}]):(w.warn(\"get history message fail ->\"+a+\":\"+oe[a]+\",\"+n),[2,{code:a,msg:oe[a]}])}}))}))}function Qt(e,t,n,o){return R(this,void 0,void 0,(function(){var a,r,i,s,c;return O(this,(function(u){switch(u.label){case 0:return a={targetId:e,conversationType:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConversationType.PRIVATE,channelId:o},r=new Ze(\"RC:ReadNtf\",{messageUId:t,lastMessageSendTime:n,type:1}),[4,Ft(a,r)];case 1:return i=u.sent(),s=i.code,c=i.msg,0===s?[2,{code:s}]:[2,{code:s,msg:c}]}}))}))}function $t(e,t,n){return R(this,void 0,void 0,(function(){var o,a,r,i,c;return O(this,(function(u){switch(u.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"messageUId\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"channelId\",n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),o=\"messageUId:\"+t+\",targetId:\"+e,w.debug(\"send read receipt message ->\"+o),a=new Ze(\"RC:RRReqMsg\",{messageUId:t}),[4,Ft({targetId:e,conversationType:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConversationType.GROUP,channelId:n},a)];case 1:return r=u.sent(),i=r.code,c=r.msg,0===i?[2,{code:i}]:[2,{code:i,msg:c}]}}))}))}function Zt(e,t,n){return R(this,void 0,void 0,(function(){return O(this,(function(e){throw new Error(\"This method is deprecated, please use method sendReadReceiptResponseV2.\")}))}))}function en(e,t,n){return R(this,void 0,void 0,(function(){var o,a,i,c,u,d,l;return O(this,(function(g){switch(g.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"messageList\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.OBJECT,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"channelId\",n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),Object.keys(t).forEach((function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(e,t[e],_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.ARRAY)})),o={targetId:e,conversationType:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConversationType.GROUP,channelId:n},i=te.imClient.context.getInfoFromCache(),0!==(c=(null==i?void 0:i.grpRRVer)||0)?[3,2]:(u=new Ze(\"RC:RRRspMsg\",{receiptMessageDic:t}),[4,Ft(o,u)]);case 1:return a=g.sent(),[3,4];case 2:return 1!==c?[3,4]:(d=[],Object.keys(t).forEach((function(e){t[e].forEach((function(e){-1===d.indexOf(e)&&d.push(e)}))})),d.length?[4,te.imClient.context.sendReadReceiptMessage(e,d,n)]:(w.warn(\"Error in parameter messageList.\"),[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.PARAMETER_ERROR}]));case 3:a=g.sent(),g.label=4;case 4:return(l=a.code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:l}]:(w.warn(\"send read receipt message fail ->\"+l+\":\"+oe[l]),[2,{code:l,msg:oe[l]}])}}))}))}function tn(e,t){return R(this,void 0,void 0,(function(){var n,o,a,r;return O(this,(function(i){switch(i.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.type\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"lastMessageSendTime\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",null==e?void 0:e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),n=new Ze(\"RC:SRSMsg\",{lastMessageSendTime:t}),[4,Ft(e,n)];case 1:return o=i.sent(),a=o.code,r=o.msg,0===a?[2,{code:a}]:[2,{code:a,msg:r}]}}))}))}function nn(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c;return O(this,(function(u){switch(u.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.messageUId\",t.messageUId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.sentTime\",t.sentTime,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.disableNotification\",null==t?void 0:t.disableNotification,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.pushConfig\",null==t?void 0:t.pushConfig,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.OBJECT),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",null==e?void 0:e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),n={user:t.user,channelId:e.channelId||\"\",disableNotification:null==t?void 0:t.disableNotification,pushConfig:null==t?void 0:t.pushConfig},o=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId+\",messageUId:\"+t.messageUId,w.debug(\"recall message ->\"+o),[4,te.imClient.context.recallMessage(e.conversationType,e.targetId,t.messageUId,t.sentTime,n)];case 1:return a=u.sent(),i=a.code,c=a.data,i===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&c?[2,{code:i,data:Z(c)}]:(w.warn(\"recall message fail ->\"+i+\":\"+oe[i]+\",\"+o),[2,{code:i,msg:oe[i]}])}}))}))}function on(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options\",t,(function(e){return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e.length}),!0),t.forEach((function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.messageUId\",e.messageUId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.sentTime\",e.sentTime,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.messageDirection\",e.messageDirection,(function(e){return 1===e||2===e}),!0)})),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",null==e?void 0:e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"delete messages ->\"+n),[4,te.imClient.context.deleteRemoteMessage(e.conversationType,e.targetId,t,e.channelId)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"delete message fail ->\"+o+\":\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS}]}}))}))}function an(e,t){return R(this,void 0,void 0,(function(){var n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.timestamp\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",null==e?void 0:e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"clear message ->\"+n),[4,te.imClient.context.deleteRemoteMessageByTimestamp(e.conversationType,e.targetId,t,e.channelId)];case 1:return(o=a.sent())!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"clear message ->\"+o+\":\"+oe[o]+\",\"+n),[2,{code:o,msg:oe[o]}]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS}]}}))}))}function rn(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c,u,d,l;return O(this,(function(g){switch(g.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"expansion\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.OBJECT,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"message\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.OBJECT,!0),n=t.conversationType,o=t.targetId,a=t.messageUId,i=t.canIncludeExpansion,c=t.expansion,u=t.channelId,d=\"conversationType:\"+n+\",targetId:\"+o+\",messageUId:\"+a,w.debug(\"update message expansion ->\"+d),[4,te.imClient.context.sendExpansionMessage({conversationType:n,targetId:o,messageUId:a,expansion:e,canIncludeExpansion:i,originExpansion:c,channelId:u})];case 1:return(l=g.sent().code)!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"update message expansion fail ->\"+l+\":\"+oe[l]+\",\"+d),[2,{code:l,msg:oe[l]}]):[2,{code:l}]}}))}))}function sn(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c,u,d;return O(this,(function(l){switch(l.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"keys\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.ARRAY,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"message\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.OBJECT,!0),n=t.conversationType,o=t.targetId,a=t.messageUId,i=t.canIncludeExpansion,c=t.channelId,u=\"conversationType:\"+n+\",targetId:\"+o+\",messageUId:\"+a,w.debug(\"remove message expansion ->\"+u),[4,te.imClient.context.sendExpansionMessage({conversationType:n,targetId:o,messageUId:a,canIncludeExpansion:i,keys:e,channelId:c})];case 1:return(d=l.sent().code)!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(w.warn(\"remove message expansion fail ->\"+d+\":\"+oe[d]+\",\"+u),[2,{code:d,msg:oe[d]}]):[2,{code:d}]}}))}))}function cn(e,t){return R(this,void 0,void 0,(function(){var n,o,a,i,c;return O(this,(function(u){switch(u.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"typingContentType\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),n=\"conversationType:\"+e.conversationType+\",targetId:\"+e.targetId,w.debug(\"send typing status message ->\"+n),o={messageType:\"RC:TypSts\",content:{typingContentType:t},isStatusMessage:!0,channelId:e.channelId},[4,te.imClient.context.sendMessage(e.conversationType,e.targetId,o)];case 1:return a=u.sent(),i=a.code,c=a.data,i===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:i,data:Z(c)}]:(w.warn(\"send typing status message fail ->\"+i+\":\"+oe[i]+\",\"+n),[2,{code:i,msg:oe[i]}])}}))}))}function un(e,t,n){return R(this,void 0,void 0,(function(){var o,a,i,c;return O(this,(function(u){switch(u.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"messageUId\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),o=\"messageUId:\"+t+\",targetId:\"+e,w.debug(\"get message reader ->\"+o),[4,te.imClient.context.getMessageReader(e,t,n)];case 1:return a=u.sent(),i=a.code,c=a.data,i===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:i,data:c}]:(w.warn(\"get message reader fail ->\"+i+\":\"+oe[i]+\",\"+o),[2,{code:i,msg:oe[i]}])}}))}))}function dn(e,t,n,o,a){return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"messageType\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"isPersited\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"isCounted\",n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"isStatusMessage\",a,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN,!1),te.imClient.context.registerMessageType(e,t,n,o,a),et(e,t,n)}function ln(e){return R(this,void 0,void 0,(function(){var t,n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?((0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",null==e?void 0:e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),[4,te.imClient.context.getFirstUnreadMessage(e.conversationType,e.targetId,e.channelId)]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return t=a.sent(),n=t.code,o=t.data,n===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n,data:o}]:(w.warn(\"insertMessage ->code:\"+n+\",targetId:\"+e.targetId),[2,{code:n,msg:oe[n]}])}}))}))}function gn(e,t,n){return void 0===n&&(n={}),R(this,void 0,void 0,(function(){var o,a,i,s,c,u,d,l,g,f,m,h,p,v,I,S;return O(this,(function(T){switch(T.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?(o=t.senderUserId,a=t.messageType,i=t.content,s=t.messageDirection,c=t.messageUId,u=t.canIncludeExpansion,d=t.expansion,l=t.disableNotification,g=t.sentTime,f=t.sentStatus,w.info(\"insertMessage ->targetId:\"+e.targetId+\",conversationType:\"+e.conversationType),m=n.isUnread,h=n.searchContent,p={senderUserId:o,messageType:a,content:i,messageDirection:s,sentTime:g,sentStatus:f,searchContent:h,isUnread:m,messageUId:c,disableNotification:l,canIncludeExpansion:u,expansionMsg:JSON.stringify(d),channelId:e.channelId||\"\"},[4,te.imClient.context.insertMessage(e.conversationType,e.targetId,p)]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return v=T.sent(),I=v.code,S=v.data,I===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:I,data:Z(S)}]:(w.warn(\"insertMessage ->code:\"+I+\",targetId:\"+e.targetId),[2,{code:I,msg:oe[I]}])}}))}))}function fn(e){return R(this,void 0,void 0,(function(){var t,n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?[4,te.imClient.context.getMessage(e)]:[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return t=a.sent(),n=t.code,o=t.data,n===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n,data:Z(o)}]:(w.warn(\"getMessage ->code:\"+n+\",messageId:\"+e),[2,{code:n,msg:oe[n]}])}}))}))}function mn(e){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)())return{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]};(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0);var t=te.imClient.context.getUnreadMentionedMessages(e.conversationType,e.targetId),n=[];return t&&t.length&&t.forEach((function(e){return n.push(Z(e))})),{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS,data:n}}function hn(e,t,n,o){return R(this,void 0,void 0,(function(){var a,i,c,u;return O(this,(function(d){switch(d.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?((0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"keyword\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"timestamp\",n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"count\",o,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),1,[4,te.imClient.context.searchMessageByContent(e.conversationType,e.targetId,t,n,o,1,e.channelId)]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return a=d.sent(),i=a.code,c=a.data,i===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(u=[],(null==c?void 0:c.messages)&&c.messages.length&&c.messages.forEach((function(e){return u.push(Z(e))})),[2,{code:i,data:{messages:u,count:null==c?void 0:c.count}}]):(w.warn(\"searchMessages ->code:\"+i+\",targetId:\"+e.targetId),[2,{code:i,msg:oe[i]}])}}))}))}function pn(e,t,n){return R(this,void 0,void 0,(function(){var o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?((0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"timestamp\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"cleanSpace\",n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN),[4,te.imClient.context.deleteMessagesByTimestamp(e.conversationType,e.targetId,t,n,e.channelId)]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return(o=a.sent())===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:o}]:(w.warn(\"deleteLocalMessagesByTimestamp ->code:\"+o+\",targetId:\"+e.targetId),[2,{code:o,msg:oe[o]}])}}))}))}function vn(e){return R(this,void 0,void 0,(function(){var t;return O(this,(function(n){switch(n.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?(w.info(\"clearMessages ->targetId:\"+e.targetId+\",conversationType:\"+e.conversationType),[4,te.imClient.context.clearMessages(e.conversationType,e.targetId,e.channelId)]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return(t=n.sent())===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:t}]:(w.warn(\"clearMessages ->code:\"+t+\",targetId:\"+e.targetId),[2,{code:t,msg:oe[t]}])}}))}))}function In(e,t,n,o){return R(this,void 0,void 0,(function(){var a,i,s;return O(this,(function(c){switch(c.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?(w.info(\"searchConversationByContent ->keyword:\"+e),[4,te.imClient.context.searchConversationByContent(e,n,o,t)]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return a=c.sent(),i=a.code,s=a.data,i===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:i,data:s}]:(w.warn(\"searchConversationByContent ->code:\"+i+\",keyword:\"+e),[2,{code:i,msg:oe[i]}])}}))}))}function Sn(e,t){return R(this,void 0,void 0,(function(){var n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?(w.info(\"clearUnreadCountByTimestamp ->targetId:\"+e.targetId+\",conversationType:\"+e.conversationType),[4,te.imClient.context.clearUnreadCountByTimestamp(e.conversationType,e.targetId,t,e.channelId)]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return(n=o.sent())===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n}]:(w.warn(\"clearUnreadCountByTimestamp ->code:\"+n+\",targetId:\"+e.targetId),[2,{code:n,msg:oe[n]}])}}))}))}function Cn(e,t){return R(this,void 0,void 0,(function(){var n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.usingCppEngine)()?((0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"messageId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"receivedStatus\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),w.info(\"setMessageReceivedStatus ->messageId:\"+e+\",receivedStatus:\"+t),[4,te.imClient.context.setMessageReceivedStatus(e,t)]):[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT,msg:oe[_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.NOT_SUPPORT]}];case 1:return(n=o.sent())===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n}]:(w.warn(\"setMessageReceivedStatus ->code:\"+n+\",messageId:\"+e),[2,{code:n,msg:oe[n]}])}}))}))}function Tn(e){return R(this,void 0,void 0,(function(){var t;return O(this,(function(n){switch(n.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tag.tagId\",e.tagId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tag.tagId\",e.tagId,(function(e){return e.length<=10})),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tag.tagName\",e.tagName,(function(e){return e.length<=15})),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tag.tagName\",e.tagName,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),w.info(\"createTag ->tagId:\"+e.tagId+\",tagName:\"+e.tagName),[4,te.imClient.context.createTag(e)];case 1:return(t=n.sent().code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:t}]:(w.warn(\"createTag ->code:\"+t+\",tagId:\"+e.tagId),[2,{code:t,msg:oe[t]}])}}))}))}function En(e){return R(this,void 0,void 0,(function(){var t;return O(this,(function(n){switch(n.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),w.info(\"removeTag ->tagId:\"+e),[4,te.imClient.context.removeTag(e)];case 1:return(t=n.sent().code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:t}]:(w.warn(\"removeTag ->code:\"+t+\",tagId:\"+e),[2,{code:t,msg:oe[t]}])}}))}))}function yn(e){return R(this,void 0,void 0,(function(){var t;return O(this,(function(n){switch(n.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tag.tagId\",e.tagId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tag.tagName\",e.tagName,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tag.tagName\",e.tagName,(function(e){return e.length<=15})),w.info(\"updateTag ->tagId:\"+e.tagId+\",tagName:\"+e.tagName),[4,te.imClient.context.updateTag(e)];case 1:return(t=n.sent().code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:t}]:(w.warn(\"updateTag ->code:\"+t+\",tagId:\"+e.tagId),[2,{code:t,msg:oe[t]}])}}))}))}function Nn(){return R(this,void 0,void 0,(function(){var e,t,n;return O(this,(function(o){switch(o.label){case 0:return[4,te.imClient.context.getTagList()];case 1:return e=o.sent(),t=e.code,n=e.data,t===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS,data:n}]:(w.warn(\"getTagList ->code:\"+t),[2,{code:t,msg:oe[t]}])}}))}))}function Rn(e){return R(this,void 0,void 0,(function(){var t,n,o;return O(this,(function(a){switch(a.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),w.info(\"getTagsForConversation ->targetId:\"+e.targetId+\",conversationType:\"+e.conversationType),[4,te.imClient.context.getTagsForConversation(e)];case 1:return t=a.sent(),n=t.code,o=t.data,n===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n,data:o}]:[2,{code:n,msg:oe[n]}]}}))}))}function On(e,t){return R(this,void 0,void 0,(function(){var n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversations\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.ARRAY,!0),t.forEach((function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID)})),w.info(\"addTagForConversations ->tagId:\"+e),[4,te.imClient.context.addTagForConversations(e,t)];case 1:return(n=o.sent().code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n}]:(w.warn(\"addTagForConversations ->code:\"+n+\",tagId:\"+e),[2,{code:n,msg:oe[n]}])}}))}))}function wn(e,t){return R(this,void 0,void 0,(function(){var n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversations\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.ARRAY,!0),t.forEach((function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID)})),w.info(\"removeTagForConversations ->tagId:\"+e),[4,te.imClient.context.removeTagForConversations(e,t)];case 1:return(n=o.sent().code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n}]:(w.warn(\"removeTagForConversations ->code:\"+n+\",tagId:\"+e),[2,{code:n,msg:oe[n]}])}}))}))}function Mn(e,t){return R(this,void 0,void 0,(function(){var n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagIds\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.ARRAY,!0),t.forEach((function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0)})),w.info(\"removeTagsForConversation ->tagIds:\"+t+\",targetId:\"+e.targetId+\",conversationType:\"+e.conversationType),[4,te.imClient.context.removeTagsForConversation(e,t)];case 1:return(n=o.sent().code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n}]:(w.warn(\"removeTagsForConversation ->code:\"+n+\",tagIds:\"+t),[2,{code:n,msg:oe[n]}])}}))}))}function _n(e,t){return R(this,void 0,void 0,(function(){var n;return O(this,(function(o){switch(o.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversations\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.ARRAY,!0),t.forEach((function(e){(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.conversationType\",e.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.targetId\",e.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",e.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID)})),w.info(\"removeTagForConversations ->tagId:\"+e),[4,te.imClient.context.removeTagForConversations(e,t)];case 1:return(n=o.sent().code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:n}]:(w.warn(\"removeTagForConversations ->code:\"+n+\",tagId:\"+e),[2,{code:n,msg:oe[n]}])}}))}))}function Un(e,t,n){return R(this,void 0,void 0,(function(){var o,a,i;return O(this,(function(c){switch(c.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"count\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"startTime\",n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),w.info(\"getConversationListByTag ->tagId:\"+e),[4,te.imClient.context.getConversationListByTag(e,n,t)];case 1:return o=c.sent(),a=o.code,i=o.data,a===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:a,data:i}]:(w.warn(\"getConversationListByTag ->code:\"+a+\",tagId:\"+e),[2,{code:a,msg:oe[a]}])}}))}))}function xn(e,t){return R(this,void 0,void 0,(function(){var n,o,a;return O(this,(function(i){switch(i.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"containMuted\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN,!0),w.info(\"getUnreadCountByTag ->tagId:\"+e),[4,te.imClient.context.getUnreadCountByTag(e,t)];case 1:return n=i.sent(),o=n.code,a=n.data,w.info(o,a),o===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:o,data:a}]:(w.warn(\"getUnreadCountByTag ->code:\"+o+\",tagId:\"+e),[2,{code:o,msg:oe[o]}])}}))}))}function bn(e,t,n){return R(this,void 0,void 0,(function(){var o,a;return O(this,(function(i){switch(i.label){case 0:return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"tagId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.targetId\",t.targetId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.STRING,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.conversationType\",t.conversationType,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.NUMBER,!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"conversation.channelId\",t.channelId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.CHANNEL_ID),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"status.isTop\",n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.AssertRules.BOOLEAN,!0),w.info(\"setConversationStatusInTag ->tagId:\"+e+\",targetId:\"+t.targetId+\",conversationType\"+t.conversationType),[4,te.imClient.context.setConversationStatusInTag(e,t,{isTop:n})];case 1:return o=i.sent(),(a=o.code)===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?[2,{code:a}]:(w.warn(\"setConversationStatusInTag ->code:\"+a+\",tagId:\"+e),[2,{code:a,msg:oe[a]}])}}))}))}zt(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.FileType.COMBINE_HTML,(function(e,t){return new ct({remoteUrl:e.downloadUrl,nameList:t.nameList,summaryList:t.summaryList,conversationType:t.conversationType,user:t.user,extra:t.extra})}));var An={COMET:\"comet\",WEBSOCKET:\"websocket\"},Pn={TEXT:\"RC:TxtMsg\",VOICE:\"RC:VcMsg\",HQ_VOICE:\"RC:HQVCMsg\",IMAGE:\"RC:ImgMsg\",GIF:\"RC:GIFMsg\",RICH_CONTENT:\"RC:ImgTextMsg\",LOCATION:\"RC:LBSMsg\",FILE:\"RC:FileMsg\",SIGHT:\"RC:SightMsg\",COMBINE:\"RC:CombineMsg\",CHRM_KV_NOTIFY:\"RC:chrmKVNotiMsg\",LOG_COMMAND:\"RC:LogCmdMsg\",EXPANSION_NOTIFY:\"RC:MsgExMsg\",REFERENCE:\"RC:ReferenceMsg\",RECALL_MESSAGE_TYPE:\"RC:RcCmd\"};_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.VersionManage.add(\"imlib\",\"5.1.2\"),_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.VersionManage.validEngine(\"~5.1.2\")||w.error(\"The current engine version '\"+_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.VersionManage.getInfo().engine+\"' error，imlib required engine version at least '~5.1.2'.\");\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./node_modules/@rongcloud/imlib-next/dist/index.esm.js?");

/***/ }),

/***/ "./node_modules/@rongcloud/plugin-rtc/dist/index.esm.js":
/*!**************************************************************!*\
  !*** ./node_modules/@rongcloud/plugin-rtc/dist/index.esm.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"RTCJoinType\": () => (/* reexport safe */ _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCJoinType),\n/* harmony export */   \"BackgroundPictureFillMode\": () => (/* binding */ ir),\n/* harmony export */   \"MixLayoutMode\": () => (/* binding */ nr),\n/* harmony export */   \"MixVideoRenderMode\": () => (/* binding */ sr),\n/* harmony export */   \"RCAbstractRoom\": () => (/* binding */ rr),\n/* harmony export */   \"RCAudienceClient\": () => (/* binding */ Rr),\n/* harmony export */   \"RCAudienceLivingRoom\": () => (/* binding */ Tr),\n/* harmony export */   \"RCCameraVideoTrack\": () => (/* binding */ it),\n/* harmony export */   \"RCFrameRate\": () => (/* binding */ Be),\n/* harmony export */   \"RCInnerCDNPullIsHttps\": () => (/* binding */ Sr),\n/* harmony export */   \"RCInnerCDNPullKind\": () => (/* binding */ gr),\n/* harmony export */   \"RCKickReason\": () => (/* binding */ yr),\n/* harmony export */   \"RCLivingRoom\": () => (/* binding */ _r),\n/* harmony export */   \"RCLivingType\": () => (/* binding */ lr),\n/* harmony export */   \"RCLocalAudioTrack\": () => (/* binding */ Qe),\n/* harmony export */   \"RCLocalFileAudioTrack\": () => (/* binding */ tt),\n/* harmony export */   \"RCLocalFileTrack\": () => (/* binding */ Ze),\n/* harmony export */   \"RCLocalFileVideoTrack\": () => (/* binding */ et),\n/* harmony export */   \"RCLocalTrack\": () => (/* binding */ ze),\n/* harmony export */   \"RCLocalVideoTrack\": () => (/* binding */ Xe),\n/* harmony export */   \"RCMCUConfigBuilder\": () => (/* binding */ ar),\n/* harmony export */   \"RCMediaType\": () => (/* binding */ Fe),\n/* harmony export */   \"RCMicphoneAudioTrack\": () => (/* binding */ rt),\n/* harmony export */   \"RCRTCClient\": () => (/* binding */ Er),\n/* harmony export */   \"RCRTCCode\": () => (/* binding */ T),\n/* harmony export */   \"RCRTCLiveRole\": () => (/* binding */ Xt),\n/* harmony export */   \"RCRTCPingResult\": () => (/* binding */ Dt),\n/* harmony export */   \"RCRTCRoom\": () => (/* binding */ mr),\n/* harmony export */   \"RCRemoteAudioTrack\": () => (/* binding */ ot),\n/* harmony export */   \"RCRemoteTrack\": () => (/* binding */ st),\n/* harmony export */   \"RCRemoteVideoTrack\": () => (/* binding */ at),\n/* harmony export */   \"RCResolution\": () => (/* binding */ He),\n/* harmony export */   \"RCScreenVideoTrack\": () => (/* binding */ nt),\n/* harmony export */   \"RCTag\": () => (/* binding */ br),\n/* harmony export */   \"RCTrack\": () => (/* binding */ qe),\n/* harmony export */   \"device\": () => (/* binding */ Ye),\n/* harmony export */   \"helper\": () => (/* binding */ Pr),\n/* harmony export */   \"installer\": () => (/* binding */ kr)\n/* harmony export */ });\n/* harmony import */ var _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @rongcloud/engine */ \"./node_modules/@rongcloud/engine/dist/index.esm.js\");\n\n/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */function S(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}const C=new _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.Logger(\"RCRTC\");var T,I;!function(e){e[e.SUCCESS=1e4]=\"SUCCESS\",e[e.SIGNAL_DISCONNECTED=5e4]=\"SIGNAL_DISCONNECTED\",e[e.PARAMS_ERROR=50001]=\"PARAMS_ERROR\",e[e.REPERT_JOIN_ROOM=50002]=\"REPERT_JOIN_ROOM\",e[e.NOT_IN_ROOM=50003]=\"NOT_IN_ROOM\",e[e.SERVICE_INVALID=50004]=\"SERVICE_INVALID\",e[e.RTC_TOKEN_INVALID=50006]=\"RTC_TOKEN_INVALID\",e[e.SIGNAL_ERROR=53001]=\"SIGNAL_ERROR\",e[e.CREATE_OFFER_FAILED=53003]=\"CREATE_OFFER_FAILED\",e[e.REQUEST_FAILED=53004]=\"REQUEST_FAILED\",e[e.MCU_SERVER_NOT_FOUND=53005]=\"MCU_SERVER_NOT_FOUND\",e[e.BROADCAST_SUB_LIST_NOT_EMPTY=53007]=\"BROADCAST_SUB_LIST_NOT_EMPTY\",e[e.ROOM_HAS_BEEN_DESTROYED=53008]=\"ROOM_HAS_BEEN_DESTROYED\",e[e.NOT_OPEN_VIDEO_AUDIO_SERVER=53009]=\"NOT_OPEN_VIDEO_AUDIO_SERVER\",e[e.GET_USER_MEDIA_FAILED=53010]=\"GET_USER_MEDIA_FAILED\",e[e.GET_DISPLAY_MEDIA_FAILED=53011]=\"GET_DISPLAY_MEDIA_FAILED\",e[e.PERMISSION_DENIED=53012]=\"PERMISSION_DENIED\",e[e.CREATE_CUSTOM_TRACK_FAILED=53013]=\"CREATE_CUSTOM_TRACK_FAILED\",e[e.INVALID_TAGS=53014]=\"INVALID_TAGS\",e[e.INVALID_USER_ID=53015]=\"INVALID_USER_ID\",e[e.CREATE_FILE_TRACK_FAILED=53016]=\"CREATE_FILE_TRACK_FAILED\",e[e.INVALID_FILE_INSTANCE=53017]=\"INVALID_FILE_INSTANCE\",e[e.SET_REMOTE_DESCRIPTION_FAILED=53018]=\"SET_REMOTE_DESCRIPTION_FAILED\",e[e.BROWSER_NOT_SUPPORT=53019]=\"BROWSER_NOT_SUPPORT\",e[e.TRACK_NOT_READY=53020]=\"TRACK_NOT_READY\",e[e.VIDEO_TRACK_MISS_MEDIA_ELEMENT=53021]=\"VIDEO_TRACK_MISS_MEDIA_ELEMENT\",e[e.TRACK_PLAY_ERROR=53022]=\"TRACK_PLAY_ERROR\",e[e.SIGNAL_AUDIENCE_JOIN_ROOM_FAILED=53023]=\"SIGNAL_AUDIENCE_JOIN_ROOM_FAILED\",e[e.SIGNAL_ROOM_CHANGE_IDENTITY_FAILED=53024]=\"SIGNAL_ROOM_CHANGE_IDENTITY_FAILED\",e[e.PACKAGE_ENVIRONMENT_ERROR=53025]=\"PACKAGE_ENVIRONMENT_ERROR\",e[e.PUBLISH_TRACK_LIMIT_EXCEEDED=53026]=\"PUBLISH_TRACK_LIMIT_EXCEEDED\",e[e.CDN_RESOURCE_IS_EMPTY=53027]=\"CDN_RESOURCE_IS_EMPTY\",e[e.SIGNAL_JOIN_RTC_ROOM_REFUSED=53028]=\"SIGNAL_JOIN_RTC_ROOM_REFUSED\",e[e.NO_PERMISSION_TO_USE_REQUESTED_DEVICE=53029]=\"NO_PERMISSION_TO_USE_REQUESTED_DEVICE\",e[e.THE_FUNCTION_IS_DISABLED_IN_PKROOM=53030]=\"THE_FUNCTION_IS_DISABLED_IN_PKROOM\"}(T||(T={})),function(e){e[e.JOIN_REFUSED=40032]=\"JOIN_REFUSED\"}(I||(I={}));class E{constructor(){this.queue=[],this.locked=!1}checkToStart(){return S(this,void 0,void 0,(function*(){if(0===this.queue.length||this.locked)return;this.locked=!0;const{resolve:e,task:t,reject:r}=this.queue.shift();let i;try{i=yield t(),e(i)}catch(e){r(e)}this.locked=!1,this.checkToStart()}))}push(e){const t=new Promise(((t,r)=>{this.queue.push({resolve:t,task:e,reject:r})}));return this.checkToStart(),t}}const y=new E,k=e=>y.push(e);let b=!0,P=!0;function O(e,t,r){const i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function L(e,t,r){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return n.apply(this,arguments);const s=e=>{const t=r(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,s),n.apply(this,[e,s])};const s=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(r))return s.apply(this,arguments);const i=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,i])},Object.defineProperty(i,\"on\"+t,{get(){return this[\"_on\"+t]},set(e){this[\"_on\"+t]&&(this.removeEventListener(t,this[\"_on\"+t]),delete this[\"_on\"+t]),e&&this.addEventListener(t,this[\"_on\"+t]=e)},enumerable:!0,configurable:!0})}function N(e){return\"boolean\"!=typeof e?new Error(\"Argument type: \"+typeof e+\". Please use a boolean.\"):(b=e,e?\"adapter.js logging disabled\":\"adapter.js logging enabled\")}function D(e){return\"boolean\"!=typeof e?new Error(\"Argument type: \"+typeof e+\". Please use a boolean.\"):(P=!e,\"adapter.js deprecation warnings \"+(e?\"disabled\":\"enabled\"))}function A(){if(\"object\"==typeof window){if(b)return;\"undefined\"!=typeof console&&\"function\"==typeof console.log&&console.log.apply(console,arguments)}}function M(e,t){P&&console.warn(e+\" is deprecated, please use \"+t+\" instead.\")}function x(e){return\"[object Object]\"===Object.prototype.toString.call(e)}function U(e){return x(e)?Object.keys(e).reduce((function(t,r){const i=x(e[r]),n=i?U(e[r]):e[r],s=i&&!Object.keys(n).length;return void 0===n||s?t:Object.assign(t,{[r]:n})}),{}):e}function w(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith(\"Id\")?w(e,e.get(t[i]),r):i.endsWith(\"Ids\")&&t[i].forEach((t=>{w(e,e.get(t),r)}))})))}function $(e,t,r){const i=r?\"outbound-rtp\":\"inbound-rtp\",n=new Map;if(null===t)return n;const s=[];return e.forEach((e=>{\"track\"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((r=>{r.type===i&&r.trackId===t.id&&w(e,r,n)}))})),n}const j=A;function V(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const i=function(e){if(\"object\"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if(\"require\"===r||\"advanced\"===r||\"mediaSource\"===r)return;const i=\"object\"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==i.exact&&\"number\"==typeof i.exact&&(i.min=i.max=i.exact);const n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):\"deviceId\"===t?\"sourceId\":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};\"number\"==typeof i.ideal?(e[n(\"min\",r)]=i.ideal,t.optional.push(e),e={},e[n(\"max\",r)]=i.ideal,t.optional.push(e)):(e[n(\"\",r)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&\"number\"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[n(\"\",r)]=i.exact):[\"min\",\"max\"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&\"object\"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,\"autoGainControl\",\"googAutoGainControl\"),t(e.audio,\"noiseSuppression\",\"googNoiseSuppression\"),e.audio=i(e.audio)}if(e&&\"object\"==typeof e.video){let s=e.video.facingMode;s=s&&(\"object\"==typeof s?s:{ideal:s});const o=t.version<66;if(s&&(\"user\"===s.exact||\"environment\"===s.exact||\"user\"===s.ideal||\"environment\"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,\"environment\"===s.exact||\"environment\"===s.ideal?t=[\"back\",\"rear\"]:\"user\"!==s.exact&&\"user\"!==s.ideal||(t=[\"front\"]),t)return r.mediaDevices.enumerateDevices().then((r=>{let o=(r=r.filter((e=>\"videoinput\"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!o&&r.length&&t.includes(\"back\")&&(o=r[r.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=i(e.video),j(\"chrome: \"+JSON.stringify(e)),n(e)}))}e.video=i(e.video)}return j(\"chrome: \"+JSON.stringify(e)),n(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:\"NotAllowedError\",PermissionDismissedError:\"NotAllowedError\",InvalidStateError:\"NotAllowedError\",DevicesNotFoundError:\"NotFoundError\",ConstraintNotSatisfiedError:\"OverconstrainedError\",TrackStartError:\"NotReadableError\",MediaDeviceFailedDueToShutdown:\"NotAllowedError\",MediaDeviceKillSwitchOn:\"NotAllowedError\",TabCaptureError:\"AbortError\",ScreenCaptureError:\"AbortError\",DeviceCaptureError:\"AbortError\"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&\": \")+this.message}}};if(r.getUserMedia=function(e,t,i){n(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{i&&i(s(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return n(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException(\"\",\"NotFoundError\");return e}),(e=>Promise.reject(s(e))))))}}}function B(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function H(e){if(\"object\"==typeof e&&e.RTCPeerConnection&&!(\"ontrack\"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,\"ontrack\",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener(\"track\",this._ontrack),this.addEventListener(\"track\",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener(\"addtrack\",(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const n=new Event(\"track\");n.track=r.track,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)})),t.stream.getTracks().forEach((r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const n=new Event(\"track\");n.track=r,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)}))},this.addEventListener(\"addstream\",this._ontrackpoly)),t.apply(this,arguments)}}else L(e,\"track\",(e=>(e.transceiver||Object.defineProperty(e,\"transceiver\",{value:{receiver:e.receiver}}),e)))}function F(e){if(\"object\"==typeof e&&e.RTCPeerConnection&&!(\"getSenders\"in e.RTCPeerConnection.prototype)&&\"createDTMFSender\"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&(\"audio\"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let n=r.apply(this,arguments);return n||(n=t(this,e),this._senders.push(n)),n};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if(\"object\"==typeof e&&e.RTCPeerConnection&&\"getSenders\"in e.RTCPeerConnection.prototype&&\"createDTMFSender\"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!(\"dtmf\"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,\"dtmf\",{get(){return void 0===this._dtmf&&(\"audio\"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function K(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,i]=arguments;if(arguments.length>0&&\"function\"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||\"function\"!=typeof e))return t.apply(this,[]);const n=function(e){const t={};return e.result().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"}[e.type]||e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){r(s(n(e)))};return t.apply(this,[i,e])}return new Promise(((e,r)=>{t.apply(this,[function(t){e(s(n(t)))},r])})).then(r,i)}}function G(e){if(!(\"object\"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!(\"getStats\"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>$(t,e.track,!0)))}}if(!(\"getStats\"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),L(e,\"track\",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>$(t,e.track,!1)))}}if(!(\"getStats\"in e.RTCRtpSender.prototype)||!(\"getStats\"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,i;return this.getSenders().forEach((r=>{r.track===e&&(t?i=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?i=!0:r=t),t.track===e))),i||t&&r?Promise.reject(new DOMException(\"There are more than one sender or receiver for the track.\",\"InvalidAccessError\")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException(\"There is no sender or receiver for the track.\",\"InvalidAccessError\"))}return t.apply(this,arguments)}}function J(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException(\"Track already exists.\",\"InvalidAccessError\")}));const t=this.getSenders();r.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),n.apply(this,arguments)}}function W(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return J(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException(\"Track already exists.\",\"InvalidAccessError\")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};const n=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(new RegExp(n.id,\"g\"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function o(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(new RegExp(i.id,\"g\"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if(\"closed\"===this.signalingState)throw new DOMException(\"The RTCPeerConnection's signalingState is 'closed'.\",\"InvalidStateError\");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException(\"The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.\",\"NotSupportedError\");const n=this.getSenders().find((e=>e.track===t));if(n)throw new DOMException(\"Track already exists.\",\"InvalidAccessError\");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[r.id];if(s)s.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event(\"negotiationneeded\"))}));else{const i=new e.MediaStream([t]);this._streams[r.id]=i,this._reverseStreams[i.id]=r,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},[\"createOffer\",\"createAnswer\"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&\"function\"==typeof arguments[0]?r.apply(this,[t=>{const r=s(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,\"localDescription\");Object.defineProperty(e.RTCPeerConnection.prototype,\"localDescription\",{get(){const e=c.get.apply(this);return\"\"===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if(\"closed\"===this.signalingState)throw new DOMException(\"The RTCPeerConnection's signalingState is 'closed'.\",\"InvalidStateError\");if(!e._pc)throw new DOMException(\"Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.\",\"TypeError\");if(!(e._pc===this))throw new DOMException(\"Sender was not created by this connection.\",\"InvalidAccessError\");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((r=>{this._streams[r].getTracks().find((t=>e.track===t))&&(t=this._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event(\"negotiationneeded\")))}}function Y(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(\"addIceCandidate\"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function q(e,t){L(e,\"negotiationneeded\",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&\"plan-b\"===r.getConfiguration().sdpSemantics)||\"stable\"===r.signalingState)return e}))}var z=Object.freeze({__proto__:null,shimMediaStream:B,shimOnTrack:H,shimGetSendersWithDtmf:F,shimGetStats:K,shimSenderReceiverGetStats:G,shimAddTrackRemoveTrackWithNative:J,shimAddTrackRemoveTrack:W,shimPeerConnection:Y,fixNegotiationNeeded:q,shimGetUserMedia:V,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(\"function\"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((t=>{const i=r.video&&r.video.width,n=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:\"desktop\",chromeMediaSourceId:t,maxFrameRate:s||3}},i&&(r.video.mandatory.maxWidth=i),n&&(r.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error(\"shimGetDisplayMedia: getSourceId argument is not a function\"))}});var Q,X,Z=(Q=function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(\"\\n\").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split(\"\\nm=\").map((function(e,t){return(t>0?\"m=\"+e:e).trim()+\"\\r\\n\"}))},t.getDescription=function(e){var r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){var r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((function(e){return 0===e.indexOf(r)}))},t.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf(\"a=candidate:\")?e.substring(12).split(\" \"):e.substring(10).split(\" \"))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case\"raddr\":r.relatedAddress=t[i+1];break;case\"rport\":r.relatedPort=parseInt(t[i+1],10);break;case\"tcptype\":r.tcpType=t[i+1];break;case\"ufrag\":r.ufrag=t[i+1],r.usernameFragment=t[i+1];break;default:r[t[i]]=t[i+1]}return r},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push(\"typ\"),t.push(r),\"host\"!==r&&e.relatedAddress&&e.relatedPort&&(t.push(\"raddr\"),t.push(e.relatedAddress),t.push(\"rport\"),t.push(e.relatedPort)),e.tcpType&&\"tcp\"===e.protocol.toLowerCase()&&(t.push(\"tcptype\"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push(\"ufrag\"),t.push(e.usernameFragment||e.ufrag)),\"candidate:\"+t.join(\" \")},t.parseIceOptions=function(e){return e.substr(14).split(\" \")},t.parseRtpMap=function(e){var t=e.substr(9).split(\" \"),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split(\"/\"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return\"a=rtpmap:\"+t+\" \"+e.name+\"/\"+e.clockRate+(1!==r?\"/\"+r:\"\")+\"\\r\\n\"},t.parseExtmap=function(e){var t=e.substr(9).split(\" \");return{id:parseInt(t[0],10),direction:t[0].indexOf(\"/\")>0?t[0].split(\"/\")[1]:\"sendrecv\",uri:t[1]}},t.writeExtmap=function(e){return\"a=extmap:\"+(e.id||e.preferredId)+(e.direction&&\"sendrecv\"!==e.direction?\"/\"+e.direction:\"\")+\" \"+e.uri+\"\\r\\n\"},t.parseFmtp=function(e){for(var t,r={},i=e.substr(e.indexOf(\" \")+1).split(\";\"),n=0;n<i.length;n++)r[(t=i[n].trim().split(\"=\"))[0].trim()]=t[1];return r},t.writeFmtp=function(e){var t=\"\",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?i.push(t+\"=\"+e.parameters[t]):i.push(t)})),t+=\"a=fmtp:\"+r+\" \"+i.join(\";\")+\"\\r\\n\"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(\" \")+1).split(\" \");return{type:t.shift(),parameter:t.join(\" \")}},t.writeRtcpFb=function(e){var t=\"\",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+=\"a=rtcp-fb:\"+r+\" \"+e.type+(e.parameter&&e.parameter.length?\" \"+e.parameter:\"\")+\"\\r\\n\"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(\" \"),r={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(\":\",t);return i>-1?(r.attribute=e.substr(t+1,i-t-1),r.value=e.substr(i+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){var t=e.substr(13).split(\" \");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var r=t.matchPrefix(e,\"a=mid:\")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(\" \");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,r){return{role:\"auto\",fingerprints:t.matchPrefix(e+r,\"a=fingerprint:\").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var r=\"a=setup:\"+t+\"\\r\\n\";return e.fingerprints.forEach((function(e){r+=\"a=fingerprint:\"+e.algorithm+\" \"+e.value+\"\\r\\n\"})),r},t.parseCryptoLine=function(e){var t=e.substr(9).split(\" \");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return\"a=crypto:\"+e.tag+\" \"+e.cryptoSuite+\" \"+(\"object\"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?\" \"+e.sessionParams.join(\" \"):\"\")+\"\\r\\n\"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf(\"inline:\"))return null;var t=e.substr(7).split(\"|\");return{keyMethod:\"inline\",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(\":\")[0]:void 0,mkiLength:t[2]?t[2].split(\":\")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+\":\"+e.keySalt+(e.lifeTime?\"|\"+e.lifeTime:\"\")+(e.mkiValue&&e.mkiLength?\"|\"+e.mkiValue+\":\"+e.mkiLength:\"\")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,\"a=crypto:\").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){var i=t.matchPrefix(e+r,\"a=ice-ufrag:\")[0],n=t.matchPrefix(e+r,\"a=ice-pwd:\")[0];return i&&n?{usernameFragment:i.substr(12),password:n.substr(10)}:null},t.writeIceParameters=function(e){return\"a=ice-ufrag:\"+e.usernameFragment+\"\\r\\na=ice-pwd:\"+e.password+\"\\r\\n\"},t.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(\" \"),n=3;n<i.length;n++){var s=i[n],o=t.matchPrefix(e,\"a=rtpmap:\"+s+\" \")[0];if(o){var a=t.parseRtpMap(o),c=t.matchPrefix(e,\"a=fmtp:\"+s+\" \");switch(a.parameters=c.length?t.parseFmtp(c[0]):{},a.rtcpFeedback=t.matchPrefix(e,\"a=rtcp-fb:\"+s+\" \").map(t.parseRtcpFb),r.codecs.push(a),a.name.toUpperCase()){case\"RED\":case\"ULPFEC\":r.fecMechanisms.push(a.name.toUpperCase())}}}return t.matchPrefix(e,\"a=extmap:\").forEach((function(e){r.headerExtensions.push(t.parseExtmap(e))})),r},t.writeRtpDescription=function(e,r){var i=\"\";i+=\"m=\"+e+\" \",i+=r.codecs.length>0?\"9\":\"0\",i+=\" UDP/TLS/RTP/SAVPF \",i+=r.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(\" \")+\"\\r\\n\",i+=\"c=IN IP4 0.0.0.0\\r\\n\",i+=\"a=rtcp:9 IN IP4 0.0.0.0\\r\\n\",r.codecs.forEach((function(e){i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));var n=0;return r.codecs.forEach((function(e){e.maxptime>n&&(n=e.maxptime)})),n>0&&(i+=\"a=maxptime:\"+n+\"\\r\\n\"),i+=\"a=rtcp-mux\\r\\n\",r.headerExtensions&&r.headerExtensions.forEach((function(e){i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){var r,i=[],n=t.parseRtpParameters(e),s=-1!==n.fecMechanisms.indexOf(\"RED\"),o=-1!==n.fecMechanisms.indexOf(\"ULPFEC\"),a=t.matchPrefix(e,\"a=ssrc:\").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return\"cname\"===e.attribute})),c=a.length>0&&a[0].ssrc,d=t.matchPrefix(e,\"a=ssrc-group:FID\").map((function(e){return e.substr(17).split(\" \").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(r=d[0][1]),n.codecs.forEach((function(e){if(\"RTX\"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&r&&(t.rtx={ssrc:r}),i.push(t),s&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:o?\"red+ulpfec\":\"red\"},i.push(t))}})),0===i.length&&c&&i.push({ssrc:c});var u=t.matchPrefix(e,\"b=\");return u.length&&(u=0===u[0].indexOf(\"b=TIAS:\")?parseInt(u[0].substr(7),10):0===u[0].indexOf(\"b=AS:\")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,i.forEach((function(e){e.maxBitrate=u}))),i},t.parseRtcpParameters=function(e){var r={},i=t.matchPrefix(e,\"a=ssrc:\").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return\"cname\"===e.attribute}))[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);var n=t.matchPrefix(e,\"a=rtcp-rsize\");r.reducedSize=n.length>0,r.compound=0===n.length;var s=t.matchPrefix(e,\"a=rtcp-mux\");return r.mux=s.length>0,r},t.parseMsid=function(e){var r,i=t.matchPrefix(e,\"a=msid:\");if(1===i.length)return{stream:(r=i[0].substr(7).split(\" \"))[0],track:r[1]};var n=t.matchPrefix(e,\"a=ssrc:\").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return\"msid\"===e.attribute}));return n.length>0?{stream:(r=n[0].value.split(\" \"))[0],track:r[1]}:void 0},t.parseSctpDescription=function(e){var r,i=t.parseMLine(e),n=t.matchPrefix(e,\"a=max-message-size:\");n.length>0&&(r=parseInt(n[0].substr(19),10)),isNaN(r)&&(r=65536);var s=t.matchPrefix(e,\"a=sctp-port:\");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};if(t.matchPrefix(e,\"a=sctpmap:\").length>0){var o=t.matchPrefix(e,\"a=sctpmap:\")[0].substr(10).split(\" \");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){var r=[];return r=\"DTLS/SCTP\"!==e.protocol?[\"m=\"+e.kind+\" 9 \"+e.protocol+\" \"+t.protocol+\"\\r\\n\",\"c=IN IP4 0.0.0.0\\r\\n\",\"a=sctp-port:\"+t.port+\"\\r\\n\"]:[\"m=\"+e.kind+\" 9 \"+e.protocol+\" \"+t.port+\"\\r\\n\",\"c=IN IP4 0.0.0.0\\r\\n\",\"a=sctpmap:\"+t.port+\" \"+t.protocol+\" 65535\\r\\n\"],void 0!==t.maxMessageSize&&r.push(\"a=max-message-size:\"+t.maxMessageSize+\"\\r\\n\"),r.join(\"\")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,i){var n=void 0!==r?r:2;return\"v=0\\r\\no=\"+(i||\"thisisadapterortc\")+\" \"+(e||t.generateSessionId())+\" \"+n+\" IN IP4 127.0.0.1\\r\\ns=-\\r\\nt=0 0\\r\\n\"},t.writeMediaSection=function(e,r,i,n){var s=t.writeRtpDescription(e.kind,r);if(s+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),\"offer\"===i?\"actpass\":\"active\"),s+=\"a=mid:\"+e.mid+\"\\r\\n\",e.direction?s+=\"a=\"+e.direction+\"\\r\\n\":e.rtpSender&&e.rtpReceiver?s+=\"a=sendrecv\\r\\n\":e.rtpSender?s+=\"a=sendonly\\r\\n\":e.rtpReceiver?s+=\"a=recvonly\\r\\n\":s+=\"a=inactive\\r\\n\",e.rtpSender){var o=\"msid:\"+n.id+\" \"+e.rtpSender.track.id+\"\\r\\n\";s+=\"a=\"+o,s+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" \"+o,e.sendEncodingParameters[0].rtx&&(s+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" \"+o,s+=\"a=ssrc-group:FID \"+e.sendEncodingParameters[0].ssrc+\" \"+e.sendEncodingParameters[0].rtx.ssrc+\"\\r\\n\")}return s+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" cname:\"+t.localCName+\"\\r\\n\",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" cname:\"+t.localCName+\"\\r\\n\"),s},t.getDirection=function(e,r){for(var i=t.splitLines(e),n=0;n<i.length;n++)switch(i[n]){case\"a=sendrecv\":case\"a=sendonly\":case\"a=recvonly\":case\"a=inactive\":return i[n].substr(2)}return r?t.getDirection(r):\"sendrecv\"},t.getKind=function(e){return t.splitLines(e)[0].split(\" \")[0].substr(2)},t.isRejected=function(e){return\"0\"===e.split(\" \",2)[1]},t.parseMLine=function(e){var r=t.splitLines(e)[0].substr(2).split(\" \");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(\" \")}},t.parseOLine=function(e){var r=t.matchPrefix(e,\"o=\")[0].substr(2).split(\" \");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if(\"string\"!=typeof e||0===e.length)return!1;for(var r=t.splitLines(e),i=0;i<r.length;i++)if(r[i].length<2||\"=\"!==r[i].charAt(1))return!1;return!0},e.exports=t},Q(X={exports:{}},X.exports),X.exports);function ee(e,t,r,i,n){var s=Z.writeRtpDescription(e.kind,t);if(s+=Z.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=Z.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),\"offer\"===r?\"actpass\":n||\"active\"),s+=\"a=mid:\"+e.mid+\"\\r\\n\",e.rtpSender&&e.rtpReceiver?s+=\"a=sendrecv\\r\\n\":e.rtpSender?s+=\"a=sendonly\\r\\n\":e.rtpReceiver?s+=\"a=recvonly\\r\\n\":s+=\"a=inactive\\r\\n\",e.rtpSender){var o=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=o;var a=\"msid:\"+(i?i.id:\"-\")+\" \"+o+\"\\r\\n\";s+=\"a=\"+a,s+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" \"+a,e.sendEncodingParameters[0].rtx&&(s+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" \"+a,s+=\"a=ssrc-group:FID \"+e.sendEncodingParameters[0].ssrc+\" \"+e.sendEncodingParameters[0].rtx.ssrc+\"\\r\\n\")}return s+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" cname:\"+Z.localCName+\"\\r\\n\",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" cname:\"+Z.localCName+\"\\r\\n\"),s}function te(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},n=function(e,t,r,n){var s=i(e.parameters.apt,r),o=i(t.parameters.apt,n);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(i){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(i.name.toLowerCase()===o.name.toLowerCase()&&i.clockRate===o.clockRate){if(\"rtx\"===i.name.toLowerCase()&&i.parameters&&o.parameters.apt&&!n(i,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(i.numChannels,o.numChannels),r.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var i=0;i<t.headerExtensions.length;i++){var n=t.headerExtensions[i];if(e.uri===n.uri){r.headerExtensions.push(n);break}}})),r}function re(e,t,r){return-1!=={offer:{setLocalDescription:[\"stable\",\"have-local-offer\"],setRemoteDescription:[\"stable\",\"have-remote-offer\"]},answer:{setLocalDescription:[\"have-remote-offer\",\"have-local-pranswer\"],setRemoteDescription:[\"have-local-offer\",\"have-remote-pranswer\"]}}[t][e].indexOf(r)}function ie(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function ne(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}var se=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent(\"addtrack\",{track:t}))}function i(t,r,i,n){var s=new Event(\"track\");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=n,e.setTimeout((function(){t._dispatchEvent(\"track\",s)}))}var n=function(r){var i=this,n=document.createDocumentFragment();if([\"addEventListener\",\"removeEventListener\",\"dispatchEvent\"].forEach((function(e){i[e]=n[e].bind(n)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState=\"stable\",this.iceConnectionState=\"new\",this.connectionState=\"new\",this.iceGatheringState=\"new\",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle=\"max-bundle\"===r.bundlePolicy,\"negotiate\"===r.rtcpMuxPolicy)throw ne(\"NotSupportedError\",\"rtcpMuxPolicy 'negotiate' is not supported\");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy=\"require\"),r.iceTransportPolicy){case\"all\":case\"relay\":break;default:r.iceTransportPolicy=\"all\"}switch(r.bundlePolicy){case\"balanced\":case\"max-compat\":case\"max-bundle\":break;default:r.bundlePolicy=\"balanced\"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn(\"RTCIceServer.url is deprecated! Use urls instead.\");var n=\"string\"==typeof i;return n&&(i=[i]),i=i.filter((function(e){return 0!==e.indexOf(\"turn:\")||-1===e.indexOf(\"transport=udp\")||-1!==e.indexOf(\"turn:[\")||r?0===e.indexOf(\"stun:\")&&t>=14393&&-1===e.indexOf(\"?transport=udp\"):(r=!0,!0)})),delete e.url,e.urls=n?i[0]:i,!!i.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var s=r.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=Z.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(n.prototype,\"localDescription\",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(n.prototype,\"remoteDescription\",{configurable:!0,get:function(){return this._remoteDescription}}),n.prototype.onicecandidate=null,n.prototype.onaddstream=null,n.prototype.ontrack=null,n.prototype.onremovestream=null,n.prototype.onsignalingstatechange=null,n.prototype.oniceconnectionstatechange=null,n.prototype.onconnectionstatechange=null,n.prototype.onicegatheringstatechange=null,n.prototype.onnegotiationneeded=null,n.prototype.ondatachannel=null,n.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),\"function\"==typeof this[\"on\"+e]&&this[\"on\"+e](t))},n.prototype._emitGatheringStateChange=function(){var e=new Event(\"icegatheringstatechange\");this._dispatchEvent(\"icegatheringstatechange\",e)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();i.iceTransport=n.iceTransport,i.dtlsTransport=n.dtlsTransport}return t||this.transceivers.push(i),i},n.prototype.addTrack=function(t,r){if(this._isClosed)throw ne(\"InvalidStateError\",\"Attempted to call addTrack on a closed peerconnection.\");var i;if(this.transceivers.find((function(e){return e.track===t})))throw ne(\"InvalidAccessError\",\"Track already exists.\");for(var n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==t.kind||(i=this.transceivers[n]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),i.track=t,i.stream=r,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},n.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var i=e.clone();e.getTracks().forEach((function(e,t){var r=i.getTracks()[t];e.addEventListener(\"enabled\",(function(e){r.enabled=e.enabled}))})),i.getTracks().forEach((function(e){r.addTrack(e,i)}))}},n.prototype.removeTrack=function(t){if(this._isClosed)throw ne(\"InvalidStateError\",\"Attempted to call removeTrack on a closed peerconnection.\");if(!(t instanceof e.RTCRtpSender))throw new TypeError(\"Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.\");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw ne(\"InvalidAccessError\",\"Sender was not created by this connection.\");var i=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},n.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},n.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},n.prototype._createIceGatherer=function(t,r){var i=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var n=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(n,\"state\",{value:\"new\",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;n.state=r?\"completed\":\"gathering\",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},n.addEventListener(\"localcandidate\",this.transceivers[t].bufferCandidates),n},n.prototype._gather=function(t,r){var i=this,n=this.transceivers[r].iceGatherer;if(!n.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,n.removeEventListener(\"localcandidate\",this.transceivers[r].bufferCandidates),n.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var s=new Event(\"icecandidate\");s.candidate={sdpMid:t,sdpMLineIndex:r};var o=e.candidate,a=!o||0===Object.keys(o).length;if(a)\"new\"!==n.state&&\"gathering\"!==n.state||(n.state=\"completed\");else{\"new\"===n.state&&(n.state=\"gathering\"),o.component=1,o.ufrag=n.getLocalParameters().usernameFragment;var c=Z.writeCandidate(o);s.candidate=Object.assign(s.candidate,Z.parseCandidate(c)),s.candidate.candidate=c,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var d=Z.getMediaSections(i._localDescription.sdp);d[s.candidate.sdpMLineIndex]+=a?\"a=end-of-candidates\\r\\n\":\"a=\"+s.candidate.candidate+\"\\r\\n\",i._localDescription.sdp=Z.getDescription(i._localDescription.sdp)+d.join(\"\");var u=i.transceivers.every((function(e){return e.iceGatherer&&\"completed\"===e.iceGatherer.state}));\"gathering\"!==i.iceGatheringState&&(i.iceGatheringState=\"gathering\",i._emitGatheringStateChange()),a||i._dispatchEvent(\"icecandidate\",s),u&&(i._dispatchEvent(\"icecandidate\",new Event(\"icecandidate\")),i.iceGatheringState=\"complete\",i._emitGatheringStateChange())}},e.setTimeout((function(){s.forEach((function(e){n.onlocalcandidate(e)}))}),0)}},n.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new e.RTCDtlsTransport(r);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,\"state\",{value:\"failed\",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:i}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,r,i){var n=te(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(n.encodings=e.sendEncodingParameters,n.rtcp={cname:Z.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(n)),i&&e.rtpReceiver&&n.codecs.length>0&&(\"video\"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?n.encodings=e.recvEncodingParameters:n.encodings=[{}],n.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(n.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(n))},n.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===[\"offer\",\"answer\"].indexOf(e.type))return Promise.reject(ne(\"TypeError\",'Unsupported type \"'+e.type+'\"'));if(!re(\"setLocalDescription\",e.type,i.signalingState)||i._isClosed)return Promise.reject(ne(\"InvalidStateError\",\"Can not set local \"+e.type+\" in state \"+i.signalingState));if(\"offer\"===e.type)t=Z.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=Z.parseRtpParameters(e);i.transceivers[t].localCapabilities=r})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if(\"answer\"===e.type){t=Z.splitSections(i._remoteDescription.sdp),r=t.shift();var n=Z.matchPrefix(r,\"a=ice-lite\").length>0;t.forEach((function(e,t){var s=i.transceivers[t],o=s.iceGatherer,a=s.iceTransport,c=s.dtlsTransport,d=s.localCapabilities,u=s.remoteCapabilities;if(!(Z.isRejected(e)&&0===Z.matchPrefix(e,\"a=bundle-only\").length)&&!s.rejected){var l=Z.getIceParameters(e,r),h=Z.getDtlsParameters(e,r);n&&(h.role=\"server\"),i.usingBundle&&0!==t||(i._gather(s.mid,t),\"new\"===a.state&&a.start(o,l,n?\"controlling\":\"controlled\"),\"new\"===c.state&&c.start(h));var p=te(d,u);i._transceive(s,p.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},\"offer\"===e.type?i._updateSignalingState(\"have-local-offer\"):i._updateSignalingState(\"stable\"),Promise.resolve()},n.prototype.setRemoteDescription=function(n){var s=this;if(-1===[\"offer\",\"answer\"].indexOf(n.type))return Promise.reject(ne(\"TypeError\",'Unsupported type \"'+n.type+'\"'));if(!re(\"setRemoteDescription\",n.type,s.signalingState)||s._isClosed)return Promise.reject(ne(\"InvalidStateError\",\"Can not set remote \"+n.type+\" in state \"+s.signalingState));var o={};s.remoteStreams.forEach((function(e){o[e.id]=e}));var a=[],c=Z.splitSections(n.sdp),d=c.shift(),u=Z.matchPrefix(d,\"a=ice-lite\").length>0,l=Z.matchPrefix(d,\"a=group:BUNDLE \").length>0;s.usingBundle=l;var h=Z.matchPrefix(d,\"a=ice-options:\")[0];return s.canTrickleIceCandidates=!!h&&h.substr(14).split(\" \").indexOf(\"trickle\")>=0,c.forEach((function(i,c){var h=Z.splitLines(i),p=Z.getKind(i),_=Z.isRejected(i)&&0===Z.matchPrefix(i,\"a=bundle-only\").length,m=h[0].substr(2).split(\" \")[2],f=Z.getDirection(i,d),v=Z.parseMsid(i),R=Z.getMid(i)||Z.generateIdentifier();if(_||\"application\"===p&&(\"DTLS/SCTP\"===m||\"UDP/DTLS/SCTP\"===m))s.transceivers[c]={mid:R,kind:p,protocol:m,rejected:!0};else{var g,S,C,T,I,E,y,k,b;!_&&s.transceivers[c]&&s.transceivers[c].rejected&&(s.transceivers[c]=s._createTransceiver(p,!0));var P,O,L=Z.parseRtpParameters(i);_||(P=Z.getIceParameters(i,d),(O=Z.getDtlsParameters(i,d)).role=\"client\"),y=Z.parseRtpEncodingParameters(i);var N=Z.parseRtcpParameters(i),D=Z.matchPrefix(i,\"a=end-of-candidates\",d).length>0,A=Z.matchPrefix(i,\"a=candidate:\").map((function(e){return Z.parseCandidate(e)})).filter((function(e){return 1===e.component}));if((\"offer\"===n.type||\"answer\"===n.type)&&!_&&l&&c>0&&s.transceivers[c]&&(s._disposeIceAndDtlsTransports(c),s.transceivers[c].iceGatherer=s.transceivers[0].iceGatherer,s.transceivers[c].iceTransport=s.transceivers[0].iceTransport,s.transceivers[c].dtlsTransport=s.transceivers[0].dtlsTransport,s.transceivers[c].rtpSender&&s.transceivers[c].rtpSender.setTransport(s.transceivers[0].dtlsTransport),s.transceivers[c].rtpReceiver&&s.transceivers[c].rtpReceiver.setTransport(s.transceivers[0].dtlsTransport)),\"offer\"!==n.type||_){if(\"answer\"===n.type&&!_){S=(g=s.transceivers[c]).iceGatherer,C=g.iceTransport,T=g.dtlsTransport,I=g.rtpReceiver,E=g.sendEncodingParameters,k=g.localCapabilities,s.transceivers[c].recvEncodingParameters=y,s.transceivers[c].remoteCapabilities=L,s.transceivers[c].rtcpParameters=N,A.length&&\"new\"===C.state&&(!u&&!D||l&&0!==c?A.forEach((function(e){ie(g.iceTransport,e)})):C.setRemoteCandidates(A)),l&&0!==c||(\"new\"===C.state&&C.start(S,P,\"controlling\"),\"new\"===T.state&&T.start(O)),!te(g.localCapabilities,g.remoteCapabilities).codecs.filter((function(e){return\"rtx\"===e.name.toLowerCase()})).length&&g.sendEncodingParameters[0].rtx&&delete g.sendEncodingParameters[0].rtx,s._transceive(g,\"sendrecv\"===f||\"recvonly\"===f,\"sendrecv\"===f||\"sendonly\"===f),!I||\"sendrecv\"!==f&&\"sendonly\"!==f?delete g.rtpReceiver:(b=I.track,v?(o[v.stream]||(o[v.stream]=new e.MediaStream),r(b,o[v.stream]),a.push([b,I,o[v.stream]])):(o.default||(o.default=new e.MediaStream),r(b,o.default),a.push([b,I,o.default])))}}else{(g=s.transceivers[c]||s._createTransceiver(p)).mid=R,g.iceGatherer||(g.iceGatherer=s._createIceGatherer(c,l)),A.length&&\"new\"===g.iceTransport.state&&(!D||l&&0!==c?A.forEach((function(e){ie(g.iceTransport,e)})):g.iceTransport.setRemoteCandidates(A)),k=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(k.codecs=k.codecs.filter((function(e){return\"rtx\"!==e.name}))),E=g.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var M,x=!1;if(\"sendrecv\"===f||\"sendonly\"===f){if(x=!g.rtpReceiver,I=g.rtpReceiver||new e.RTCRtpReceiver(g.dtlsTransport,p),x)b=I.track,v&&\"-\"===v.stream||(v?(o[v.stream]||(o[v.stream]=new e.MediaStream,Object.defineProperty(o[v.stream],\"id\",{get:function(){return v.stream}})),Object.defineProperty(b,\"id\",{get:function(){return v.track}}),M=o[v.stream]):(o.default||(o.default=new e.MediaStream),M=o.default)),M&&(r(b,M),g.associatedRemoteMediaStreams.push(M)),a.push([b,I,M])}else g.rtpReceiver&&g.rtpReceiver.track&&(g.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===g.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent(\"removetrack\",{track:t}))}(r,t)})),g.associatedRemoteMediaStreams=[]);g.localCapabilities=k,g.remoteCapabilities=L,g.rtpReceiver=I,g.rtcpParameters=N,g.sendEncodingParameters=E,g.recvEncodingParameters=y,s._transceive(s.transceivers[c],!1,x)}}})),void 0===s._dtlsRole&&(s._dtlsRole=\"offer\"===n.type?\"active\":\"passive\"),s._remoteDescription={type:n.type,sdp:n.sdp},\"offer\"===n.type?s._updateSignalingState(\"have-remote-offer\"):s._updateSignalingState(\"stable\"),Object.keys(o).forEach((function(t){var r=o[t];if(r.getTracks().length){if(-1===s.remoteStreams.indexOf(r)){s.remoteStreams.push(r);var n=new Event(\"addstream\");n.stream=r,e.setTimeout((function(){s._dispatchEvent(\"addstream\",n)}))}a.forEach((function(e){var t=e[0],n=e[1];r.id===e[2].id&&i(s,t,n,[r])}))}})),a.forEach((function(e){e[2]||i(s,e[0],e[1],[])})),e.setTimeout((function(){s&&s.transceivers&&s.transceivers.forEach((function(e){e.iceTransport&&\"new\"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn(\"Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification\"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState(\"closed\")},n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event(\"signalingstatechange\");this._dispatchEvent(\"signalingstatechange\",t)},n.prototype._maybeFireNegotiationNeeded=function(){var t=this;\"stable\"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event(\"negotiationneeded\");t._dispatchEvent(\"negotiationneeded\",e)}}),0))},n.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e=\"new\",t.failed>0?e=\"failed\":t.checking>0?e=\"checking\":t.disconnected>0?e=\"disconnected\":t.new>0?e=\"new\":t.connected>0?e=\"connected\":t.completed>0&&(e=\"completed\"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event(\"iceconnectionstatechange\");this._dispatchEvent(\"iceconnectionstatechange\",r)}},n.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e=\"new\",t.failed>0?e=\"failed\":t.connecting>0?e=\"connecting\":t.disconnected>0?e=\"disconnected\":t.new>0?e=\"new\":t.connected>0&&(e=\"connected\"),e!==this.connectionState){this.connectionState=e;var r=new Event(\"connectionstatechange\");this._dispatchEvent(\"connectionstatechange\",r)}},n.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(ne(\"InvalidStateError\",\"Can not call createOffer after close\"));var i=r.transceivers.filter((function(e){return\"audio\"===e.kind})).length,n=r.transceivers.filter((function(e){return\"video\"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError(\"Legacy mandatory/optional constraints not supported.\");void 0!==s.offerToReceiveAudio&&(i=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(n=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){\"audio\"===e.kind?--i<0&&(e.wantReceive=!1):\"video\"===e.kind&&--n<0&&(e.wantReceive=!1)}));i>0||n>0;)i>0&&(r._createTransceiver(\"audio\"),i--),n>0&&(r._createTransceiver(\"video\"),n--);var o=Z.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(i,n){var s=i.track,o=i.kind,a=i.mid||Z.generateIdentifier();i.mid=a,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(n,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(o);t<15019&&(c.codecs=c.codecs.filter((function(e){return\"rtx\"!==e.name}))),c.codecs.forEach((function(e){\"H264\"===e.name&&void 0===e.parameters[\"level-asymmetry-allowed\"]&&(e.parameters[\"level-asymmetry-allowed\"]=\"1\"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),c.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=i.sendEncodingParameters||[{ssrc:1001*(2*n+1)}];s&&t>=15019&&\"video\"===o&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,o)),i.localCapabilities=c,i.sendEncodingParameters=d})),\"max-compat\"!==r._config.bundlePolicy&&(o+=\"a=group:BUNDLE \"+r.transceivers.map((function(e){return e.mid})).join(\" \")+\"\\r\\n\"),o+=\"a=ice-options:trickle\\r\\n\",r.transceivers.forEach((function(e,t){o+=ee(e,e.localCapabilities,\"offer\",e.stream,r._dtlsRole),o+=\"a=rtcp-rsize\\r\\n\",!e.iceGatherer||\"new\"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,o+=\"a=\"+Z.writeCandidate(e)+\"\\r\\n\"})),\"completed\"===e.iceGatherer.state&&(o+=\"a=end-of-candidates\\r\\n\"))}));var a=new e.RTCSessionDescription({type:\"offer\",sdp:o});return Promise.resolve(a)},n.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(ne(\"InvalidStateError\",\"Can not call createAnswer after close\"));if(\"have-remote-offer\"!==r.signalingState&&\"have-local-pranswer\"!==r.signalingState)return Promise.reject(ne(\"InvalidStateError\",\"Can not call createAnswer in signalingState \"+r.signalingState));var i=Z.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(i+=\"a=group:BUNDLE \"+r.transceivers.map((function(e){return e.mid})).join(\" \")+\"\\r\\n\"),i+=\"a=ice-options:trickle\\r\\n\";var n=Z.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,s){if(!(s+1>n)){if(e.rejected)return\"application\"===e.kind?\"DTLS/SCTP\"===e.protocol?i+=\"m=application 0 DTLS/SCTP 5000\\r\\n\":i+=\"m=application 0 \"+e.protocol+\" webrtc-datachannel\\r\\n\":\"audio\"===e.kind?i+=\"m=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\na=rtpmap:0 PCMU/8000\\r\\n\":\"video\"===e.kind&&(i+=\"m=video 0 UDP/TLS/RTP/SAVPF 120\\r\\na=rtpmap:120 VP8/90000\\r\\n\"),void(i+=\"c=IN IP4 0.0.0.0\\r\\na=inactive\\r\\na=mid:\"+e.mid+\"\\r\\n\");var o;if(e.stream)\"audio\"===e.kind?o=e.stream.getAudioTracks()[0]:\"video\"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&t>=15019&&\"video\"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var a=te(e.localCapabilities,e.remoteCapabilities);!a.codecs.filter((function(e){return\"rtx\"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=ee(e,a,\"answer\",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+=\"a=rtcp-rsize\\r\\n\")}}));var s=new e.RTCSessionDescription({type:\"answer\",sdp:i});return Promise.resolve(s)},n.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError(\"sdpMLineIndex or sdpMid required\")):new Promise((function(i,n){if(!r._remoteDescription)return n(ne(\"InvalidStateError\",\"Can not add ICE candidate without a remote description\"));if(e&&\"\"!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var o=0;o<r.transceivers.length;o++)if(r.transceivers[o].mid===e.sdpMid){s=o;break}var a=r.transceivers[s];if(!a)return n(ne(\"OperationError\",\"Can not add ICE candidate\"));if(a.rejected)return i();var c=Object.keys(e.candidate).length>0?Z.parseCandidate(e.candidate):{};if(\"tcp\"===c.protocol&&(0===c.port||9===c.port))return i();if(c.component&&1!==c.component)return i();if((0===s||s>0&&a.iceTransport!==r.transceivers[0].iceTransport)&&!ie(a.iceTransport,c))return n(ne(\"OperationError\",\"Can not add ICE candidate\"));var d=e.candidate.trim();0===d.indexOf(\"a=\")&&(d=d.substr(2)),(t=Z.getMediaSections(r._remoteDescription.sdp))[s]+=\"a=\"+(c.type?d:\"end-of-candidates\")+\"\\r\\n\",r._remoteDescription.sdp=Z.getDescription(r._remoteDescription.sdp)+t.join(\"\")}else for(var u=0;u<r.transceivers.length&&(r.transceivers[u].rejected||(r.transceivers[u].iceTransport.addRemoteCandidate({}),(t=Z.getMediaSections(r._remoteDescription.sdp))[u]+=\"a=end-of-candidates\\r\\n\",r._remoteDescription.sdp=Z.getDescription(r._remoteDescription.sdp)+t.join(\"\"),!r.usingBundle));u++);i()}))},n.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw ne(\"InvalidAccessError\",\"Invalid selector.\");return r.getStats()}var i=[];return this.transceivers.forEach((function(e){[\"rtpSender\",\"rtpReceiver\",\"iceGatherer\",\"iceTransport\",\"dtlsTransport\"].forEach((function(t){e[t]&&i.push(e[t].getStats())}))})),Promise.all(i).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};[\"RTCRtpSender\",\"RTCRtpReceiver\",\"RTCIceGatherer\",\"RTCIceTransport\",\"RTCDtlsTransport\"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var i=r.prototype.getStats;r.prototype.getStats=function(){return i.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var i;e[r].type={inboundrtp:\"inbound-rtp\",outboundrtp:\"outbound-rtp\",candidatepair:\"candidate-pair\",localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"}[(i=e[r]).type]||i.type,t.set(r,e[r])})),t}))}}}));var s=[\"createOffer\",\"createAnswer\"];return s.forEach((function(e){var t=n.prototype[e];n.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[0]||\"function\"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){\"function\"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){\"function\"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(s=[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"]).forEach((function(e){var t=n.prototype[e];n.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[1]||\"function\"==typeof e[2]?t.apply(this,arguments).then((function(){\"function\"==typeof e[1]&&e[1].apply(null)}),(function(t){\"function\"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),[\"getStats\"].forEach((function(e){var t=n.prototype[e];n.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[1]?t.apply(this,arguments).then((function(){\"function\"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),n};function oe(e){const t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((e=>Promise.reject(function(e){return{name:{PermissionDeniedError:\"NotAllowedError\"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e))))}}function ae(e){\"getDisplayMedia\"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function ce(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,\"enabled\");Object.defineProperty(e.MediaStreamTrack.prototype,\"enabled\",{set(e){t.set.call(this,e);const r=new Event(\"enabled\");r.enabled=e,this.dispatchEvent(r)}})}e.RTCRtpSender&&!(\"dtmf\"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,\"dtmf\",{get(){return void 0===this._dtmf&&(\"audio\"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):\"video\"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const r=se(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((e=>{if(e&&(e.urls||e.url)){let t=e.urls||e.url;e.url&&!e.urls&&M(\"RTCIceServer.url\",\"RTCIceServer.urls\");const i=\"string\"==typeof t;return i&&(t=[t]),t=t.filter((e=>{if(0===e.indexOf(\"stun:\"))return!1;const t=e.startsWith(\"turn\")&&!e.startsWith(\"turn:[\")&&e.includes(\"transport=udp\");return t&&!r?(r=!0,!0):t&&!r})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))}(e.iceServers,t.version),A(\"ICE servers after filtering:\",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype}function de(e){e.RTCRtpSender&&!(\"replaceTrack\"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var ue=Object.freeze({__proto__:null,shimPeerConnection:ce,shimReplaceTrack:de,shimGetUserMedia:oe,shimGetDisplayMedia:ae});function le(e,t){const r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){M(\"navigator.getUserMedia\",\"navigator.mediaDevices.getUserMedia\"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&\"autoGainControl\"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return\"object\"==typeof r&&\"object\"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,\"autoGainControl\",\"mozAutoGainControl\"),e(r.audio,\"noiseSuppression\",\"mozNoiseSuppression\")),t(r)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,\"mozAutoGainControl\",\"autoGainControl\"),e(r,\"mozNoiseSuppression\",\"noiseSuppression\"),r}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(r){return\"audio\"===this.kind&&\"object\"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,\"autoGainControl\",\"mozAutoGainControl\"),e(r,\"noiseSuppression\",\"mozNoiseSuppression\")),t.apply(this,[r])}}}}function he(e){\"object\"==typeof e&&e.RTCTrackEvent&&\"receiver\"in e.RTCTrackEvent.prototype&&!(\"transceiver\"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,\"transceiver\",{get(){return{receiver:this.receiver}}})}function pe(e,t){if(\"object\"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(\"addIceCandidate\"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const r={inboundrtp:\"inbound-rtp\",outboundrtp:\"outbound-rtp\",candidatepair:\"candidate-pair\",localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,s]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!n)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(t){if(\"TypeError\"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(n,s)}}function _e(e){if(\"object\"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&\"getStats\"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function me(e){if(\"object\"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&\"getStats\"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),L(e,\"track\",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function fe(e){e.RTCPeerConnection&&!(\"removeStream\"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){M(\"removeStream\",\"removeTrack\"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function ve(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Re(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],r=e&&\"sendEncodings\"in e;r&&e.sendEncodings.forEach((e=>{if(\"rid\"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError(\"Invalid RID value provided.\")}if(\"scaleResolutionDownBy\"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError(\"scale_resolution_down_by must be >= 1.0\");if(\"maxFramerate\"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError(\"max_framerate must be >= 0.0\")}));const i=t.apply(this,arguments);if(r){const{sender:t}=i,r=t.getParameters();(!(\"encodings\"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function ge(e){if(\"object\"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return\"encodings\"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Se(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Ce(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Te=Object.freeze({__proto__:null,shimOnTrack:he,shimPeerConnection:pe,shimSenderGetStats:_e,shimReceiverGetStats:me,shimRemoveStream:fe,shimRTCDataChannel:ve,shimAddTransceiver:Re,shimGetParameters:ge,shimCreateOffer:Se,shimCreateAnswer:Ce,shimGetUserMedia:le,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException(\"getDisplayMedia without video constraints is undefined\");return e.name=\"NotFoundError\",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function Ie(e){if(\"object\"==typeof e&&e.RTCPeerConnection){if(\"getLocalStreams\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!(\"addStream\"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}\"removeStream\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function Ee(e){if(\"object\"==typeof e&&e.RTCPeerConnection&&(\"getRemoteStreams\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!(\"onaddstream\"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,\"onaddstream\",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener(\"addstream\",this._onaddstream),this.removeEventListener(\"track\",this._onaddstreampoly)),this.addEventListener(\"addstream\",this._onaddstream=e),this.addEventListener(\"track\",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event(\"addstream\");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener(\"track\",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event(\"addstream\");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function ye(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};let a=function(e,t,r){const i=n.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i};t.setLocalDescription=a,a=function(e,t,r){const i=s.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.setRemoteDescription=a,a=function(e,t,r){const i=o.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.addIceCandidate=a}function ke(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(be(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}.bind(t))}function be(e){return e&&void 0!==e.video?Object.assign({},e,{video:U(e.video)}):e}function Pe(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let i=e.iceServers[r];!i.hasOwnProperty(\"urls\")&&i.hasOwnProperty(\"url\")?(M(\"RTCIceServer.url\",\"RTCIceServer.urls\"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,\"generateCertificate\"in t&&Object.defineProperty(e.RTCPeerConnection,\"generateCertificate\",{get:()=>t.generateCertificate})}function Oe(e){\"object\"==typeof e&&e.RTCTrackEvent&&\"receiver\"in e.RTCTrackEvent.prototype&&!(\"transceiver\"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,\"transceiver\",{get(){return{receiver:this.receiver}}})}function Le(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>\"audio\"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?\"sendrecv\"===t.direction?t.setDirection?t.setDirection(\"sendonly\"):t.direction=\"sendonly\":\"recvonly\"===t.direction&&(t.setDirection?t.setDirection(\"inactive\"):t.direction=\"inactive\"):!0!==e.offerToReceiveAudio||t||this.addTransceiver(\"audio\"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>\"video\"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?\"sendrecv\"===r.direction?r.setDirection?r.setDirection(\"sendonly\"):r.direction=\"sendonly\":\"recvonly\"===r.direction&&(r.setDirection?r.setDirection(\"inactive\"):r.direction=\"inactive\"):!0!==e.offerToReceiveVideo||r||this.addTransceiver(\"video\")}return t.apply(this,arguments)}}function Ne(e){\"object\"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var De=Object.freeze({__proto__:null,shimLocalStreamsAPI:Ie,shimRemoteStreamsAPI:Ee,shimCallbacksAPI:ye,shimGetUserMedia:ke,shimConstraints:be,shimRTCIceServerUrls:Pe,shimTrackEventTransceiver:Oe,shimCreateOfferLegacy:Le,shimAudioContext:Ne});function Ae(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&\"foundation\"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if(\"object\"==typeof e&&e.candidate&&0===e.candidate.indexOf(\"a=\")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const r=new t(e),i=Z.parseCandidate(e.candidate),n=Object.assign(r,i);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,L(e,\"icecandidate\",(t=>(t.candidate&&Object.defineProperty(t,\"candidate\",{value:new e.RTCIceCandidate(t.candidate),writable:\"false\"}),t)))}function Me(e,t){if(!e.RTCPeerConnection)return;\"sctp\"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,\"sctp\",{get(){return void 0===this._sctp?null:this._sctp}});const r=function(e){if(!e||!e.sdp)return!1;const t=Z.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Z.parseMLine(e);return t&&\"application\"===t.kind&&-1!==t.protocol.indexOf(\"SCTP\")}))},i=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r},n=function(e){let r=65536;return\"firefox\"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},s=function(e,r){let i=65536;\"firefox\"===t.browser&&57===t.version&&(i=65535);const n=Z.matchPrefix(e.sdp,\"a=max-message-size:\");return n.length>0?i=parseInt(n[0].substr(19),10):\"firefox\"===t.browser&&-1!==r&&(i=2147483637),i},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,\"chrome\"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();\"plan-b\"===e&&Object.defineProperty(this,\"sctp\",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const e=i(arguments[0]),t=n(e),r=s(arguments[0],e);let o;o=0===t&&0===r?Number.POSITIVE_INFINITY:0===t||0===r?Math.max(t,r):Math.min(t,r);const a={};Object.defineProperty(a,\"maxMessageSize\",{get:()=>o}),this._sctp=a}return o.apply(this,arguments)}}function xe(e){if(!e.RTCPeerConnection||!(\"createDataChannel\"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const i=arguments[0],n=i.length||i.size||i.byteLength;if(\"open\"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw new TypeError(\"Message too large (can send a maximum of \"+t.sctp.maxMessageSize+\" bytes)\");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},L(e,\"datachannel\",(e=>(t(e.channel,e.target),e)))}function Ue(e){if(!e.RTCPeerConnection||\"connectionState\"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,\"connectionState\",{get(){return{completed:\"connected\",checking:\"connecting\"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"onconnectionstatechange\",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener(\"connectionstatechange\",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener(\"connectionstatechange\",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),[\"setLocalDescription\",\"setRemoteDescription\"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event(\"connectionstatechange\",e);t.dispatchEvent(r)}return e},this.addEventListener(\"iceconnectionstatechange\",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function we(e,t){if(!e.RTCPeerConnection)return;if(\"chrome\"===t.browser&&t.version>=71)return;if(\"safari\"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf(\"\\na=extmap-allow-mixed\")){const r=t.sdp.split(\"\\n\").filter((e=>\"a=extmap-allow-mixed\"!==e.trim())).join(\"\\n\");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function $e(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(\"chrome\"===t.browser&&t.version<78||\"firefox\"===t.browser&&t.version<68||\"safari\"===t.browser)&&arguments[0]&&\"\"===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}var je=Object.freeze({__proto__:null,shimRTCIceCandidate:Ae,shimMaxMessageSize:Me,shimSendThrowTypeError:xe,shimConnectionState:Ue,removeExtmapAllowMixed:we,shimAddIceCandidateNullOrEmpty:$e});const Ve=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const r=A,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser=\"Not a browser.\",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser=\"firefox\",t.version=O(r.userAgent,/Firefox\\/(\\d+)\\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser=\"chrome\",t.version=O(r.userAgent,/Chrom(e|ium)\\/(\\d+)\\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\\/(\\d+).(\\d+)$/))t.browser=\"edge\",t.version=O(r.userAgent,/Edge\\/(\\d+).(\\d+)$/,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\\/(\\d+)\\./))return t.browser=\"Not a supported browser.\",t;t.browser=\"safari\",t.version=O(r.userAgent,/AppleWebKit\\/(\\d+)\\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&\"currentDirection\"in e.RTCRtpTransceiver.prototype}return t}(e),n={browserDetails:i,commonShim:je,extractVersion:O,disableLog:N,disableWarnings:D};switch(i.browser){case\"chrome\":if(!z||!Y||!t.shimChrome)return r(\"Chrome shim is not included in this adapter release.\"),n;if(null===i.version)return r(\"Chrome shim can not determine version, not shimming.\"),n;r(\"adapter.js shimming chrome.\"),n.browserShim=z,$e(e,i),V(e,i),B(e),Y(e,i),H(e),W(e,i),F(e),K(e),G(e),q(e,i),Ae(e),Ue(e),Me(e,i),xe(e),we(e,i);break;case\"firefox\":if(!Te||!pe||!t.shimFirefox)return r(\"Firefox shim is not included in this adapter release.\"),n;r(\"adapter.js shimming firefox.\"),n.browserShim=Te,$e(e,i),le(e,i),pe(e,i),he(e),fe(e),_e(e),me(e),ve(e),Re(e),ge(e),Se(e),Ce(e),Ae(e),Ue(e),Me(e,i),xe(e);break;case\"edge\":if(!ue||!ce||!t.shimEdge)return r(\"MS edge shim is not included in this adapter release.\"),n;r(\"adapter.js shimming edge.\"),n.browserShim=ue,oe(e),ae(e),ce(e,i),de(e),Me(e,i),xe(e);break;case\"safari\":if(!De||!t.shimSafari)return r(\"Safari shim is not included in this adapter release.\"),n;r(\"adapter.js shimming safari.\"),n.browserShim=De,$e(e,i),Pe(e),Le(e),ye(e),Ie(e),Ee(e),Oe(e),ke(e),Ne(e),Ae(e),Me(e,i),xe(e),we(e,i);break;default:r(\"Unsupported browser!\")}return n}({window:\"undefined\"==typeof window?void 0:window});var Be,He,Fe;!function(e){e.FPS_10=\"FPS_10\",e.FPS_15=\"FPS_15\",e.FPS_24=\"FPS_24\",e.FPS_30=\"FPS_30\"}(Be||(Be={})),function(e){e.W176_H132=\"W176_H132\",e.W176_H144=\"W176_H144\",e.W256_H144=\"W256_H144\",e.W320_H180=\"W320_H180\",e.W240_H240=\"W240_H240\",e.W320_H240=\"W320_H240\",e.W480_H360=\"W480_H360\",e.W640_H360=\"W640_H360\",e.W480_H480=\"W480_H480\",e.W640_H480=\"W640_H480\",e.W720_H480=\"W720_H480\",e.W1280_H720=\"W1280_H720\",e.W1920_H1080=\"W1920_H1080\"}(He||(He={})),function(e){e[e.AUDIO_ONLY=0]=\"AUDIO_ONLY\",e[e.VIDEO_ONLY=1]=\"VIDEO_ONLY\",e[e.AUDIO_VIDEO=2]=\"AUDIO_VIDEO\"}(Fe||(Fe={}));const Ke={[He.W176_H132]:{width:176,height:132,maxBitrate:150,minBitrate:80},[He.W176_H144]:{width:176,height:144,maxBitrate:160,minBitrate:80},[He.W256_H144]:{width:256,height:144,maxBitrate:240,minBitrate:120},[He.W320_H180]:{width:320,height:180,maxBitrate:280,minBitrate:120},[He.W240_H240]:{width:240,height:240,maxBitrate:280,minBitrate:120},[He.W320_H240]:{width:320,height:240,maxBitrate:400,minBitrate:120},[He.W480_H360]:{width:480,height:360,maxBitrate:650,minBitrate:150},[He.W640_H360]:{width:640,height:360,maxBitrate:800,minBitrate:180},[He.W480_H480]:{width:480,height:480,maxBitrate:800,minBitrate:180},[He.W640_H480]:{width:640,height:480,maxBitrate:900,minBitrate:200},[He.W720_H480]:{width:720,height:480,maxBitrate:1e3,minBitrate:200},[He.W1280_H720]:{width:1280,height:720,maxBitrate:2200,minBitrate:250},[He.W1920_H1080]:{width:1920,height:1080,maxBitrate:4e3,minBitrate:400}},Ge=(e,t)=>{const r=e*t;let i=Number.MAX_VALUE,n=null;for(const e in Ke){const t=Ke[e],s=Math.abs(t.width*t.height-r);s<i&&(n=t,i=s)}return n},Je={10:1,15:1,24:1.5,30:1.5},We=e=>{let t=Number.MAX_VALUE,r=1;for(const i in Je){const n=Math.abs(e-parseInt(i));n<t&&(t=n,r=Je[i])}return r},Ye={getCameras:()=>S(void 0,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((e=>\"videoinput\"===e.kind))})),getMicrophones:()=>S(void 0,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((e=>\"audioinput\"===e.kind))})),getSpeakers:()=>S(void 0,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((e=>\"audiooutput\"===e.kind))}))};class qe extends _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.EventEmitter{constructor(e,t,r,i,n){super(),this._tag=e,this._userId=t,this._kind=r,this._isLocalTrack=i,this._roomId=n,this._localMuted=!1,this._remoteMuted=!1,this._streamId=[this._userId||this._roomId,this._tag].join(\"_\"),this._id=[this._streamId,this.isAudioTrack()?0:1].join(\"_\")}getStreamId(){return this._streamId}getTrackId(){return this._id}getUserId(){return this._userId}__innerGetMediaStreamTrack(){return this._msTrack}getTag(){return this._tag}isLocalTrack(){return this._isLocalTrack}isVideoTrack(){return\"video\"===this._kind}isAudioTrack(){return\"audio\"===this._kind}isReady(){var e;return\"live\"===(null===(e=this._msTrack)||void 0===e?void 0:e.readyState)}__innerSetMediaStreamTrack(e){this._msTrack=e,this._setLocalMuted(this._localMuted);const t=this._msStream=this._msStream||new MediaStream,r=t.getTracks()[0];r&&t.removeTrack(r),e?t.addTrack(e):this._element&&(this._element.pause(),this._element.srcObject=null)}_setLocalMuted(e){this._msTrack&&(this._msTrack.enabled=!e),this._localMuted=e}mute(){C.info(`set ${this._id} enabled: false`),this._setLocalMuted(!0)}unmute(){C.info(`set ${this._id} enabled: true`),this._setLocalMuted(!1)}isLocalMuted(){return this._localMuted}isMCUTrack(){return Boolean(this._roomId)}isOwnerMuted(){return this._remoteMuted}play(e,t){return S(this,void 0,void 0,(function*(){if(!this._msTrack)return C.warn(`the track is not ready to play -> id: ${this._id}`),{code:T.TRACK_NOT_READY};if(\"ended\"===this._msTrack.readyState&&C.warn(`the track's readyState is 'ended' -> id: ${this._id}`),null==t?void 0:t.volume){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(null==t?void 0:t.volume))return C.error(`${null==t?void 0:t.volume} is not a number, the valid range of options.volume is 0-100`),{code:T.PARAMS_ERROR};(null==t?void 0:t.volume)<0&&(t.volume=0,C.warn(\"the valid range of options.volume is 0-100, the value of volume has been set 0\")),(null==t?void 0:t.volume)>100&&(t.volume=100,C.warn(\"the valid range of options.volume is 0-100, the value of volume has been set 100\"))}if(null==t?void 0:t.audioDeviceId){if(!(yield Ye.getSpeakers()).map((e=>e.deviceId)).includes(t.audioDeviceId))return C.error(`the options.audioDeviceId is invalid --\\x3e ${t.audioDeviceId}`),{code:T.PARAMS_ERROR}}const i=this.isVideoTrack();if(i&&(!e||!(e instanceof HTMLVideoElement)))return C.error(`the video track need an <video> to play -> id: ${this._id}`),{code:T.VIDEO_TRACK_MISS_MEDIA_ELEMENT};this._element=i?e:this._element||new Audio,this._localMuted&&this._setLocalMuted(!1),this._element.srcObject&&this._element.srcObject===this._msStream||this._element.pause(),this._element.onloadstart=e=>{var t;C.debug(`HTMLMediaElement onloadstart -> id: ${null===(t=e.target)||void 0===t?void 0:t.id}, trackId: ${this._id}`)},this._element.ondurationchange=e=>{var t;C.debug(`HTMLMediaElement ondurationchange -> id: ${null===(t=e.target)||void 0===t?void 0:t.id}, trackId: ${this._id}`)},this._element.onloadedmetadata=e=>{var t;C.debug(`HTMLMediaElement onloadedmetadata -> id: ${null===(t=e.target)||void 0===t?void 0:t.id}, trackId: ${this._id}`)},this._element.onloadeddata=e=>{var t;C.debug(`HTMLMediaElement onloadeddata -> id: ${null===(t=e.target)||void 0===t?void 0:t.id}, trackId: ${this._id}`)},this._element.onabort=e=>{var t;C.info(`HTMLMediaElement onabort -> id: ${null===(t=e.target)||void 0===t?void 0:t.id}, trackId: ${this._id}`)},this._element.oncanplay=e=>{var t;C.info(`HTMLMediaElement oncanplay -> id: ${null===(t=e.target)||void 0===t?void 0:t.id}, trackId: ${this._id}`)},this._element.onvolumechange=e=>{var t;const r=Math.floor(100*(null===(t=e.target)||void 0===t?void 0:t.volume));C.info(`HTMLMediaElement onvolumechange -> volume: ${r}, trackId: ${this._id}`)},this._element.srcObject=this._msStream,this._element.autoplay=!0,i&&(this._element.playsInline=!0,this._element.x5PlaysInline=!0,this._element.webkitPlaysInline=!0),i||!(null==t?void 0:t.volume)&&0!==(null==t?void 0:t.volume)||(this._element.volume=(null==t?void 0:t.volume)/100);try{(null==t?void 0:t.audioDeviceId)&&!i?yield this._element.setSinkId(t.audioDeviceId):this._element.play()}catch(e){return\"No permission to use requested device\"===e.message?(C.error(`setSinkId failed -> ${e.message}`),{code:T.NO_PERMISSION_TO_USE_REQUESTED_DEVICE}):(C.error(e),{code:T.TRACK_PLAY_ERROR})}return{code:T.SUCCESS}}))}__innerDestroy(){this.__innerSetMediaStreamTrack(void 0)}__releaseMediaElement(){this._element&&(this._element.remove(),this._element.srcObject=null)}}class ze extends qe{constructor(e,t,r,i){super(e,t,r,!0),this._isPublished=!1,this.__innerSetMediaStreamTrack(i),i.onended=()=>{i.onended=null,this.emit(ze.EVENT_LOCAL_TRACK_END,this),this.removeAll(ze.EVENT_LOCAL_TRACK_END)}}_setLocalMuted(e){const t=this._localMuted!==e;super._setLocalMuted(e),this._remoteMuted=this._localMuted,t&&this.emit(ze.__INNER_EVENT_MUTED_CHANGE__,this)}__innerSetPublished(e){this._isPublished=e}isPublished(){return this._isPublished}destroy(){var e;C.info(`track is destroyed -> trackId: ${this.getTrackId()}`),null===(e=this._msTrack)||void 0===e||e.stop(),super.__innerDestroy(),this.isAudioTrack()&&super.__releaseMediaElement(),this.emit(ze.__INNER_EVENT_DESTROY__,this)}setBitrate(e=0,t=0,i=0){!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)||!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(t)||!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(i)||e<=0||t<=0||e<t?C.error(\"setBitrate params error ->\"):this._bitrateInfo={max:e,min:t,start:i}}getBitrate(){var e,t;const{min:r,max:i}=this._msTrack?_t(this._msTrack):{min:0,max:0};return{min:(null===(e=this._bitrateInfo)||void 0===e?void 0:e.min)||r,max:(null===(t=this._bitrateInfo)||void 0===t?void 0:t.max)||i}}}ze.EVENT_LOCAL_TRACK_END=\"local-track-end\",ze.__INNER_EVENT_MUTED_CHANGE__=\"inner-muted-change\",ze.__INNER_EVENT_DESTROY__=\"inner-destroy\";class Qe extends ze{constructor(e,t,r){super(e,t,\"audio\",r)}setBitrate(e,t,r){C.warn(\"`setBitrate` invalid for audio track\")}getBitrate(){return{start:32,max:32,min:32}}}class Xe extends ze{constructor(e,t,r,i=!1){super(e,t,\"video\",r),this._isTiny=i}__isTiny(){return this._isTiny}getStreamId(){const e=super.getStreamId();return this._isTiny?`${e}_tiny`:e}getTrackId(){const e=super.getTrackId();return this._isTiny?`${e}_tiny`:e}}class Ze extends ze{constructor(e,t,r,i,n){super(e,t,r,i),this._resource=n,Ze.__innerSetMapping(this.getTrackId(),n)}static __innerSetMapping(e,t){const r=this._mapping.get(t)||[];r.push(e),this._mapping.set(t,r)}static __innerRemoveMapping(e,t){var r,i;const n=null===(r=this._mapping.get(t))||void 0===r?void 0:r.filter((t=>t!==e));n&&n.length>0?this._mapping.set(t,n):(this._mapping.delete(t),t.pause(),t.src=\"\",null===(i=t.parentNode)||void 0===i||i.removeChild(t))}destroy(){this.isAudioTrack()&&this.mute(),Ze.__innerRemoveMapping(this.getTrackId(),this._resource),super.destroy()}}Ze._mapping=new Map;class et extends Ze{constructor(e,t,r,i){super(e,t,\"video\",r,i)}}class tt extends Ze{constructor(e,t,r,i){super(e,t,\"audio\",r,i)}_setLocalMuted(e){this._resource&&(this._resource.muted=e),super._setLocalMuted(e)}play(){return this._setLocalMuted(!1),Promise.resolve({code:T.SUCCESS})}}class rt extends Qe{}class it extends Xe{}class nt extends Xe{}class st extends qe{constructor(e,t,r,i){super(e,t,r,!1,i),this._isSubscribed=!1}__innerSetRemoteMuted(e){this._remoteMuted=e}__innerSetSubscribed(e){this._isSubscribed=e}isSubscribed(){return this._isSubscribed}}class ot extends st{constructor(e,t,r){super(e,t,\"audio\",r)}}class at extends st{constructor(e,t,r){super(e,t,\"video\",r)}}const ct=(e,t)=>({name:e,content:JSON.stringify({uris:t,ignore:!0})}),dt=e=>JSON.stringify(e),ut=e=>/^[a-zA-Z\\d-=]+$/g.test(e),lt=\"http:\"!==location.protocol||[\"localhost\",\"127.0.0.1\"].includes(location.hostname),ht=e=>{if(void 0===e)return 0;if((0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e))return e;const t=e;return t.exact||t.ideal||t.max||0},pt=e=>{const t=e.getConstraints();return{width:ht(t.width),height:ht(t.height),frameRate:ht(t.frameRate)}},_t=e=>{const{width:t,height:r,frameRate:i}=pt(e),n=Ge(t,r),s=We(i);return{min:n.minBitrate*s,max:n.maxBitrate*s}},mt=e=>[e.msid,e.mediaType].join(\"_\"),ft=e=>{const t=e.split(\"_\");return{mediaType:parseInt(t.pop()),tag:t.pop(),userId:t.join(\"_\")}},vt=(e,t)=>[e,t].join(\"_\"),Rt=e=>e.map((e=>Object.assign({},e))),gt=(e,t,r=!1)=>{e=e.slice();const i=[],n=[],s=[];return t.forEach((t=>{const n=mt(t);let o=e.findIndex((e=>mt(e)===n));if(r&&(o=e.findIndex((e=>e.uri===t.uri))),-1===o)return void i.push(t);const a=e[o];a.uri!==t.uri?i.push(t):a.state!==t.state&&s.push(t),e.splice(o,1)})),n.push(...e),{publishedList:i,unpublishedList:n,modifiedList:s}},St=()=>{let e=\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return(\"x\"===e?t:3&t|8).toString(16)}));return e=e.replace(/-/g,\"\")+\"0\",e=parseInt(e,16),e=(e=>{const t=\"0123456789abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ+/\".split(\"\"),r=t.length+1;let i=+e;const n=[];do{const e=i%r;i=(i-e)/r,n.unshift(t[e])}while(i);return n.join(\"\")})(e),e.length>22&&(e=e.slice(0,22)),e},Ct=e=>{const[t,r]=e.split(\"_\").map((e=>parseInt(e.replace(/[^\\d]/g,\"\"))));return{width:t,height:r}},Tt=e=>!!He[e],It=e=>!!Be[e],Et=e=>parseInt(e.replace(\"FPS_\",\"\")),yt=(()=>{const{browser:e,version:t,supportsUnifiedPlan:r}=Ve.browserDetails;return{browser:e,version:t,supportsUnifiedPlan:!1!==r}})();function kt(){return\"captureStream\"in HTMLMediaElement.prototype||\"mozCaptureStream\"in HTMLMediaElement.prototype}function bt(){return\"mediaDevices\"in navigator&&\"getDisplayMedia\"in navigator.mediaDevices}const Pt=e=>\"[object Null]\"===Object.prototype.toString.call(e),Ot=e=>1===e.type,Lt=e=>{const t={},r=Object.keys(e.users);return r.length&&r.forEach((r=>{const i=[],n=e.users[r];if(n.uris)try{i.push(...JSON.parse(n.uris))}catch(e){C.warn(`invalid user data -> userId: ${r}, userData: ${n}`)}t[r]=i})),t};var Nt,Dt;!function(e){e.PUBLISH=\"RCRTC:PublishResource\",e.UNPUBLISH=\"RCRTC:UnpublishResource\",e.MODIFY=\"RCRTC:ModifyResource\",e.TOTAL_CONTENT_RESOURCE=\"RCRTC:TotalContentResources\",e.STATE=\"RCRTC:state\",e.ROOM_NOTIFY=\"RCRTC:RoomNtf\",e.USER_NOTIFY=\"RCRTC:UserNtf\",e.KICK=\"RCRTC:kick\",e.PK_INVITE=\"RCRTC:invite\",e.PK_INVITE_TIMEOUT=\"RCRTC:inviteTimeout\",e.PK_CANCEL_INVITE=\"RCRTC:cancelInvite\",e.PK_INVITE_ANSWER=\"RCRTC:answerInvite\",e.PK_END=\"RCRTC:endInvite\",e.OTHER_ROOM_OFFLINE=\"RCRTC:otherRoomOffline\"}(Nt||(Nt={})),function(e){e.SUCCESS=\"Success\",e.FAIL=\"Fail\"}(Dt||(Dt={}));class At{constructor(e,t,r,i=1e4){this._roomId=e,this._roomMode=t,this._context=r,this._gap=i,this._latestTimestamp=Date.now(),this._timer=null}start(){return S(this,void 0,void 0,(function*(){this._timer||(this._timer=setInterval(this._loop.bind(this),this._gap))}))}_loop(){var e,t,r;return S(this,void 0,void 0,(function*(){const n=yield new Promise((e=>{this._context.rtcPing(this._roomId,this._roomMode).then(e).catch((t=>{C.error(`rtcping receive unknown error -> ${t}`),e(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.UNKNOWN)})),setTimeout(e,1e4,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.TIMEOUT)})),s=Date.now();if(n===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return this._latestTimestamp=s,void(null===(e=this.onPingResult)||void 0===e||e.call(this,Dt.SUCCESS));null===(t=this.onPingResult)||void 0===t||t.call(this,Dt.FAIL),C.warn(`rtcping failed -> code: ${n}`),(40003===n||s-this._latestTimestamp>6e4)&&(this.stop(),null===(r=this.onFailed)||void 0===r||r.call(this,40003===n))}))}stop(){this._timer&&(clearInterval(this._timer),this._timer=null)}}var Mt;!function(e){e[e.NORMAL=1]=\"NORMAL\",e[e.TINY=2]=\"TINY\"}(Mt||(Mt={}));const xt=(e,t)=>Math.round(8*t/e),Ut=(e,t=2)=>{const r=10**t;return Math.round(e*r)/r},wt=(e,t=2)=>{e>1&&(e/=32767);const r=10**t;return Math.ceil(e*r)},$t=(e,t,r,i)=>{if(0===t)return 0;if(!r||!i)return Ut(e/t,3);const n=t-i;if(0===n)return 0;const s=e-r;return s<0||n<0?0:Ut(s/n,3)},jt=e=>{const{jitter:t,rtt:r,packetsLostRate:i}=e;return!Pt(t)||!Pt(r)||0!==i};class Vt{constructor(e,t){this._rtcPeerConn=e,this._sdpSemantics=t,this._latestPacketsSent={},this._latestBytesSent={},this._latestBytesRecv={},this._latestPacketsRecv={}}updateBytesSent(e,t,r){let i,n;if(this._latestBytesSent[e]&&t<this._latestBytesSent[e].bytesSent&&this.clearLatestpacketsSent([e]),this._latestBytesSent[e]){const{bytesSent:s,timestamp:o}=this._latestBytesSent[e];i=t-s,n=r-o,this._latestBytesSent[e]={bytesSent:t,timestamp:r}}else i=t,n=1e3,this._latestBytesSent[e]={bytesSent:t,timestamp:r};return xt(n,i)}updateBytesRecv(e,t,r){let i,n;if(this._latestBytesRecv[e]&&t<this._latestBytesRecv[e].bytesRecv&&this.clearLatestPacketsRecv([e]),this._latestBytesRecv[e]){const{bytesRecv:s,timestamp:o}=this._latestBytesRecv[e];i=t-s,n=r-o,this._latestBytesRecv[e]={bytesRecv:t,timestamp:r}}else i=t,n=1e3,this._latestBytesRecv[e]={bytesRecv:t,timestamp:r};return xt(n,i)}updateSenderPacketsLost(e,t,r){let i;if(Object.prototype.hasOwnProperty.call(this._latestPacketsSent[e],\"packetsSent\")){const{packetsLost:n,packetsSent:s}=this._latestPacketsSent[e];i=$t(t,r,n,s),this._latestPacketsSent[e].packetsLost=t,this._latestPacketsSent[e].packetsSent=n===t?s:r}else i=$t(t,r),this._latestPacketsSent[e].packetsLost=t,this._latestPacketsSent[e].packetsSent=r;return i}updateReceiverPacketsLost(e,t,r){let i;if(this._latestPacketsRecv[e]){const{packetsLost:n,packetsRecv:s}=this._latestPacketsRecv[e];i=$t(t,r+t,n,s+n)}else i=$t(t,r);return this._latestPacketsRecv[e]={packetsLost:t,packetsRecv:r},i}clearLatestpacketsSent(e){e.forEach((e=>{if(parseInt(e.split(\"_\").pop())===Fe.VIDEO_ONLY){const t=`${e}_tiny`;delete this._latestPacketsSent[t],delete this._latestBytesSent[t]}delete this._latestPacketsSent[e],delete this._latestBytesSent[e]}))}clearLatestPacketsRecv(e){e.forEach((e=>{delete this._latestPacketsRecv[e],delete this._latestBytesRecv[e]}))}parseRTCStatsReport(e){const t=e.keys(),r={};let i=t.next();for(;!i.done;){const n=i.value,s=e.get(n);/^RTCCodec_/.test(n)||(r[n]=s),i=t.next()}return r}formatRCRTCStateReport(e){return{senders:[],receivers:[]}}getAudioLevelList(e){return[]}getResourceIdByParseSdp(e){var t,r;const i=e.ssrc,n=e.kind||e.mediaType,s=null===(t=this._rtcPeerConn.currentLocalDescription)||void 0===t?void 0:t.sdp,o=null===(r=this._rtcPeerConn.currentRemoteDescription)||void 0===r?void 0:r.sdp;let a;a=\"unified-plan\"===this._sdpSemantics?new RegExp(\"a=msid:(.*?) \"):new RegExp(`a=ssrc:${i} msid:(.*?) `);const c=null==s?void 0:s.split(\"\\r\\nm=\"),d=null==c?void 0:c.filter((e=>e.includes(`a=ssrc:${i}`)))[0],u=null==d?void 0:d.match(a);let l=u?u[1]:\"\";if(l)return`${l}_${\"video\"===n?1:0}`;const h=null==o?void 0:o.split(\"\\r\\nm=\"),p=null==h?void 0:h.filter((e=>e.includes(`a=ssrc:${i}`)))[0],_=null==p?void 0:p.match(a);return l=_?_[1]:\"\",`${l}_${\"video\"===n?1:0}`}isValidSender(e){var t;const r=null===(t=this._rtcPeerConn.currentLocalDescription)||void 0===t?void 0:t.sdp,{ssrc:i}=e;return!(null==r?void 0:r.split(\"\\r\\nm=\").some((e=>e.includes(i)&&e.includes(\"a=inactive\"))))}isValidReceiver(e){var t;const r=null===(t=this._rtcPeerConn.currentRemoteDescription)||void 0===t?void 0:t.sdp,{ssrc:i}=e;return!(null==r?void 0:r.split(\"\\r\\nm=\").some((e=>e.includes(i)&&e.includes(\"a=inactive\"))))}}class Bt extends Vt{formatRCRTCStateReport(e){const t={senders:[],receivers:[]},r=Math.floor(e.RTCPeerConnection.timestamp);t.timestamp=r;const i=Object.keys(e);let n=0,s=0;i.filter((e=>/^RTCOutboundRTP(Video|Audio)Stream_/.test(e))).forEach((i=>{const o=e[i];if(\"unified-plan\"===this._sdpSemantics&&!this.isValidSender(o))return;const{id:a,kind:c,transportId:d,mediaSourceId:u,remoteId:l,packetsSent:h,bytesSent:p,trackId:_,encoderImplementation:m,pliCount:f,nackCount:v,firCount:R}=o;if(!_)return;let{framesPerSecond:g,frameWidth:S,frameHeight:C}=o;\"video\"!==c||S||C||g||(S=e[_].frameWidth,C=e[_].frameHeight,g=u?e[u].framesPerSecond:null);const T=e[l];let I=null,E=null,y=0;T&&(I=T.jitter,E=T.roundTripTime,y=T.packetsLost),n+=y;const k=this.getResourceIdByParseSdp(o),b=u?e[u].audioLevel:e[_].audioLevel;let P=null;!this._latestPacketsSent[k]&&(this._latestPacketsSent[k]={}),T?P=this.updateSenderPacketsLost(k,y,h):this._latestPacketsSent[k].crtPacketsSent=h;let O=this.updateBytesSent(k,p,r);O<0&&(O=0),s+=O,t.senders.push({id:a,trackId:k,kind:c,packetsLostRate:P,remoteResource:!1,audioLevel:b||0===b?wt(b):null,frameWidth:S,frameHeight:C,frameRate:g,bitrate:O,jitter:I?Math.round(1e3*I):I,rtt:E,encoderImplementation:m,pliCount:f,nackCount:v,googFirsSent:-1,samplingRate:-1,googRenderDelayMs:-1,trackState:-1})}));i.filter((e=>/RTCRemoteInboundRtp(Video|Audio)Stream_/.test(e))).forEach((r=>{const{localId:i,jitter:n,roundTripTime:s,packetsLost:o}=e[r],a=t.senders.filter((e=>e.id===i))[0];if(a&&!jt(a)){const t=this.getResourceIdByParseSdp(e[a.id]);a.jitter=Math.round(1e3*n),a.rtt=s;const r=this._latestPacketsSent[t].crtPacketsSent;a.packetsLostRate=this.updateSenderPacketsLost(t,o,r)}}));let o=0;i.filter((e=>/^RTCInboundRTP(Video|Audio)Stream_/.test(e))).forEach((i=>{const s=e[i];if(\"unified-plan\"===this._sdpSemantics&&!this.isValidReceiver(s))return;const{trackId:a,packetsLost:c,packetsReceived:d,jitter:u,bytesReceived:l,framesPerSecond:h,kind:p,codecImplementationName:_,nackCount:m,pliCount:f}=s;if(!a)return;let{frameWidth:v,frameHeight:R,audioLevel:g}=s;\"video\"===p?v||R||(v=e[a].frameWidth,R=e[a].frameHeight):g||(g=e[a].audioLevel),n+=c;const S=this.getResourceIdByParseSdp(s),C=this.updateReceiverPacketsLost(S,c,d);let T=this.updateBytesRecv(S,l,r);T<0&&(T=0),o+=T,t.receivers.push({trackId:S,kind:p,packetsLostRate:C,remoteResource:!0,audioLevel:g||0===g?wt(g):null,frameWidth:v,frameHeight:R,frameRate:h,bitrate:T,jitter:u?Math.round(1e3*u):0,codecImplementationName:_,nackCount:m,pliCount:f,rtt:null,samplingRate:-1,googFirsReceived:-1,googRenderDelayMs:-1,trackState:-1})}));const a=i.filter((e=>/^RTCTransport_/.test(e)))[0];if(a){const r=e[a],{selectedCandidatePairId:i}=r;if(i){const r=e[i],{availableOutgoingBitrate:a,availableIncomingBitrate:c,currentRoundTripTime:d,localCandidateId:u,remoteCandidateId:l}=r,h=e[u],{ip:p,port:_,networkType:m}=h,f=e[l],{ip:v,port:R,protocol:g}=f;t.iceCandidatePair={IP:p,port:_,networkType:m,remoteIP:v,remotePort:R,protocol:g,bitrateRecv:o,bitrateSend:s,rtt:1e3*d,availableOutgoingBitrate:a,availableIncomingBitrate:c,totalPacketsLost:n},t.receivers.forEach((e=>{e.rtt=d}))}}return t}getAudioLevelList(e){const t=[],r=Object.keys(e);r.filter((e=>/^RTCOutboundRTPAudioStream_/.test(e))).forEach((r=>{var i;const n=e[r];if(\"unified-plan\"===this._sdpSemantics&&!this.isValidSender(n))return;const{mediaSourceId:s,trackId:o}=n,a=this.getResourceIdByParseSdp(n),c=s&&e[s]?e[s].audioLevel:(null===(i=e[o])||void 0===i?void 0:i.audioLevel)||null;t.push({trackId:a,audioLevel:c||0===c?wt(c):null})}));return r.filter((e=>/^RTCInboundRTPAudioStream_/.test(e))).forEach((r=>{const i=e[r];if(\"unified-plan\"===this._sdpSemantics&&!this.isValidReceiver(i))return;const{trackId:n}=i,s=i.audioLevel||e[n].audioLevel,o=this.getResourceIdByParseSdp(i);t.push({trackId:o,audioLevel:s||0===s?wt(s):null})})),t}}class Ht extends Vt{formatRCRTCStateReport(e){const t=+new Date,r={senders:[],receivers:[],timestamp:t};let i=0,n=0,s=0;for(const o in e){const a=e[o],c=a.type;if(\"outbound-rtp\"===c){if(\"unified-plan\"===this._sdpSemantics&&!this.isValidSender(a))continue;const{id:s,kind:o,bytesSent:c,packetsSent:d,bitrateMean:u,framerateMean:l,nackCount:h,pliCount:p,remoteId:_}=a,{jitter:m,roundTripTime:f,packetsLost:v}=_?e[_]:{jitter:null,roundTripTime:null,packetsLost:0},R=this.getResourceIdByParseSdp(a);i+=v;let g=null;!this._latestPacketsSent[R]&&(this._latestPacketsSent[R]={}),_?g=this.updateSenderPacketsLost(R,v,d):this._latestPacketsSent[R].crtPacketsSent=d;let S=0;\"video\"===o?u&&(S=Math.floor(u/1e3)):S=this.updateBytesSent(R,c,t),S<0&&(S=0),n+=S,r.senders.push({trackId:R,kind:o,packetsLostRate:g,remoteResource:!1,audioLevel:null,frameWidth:null,frameHeight:null,frameRate:Math.floor(l),bitrate:S,jitter:m?Math.round(1e3*m):null,rtt:f,encoderImplementation:null,pliCount:p,nackCount:h,googFirsSent:-1,samplingRate:-1,googRenderDelayMs:-1,trackState:-1})}if(\"remote-inbound-rtp\"===c){const{localId:t}=a,i=this.getResourceIdByParseSdp(e[t]),n=r.senders.filter((e=>e.trackId===i))[0];n&&jt(n)&&(n.jitter=Math.round(1e3*a.jitter),n.rtt=a.rtt,n.packetsLostRate=this.updateSenderPacketsLost(i,a.packetsLost,this._latestPacketsSent[i].crtPacketsSent))}if(\"inbound-rtp\"===c){if(\"unified-plan\"===this._sdpSemantics&&!this.isValidReceiver(a))continue;const{id:e,packetsLost:n,bytesReceived:o,packetsReceived:c,jitter:d,framerateMean:u,kind:l,bitrateMean:h,nackCount:p,pliCount:_}=a,m=this.getResourceIdByParseSdp(a);i+=n;const f=this.updateReceiverPacketsLost(m,n,c);let v=0;\"video\"===l?h&&(v=Math.floor(h/1e3)):v=this.updateBytesRecv(m,o,t),v<0&&(v=0),s+=v,r.receivers.push({trackId:m,kind:l,packetsLostRate:f,remoteResource:!0,audioLevel:null,frameWidth:null,frameHeight:null,frameRate:Math.floor(u),bitrate:v,jitter:d?Math.round(1e3*d):null,codecImplementationName:null,nackCount:p,pliCount:_,rtt:null,samplingRate:-1,googFirsReceived:-1,googRenderDelayMs:-1,trackState:-1})}if(\"candidate-pair\"===c&&\"succeeded\"===a.state){const t=e[a.localCandidateId],{address:o,port:c}=t,d=e[a.remoteCandidateId],{address:u,port:l,protocol:h}=d;r.iceCandidatePair={IP:o,port:c,networkType:null,remoteIP:u,remotePort:l,protocol:h,bitrateRecv:s,bitrateSend:n,rtt:null,availableOutgoingBitrate:null,availableIncomingBitrate:null,totalPacketsLost:i}}}return r.iceCandidatePair&&(r.iceCandidatePair.bitrateSend=n),r.iceCandidatePair&&(r.iceCandidatePair.bitrateRecv=s),r}getAudioLevelList(e){const t=[];for(const r in e){const i=e[r],n=i.type;if(\"outbound-rtp\"===n){if(\"unified-plan\"===this._sdpSemantics&&!this.isValidSender(i))continue;const{kind:e}=i;if(\"video\"===e)continue;const r=this.getResourceIdByParseSdp(i);t.push({trackId:r,audioLevel:null})}if(\"inbound-rtp\"===n){if(\"unified-plan\"===this._sdpSemantics&&!this.isValidReceiver(i))continue;const{kind:e}=i;if(\"video\"===e)continue;const r=this.getResourceIdByParseSdp(i);t.push({trackId:r,audioLevel:null})}}return t}}class Ft extends Vt{formatRCRTCStateReport(e){const t={senders:[],receivers:[]},r=Math.floor(e.RTCPeerConnection.timestamp);t.timestamp=r;const i=Object.keys(e);let n=0,s=0;i.filter((e=>/^RTCOutboundRTP(Video|Audio)Stream_/.test(e))).forEach((i=>{const n=e[i];if(\"unified-plan\"===this._sdpSemantics&&!this.isValidSender(n))return;const o=this.getResourceIdByParseSdp(n),{mediaType:a,transportId:c,remoteId:d,packetsSent:u,bytesSent:l,trackId:h,encoderImplementation:p,pliCount:_,nackCount:m,firCount:f}=n;if(!h)return;const{audioLevel:v,frameHeight:R,frameWidth:g}=e[h];let S=this.updateBytesSent(o,l,r);S<0&&(S=0),s+=S,t.senders.push({trackId:o,kind:a,packetsLostRate:null,remoteResource:!1,audioLevel:v||0===v?wt(v):null,frameWidth:g,frameHeight:R,frameRate:null,bitrate:S,jitter:null,rtt:null,encoderImplementation:p,pliCount:_,nackCount:m,googFirsSent:-1,samplingRate:-1,googRenderDelayMs:-1,trackState:-1})}));let o=0;i.filter((e=>/^RTCInboundRTP(Video|Audio)Stream_/.test(e))).forEach((i=>{const s=e[i];if(\"unified-plan\"===this._sdpSemantics&&!this.isValidReceiver(s))return;const{trackId:a,packetsLost:c,packetsReceived:d,jitter:u,bytesReceived:l,mediaType:h,nackCount:p,pliCount:_}=s,m=this.getResourceIdByParseSdp(s);if(!a)return;const{frameHeight:f,frameWidth:v,audioLevel:R}=e[a];n+=c;const g=this.updateReceiverPacketsLost(m,c,d);let S=this.updateBytesRecv(m,l,r);S<0&&(S=0),o+=S,t.receivers.push({trackId:m,kind:h,packetsLostRate:g,remoteResource:!0,audioLevel:R||0===R?wt(R):null,frameWidth:v,frameHeight:f,frameRate:null,bitrate:S,jitter:u,codecImplementationName:null,nackCount:p,pliCount:_,rtt:null,samplingRate:-1,googFirsReceived:-1,googRenderDelayMs:-1,trackState:-1})}));const a=i.filter((e=>/^RTCTransport_/.test(e)))[0];if(a){const r=e[a],{selectedCandidatePairId:i}=r;if(i){const r=e[i],{availableOutgoingBitrate:a,availableIncomingBitrate:c,currentRoundTripTime:d,localCandidateId:u,remoteCandidateId:l}=r,h=e[u],{address:p,port:_}=h,m=e[l],{address:f,port:v,protocol:R}=m;t.iceCandidatePair={IP:p||null,port:_,networkType:null,remoteIP:f,remotePort:v,protocol:R,bitrateRecv:o,bitrateSend:s,rtt:1e3*d,availableOutgoingBitrate:a,availableIncomingBitrate:c,totalPacketsLost:n},t.receivers.forEach((e=>{e.rtt=d}))}}return t}getAudioLevelList(e){const t=[],r=Object.keys(e);r.filter((e=>/^RTCOutboundRTP(Video|Audio)Stream_/.test(e))).forEach((r=>{const i=e[r];if(\"unified-plan\"===this._sdpSemantics&&!this.isValidSender(i))return;const{trackId:n,mediaType:s}=i;if(\"video\"===s)return;const o=this.getResourceIdByParseSdp(i),a=e[n];t.push({trackId:o,audioLevel:a||0===a?wt(a):null})}));return r.filter((e=>/^RTCInboundRTP(Video|Audio)Stream_/.test(e))).forEach((r=>{const i=e[r];if(\"unified-plan\"===this._sdpSemantics&&!this.isValidReceiver(i))return;const{trackId:n,mediaType:s}=i;if(!n||\"video\"===s)return;const{audioLevel:o}=e[n],a=this.getResourceIdByParseSdp(i);t.push({trackId:a,audioLevel:o||0===o?wt(o):null})})),t}}class Kt{constructor(e){this._peer=e,this._outboundStreams={}}static setSdpSemantics(e){const{browser:t,version:r,supportsUnifiedPlan:i}=yt;i?/chrome/i.test(t)?this._sdpSemantics=r>92?\"unified-plan\":r<72?\"plan-b\":e:/firefox/i.test(t)?this._sdpSemantics=\"unified-plan\":/safari/i.test(t)?this._sdpSemantics=r<12?\"plan-b\":\"unified-plan\":this._sdpSemantics=\"unified-plan\":this._sdpSemantics=\"plan-b\"}static getSdpSemantics(){return Kt._sdpSemantics}getOutboundVideoInfo(){const e=[];for(const t in this._outboundStreams){const r=this._outboundStreams[t].getVideoTracks()[0];if(!r)continue;const i=/_tiny$/.test(t),{width:n,height:s}=pt(r);e.push({trackId:r.id,simulcast:i?Mt.TINY:Mt.NORMAL,resolution:`${n}x${s}`})}return e}setRemoteAnswer(e){return S(this,void 0,void 0,(function*(){e=e.replace(/\\s+\\r\\n/g,\"\\r\\n\");try{yield this._peer.setRemoteDescription({type:\"answer\",sdp:e})}catch(e){return C.error(e),T.SET_REMOTE_DESCRIPTION_FAILED}return T.SUCCESS}))}getStatParsr(e,t){return/chrome/i.test(yt.browser)?new Bt(e,t):/Firefox/i.test(yt.browser)?new Ht(e,t):/Safari/i.test(yt.browser)?new Ft(e,t):null}}class Gt extends Kt{constructor(){super(...arguments),this.senders={},this._localTracks=[]}addLocalTrack(e){this._localTracks.includes(e)||this._localTracks.push(e);const t=e.getStreamId(),r=e.__innerGetMediaStreamTrack(),i=this._outboundStreams[t]||(this._outboundStreams[t]=new MediaStream);i.getTracks().forEach((e=>{e.kind===r.kind&&i.removeTrack(e)})),i.addTrack(r);const n=e.getTrackId(),s=this.senders[n];s?s.replaceTrack(r):this.senders[n]=this._peer.addTrack(r,i)}removeLocalTrack(e){const t=this._localTracks.findIndex((t=>t===e));t>=0&&this._localTracks.splice(t,1);const r=e.getTrackId(),i=this.senders[r];i&&(i.replaceTrack(null),this._peer.removeTrack(i),delete this.senders[r])}updateSubRemoteTracks(e){}updateRecvTransceiverMap(e,t){}setBitrate(e,t,r){this._maxBitrate=e,this._minBitrate=t,this._startBitrate=r||.7*e}createOffer(e){return S(this,void 0,void 0,(function*(){const t=yield this._peer.createOffer({iceRestart:e,offerToReceiveAudio:!0,offerToReceiveVideo:!0});for(const e in this._outboundStreams){const r=this._outboundStreams[e].id;t.sdp=t.sdp.replace(new RegExp(r,\"g\"),e)}return yield this._peer.setLocalDescription(t),{type:\"offer\",semantics:\"plan-b\",sdp:t.sdp}}))}setRemoteAnswer(e){let t=0,r=0;this._localTracks.forEach((e=>{const{min:i,max:n}=e.getBitrate();r+=i,t+=n})),t=this._maxBitrate&&this._maxBitrate>0?Math.min(t,this._maxBitrate):t,r=this._minBitrate&&this._minBitrate>0?Math.max(r,this._minBitrate):r;const i=this._startBitrate||Math.round(.7*t),n=`b=AS:${t}`;e=e.replace(/[\\r\\n]+m=video[^\\r\\n]+/,(e=>`${e}\\r\\n${n}`));const s=[`;x-google-min-bitrate=${r}`,`;x-google-max-bitrate=${t}`,`;x-google-start-bitrate=${i}`].join(\"\");return e=e.replace(/[\\r\\n]+[^\\r\\n]+profile-level-id[^\\r\\n]+/g,(e=>e+s)),super.setRemoteAnswer(e)}}class Jt extends Kt{constructor(){super(...arguments),this._sendTransceiver={},this._localTracks={},this._recvAudio=[],this._recvVideo=[],this._recvTransceiver={},this._subedTracks=[]}setBitrate(e,t,r){C.warn(\"the interface named `setBitrate` is invalid while sdpSemantics value is `unified-plan`\")}addLocalTrack(e){const t=e.getTrackId(),r=e.getStreamId(),i=e.__innerGetMediaStreamTrack();this._localTracks[t]=e;const n=this._outboundStreams[r]||(this._outboundStreams[r]=new MediaStream);n.getTracks().forEach((e=>{e.kind===i.kind&&n.removeTrack(e)})),n.addTrack(i);const s=this._sendTransceiver[t];s?(s.sender.replaceTrack(i),s.direction=\"sendonly\"):this._sendTransceiver[t]=this._peer.addTransceiver(i,{direction:\"sendonly\",streams:[n]})}removeLocalTrack(e){const t=e.getTrackId(),r=e.getStreamId();e.__innerGetMediaStreamTrack(),delete this._localTracks[t];const i=this._sendTransceiver[t];if(!i)return;i.direction=\"inactive\",this._peer.removeTrack(i.sender),i.sender.replaceTrack(null);const n=this._outboundStreams[r];(e.isAudioTrack()?n.getAudioTracks():n.getVideoTracks()).forEach((e=>n.removeTrack(e)));const s=this._sendTransceiver[`${t}_tiny`];if(!s||\"inactive\"===s.direction)return;s.direction=\"inactive\";const o=s.sender,a=o.track;this._peer.removeTrack(o),o.replaceTrack(null);this._outboundStreams[`${r}_tiny`].removeTrack(a),a.stop()}updateRecvTransceiverMap(e,t){const{mediaType:r}=ft(e);this._recvTransceiver[e]=t;const i=r===Fe.AUDIO_ONLY?this._recvAudio:this._recvVideo,n=i.findIndex((e=>e===t));n>=0&&i.splice(n,1)}updateSubRemoteTracks(e){const t=e.slice(),r=this._subedTracks.slice();this._subedTracks=e.slice();for(let e=t.length-1;e>=0;e-=1){const i=t[e],n=r.findIndex((e=>e===i));n>=0&&(t.splice(e,1),r.splice(n,1))}r.length&&r.forEach((e=>{const t=e.getTrackId();e.__innerSetMediaStreamTrack(void 0);const r=this._recvTransceiver[t];r&&(r.direction=\"inactive\")}));const i={audio:0,video:0};t.length&&t.forEach((e=>{const t=e.isAudioTrack()?\"audio\":\"video\",r=this._recvTransceiver[e.getTrackId()];r?r.direction=\"recvonly\":i[t]+=1}));for(let e=this._recvAudio.length;e<i.audio;e+=1)this._recvAudio.push(this._peer.addTransceiver(\"audio\",{direction:\"recvonly\"}));for(let e=this._recvVideo.length;e<i.video;e+=1)this._recvVideo.push(this._peer.addTransceiver(\"video\",{direction:\"recvonly\"}))}createOffer(e){return S(this,void 0,void 0,(function*(){const t=yield this._peer.createOffer({iceRestart:e});let r=t.sdp;for(const e in this._outboundStreams){const t=this._outboundStreams[e].id;r=r.replace(new RegExp(t,\"g\"),e)}return r=(e=>e.split(/\\r\\n(?=m=)/).map((e=>(e=>/a=(recvonly|inactive)/.test(e)?e.replace(/\\r\\na=(ssrc|msid)[^\\r\\n]+/g,\"\"):e)(e))).join(\"\\r\\n\"))(r),r=r.replace(/a=ice-options:trickle/g,\"a=ice-options:trickle\\r\\na=ice-options:renomination\"),t.sdp=r,yield this._peer.setLocalDescription(t),{type:\"offer\",semantics:\"unified-plan\",sdp:r}}))}setRemoteAnswer(e){e=e.split(/\\r\\n(?=m=)/).map((e=>{var t;const r=e.match(/a=mid:[^\\s]+/);if(!r)return e;const i=r[0].replace(\"a=mid:\",\"\");let n=\"\";for(const e in this._sendTransceiver){if(this._sendTransceiver[e].mid===i){n=e;break}}if(!n)return e;const s=null===(t=this._localTracks[n])||void 0===t?void 0:t.getBitrate();if(!s)return e;const{max:o,min:a}=s,c=o&&o>0?s.start||.7*o:0,d=[];if(o&&o>0&&d.push(`;x-google-max-bitrate=${o}`),a&&a>0&&d.push(`;x-google-min-bitrate=${a}`),c>0&&d.push(`;x-google-start-bitrate=${c}`),0===d.length)return e;const u=d.join(\"\");return e.replace(/[\\r\\n]+[^\\r\\n]+profile-level-id[^\\r\\n]+/g,(e=>e+u))})).join(\"\\r\\n\");const t=/[\\r\\n]+\\r\\n[\\r\\n]+/g;return t.test(e)&&(C.warn(`answer sdp invalid -> ${JSON.stringify(e)}`),e=e.replace(t,\"\\r\\n\")),super.setRemoteAnswer(e)}}class Wt extends _rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.EventEmitter{constructor(e,t){super(),this._reTryExchange=e,this._polarisReport=t,this.pubLocalTracks={},this._reTryExchangeTimer=null,this._reportStatsTimer=null,this._reportListener=null;const r=Kt.getSdpSemantics(),i=this._rtcPeerConn=new RTCPeerConnection({sdpSemantics:r});this._sdpStrategy=\"plan-b\"===r?new Gt(i):new Jt(i),this._rtcPeerConn.oniceconnectionstatechange=this._onICEConnectionStateChange.bind(this),this._rtcPeerConn.onconnectionstatechange=this._onConnectionStateChange.bind(this),this._rtcPeerConn.ontrack=this._onTrackReady.bind(this),this.reportParser=this._sdpStrategy.getStatParsr(this._rtcPeerConn,r)}getLocalTracks(){return Object.values(this.pubLocalTracks)}_onConnectionStateChange(){C.info(`onconnectionstatechange -> ${this._rtcPeerConn.connectionState}`)}_onICEConnectionStateChange(){var e,t;C.info(`oniceconnectionstatechange -> ${this._rtcPeerConn.iceConnectionState}`),\"connected\"===this._rtcPeerConn.iceConnectionState&&(this._reportStatsTimer&&clearInterval(this._reportStatsTimer),this._reportStatsTimer=setInterval(this._reportHandle.bind(this),1e3)),\"failed\"!==this._rtcPeerConn.iceConnectionState&&\"disconnected\"!==this._rtcPeerConn.iceConnectionState||(C.warn(\"iceconenction state is `failed`, exchange SDP to try again.\"),this._reTryExchange(),this._reTryExchangeTimer=setInterval(this._reTryExchange,15e3));try{null===(t=null===(e=this._reportListener)||void 0===e?void 0:e.onICEConnectionStateChange)||void 0===t||t.call(e,this._rtcPeerConn.iceConnectionState)}catch(e){C.error(\"onICEConnectionStateChange error\",e)}}_onTrackReady(e){if(!e.streams.length)return;const t=[e.streams[0].id,\"audio\"===e.receiver.track.kind?Fe.AUDIO_ONLY:Fe.VIDEO_ONLY].join(\"_\");this._updateRecvTransceiverMap(t,e.transceiver),this.emit(Wt.__INNER_EVENT_TRACK_READY__,e)}setBitrate(e,t,r){return S(this,void 0,void 0,(function*(){this._sdpStrategy.setBitrate(e,t,r)}))}createOffer(e){return S(this,void 0,void 0,(function*(){const t=yield this._sdpStrategy.createOffer(e);return C.debug(`offer -> ${JSON.stringify(t.sdp)}`),t}))}setRemoteAnswer(e){return S(this,void 0,void 0,(function*(){return C.debug(`answer -> ${JSON.stringify(e)}`),this._sdpStrategy.setRemoteAnswer(e)}))}getLocalTrack(e){return this.pubLocalTracks[e]||null}addLocalTrack(e){this.pubLocalTracks[e.getTrackId()]=e,this._sdpStrategy.addLocalTrack(e),e.off(ze.__INNER_EVENT_MUTED_CHANGE__,this._onLocalTrackMuted,this),e.off(ze.__INNER_EVENT_DESTROY__,this._onLocalTrackDestroied,this),e.on(ze.__INNER_EVENT_MUTED_CHANGE__,this._onLocalTrackMuted,this),e.on(ze.__INNER_EVENT_DESTROY__,this._onLocalTrackDestroied,this)}removeLocalTrackById(e){const t=this.getLocalTrack(e);t&&this.removeLocalTrack(t)}removeAllLocalTrack(){Object.keys(this.pubLocalTracks).forEach((e=>{/_tiny$/.test(e)||this.removeLocalTrackById(e)}))}removeLocalTrack(e){const t=e.getTrackId();delete this.pubLocalTracks[t],this._sdpStrategy.removeLocalTrack(e),e.__innerSetPublished(!1),e.off(ze.__INNER_EVENT_MUTED_CHANGE__,this._onLocalTrackMuted,this),e.off(ze.__INNER_EVENT_DESTROY__,this._onLocalTrackDestroied,this);const r=`${t}_tiny`,i=this.getLocalTrack(r);i&&(this._sdpStrategy.removeLocalTrack(i),delete this.pubLocalTracks[r],i.destroy())}_updateRecvTransceiverMap(e,t){this._sdpStrategy.updateRecvTransceiverMap(e,t)}updateSubRemoteTracks(e){this._sdpStrategy.updateSubRemoteTracks(e)}getOutboundVideoInfo(){return this._sdpStrategy.getOutboundVideoInfo()}_onLocalTrackMuted(e){const t=this.getLocalTrack(`${e.getTrackId()}_tiny`);t&&(t.__innerGetMediaStreamTrack().enabled=!e.isLocalMuted()),this.emit(ze.__INNER_EVENT_MUTED_CHANGE__,e)}_onLocalTrackDestroied(e){this.emit(ze.__INNER_EVENT_DESTROY__,e)}registerReportListener(e){this._reportListener=e}_createRCRTCStateReport(e){const{timestamp:t,iceCandidatePair:r,senders:i,receivers:n}=JSON.parse(JSON.stringify(e));null==r||delete r.totalPacketsLost;for(const e in r)Pt(r[e])&&delete r[e];return{timestamp:t,iceCandidatePair:r,senders:i.map((e=>{const t={};return e.trackId&&(t.trackId=e.trackId),e.kind&&(t.kind=e.kind),(e.packetsLostRate||0===e.packetsLostRate)&&(t.packetsLostRate=e.packetsLostRate),t.remoteResource=e.remoteResource,(e.audioLevel||0===e.audioLevel)&&(t.audioLevel=e.audioLevel),e.frameWidth&&(t.frameWidth=e.frameWidth),e.frameHeight&&(t.frameHeight=e.frameHeight),e.frameRate&&(t.frameRate=e.frameRate),(e.bitrate||0===e.bitrate)&&(t.bitrate=e.bitrate),e.jitter&&(t.jitter=e.jitter),t})),receivers:n.map((e=>{const t={};return e.trackId&&(t.trackId=e.trackId),e.kind&&(t.kind=e.kind),(e.packetsLostRate||0===e.packetsLostRate)&&(t.packetsLostRate=e.packetsLostRate),t.remoteResource=e.remoteResource,(e.audioLevel||0===e.audioLevel)&&(t.audioLevel=e.audioLevel),e.frameWidth&&(t.frameWidth=e.frameWidth),e.frameHeight&&(t.frameHeight=e.frameHeight),e.frameRate&&(t.frameRate=e.frameRate),(e.bitrate||0===e.bitrate)&&(t.bitrate=e.bitrate),e.jitter&&(t.jitter=e.jitter),t}))}}_getStatsData(){var e,t;return S(this,void 0,void 0,(function*(){const r=yield this._rtcPeerConn.getStats(),i=null===(e=this.reportParser)||void 0===e?void 0:e.parseRTCStatsReport(r);return null===(t=this.reportParser)||void 0===t?void 0:t.formatRCRTCStateReport(i)}))}getAudioLevelReportData(){var e,t;return S(this,void 0,void 0,(function*(){const r=yield this._rtcPeerConn.getStats(),i=null===(e=this.reportParser)||void 0===e?void 0:e.parseRTCStatsReport(r);if(!i)return[];return null===(t=this.reportParser)||void 0===t?void 0:t.getAudioLevelList(i)}))}_reportHandle(){var e,t,r;return S(this,void 0,void 0,(function*(){const i=yield this._getStatsData();if(!i)return;(i.senders.length||i.receivers.length)&&(null===(e=this._polarisReport)||void 0===e||e.sendR3R4Data(i));const n=this._createRCRTCStateReport(i);null===(r=null===(t=this._reportListener)||void 0===t?void 0:t.onStateReport)||void 0===r||r.call(t,n)}))}getRTCPeerConn(){return this._rtcPeerConn}destroy(){this.clear(),this.clearReTryExchangeTimer(),this._reportStatsTimer&&(clearInterval(this._reportStatsTimer),this._reportStatsTimer=null),this.registerReportListener(null),this._rtcPeerConn.close(),this.reportParser=null}clearReTryExchangeTimer(){clearInterval(this._reTryExchangeTimer),this._reTryExchangeTimer=null}}var Yt,qt,zt,Qt,Xt;Wt.__INNER_EVENT_TRACK_READY__=\"inner-track-ready\",function(e){e[e.DISABLE=0]=\"DISABLE\",e[e.ENABLE=1]=\"ENABLE\"}(Yt||(Yt={})),function(e){e[e.MeetingOrAnchor=1]=\"MeetingOrAnchor\",e[e.Audience=2]=\"Audience\"}(qt||(qt={}));class Zt{constructor(e,t,r,i,n=qt.MeetingOrAnchor){this._context=e,this._runtime=t,this._roomId=r,this._crtRTCRoom=i,this._userRole=n}_send(e){this._context.getConnectionStatus()===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConnectionStatus.CONNECTED&&this._context.setRTCState(this._roomId,e)}_getClientID(){const e=\"uuid\";let t=this._runtime.localStorage.getItem(e);return t||(t=St(),this._runtime.localStorage.setItem(e,t)),t}_getRealResourceId(e){let t=e;const r=e.indexOf(\"_tiny\");return r>-1&&(t=e.slice(0,r)),t}_getPolarisTrackId(e){let t=\"\";const r=e.split(\"_\");if(e.includes(\"_tiny\")){const e=r.pop(),i=parseInt(r.pop())===Fe.AUDIO_ONLY?\"audio\":\"video\",n=r.pop();t=[r.join(\"_\"),n,e,i].join(\"_\")}else{const e=parseInt(r.pop())===Fe.AUDIO_ONLY?\"audio\":\"video\",i=r.pop();t=[r.join(\"_\"),i,e].join(\"_\")}return t}sendR3R4Data(e){const{iceCandidatePair:t,senders:r,receivers:i}=e,n=(null==t?void 0:t.bitrateSend)||-1,s=(null==t?void 0:t.bitrateRecv)||-1,o=(null==t?void 0:t.networkType)||\"unknown\",a=(null==t?void 0:t.rtt)||-1,c=`${(null==t?void 0:t.IP)||-1}:${null==t?void 0:t.port}`,d=(null==t||t.remoteIP,null==t||t.remotePort,(null==t?void 0:t.availableIncomingBitrate)||-1),u=(null==t?void 0:t.availableOutgoingBitrate)||-1,l=(null==t?void 0:t.totalPacketsLost)||-1,h=this._context.getCurrentId();let p=`R3\\t${n}\\t-1\\t-1\\t-1\\t${o}\\t${a}\\t${c}\\t${d}\\t${u}\\t${l}\\t${h}\\r`,_=`R4\\t${s}\\t-1\\t-1\\t-1\\t${o}\\t${a}\\t${c}\\t${d}\\t${u}\\t${l}\\t${h}\\r`;const m=r.map((e=>{var t;const{trackId:r,audioLevel:i,samplingRate:n,bitrate:s,packetsLostRate:o,frameRate:a,frameWidth:c,frameHeight:d,googRenderDelayMs:u,jitter:l,nackCount:h,pliCount:p,rtt:_,googFirsSent:m,encoderImplementation:f}=e,v=this._getPolarisTrackId(r),R=this._getRealResourceId(r);return{trackId:v,googCodecName:f||String(-1),audioLevel:i||0===i?i:-1,bitrate:s||0===s?s:-1,packetsLostRate:o||0===o?o:-1,frameRate:a||-1,resolution:c&&d?`${c} * ${d}`:\"-1\",jitter:l||-1,nackCount:h||0===h?h:-1,pliCount:p||0===p?p:-1,rtt:_||-1,googFirsSent:m,samplingRate:n,googRenderDelayMs:u,encoderImplementation:f||String(-1),trackState:(null===(t=this._crtRTCRoom.getLocalTrack(R))||void 0===t?void 0:t.isLocalMuted())?Yt.DISABLE:Yt.ENABLE}})),f=i.filter((e=>!!e.trackId)).map((e=>{var t;const{trackId:r,audioLevel:i,samplingRate:n,bitrate:s,packetsLostRate:o,frameRate:a,frameWidth:c,frameHeight:d,googRenderDelayMs:u,jitter:l,nackCount:h,pliCount:p,rtt:_,googFirsReceived:m,codecImplementationName:f}=e,v=this._getPolarisTrackId(r),R=this._getRealResourceId(r);return{trackId:v,googCodecName:f||String(-1),audioLevel:i||0===i?i:-1,bitrate:s||0===s?s:-1,packetsLostRate:o||0===o?o:-1,frameRate:a||-1,resolution:c&&d?`${c} * ${d}`:\"-1\",jitter:l||-1,nackCount:h||0===h?h:-1,pliCount:p||0===p?p:-1,rtt:_||-1,googFirsReceived:m,samplingRate:n,googRenderDelayMs:u,codecImplementationName:f||String(-1),trackState:(null===(t=this._crtRTCRoom.getRemoteTrack(R))||void 0===t?void 0:t.isLocalMuted())?Yt.DISABLE:Yt.ENABLE}}));p+=m.map((e=>`${e.trackId}\\t${e.googCodecName}\\t${e.audioLevel}\\t${e.samplingRate}\\t${e.bitrate}\\t${e.packetsLostRate}\\t${e.frameRate}\\t${e.resolution}\\t${e.googRenderDelayMs}\\t${e.jitter}\\t${e.nackCount}\\t${e.pliCount}\\t${e.rtt}\\t${e.googFirsSent}\\t${e.encoderImplementation}\\t${e.trackState}`)).join(\"\\n\"),e.senders.length&&this._send(p+`\\r${this._userRole}`),_+=f.map((e=>`${e.trackId}\\t${e.googCodecName}\\t${e.audioLevel}\\t${e.samplingRate}\\t${e.bitrate}\\t${e.packetsLostRate}\\t${e.frameRate}\\t${e.resolution}\\t${e.googRenderDelayMs}\\t${e.jitter}\\t${e.nackCount}\\t${e.pliCount}\\t${e.rtt}\\t${e.googFirsReceived}\\t${e.codecImplementationName}\\t${e.trackState}`)).join(\"\\n\"),e.receivers.length&&this._send(_+`\\r${this._userRole}`)}sendR1(){const e=`R1\\t5.3.1\\t${this._context.getCoreVersion()}\\tweb\\t${navigator.platform}\\t-1\\t${yt.browser}\\t${yt.version}\\t${this._getClientID()}\\t${this._userRole}`;this._send(e)}sendR2(e,t,r){const i=`R2\\t${e}\\t${t}\\t${this._getClientID()}\\r${r.join(\"\\t\")}\\r${this._userRole}`;this._send(i)}}!function(e){e.PUBLISH=\"publish\",e.SUBSCRIBE=\"subscribe\"}(zt||(zt={})),function(e){e.BEGIN=\"begin\",e.END=\"end\"}(Qt||(Qt={}));class er{constructor(e){this._room=e,this._audioLevelChangeHandler=null,this._timer=null,this._pc=this._room.__getPC()}_audioLevelReport(){return S(this,void 0,void 0,(function*(){if(\"new\"===this._pc.getRTCPeerConn().iceConnectionState||!this._audioLevelChangeHandler)return;const e=(yield this._pc.getAudioLevelReportData()).map((e=>{const{userId:t}=Pr.parseTrackId(e.trackId);return{track:this._room.getCrtUserId()===t?this._room.getLocalTrack(e.trackId):this._room.getRemoteTrack(e.trackId),audioLevel:e.audioLevel||0}})).filter((e=>e.track));this._audioLevelChangeHandler(e)}))}onAudioLevelChange(e,t){t<300||t>1e3?C.error('the valid range of onAudioLevelChange params \"gap\" is: > 300 && < 1000'):e?(this._audioLevelChangeHandler=e,this._timer=setInterval(this._audioLevelReport.bind(this),t)):this._audioLevelChangeHandler=null}clearAudioLevelReportTimer(){this._timer&&(clearInterval(this._timer),this._timer=null)}}!function(e){e[e.ANCHOR=1]=\"ANCHOR\",e[e.AUDIENCE=2]=\"AUDIENCE\"}(Xt||(Xt={}));const tr=e=>e instanceof qe?e.getTrackId():e.track.getTrackId();class rr{constructor(e,t,r,i,n,s,o,a,c,d){this._context=e,this._runtime=t,this._roomId=r,this._roomMode=n,this._service=s,this._initOptions=o,this._ntfClearRoomItem=a,this._isMainRoom=d,this._remoteTracks={},this._subscribedList=[],this._destroyed=!1,this.msgTaskQueue=new E,this._appListener=null,this._onRecvPKMsg=null,this._token=i.token,this._sessionId=i.sessionId,this._roomResources=c?{}:Lt(i),this._initRemoteTracks();const u=this._context.getCurrentId(),l=this._roomResources[u]=this._roomResources[u]||[];C.debug(`room data -> ${JSON.stringify(this._roomResources)}`),l.length>0&&k((()=>this._unpublishPrev(l))),c&&this._afterChangedRole(i),this._pinger=new At(r,this._roomMode,e,this._initOptions.pingGap),this._pinger.onFailed=this._kickoff.bind(this),this._pinger.onPingResult=this._handlePingResult.bind(this),this._pinger.start(),this._polarisReport=new Zt(this._context,this._runtime,this._roomId,this),this._polarisReport.sendR1(),this._pc=new Wt(this._reTryExchange.bind(this),this._polarisReport),this._pc.on(Wt.__INNER_EVENT_TRACK_READY__,this._onTrackReady,this),this._pc.on(ze.__INNER_EVENT_MUTED_CHANGE__,this._onLocalTrackMuted,this),this._pc.on(ze.__INNER_EVENT_DESTROY__,this._onLocalTrackDestroied,this)}_initRemoteTracks(){const e=this._context.getCurrentId();for(const t in this._roomResources){const r=this._roomResources[t];t!==e&&0!==r.length&&r.forEach((e=>{const t=mt(e),{tag:r,userId:i,mediaType:n}=ft(t),s=n===Fe.AUDIO_ONLY?new ot(r,i):new at(r,i);s.__innerSetRemoteMuted(0===e.state),this._remoteTracks[t]=s}))}}_handlePingResult(e){this._callAppListener(\"onPing\",e)}setBitrate(e,t,i){C.warn(\"`RCAbstractRoom.setBitrate` will be deprecated, use `RCLocalTrack.setBitrate` instead.\"),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"max\",e,(e=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)&&e>Math.max(t||1,200)),!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"min\",t,(t=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(t)&&t>=1&&(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)||t<e)),!0),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"start\",i,(i=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(i)&&i>t&&i<=e)),this._pc.setBitrate(e,t,i)}_onTrackReady(e){const t=e.streams[0].id,r=e.receiver.track,i=[t,\"audio\"===r.kind?Fe.AUDIO_ONLY:Fe.VIDEO_ONLY].join(\"_\"),n=this._remoteTracks[i];n?(n.__innerSetMediaStreamTrack(r),this._callAppListener(\"onTrackReady\",n)):C.warn(`cannot found remote track ${r.id}`)}_callAppListener(e,...t){var r;const i=null===(r=this._appListener)||void 0===r?void 0:r[e];if(i)try{i(...t)}catch(e){C.error(e)}}_onUserUnpublish(e){return S(this,void 0,void 0,(function*(){yield this.unsubscribe(e),e.forEach((e=>{e.__innerDestroy(),delete this._remoteTracks[e.getTrackId()]})),this._onTrackUnpublish(e)}))}_onTrackUnpublish(e){this._callAppListener(\"onTrackUnpublish\",e)}_unpublishPrev(e){return S(this,void 0,void 0,(function*(){const t=e.slice();e.length=0,C.info(`unpublish uris prev login: ${JSON.stringify(t)}`);const r=yield this._context.setRTCTotalRes(this._roomId,ct(Nt.UNPUBLISH,t),dt([]),Nt.TOTAL_CONTENT_RESOURCE,dt([]));r!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?C.error(`unpublish prev uris failed -> code: ${r}`):C.debug(\"unpublish uris prev login succeed\")}))}__parseInnerMessage(e){const{targetId:t,conversationType:r}=e;if(r!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConversationType.RTC_ROOM)return!1;if(t!==this._roomId)return!0;C.info(`recv inner msg -> message: ${JSON.stringify(e)} | roomid: ${this._roomId}`);const i=e.content;switch(e.messageType){case Nt.KICK:this._kickoff(!0,i);break;case Nt.STATE:this.msgTaskQueue.push((()=>this._stateHandle(i)));break;case Nt.MODIFY:case Nt.PUBLISH:case Nt.UNPUBLISH:case Nt.TOTAL_CONTENT_RESOURCE:this.msgTaskQueue.push((()=>this._resourceHandle(i,e.messageType,e.senderUserId)));break;case Nt.ROOM_NOTIFY:this._callAppListener(\"onRoomAttributeChange\",e.messageType,e.content);break;case Nt.USER_NOTIFY:C.warn(`TODO: ${Nt.USER_NOTIFY}`);break;case Nt.PK_INVITE:case Nt.PK_CANCEL_INVITE:case Nt.PK_INVITE_TIMEOUT:case Nt.PK_INVITE_ANSWER:case Nt.PK_END:this._onRecvPKMsg&&this._onRecvPKMsg(e);break;case Nt.OTHER_ROOM_OFFLINE:break;default:this._callAppListener(\"onMessageReceive\",e.messageType,e.content,e.senderUserId,e.messageUId)}return!0}_kickoff(e,t){let r;C.warn(`onKickOff -> byServer: ${e}`),this._ntfClearRoomItem(),this._leaveHandle(!e),e&&((null==t?void 0:t.users)||[]).forEach((e=>{e.userId===this._context.getCurrentId()&&(r=e.type)})),this._callAppListener(\"onKickOff\",e,r)}_rtcpeerClosed(){this._ntfClearRoomItem(),this._leaveHandle(!0),this._callAppListener(\"onRTCPeerConnectionCloseByException\")}_resourceHandle(e,t,r){return S(this,void 0,void 0,(function*(){if(this._assertRoomDestroyed())return void C.warn(`room has been destroyed. -> roomId: ${this._roomId}`);const{uris:i,ignore:n}=e;if(n||!i)return;const s=[],o=[],a=[];let c;const d=this._roomResources[r]||(this._roomResources[r]=[]);switch(t){case Nt.MODIFY:a.push(...i);break;case Nt.PUBLISH:s.push(...i);break;case Nt.UNPUBLISH:o.push(...i);break;case Nt.TOTAL_CONTENT_RESOURCE:c=gt(d,i),s.push(...c.publishedList),o.push(...c.unpublishedList),a.push(...c.modifiedList)}if(s.length>0){const e=d.map(mt),t=[],r=[];if(s.forEach((i=>{const n=mt(i),s=e.indexOf(n),{userId:o,tag:a,mediaType:c}=ft(n);s>-1?d[s]=i:d.push(i);let u=this._remoteTracks[n];u?u.isSubscribed()&&t.push(u):(u=c===Fe.AUDIO_ONLY?new ot(a,o):new at(a,o),this._remoteTracks[n]=u,r.push(u)),u.__innerSetRemoteMuted(0===i.state)})),t.length){const e=t.map((e=>e.getTrackId()));C.debug(`resub tracks -> ${JSON.stringify(e)}`);const{code:r}=yield k((()=>this.__subscribe(t,!0)));r!==T.SUCCESS&&C.error(`resub tracks failed -> code: ${r}, ids: ${JSON.stringify(e)}`)}this._onTrackPublish(r)}if(o.length>0){const e=o.map(mt);for(let t=d.length-1;t>=0;t-=1){const r=d[t];e.includes(mt(r))&&d.splice(t,1)}const t=o.map((e=>{const t=mt(e);return this._remoteTracks[t]}));yield this._onUserUnpublish(t)}if(a.length>0){const e=d.map(mt);for(let t=0;t<a.length;t+=1){const r=a[t],i=mt(r),n=e.indexOf(i);d[n].state=r.state;const s=this._remoteTracks[i];s.__innerSetRemoteMuted(0===r.state),s.isAudioTrack()?this._onAudioMuteChange(s):this._onVideoMuteChange(s)}}}))}_onTrackPublish(e){this._callAppListener(\"onTrackPublish\",e)}_stateHandle(e){var t;return S(this,void 0,void 0,(function*(){const{users:r}=e;if(0===r.length)return;const i=[],n=[],s=[],o=[];r.forEach((e=>{0==+e.state?(C.debug(`user joined -> ${e.userId}`),this._roomResources[e.userId]||(e.switchRoleType?s.push(e.userId):i.push(e.userId)),this._roomResources[e.userId]=this._roomResources[e.userId]||[]):(C.debug(`user left -> ${e.userId}`),e.switchRoleType?o.push(e.userId):n.push(e.userId))}));const a=[...i,...s],c=[...n,...o];if(c.length){const e=[],t=[];c.forEach((r=>{e.push(...this.getRemoteTracksByUserId(r)),t.push(r)})),e.length&&(yield this.unsubscribe(e),e.forEach((e=>delete this._remoteTracks[e.getTrackId()]))),t.length&&t.forEach((e=>delete this._roomResources[e]))}if(null===(t=this._appListener)||void 0===t?void 0:t.onSwitchRole)return s.length&&s.forEach((e=>this._callAppListener(\"onSwitchRole\",e,Xt.ANCHOR))),o.length&&o.forEach((e=>this._callAppListener(\"onSwitchRole\",e,Xt.AUDIENCE))),i.length&&this._callAppListener(\"onUserJoin\",i),void(n.length&&this._callAppListener(\"onUserLeave\",n));a.length&&this._callAppListener(\"onUserJoin\",a),c.length&&this._callAppListener(\"onUserLeave\",c)}))}getRoomId(){return this._roomId}getCrtUserId(){return this._context.getCurrentId()}__getPC(){return this._pc}getRemoteUserIds(){const e=this._context.getCurrentId();return Object.keys(this._roomResources).filter((t=>t!==e))}getRemoteTracks(){const e=[];return this.getRemoteUserIds().forEach((t=>{e.push(...this.getRemoteTracksByUserId(t))})),e}getRemoteTracksByUserId(e){const t=[];for(const r in this._remoteTracks){const i=this._remoteTracks[r];i.getUserId()===e&&t.push(i)}return t}getSessionId(){return this._sessionId}sendMessage(e,t){return S(this,void 0,void 0,(function*(){const{code:r}=yield this._context.sendMessage(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConversationType.RTC_ROOM,this._roomId,{messageType:e,content:t,isStatusMessage:!0});return r!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`send message failed -> code: ${r}`),{code:T.SIGNAL_ERROR}):{code:T.SUCCESS}}))}setRoomAttribute(e,t,r,n=!1){return S(this,void 0,void 0,(function*(){const s=yield this._context.setRTCData(this._roomId,e,t,n,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCApiType.ROOM,r);return s!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`SetRoomAttributeValue Failed: ${s}`),{code:T.SIGNAL_ERROR}):{code:T.SUCCESS}}))}deleteRoomAttributes(e,t,r=!1){return S(this,void 0,void 0,(function*(){const n=yield this._context.removeRTCData(this._roomId,e,r,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCApiType.ROOM,t);return n!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`DeleteRoomAttribute Failed: ${n}`),{code:T.SIGNAL_ERROR}):{code:T.SUCCESS}}))}getRoomAttributes(e=[],t=!1){return S(this,void 0,void 0,(function*(){const{code:r,data:n}=yield this._context.getRTCData(this._roomId,e,t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCApiType.ROOM);return r!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`GetRoomAttributes Failed: ${r}`),{code:T.SIGNAL_ERROR}):{code:T.SUCCESS,data:n}}))}_setUserAttributeValue(e,t,r){return this._context.setRTCData(this._roomId,e,t,!1,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCApiType.PERSON,r)}_deleteUserAttributes(e,t){return this._context.removeRTCData(this._roomId,e,!1,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCApiType.PERSON,t)}_getUserAttributes(e){return this._context.getRTCData(this._roomId,e,!1,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCApiType.PERSON)}isDestroyed(){return this._destroyed}__destroy(e){return this._leaveHandle(e)}_leaveHandle(e){var t;return S(this,void 0,void 0,(function*(){this._destroyed||(this._destroyed=!0,null===(t=this._audioLevelReport)||void 0===t||t.clearAudioLevelReportTimer(),e&&(yield this._context.quitRTCRoom(this._roomId)),this._isMainRoom&&this._quitAllPKRoom(),this._pc.removeAllLocalTrack(),this._pinger.stop(),this._isMainRoom&&(yield this._service.exit(this._getRTCReqestHeaders())),this._pc.destroy(),this._polarisReport=null,this._removeRemoteTracks())}))}_onLocalTrackDestroied(e){e instanceof Xe&&e.__isTiny()||this.unpublish([e])}_onLocalTrackMuted(e){return S(this,void 0,void 0,(function*(){const t=e.getTrackId(),r=this._context.getCurrentId(),n=[{resourceId:t,enabled:!e.isLocalMuted()}],s=this._roomResources[r]||[],o=[];for(let e=0;e<s.length;e+=1){const t=s[e],r=mt(t),i=n.findIndex((e=>e.resourceId===r));if(i>=0){const{enabled:e}=n[i];t.state=e?1:0,o.push(t);break}}const a=yield k((()=>this._context.setRTCTotalRes(this._roomId,ct(Nt.MODIFY,o),dt(s),Nt.TOTAL_CONTENT_RESOURCE)));a!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&C.error(\"notice `track.enabled` change failed -> code: \"+a)}))}_removePubFailedTracks(e){e.forEach((e=>{const t=e instanceof ze?e:e.track;C.debug(`remove pub failed track from peerconnection -> trackId: ${t.getTrackId()}`),this._pc.removeLocalTrackById(t.getTrackId())}))}publish(e){return S(this,void 0,void 0,(function*(){return k((()=>this.__publish(e)))}))}__publish(e){return S(this,void 0,void 0,(function*(){if(!this._isMainRoom&&this instanceof _r)return C.error(\"the `publish` is disabled in PK room \"),{code:T.THE_FUNCTION_IS_DISABLED_IN_PKROOM};if(this._assertRoomDestroyed())return C.error(`publish failed, room has been destroyed. -> roomId: ${this._roomId}`),{code:T.ROOM_HAS_BEEN_DESTROYED};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"tracks\",e,(()=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e.length>0&&e.every((e=>e instanceof ze||e.track instanceof ze))),!0))return C.error(`publish failed, tracks is invalid -> roomId: ${this._roomId}`),{code:T.PARAMS_ERROR};const t=this._context.getCurrentId();if(this._pc.getLocalTracks().length+(e=>{let t=0;return e.forEach((e=>{e instanceof ze?t++:e.pubTiny&&e.track.isVideoTrack()?t+=2:t++})),t})(e)>10)return C.error(`publish failed, tracks limit exceeded -> roomId: ${this._roomId}`),{code:T.PUBLISH_TRACK_LIMIT_EXCEEDED};C.debug(`publish tracks -> roomId: ${this._roomId}, tracks: ${e.map(tr)}`),e.forEach((e=>{const{track:t,pubTiny:r}=e instanceof ze?{pubTiny:!1,track:e}:e;if(this._pc.addLocalTrack(t),t.isVideoTrack()&&r){let e;try{e=t.__innerGetMediaStreamTrack().clone();const i=r.frameRate||Be.FPS_15,n=r.resolution||He.W176_H144,{width:s,height:o}=Ct(n),a=Et(i);e.applyConstraints({width:s,height:o,frameRate:a})}catch(r){return null==e||e.stop(),void C.warn(`pubTiny failed -> id: ${t.getTrackId()}, msg: ${r.message}`)}this._pc.addLocalTrack(new Xe(t.getTag(),t.getUserId(),e,!0))}})),this._pc.clearReTryExchangeTimer();const r=yield this._createExchangeParams(this._subscribedList,!1),n=this._getPushOtherRoomsParams();n&&(r.pushOtherRooms=n);const s=yield this._exchangeHandle(r);if(s.code!==T.SUCCESS)return C.error(`publish failed -> roomId: ${this._roomId}, code: ${s.code}`),this._removePubFailedTracks(e),{code:s.code};const{publishList:o,sdp:a,resultCode:l,message:h,urls:p,mcuPublishList:_}=s.data;if(l!==T.SUCCESS)return C.error(`publish failed -> roomId: ${this._roomId}, code: ${l}, msg: ${h}`),this._removePubFailedTracks(e),{code:l};const m=yield this._pc.setRemoteAnswer(a.sdp);if(m!==T.SUCCESS)return{code:m};const f=this._roomResources[t],v=o.map((e=>Object.assign({tag:e.msid.split(\"_\").pop(),state:this._getResourceState(mt(e))},e))),{publishedList:R}=gt(f,v),g=(null==_?void 0:_.map((e=>Object.assign({tag:e.msid.split(\"_\").pop(),state:1},e))))||[],S=yield this._context.setRTCTotalRes(this._roomId,ct(Nt.PUBLISH,R),dt(v),Nt.TOTAL_CONTENT_RESOURCE,dt(g));if(S!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return C.error(`send publish streams notification failed: ${S}`),{code:T.SIGNAL_ERROR};this._roomResources[t]=v;const I=R.map((e=>mt(e)));return this._polarisReport&&this._polarisReport.sendR2(zt.PUBLISH,Qt.BEGIN,I),e.forEach((e=>{const{track:t}=e instanceof ze?{track:e}:e;t.__innerSetPublished(!0)})),C.debug(`publish success: ${I.join(\",\")}`),this._roomMode===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE?{code:T.SUCCESS,liveUrl:null==p?void 0:p.liveUrl}:{code:T.SUCCESS}}))}_getPushOtherRoomsParams(){if(this instanceof _r){const{code:e,roomPKHandler:t}=this.getRoomPKHandler(),r=[];if(e===T.SUCCESS&&t){const e=t.getJoinedPKRooms();for(const i in e){const n=e[i].getSessionId(),s=t.getPKInfo(i);if(!s)return;const{inviterUserAutoMix:o,inviteeUserAutoMix:a,inviterUserId:c}=s,d=this._context.getCurrentId()===c;r.push({roomId:i,sessionId:n,autoMix:d?!!o:!!a})}}return r}}_reTryExchange(){return S(this,void 0,void 0,(function*(){k((()=>S(this,void 0,void 0,(function*(){const e=yield this._createExchangeParams(this._subscribedList,!0),t=this._getPushOtherRoomsParams();t&&(e.pushOtherRooms=t);const r=yield this._exchangeHandle(e);if(r.code!==T.SUCCESS)return C.error(`reTryExchange failed: ${r.code}`),{code:r.code};const{sdp:i,resultCode:n}=r.data;if(n!==T.SUCCESS)return C.error(`reTryExchange failed: ${n}`),{code:n};this._pc.clearReTryExchangeTimer();const s=yield this._pc.setRemoteAnswer(i.sdp);return s!==T.SUCCESS?{code:s}:void 0}))))}))}_exchangeHandle(e){return this._service.exchange(this._getRTCReqestHeaders(),e)}_getRTCReqestHeaders(){return{\"App-Key\":this._context.getAppkey(),RoomId:this._roomId,Token:this._token,RoomType:this._roomMode,UserId:this._context.getCurrentId()}}_createExchangeParams(e,t){return S(this,void 0,void 0,(function*(){return{sdp:yield this._pc.createOffer(t),extend:JSON.stringify({resolutionInfo:this._pc.getOutboundVideoInfo()}),subscribeList:e.filter((e=>{const t=e.track.getTrackId(),{userId:r}=ft(t);if(!this._roomResources[r])return!1;const i=this._roomResources[r].filter((e=>t===`${e.msid}_${e.mediaType}`)).length;return i})).map((e=>({simulcast:e.subTiny?Mt.TINY:Mt.NORMAL,resolution:\"\",uri:this._getResourceById(e.track.getTrackId()).uri}))),switchstream:!1}}))}_getResourceState(e){var t;return(null===(t=this.getLocalTrack(e))||void 0===t?void 0:t.isLocalMuted())?0:1}unpublish(e){return S(this,void 0,void 0,(function*(){return k((()=>this.__unpublish(e)))}))}__unpublish(e){var t;return S(this,void 0,void 0,(function*(){if(!this._isMainRoom&&this instanceof _r)return C.error(\"the `unpublish` is disabled in PK room \"),{code:T.THE_FUNCTION_IS_DISABLED_IN_PKROOM};if(this._assertRoomDestroyed())return C.warn(`room has been destroyed, no need to unpublish tracks -> roomId: ${this._roomId}`),{code:T.SUCCESS};const r=this._context.getCurrentId();if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"tracks\",e,(()=>e.every((e=>e.getUserId()===r&&e instanceof ze))),!0))return C.warn(`unpublish failed, tracks is invalid -> roomId: ${this._roomId}, tracks: ${e.map(tr)}`),{code:T.PARAMS_ERROR};const n=e.map((e=>e.getTrackId())),s=n.map(this._getResourceById.bind(this)).filter((e=>!!e));if(0===s.length)return{code:T.SUCCESS};const o=this._roomResources[r].filter((e=>!s.includes(e)));n.forEach((e=>this._pc.removeLocalTrackById(e))),null===(t=this._polarisReport)||void 0===t||t.sendR2(zt.PUBLISH,Qt.END,n),this._pc.clearReTryExchangeTimer();const a=yield this._createExchangeParams(this._subscribedList,!1),d=this._getPushOtherRoomsParams();d&&(a.pushOtherRooms=d);const u=yield this._exchangeHandle(a);if(u.code!==T.SUCCESS)return C.error(`exchange failed -> code: ${u.code}`),{code:u.code};const{publishList:l,sdp:h,resultCode:p,message:_,mcuPublishList:m}=u.data;p!==T.SUCCESS&&C.error(`unpublish streams failed -> code: ${p}, msg: ${_}`);const f=m?m.map((e=>Object.assign({tag:e.msid.split(\"_\").pop(),state:1},e))):[],v=yield this._context.setRTCTotalRes(this._roomId,ct(Nt.UNPUBLISH,s),dt(o),Nt.TOTAL_CONTENT_RESOURCE,dt(f));if(v!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return C.error(\"send unpublish notification failed:\",v),{code:T.SIGNAL_ERROR};C.debug(`unpublish success -> tracks: ${n.join(\",\")}`);const R=yield this._pc.setRemoteAnswer(h.sdp);if(R!==T.SUCCESS)return{code:R};const g=l.map((e=>Object.assign({tag:e.msid.split(\"_\").pop(),state:this._getResourceState(mt(e))},e)));return this._roomResources[r]=g,{code:T.SUCCESS}}))}_getResourceById(e){const{userId:t}=ft(e);return this._roomResources[t].find((t=>mt(t)===e))}_isValidResourceId(e){var t;const{userId:r}=ft(e);return!!(null===(t=this._roomResources[r])||void 0===t?void 0:t.find((t=>mt(t)===e)))}subscribe(e){return S(this,void 0,void 0,(function*(){return k((()=>this.__subscribe(e,!1)))}))}__subscribe(e,t=!1){var r;return S(this,void 0,void 0,(function*(){if(this._assertRoomDestroyed())return C.error(`subscribe failed, room has been destroyed -> roomId: ${this._roomId}`),{code:T.ROOM_HAS_BEEN_DESTROYED};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"tracks\",e,(()=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e.length>0&&e.every((e=>e instanceof st||e.track instanceof st))),!0))return C.error(`subscribe failed, tracks is invalid -> roomId: ${this._roomId}`),{code:T.PARAMS_ERROR};C.info(`subscribe -> roomId: ${this._roomId}, tracks: ${e.map(tr)}`);const i=this._subscribedList.map((e=>Object.assign({},e))),n=e.map((e=>e instanceof st?{track:e}:e));let s=!1;const o=[];return n.forEach((e=>{const t=e.track.getTrackId();o.push(t);const r=i.find((e=>e.track.getTrackId()===t));r&&r.subTiny===e.subTiny||(r?r.subTiny=e.subTiny:i.push(e),s=!0)})),s||t?(null===(r=this._polarisReport)||void 0===r||r.sendR2(zt.SUBSCRIBE,Qt.BEGIN,o),this._updateSubListHandle(i,!0)):{code:T.SUCCESS}}))}unsubscribe(e){return S(this,void 0,void 0,(function*(){return k((()=>this.__unsubscribe(e)))}))}__unsubscribe(e){var t;return S(this,void 0,void 0,(function*(){if(this._assertRoomDestroyed())return C.warn(`room has beed destroyed, no need to unsubscribe tracks -> roomId: ${this._roomId}`),{code:T.SUCCESS};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"tracks\",e,(()=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e.length>0&&e.every((e=>e instanceof st))),!0))return C.error(`unsubscribe failed, tracks is invalid -> roomId: ${this._roomId}`),{code:T.PARAMS_ERROR};C.info(`unsubscribe -> roomId: ${this._roomId}, tracks: ${e.map(tr)}`);const r=this._subscribedList.map((e=>Object.assign({},e))).filter((t=>!e.includes(t.track)));return null===(t=this._polarisReport)||void 0===t||t.sendR2(zt.SUBSCRIBE,Qt.END,e.map((e=>e.getTrackId()))),this._updateSubListHandle(r,!1)}))}_assertRoomDestroyed(){if(this._destroyed){const e=\"This room has been destroyed. Please use `RCRTCClient.joinRTCRoom` or `RCRTCClient.joinLivingRoom` to catch another instance.\";return C.warn(e),T.ROOM_HAS_BEEN_DESTROYED}}getLocalTrack(e){return this._pc.getLocalTrack(e)}getLocalTracks(){return this._pc.getLocalTracks()}getRemoteTrack(e){return this._remoteTracks[e]||null}updateSubList(e){return S(this,void 0,void 0,(function*(){return k((()=>this._updateSubListHandle(e,!1)))}))}_updateSubListHandle(e,t=!1){return S(this,void 0,void 0,(function*(){if(this._assertRoomDestroyed())return{code:T.ROOM_HAS_BEEN_DESTROYED};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"resources\",e,(()=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e.every((e=>e instanceof st||e.track instanceof st))),!0))return C.error(`update sublist failed, tracks is invalid -> roomId: ${this._roomId}`),{code:T.PARAMS_ERROR};C.info(`update subscribe list -> roomId: ${this._roomId}, forceReq: ${t}, tracks: ${e.map(tr)}`);let r=e.map((e=>e instanceof st?{track:e}:Object.assign({},e)));const i={};r=r.filter((e=>{const t=e.track.getTrackId();return this._remoteTracks[t]?!i[t]&&(i[t]=!0):(C.warn(`track cannot found in room -> trackId: ${t}`),!1)})).map((e=>Object.assign({},e)));const n=this._subscribedList.map((e=>Object.assign({},e)));if(!t){let e=!1;if(r.forEach((t=>{const r=n.findIndex((e=>e.track===t.track));if(-1===r)return void(e=!0);n.splice(r,1)[0].subTiny!==t.subTiny&&(e=!0)})),n.length&&(e=!0),!e)return{code:T.SUCCESS}}this._pc.clearReTryExchangeTimer(),this._pc.updateSubRemoteTracks(r.map((e=>e.track)));const s=yield this._createExchangeParams(r,!1),o=this._getPushOtherRoomsParams();o&&(s.pushOtherRooms=o);const a=yield this._exchangeHandle(s),u=r.map((e=>e.track.getTrackId()));if(a.code!==T.SUCCESS)return{code:a.code};const{sdp:l,resultCode:h,message:p,subscribedList:_}=a.data;if(h!==T.SUCCESS)return C.error(`change subscribe list failed: ${h}`),{code:h};C.debug(`subscribe success: ${u.join(\",\")}`);const m=yield this._pc.setRemoteAnswer(l.sdp);if(m!==T.SUCCESS)return{code:m};const f=null==_?void 0:_.map((e=>`${e.msid}_${e.mediaType}`)),v=r.filter((e=>null==f?void 0:f.includes(e.track.getTrackId()))),R=r.filter((e=>!(null==f?void 0:f.includes(e.track.getTrackId()))));for(const e in this._remoteTracks){const t=v.some((t=>t.track.getTrackId()===e));this._remoteTracks[e].__innerSetSubscribed(t)}return this._subscribedList.splice(0,this._subscribedList.length,...v),R.length?{code:T.SUCCESS,failedList:R}:{code:T.SUCCESS}}))}registerRoomEventListener(e){this._appListener=e}registerReportListener(e){this._pc.registerReportListener(e)}onAudioLevelChange(e,t){var r;null===(r=this._audioLevelReport)||void 0===r||r.clearAudioLevelReportTimer(),this._audioLevelReport=new er(this),this._audioLevelReport.onAudioLevelChange(e,t||1e3)}__onReconnected(e){return S(this,void 0,void 0,(function*(){if(\"closed\"===this._pc.getRTCPeerConn().connectionState)return C.warn(\"RTCPeerConnection closed. Please rejoin room to restore services.\"),void this._rtcpeerClosed();const{code:t,data:r}=yield this._context.joinRTCRoom(this._roomId,this._roomMode,e);if(t!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return void C.error(`RTC __onReconnected getRTCRoomInfo failed: ${t}`);C.debug(`RTC __onReconnected getRTCRoomInfo success: ${JSON.stringify(r)}`);const n=[],s={},o={},a={},c=Lt(r),d=Object.keys(c),u=Object.keys(this._roomResources);for(let e=d.length-1;e>=0;e-=1){const t=d[e],r=u.indexOf(t);if(-1===r){n.push(t),s[t]=Rt(c[t]);continue}const i=this._roomResources[t],l=c[t],{publishedList:h,modifiedList:p,unpublishedList:_}=gt(i,l,!0);s[t]=Rt(h),o[t]=Rt(_),a[t]=Rt(p),u.splice(r,1)}u.length&&u.forEach((e=>{delete this._roomResources[e]})),Object.assign(this._roomResources,c),u.length&&this._callAppListener(\"onUserLeave\",u),n.length&&this._callAppListener(\"onUserJoin\",n);for(const e in o){const t=o[e];if(t.length){const e=t.map((e=>this._remoteTracks[mt(e)]));yield this._onUserUnpublish(e)}}return Object.keys(s).forEach((e=>{const t=s[e];if(0===t.length)return;const r=t.map((e=>{const t=mt(e),{userId:r,tag:i,mediaType:n}=ft(t),s=this._remoteTracks[t]=n===Fe.AUDIO_ONLY?new ot(i,r):new at(i,r);return s.__innerSetRemoteMuted(0===e.state),s}));this._onTrackPublish(r)})),Object.keys(a).forEach((e=>{a[e].forEach((e=>{const t=mt(e),r=this._remoteTracks[t];r.__innerSetRemoteMuted(0===e.state),r.isAudioTrack()?this._onAudioMuteChange(r):this._onVideoMuteChange(r)}))})),{data:r}}))}_onAudioMuteChange(e){this._callAppListener(\"onAudioMuteChange\",e)}_onVideoMuteChange(e){this._callAppListener(\"onVideoMuteChange\",e)}_afterChangedRole(e){}_removeRemoteTracks(){const e=Object.values(this._remoteTracks);e.length&&(e.forEach((e=>{e.isAudioTrack()&&e.__releaseMediaElement()})),this._remoteTracks={})}_registerPKMsgListener(e){this._onRecvPKMsg=e}_quitAllPKRoom(){}}var ir,nr,sr;!function(e){e[e.CROP=1]=\"CROP\",e[e.WHOLE=2]=\"WHOLE\"}(ir||(ir={})),function(e){e[e.CUSTOMIZE=1]=\"CUSTOMIZE\",e[e.SUSPENSION=2]=\"SUSPENSION\",e[e.ADAPTATION=3]=\"ADAPTATION\"}(nr||(nr={})),function(e){e[e.CROP=1]=\"CROP\",e[e.WHOLE=2]=\"WHOLE\"}(sr||(sr={}));const or=()=>({version:1,mode:nr.SUSPENSION});class ar{constructor(e,t,r){this._onFlush=e,this._isValidTrackId=t,this._sendCDNInfoSignal=r,this._values=or()}setHostVideoTrack(e){if(!this._isValidTrackId(e))return C.error(`setHostVideoTrack failed: videoTrackId is invalid -> ${e}`),this;const{mediaType:t,tag:r,userId:i}=ft(e);return t!==Fe.VIDEO_ONLY?(C.error(`setHostVideoTrack failed: kind of resource is not 'video' -> ${e}`),this):(this._values.host_stream_id=vt(i,r),this)}setMixLayoutMode(e){return[nr.CUSTOMIZE,nr.SUSPENSION,nr.ADAPTATION].includes(e)?(this._values.mode=e,this):(C.error(`layout mode is invalid: ${e}`),this)}_addOutputValue(e,t,r=\"normal\"){const i=this._values.output||(this._values.output={video:{normal:{width:640,height:480}}});if(\"cdn\"===e)return void(i.cdn=t);if(\"audio\"===e)return void(i.audio={bitrate:t});const n=i.video;if(\"normal\"!==r&&\"tiny\"!==r)if(\"backgroundColor\"!==r)if(\"exparams\"!==r){if(\"backgroundPicture\"===r){const e=n.backgroundPicture||(n.backgroundPicture={fillMode:ir.CROP,picture:[]});Object.assign(e,t)}}else n.exparams={renderMode:t};else n.backgroundColor=t;else{const e=n[r]||(n[r]={});Object.assign(e,t)}}setOutputVideoResolution(e){if(!Tt(e))return C.warn(\"setOutputVideoResolution failed: `resolution` is invalid\"),this;const{width:t,height:r}=Ct(e);return this._addOutputValue(\"video\",{width:t,height:r},\"normal\"),this}setOutputVideoFPS(e){if(!It(e))return C.warn(\"setOutputVideoFPS failed: `fps` is invalid\"),this;const t=Et(e);return this._addOutputValue(\"video\",{fps:t},\"normal\"),this}setOutputVideoBitrate(e){return!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)||e<=0?C.error(`bitrate is invalid: ${e}`):this._addOutputValue(\"video\",{bitrate:e},\"normal\"),this}setOutputTinyVideoResolution(e){if(!Tt(e))return C.warn(\"setOutputTinyVideoResolution failed: `resolution` is invalid\"),this;const{width:t,height:r}=Ct(e);return this._addOutputValue(\"video\",{width:t,height:r},\"tiny\"),this}setOutputTinyVideoFPS(e){if(!It(e))return C.warn(\"setOutputTinyVideoFPS failed: `fps` is invalid\"),this;const t=Et(e);return this._addOutputValue(\"video\",{fps:t},\"tiny\"),this}setOutputTinyVideoBitrate(e){return!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)||e<=0?C.error(`bitrate is invalid: ${e}`):this._addOutputValue(\"video\",{bitrate:e},\"tiny\"),this}setOutputVideoRenderMode(e){return[sr.CROP,sr.WHOLE].includes(e)?this._addOutputValue(\"video\",e,\"exparams\"):C.error(`renderMode is invalid: ${e}`),this}setOutputAudioBitrate(e){return (0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)&&e>0?this._addOutputValue(\"audio\",e):C.error(`bitrate is invalid: ${e}`),this}setOutputBackgroundColor(e){return/^0x[a-fA-F0-9]{6}$/.test(e)?this._addOutputValue(\"video\",e,\"backgroundColor\"):C.error(`color is invalid: ${e}`),this}addOutputBackgroundPicture(e,t,i,n,s){var o,a,c;if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isHttpUrl)(e))return C.error(`uri is invalid: ${e}`),this;if([t,i,n,s].some((e=>!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)||e<0||e>1)))return C.error(`some attrs of (x, y, w, h) is invalid: ${t}, ${i}, ${n}, ${s}`),this;const d=(null===(c=null===(a=null===(o=this._values.output)||void 0===o?void 0:o.video)||void 0===a?void 0:a.backgroundPicture)||void 0===c?void 0:c.picture)||[];return d.push({uri:e,w:n,h:s,x:t,y:i}),this._addOutputValue(\"video\",{picture:d},\"backgroundPicture\"),this}removeOutputBackgroundPicture(e){var t,r,i;if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isHttpUrl)(e))return C.error(`uri is invalid: ${e}`),this;let n=null===(i=null===(r=null===(t=this._values.output)||void 0===t?void 0:t.video)||void 0===r?void 0:r.backgroundPicture)||void 0===i?void 0:i.picture;return n&&(n=n.filter((t=>t.uri!==e)),this._addOutputValue(\"video\",{pictures:n},\"backgroundPicture\")),this}clearOutputBackgroundPicture(){return this._addOutputValue(\"video\",{pictures:[]},\"backgroundPicture\"),this}setOutputBackgroundPictureFillMode(e){return[ir.CROP,ir.WHOLE].includes(e)?this._addOutputValue(\"video\",{fillMode:e},\"backgroundPicture\"):C.error(`fillMode is invalid: ${e}`),this}addPublishStreamUrls(e){var t,r;const i=/^rtmp:\\/\\/.+/;if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)||0===e.length||e.some((e=>!i.test(e))))return C.error(`urls is invalid: ${e}`),this;const n=(null===(r=null===(t=this._values.output)||void 0===t?void 0:t.cdn)||void 0===r?void 0:r.concat())||[];let s=!1;return e.forEach((e=>{n.some((t=>t.pushurl===e))||(s=!0,n.push({pushurl:e}))})),n.length>5?(C.error(\"publish stream url no more than 5\"),this):(s&&this._addOutputValue(\"cdn\",n),this)}removePublishStreamUrls(e){var t,r;const i=/^rtmp:\\/\\/.+/;if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)||0===e.length||e.some((e=>!i.test(e))))return C.error(`urls is invalid: ${e}`),this;const n=(null===(r=null===(t=this._values.output)||void 0===t?void 0:t.cdn)||void 0===r?void 0:r.concat())||[];for(let t=n.length-1;t>=0;t-=1){const{pushurl:r}=n[t],i=e.indexOf(r);i>=0&&(e.splice(i,1),n.splice(t,1))}return this._addOutputValue(\"cdn\",n),this}clearPublishStreamUrls(){return this._addOutputValue(\"cdn\",[]),this}addCustomizeLayoutVideo(e,t,i,n,s){if(!this._isValidTrackId(e))return C.error(`trackId is invalid: ${e}`),this;if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(t)||!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(i))return C.error(`some attrs of (x, y) is invalid: ${t}, ${i}`),this;if([n,s].some((e=>!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)||e<0)))return C.error(`some attrs of (width, height) is invalid: ${n}, ${s}`),this;const{userId:o,tag:a,mediaType:c}=ft(e);if(c!==Fe.VIDEO_ONLY)return C.error(`kind of resource is not 'video': ${e}`),this;const d=vt(o,a);return(this._values.input||(this._values.input={video:[]})).video.push({user_id:o,stream_id:d,x:t,y:i,width:n,height:s}),this}removeCustomizeLayoutVideo(e){if(!this._isValidTrackId(e))return C.error(`trackId is invalid: ${e}`),this;const{userId:t,tag:r,mediaType:i}=ft(e);if(i!==Fe.VIDEO_ONLY)return C.error(`kind of resource is not 'video': ${e}`),this;const n=vt(t,r),s=this._values.input||(this._values.input={video:[]});return s.video=s.video.filter((e=>e.stream_id===n)),this}clearCustomizeLayoutVideo(){return(this._values.input||(this._values.input={video:[]})).video=[],this}flush(){var e,t,r,i;return S(this,void 0,void 0,(function*(){const n=JSON.parse(JSON.stringify(this._values)),{code:s}=yield this._onFlush(n);return s===T.SUCCESS&&((null===(t=null===(e=this._values.output)||void 0===e?void 0:e.video.normal)||void 0===t?void 0:t.width)||(null===(i=null===(r=this._values.output)||void 0===r?void 0:r.video.normal)||void 0===i?void 0:i.fps))&&this._sendCDNInfoSignal(),this._values=or(),{code:s}}))}}var cr,dr,ur,lr;!function(e){e[e.OPEN=1]=\"OPEN\",e[e.STOP=2]=\"STOP\"}(cr||(cr={})),function(e){e[e.SPREAD=0]=\"SPREAD\",e[e.NO_SPREAD=-1]=\"NO_SPREAD\"}(dr||(dr={})),function(e){e[e.AUTOMATIC=0]=\"AUTOMATIC\",e[e.MANUAL=1]=\"MANUAL\"}(ur||(ur={})),function(e){e[e.VIDEO=0]=\"VIDEO\",e[e.AUDIO=1]=\"AUDIO\"}(lr||(lr={}));const hr=()=>\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return(\"x\"===e?t:3&t|8).toString(16)}));class pr{constructor(e,t,r,i,n,s,o,a){this._context=e,this._runtime=t,this._service=r,this._initOptions=i,this._mainLivingRoom=n,this._registerPKMsgListener=s,this._onJoinedPKRoom=o,this._onLeavePKRoom=a,this._inviteTimeout=30,this._PKInfo={},this._appListener=null,this._joinedPKRooms={},this._registerPKMsgListener(this._onRecvPKMsg.bind(this)),this._mainRoomId=this._mainLivingRoom.getRoomId()}_callAppListener(e,...t){var r;const i=null===(r=this._appListener)||void 0===r?void 0:r[e];if(i)try{i(...t)}catch(e){C.error(e)}}_onInvite(e){const t=e.inviteInfo||{},{inviterRoomId:r,inviterUserId:i,extra:n}=t,s={inviterRoomId:r,inviterUserId:i};n&&Object.assign(s,{extra:n}),this._PKInfo[r]=t,this._callAppListener(\"onRequestJoinOtherRoom\",s)}_onCancelInvite(e){const{inviterRoomId:t,inviterUserId:r,extra:i}=e.inviteInfo||{},n={inviterRoomId:t,inviterUserId:r};i&&Object.assign(n,{extra:i}),delete this._PKInfo[t],this._callAppListener(\"onCancelRequestOtherRoom\",n)}_onInviteTimeout(e){}_onInviteAnswer(e){const{answerCode:t,inviteContent:r,inviteeUserAutoMix:i}=e,{inviterUserId:n,inviterRoomId:s,inviteeUserId:o,inviteeRoomId:a,extra:c}=r,d={agree:1===t,inviterRoomId:s,inviterUserId:n,inviteeRoomId:a,inviteeUserId:o};this._PKInfo[a].inviteeUserAutoMix=i,this._callAppListener(\"onResponseJoinOtherRoom\",d)}_onPKEnd(e){return S(this,void 0,void 0,(function*(){const{inviteeRoomId:t,inviterRoomId:r,userId:i}=e.inviteInfo,n=r===this._mainRoomId?t:r,s={endRoomId:n,endUserId:i};yield this.leaveOtherRoom(this._joinedPKRooms[n]),delete this._PKInfo[n],this._callAppListener(\"onFinishOtherRoom\",s)}))}_onRecvPKMsg(e){const{targetId:t,content:r,messageType:i}=e;switch(i){case Nt.PK_INVITE:this._onInvite(r);break;case Nt.PK_CANCEL_INVITE:this._onCancelInvite(r);break;case Nt.PK_INVITE_TIMEOUT:this._onInviteTimeout(r);break;case Nt.PK_INVITE_ANSWER:this._onInviteAnswer(r);break;case Nt.PK_END:this._onPKEnd(r)}}registerRoomPKEventListener(e){this._appListener=e}requestJoinOtherRoom(e,t,r){return S(this,void 0,void 0,(function*(){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"inviteeRoomId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0)||!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"inviteeUserId\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0))return{code:T.PARAMS_ERROR};C.debug(`requestRoomPK -> inviteeRoomId: ${e}; inviteeUserId: ${t}; options: ${JSON.stringify(r||{})}`);const n=hr(),s=!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isBoolean)(null==r?void 0:r.autoMix)||(null==r?void 0:r.autoMix),o={inviteSessionId:n,inviterRoomId:this._mainRoomId,inviterUserId:this._context.getCurrentId(),inviterUserAutoMix:s,inviteeRoomId:e,inviteeUserId:t,inviteeTimeoutTime:this._inviteTimeout,extra:(null==r?void 0:r.extra)||\"\"},a={roomId:this._mainRoomId,invitedRoomId:e,invitedUserId:t,inviteTimeout:this._inviteTimeout,inviteInfo:JSON.stringify(o),inviteSessionId:n};C.debug(`requestRoomPK -> params: ${JSON.stringify(a)}`);const d=yield this._context.requestRoomPK(a);return d!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`requestRoomPK failed: ${d}`),{code:d}):(C.debug(\"requestRoomPK success\"),this._PKInfo[e]={inviteSessionId:n,inviterRoomId:this._mainRoomId,inviterUserId:this._context.getCurrentId(),inviterUserAutoMix:s,inviteeRoomId:e},{code:T.SUCCESS})}))}cancelRequestJoinOtherRoom(e,t,r){return S(this,void 0,void 0,(function*(){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"inviteeRoomId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0)||!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"inviteeUserId\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0))return{code:T.PARAMS_ERROR};if(!this._PKInfo[e])return C.error(`未发起过与 ${e} 房间内 ${t} 连麦的请求`),{code:T.PARAMS_ERROR};C.debug(`canceRequestJoinPK -> inviteeRoomId: ${e}; inviteeUserId: ${t}; extra: ${r}`);const n={inviterRoomId:this._mainRoomId,inviterUserId:this._context.getCurrentId(),inviteeRoomId:e,inviteeUserId:t,extra:r||\"\"},s={roomId:this._mainRoomId,invitedRoomId:e,invitedUserId:t,inviteSessionId:this._PKInfo[e].inviteSessionId,inviteInfo:JSON.stringify(n)};C.debug(`canceRequestJoinPK -> params: ${JSON.stringify(s)}`);const o=yield this._context.cancelRoomPK(s);return o!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`canceRequestJoinPK failed: ${o}`),{code:o}):(C.debug(\"canceRequestJoinPK success\"),delete this._PKInfo[e],{code:T.SUCCESS})}))}responseJoinOtherRoom(e,t,r,n){return S(this,void 0,void 0,(function*(){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"inviterRoomId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0)||!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"inviterUserId\",t,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0))return{code:T.PARAMS_ERROR};if(!this._PKInfo[e])return C.error(`${e} 房间内的 ${t} 未发起过连麦请求`),{code:T.PARAMS_ERROR};C.debug(`responseRoomPK -> inviterRoomId: ${e}; inviterUserId: ${t}; agree: ${r}; options: ${JSON.stringify(n||{})}`);const{inviteSessionId:s,inviterUserAutoMix:o}=this._PKInfo[e],a=!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isBoolean)(null==n?void 0:n.autoMix)||(null==n?void 0:n.autoMix),d={inviteSessionId:s,inviterRoomId:e,inviterUserId:t,inviteeRoomId:this._mainRoomId,inviteeUserId:this._context.getCurrentId(),inviteeUserAutoMix:a},u=Object.assign(d,{inviterUserAutoMix:o}),l=r?Object.assign(d,{MultiRoomKey:`${e}|${this._mainRoomId}`,MultiRoomValue:JSON.stringify(u)}):d;!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isUndefined)(null==n?void 0:n.extra)&&Object.assign(l,{extra:n.extra});const m={agree:r,roomId:this._mainRoomId,inviteSessionId:s,inviteRoomId:e,inviteUserId:t,content:JSON.stringify(l),key:`${e}|${t}`,value:JSON.stringify(d)};C.debug(`responseRoomPK -> params: ${JSON.stringify(m)}`);const f=yield this._context.responseRoomPK(m);return f!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`responseRoomPK failed: ${f}`),{code:f}):(C.debug(\"responseRoomPK success\"),this._PKInfo[e].inviteeUserAutoMix=a,{code:T.SUCCESS})}))}_quitRoomPK(e){return S(this,void 0,void 0,(function*(){const{inviterRoomId:t,inviteeRoomId:r,inviterUserId:n}=this._PKInfo[e],s={inviteeRoomId:r,inviterRoomId:t,userId:this._context.getCurrentId()},o={roomId:this._mainRoomId,endRoomId:e,sessionId:this._PKInfo[e].inviteSessionId,content:JSON.stringify(s),keys:[`${t}|${n}`]};C.debug(`quitRoomPK -> params: ${JSON.stringify(o)}`);const a=yield this._context.endRoomPK(o);return a!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`quitRoomPK failed: ${a}`),{code:T.SIGNAL_ERROR}):(C.debug(\"quitRoomPK success\"),delete this._PKInfo[e],{code:T.SUCCESS})}))}_relaseCrtRoom(){}joinOtherRoom(e){return S(this,void 0,void 0,(function*(){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"roomId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0))return{code:T.PARAMS_ERROR};if(this._context.getConnectionStatus()!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConnectionStatus.CONNECTED)return{code:T.SIGNAL_DISCONNECTED};if(C.debug(`joinPKRoom, roomId: ${e}`),this._joinedPKRooms[e])return{code:T.REPERT_JOIN_ROOM};const t=lr.VIDEO,{code:r,data:s}=yield this._context.joinRTCRoom(e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE,t);if(r!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return C.error(`joinRoom failed -> code: ${r}`),{code:r};C.debug(`JoinPKRoom success -> userId: ${this._context.getCurrentId()}, roomId: ${e}, data: ${JSON.stringify(s)}`);const o=new _r(this._context,this._runtime,e,s,this._service,this._initOptions,this._relaseCrtRoom.bind(this),t,!1,!1);return this._joinedPKRooms[e]=o,this._onJoinedPKRoom(e,o),{room:o,code:T.SUCCESS,userIds:o.getRemoteUserIds(),tracks:o.getRemoteTracks()}}))}leaveOtherRoom(e,t){return S(this,void 0,void 0,(function*(){return k((()=>S(this,void 0,void 0,(function*(){const r=e.getRoomId();return C.debug(`leavePKRoom -> userId: ${this._context.getCurrentId()} , roomId: ${r}`),yield e.__destroy(!0),delete this._joinedPKRooms[r],this._onLeavePKRoom(r),this._PKInfo[r]?(t&&this._quitRoomPK(r),{code:T.SUCCESS}):{code:T.SUCCESS}}))))}))}getPKInfo(e){return this._PKInfo[e]}getJoinedPKRooms(){return this._joinedPKRooms}}class _r extends rr{constructor(e,t,r,i,n,s,o,a,c=!1,d){var l;super(e,t,r,i,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE,n,s,o,c,d),this._livingType=a,this._isMainRoom=d,this._CDNUris=null,this._CDNEnable=!1,this._mcuConfigBuilder=new ar(this._onMCUConfigFlush.bind(this),this._isValidResourceId.bind(this),this._sendCDNInfoSignal.bind(this)),this._isMainRoom&&(this._roomPKHandler=new pr(e,t,n,s,this,super._registerPKMsgListener.bind(this),this._onJoinedPKRoom.bind(this),this._onLeavePKRoom.bind(this)));const h=null===(l=i.roomInfo.filter((e=>\"cdn_uris\"===e.key))[0])||void 0===l?void 0:l.value;h&&(this._CDNUris=JSON.parse(h)[0])}_isValidResourceId(e){var t;const{userId:r}=ft(e),i=!!(null===(t=this._roomResources[r])||void 0===t?void 0:t.find((t=>mt(t)===e)));let n=!1;const{code:s,roomPKHandler:o}=this.getRoomPKHandler();if(s!==T.SUCCESS||!o)return i;const a=o.getJoinedPKRooms(),c=[];return Object.values(a).map((e=>{c.push(...e.getRemoteTracks())})),n=c.some((t=>e===t.getTrackId())),i||n}getLivingType(){return this._livingType}getMCUConfigBuilder(){return this._isMainRoom?this._mcuConfigBuilder:(C.error(\"the `getMCUConfigBuilder` is disabled in PK room \"),{code:T.THE_FUNCTION_IS_DISABLED_IN_PKROOM})}_onMCUConfigFlush(e){return S(this,void 0,void 0,(function*(){const t={\"App-Key\":this._context.getAppkey(),Token:this._token,RoomId:this.getRoomId(),UserId:this._context.getCurrentId(),SessionId:this.getSessionId()},{code:r,res:i}=yield this._service.setMcuConfig(t,e);return r!==T.SUCCESS?(C.error(`set MCU config failed: ${r}`),{code:r}):(C.info(\"set MCU config success\"),i.pull_url&&(this._CDNUris=JSON.parse(i.pull_url)),{code:r,res:i})}))}__onReconnected(){const e=Object.create(null,{__onReconnected:{get:()=>super.__onReconnected}});var t,r;return S(this,void 0,void 0,(function*(){const i=yield e.__onReconnected.call(this,this._livingType);if(!i||!i.data)return;const n=i.data.roomInfo,s=null===(t=n.filter((e=>\"cdn_uris\"===e.key))[0])||void 0===t?void 0:t.value;if(!s)return;const o=JSON.parse(s);(null===(r=this._CDNUris)||void 0===r?void 0:r.enableInnerCDN)!==o.enableInnerCDN&&this._callAppListener(\"onCDNEnableChange\",o.enableInnerCDN),this._CDNUris=o}))}enableInnerCDN(e){return S(this,void 0,void 0,(function*(){if(!this._isMainRoom)return C.error(\"the `enableInnerCDN` is disabled in PK room \"),{code:T.THE_FUNCTION_IS_DISABLED_IN_PKROOM};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isBoolean)(e))return C.error(\"`enable` is invalid\"),{code:T.PARAMS_ERROR};this._CDNEnable=e;const t={version:2,output:{inCDNModel:e?cr.OPEN:cr.STOP}},{code:r}=yield this._onMCUConfigFlush(t);if(r!==T.SUCCESS)return C.error(`enableInnerCDN failed -> code: ${r}`),{code:T.SIGNAL_ERROR};if(this._CDNUris&&this._CDNUris.broadcast!==dr.SPREAD)return C.info(\"enableInnerCDN succeed\"),{code:T.SUCCESS};const{code:i}=yield k((()=>S(this,void 0,void 0,(function*(){return this._sendCDNInfoSignal()}))));return i===T.SUCCESS?(C.info(\"enableInnerCDN succeed\"),{code:T.SUCCESS}):(C.error(`enableInnerCDN failed -> code: ${i}`),{code:i})}))}_sendCDNInfoSignal(){return S(this,void 0,void 0,(function*(){this._CDNUris=Object.assign({},this._CDNUris,{enableInnerCDN:this._CDNEnable});return(yield Promise.all([this._spreadCDNInfo(this._CDNUris),this._setRoomCDNInfo(this._CDNUris)])).every((e=>e.code===T.SUCCESS))?{code:T.SUCCESS}:{code:T.SIGNAL_ERROR}}))}_spreadCDNInfo(e){return S(this,void 0,void 0,(function*(){const t=yield this._context.setRTCCDNUris(this._roomId,Nt.TOTAL_CONTENT_RESOURCE,JSON.stringify([e]));return t!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`spreadCDNInfo failed -> code: ${t}`),{code:T.SIGNAL_ERROR}):(C.info(\"spreadCDNInfo succeed\"),{code:T.SUCCESS})}))}_setRoomCDNInfo(e){return S(this,void 0,void 0,(function*(){const t=yield this._context.setRTCData(this._roomId,\"cdn_uris\",JSON.stringify([e]),!0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCApiType.ROOM);return t!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(`setRoomCDNInfo failed -> code: ${t}`),{code:T.SIGNAL_ERROR}):(C.info(\"setRoomCDNInfo succeed\"),{code:T.SUCCESS})}))}_resourceHandle(e,t,r){const i=Object.create(null,{_resourceHandle:{get:()=>super._resourceHandle}});var n;return S(this,void 0,void 0,(function*(){i._resourceHandle.call(this,e,t,r),e.cdn_uris&&((null===(n=this._CDNUris)||void 0===n?void 0:n.enableInnerCDN)!==e.cdn_uris[0].enableInnerCDN&&this._callAppListener(\"onCDNEnableChange\",!this.__getCDNEnable()),this._CDNUris=e.cdn_uris[0])}))}_exchangeHandle(e){var t,r,i;return S(this,void 0,void 0,(function*(){const n=yield this._service.exchange(this._getRTCReqestHeaders(),e),s=null===(r=null===(t=n.data)||void 0===t?void 0:t.urls)||void 0===r?void 0:r.pull_url;return n.code===T.SUCCESS&&s?(this._CDNUris=JSON.parse(s),(null===(i=this._CDNUris)||void 0===i?void 0:i.broadcast)===dr.SPREAD&&(this._CDNEnable=!0,this._sendCDNInfoSignal()),n):n}))}_afterChangedRole(e){const t=Lt(e),r=this._context.getCurrentId(),i=Object.keys(t);setTimeout((()=>{var n,s,o;const a=i.filter((e=>e!==r));a.length>0&&this._callAppListener(\"onUserJoin\",a);for(const e in t)e!==r&&this._resourceHandle({uris:t[e]},Nt.TOTAL_CONTENT_RESOURCE,e);(null===(n=e.roomInfo.filter((e=>\"cdn_uris\"===e.key))[0])||void 0===n?void 0:n.value)&&(null===(s=this._CDNUris)||void 0===s?void 0:s.push_mode)===ur.MANUAL&&this._callAppListener(\"onCDNEnableChange\",null===(o=this._CDNUris)||void 0===o?void 0:o.enableInnerCDN)}))}__getCDNEnable(){var e;return null===(e=this._CDNUris)||void 0===e?void 0:e.enableInnerCDN}__getCDNPushMode(){var e;return null===(e=this._CDNUris)||void 0===e?void 0:e.push_mode}_onJoinedPKRoom(e,t){const{code:r,roomPKHandler:i}=this.getRoomPKHandler();if(r===T.SUCCESS&&i){if(!i.getPKInfo(e))return;this._exchangeWithPushOtherRoom()}}_onLeavePKRoom(e){const{code:t,roomPKHandler:r}=this.getRoomPKHandler();if(t===T.SUCCESS&&r){if(!r.getPKInfo(e))return;this._exchangeWithPushOtherRoom()}}_exchangeWithPushOtherRoom(){return S(this,void 0,void 0,(function*(){if(!this.getLocalTracks().length)return;const e=yield this._createExchangeParams(this._subscribedList,!1),t=this._getPushOtherRoomsParams();t&&(e.pushOtherRooms=t);const r=yield this._exchangeHandle(e);if(r.code!==T.SUCCESS)return C.error(`reTryExchange failed: ${r.code}`),{code:r.code};const{sdp:i,resultCode:n}=r.data;if(n!==T.SUCCESS)return C.error(`exchange with pushOtherRoom failed: ${n}`),{code:n};const s=yield this._pc.setRemoteAnswer(i.sdp);return s!==T.SUCCESS?{code:s}:void 0}))}getRoomPKHandler(){return this._isMainRoom?{code:T.SUCCESS,roomPKHandler:this._roomPKHandler}:(C.error(\"the `getRoomPKHandler` is disabled in PK room \"),{code:T.THE_FUNCTION_IS_DISABLED_IN_PKROOM})}_quitAllPKRoom(){const e=this._roomPKHandler.getJoinedPKRooms();for(const t in e){const r=e[t];this._roomPKHandler.leaveOtherRoom(r)}}}class mr extends rr{constructor(e,t,r,i,n,s,o){super(e,t,r,i,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.RTC,n,s,o,!1)}}const fr=()=>({\"Content-Type\":\"application/json;charset=UTF-8\",\"Cache-Control\":\"no-cache\",ClientType:`web|${yt.browser}|${yt.version}`,ClientVersion:\"5.3.1\",\"Client-Session-Id\":hr(),\"Request-Id\":Date.now().toString()});class vr{constructor(e,t,r,i=5e3){this._runtime=e,this._context=t,this._msUrl=r,this._timeout=i,this._msInNavi=[],this._failedMs=[],this._rtcFinger=void 0,this._clusterId=\"\",this._configUrl=\"\"}getNaviMS(){return this._msUrl?[this._msUrl]:this._clusterId?[`https://${this._clusterId}`]:(0===this._msInNavi.length&&(0===this._failedMs.length?this._msInNavi.push(...(e=>{var t;if(!e)return[];let r;try{r=JSON.parse(e.voipCallInfo||'{ \"strategy\": 0 }')}catch(t){return C.warn(\"parse `voipCallInfo` of navi failed: \"+e.voipCallInfo),[]}if(0===r.strategy)return[];const i=null===(t=r.callEngine)||void 0===t?void 0:t.filter((e=>4===e.engineType));if(!i||0===i.length)return[];const n=i[0],s=[];return n.mediaServer&&s.push(n.mediaServer.replace(/^(https?:\\/\\/)?/,\"https://\")),n.backupMediaServer&&n.backupMediaServer.forEach((e=>{s.push(e.replace(/^(https?:\\/\\/)?/,\"https://\"))})),s})(this._context.getNaviInfo())):(this._msInNavi.push(...this._failedMs),this._failedMs.length=0)),this._msInNavi.map((e=>e.trim())))}_request(e,t,r){return S(this,void 0,void 0,(function*(){const i=this.getNaviMS();if(0===i.length)return{code:T.NOT_OPEN_VIDEO_AUDIO_SERVER};this._rtcFinger&&(r.rtcFinger=this._rtcFinger);for(let n=0;n<i.length;n+=1){const s=`${i[n]}${e}`,o=fr();C.debug(`request -> Request-Id: ${o[\"Request-Id\"]}, url: ${s}`);const{status:a,data:c}=yield this._runtime.httpReq({url:s,body:JSON.stringify(r),headers:Object.assign(Object.assign({},o),t),method:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.HttpMethod.POST,timeout:this._timeout});if(200===a){const e=JSON.parse(c);return e.rtcFinger&&(this._rtcFinger=e.rtcFinger),e.clusterId&&(this._clusterId=e.clusterId),C.debug(`request success -> Request-Id: ${o[\"Request-Id\"]}`),{code:T.SUCCESS,data:e}}C.warn(`request failed -> Request-Id: ${o[\"Request-Id\"]}, status: ${a}, url: ${s}`),this._failedMs.push(...this._msInNavi.splice(n,1))}return{code:T.REQUEST_FAILED}}))}exchange(e,t){var r;return S(this,void 0,void 0,(function*(){const i=yield this._request(\"/exchange\",e,t);if(i.code===T.SUCCESS&&(null===(r=i.data)||void 0===r?void 0:r.resultCode)===T.SUCCESS){const e=i.data.urls;e&&(this._configUrl=e.configUrl)}return i}))}exit(e){return S(this,void 0,void 0,(function*(){const{code:t}=yield this._request(\"/exit\",e,{});return t}))}broadcastSubscribe(e,t){return this._request(\"/broadcast/subscribe\",e,t)}broadcastExit(e){return S(this,void 0,void 0,(function*(){const{code:t}=yield this._request(\"/broadcast/exit\",e,{});return{code:t}}))}setMcuConfig(e,t){return S(this,void 0,void 0,(function*(){if(!this._configUrl)return{code:T.MCU_SERVER_NOT_FOUND};const r=`${this._configUrl.replace(/^(https?:\\/\\/)?/,\"https://\")}/server/mcu/config`,i=fr();C.debug(`request -> Request-Id: ${i[\"Request-Id\"]}, url: ${r}`);const{status:n,data:s}=yield this._runtime.httpReq({url:r,headers:Object.assign(Object.assign({},i),e),body:JSON.stringify(t),method:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.HttpMethod.POST});if(200===n){C.debug(`request success -> Request-Id: ${i[\"Request-Id\"]}`);const e=JSON.parse(s);return{code:e.resultCode,res:e}}return{code:T.REQUEST_FAILED}}))}getCDNResourceInfo(e,t){return S(this,void 0,void 0,(function*(){const r=fr(),{status:i,data:n}=yield this._runtime.httpReq({url:t,headers:Object.assign(Object.assign({},r),e),method:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.HttpMethod.GET});if(200===i){const e=JSON.parse(n);return{code:e.resultCode,res:e}}return C.warn(`request failed -> Request-Id: ${r[\"Request-Id\"]}, status: ${i}, url: ${t}`),{code:T.REQUEST_FAILED}}))}}class Rr{constructor(e,t,r){this._context=e,this._rtcToken=\"\",this._liveUrl=\"\",this._subTracks=[],this._livingType=null,this._mediaType=null,this._subTiny=!1,this._fromRetry=!1,this._appListener=null,this._service=new vr(t,e,r.mediaServer)}_getReqHeaders(e){return S(this,void 0,void 0,(function*(){const t=this._context.getCurrentId(),r=t;if(!this._rtcToken){const{code:t,data:n}=yield this._context.getRTCToken(r,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE,e);if(t!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return C.error(`getRTCToken failed: ${t}`),{code:T.SIGNAL_ERROR};this._rtcToken=n.rtcToken}return{code:T.SUCCESS,headers:{\"App-Key\":this._context.getAppkey(),UserId:t,RoomId:r,RoomType:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE,Token:this._rtcToken}}}))}_clearSubscribeInfo(){var e;this._liveUrl=\"\",this._livingType=null,this._mediaType=null,this._subTiny=!1,this._subTracks.length=0,null===(e=this._pc)||void 0===e||e.destroy(),this._pc=null}_reTryExchange(){var e;return S(this,void 0,void 0,(function*(){this._fromRetry=!0;const{code:t}=yield this.subscribe(this._liveUrl,this._livingType,this._mediaType,this._subTiny);t===T.SUCCESS&&(null===(e=this._pc)||void 0===e||e.clearReTryExchangeTimer())}))}subscribe(e,t,r,i=!1){return S(this,void 0,void 0,(function*(){return k((()=>this.__subscribe(e,t,r,i)))}))}__subscribe(e,t,r,i=!1){var n;return S(this,void 0,void 0,(function*(){const s=[];if(Ot(this._context.getNaviInfo()))return{code:T.PACKAGE_ENVIRONMENT_ERROR,tracks:s};if(!this._fromRetry&&(null===(n=this._pc)||void 0===n||n.clearReTryExchangeTimer()),this._fromRetry=!1,!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isString)(e))return C.error(`liveUrl is invalid: ${e}`),{code:T.PARAMS_ERROR,tracks:s};if(![lr.AUDIO,lr.VIDEO].includes(t))return C.error(`livingType is invalid: ${t}`),{code:T.PARAMS_ERROR,tracks:s};if(![Fe.AUDIO_ONLY,Fe.VIDEO_ONLY,Fe.AUDIO_VIDEO].includes(r))return C.error(`mediaType is invalid: ${r}`),{code:T.PARAMS_ERROR,tracks:s};if(this._liveUrl&&this._liveUrl!==e)return{code:T.BROADCAST_SUB_LIST_NOT_EMPTY,tracks:s};this._pc||(this._pc=new Wt(this._reTryExchange.bind(this)),this._pc.on(Wt.__INNER_EVENT_TRACK_READY__,this._onTrackReady,this),this.registerReportListener(this._reportListener)),this._liveUrl=e;const{code:o,headers:a}=yield this._getReqHeaders(t);if(o!==T.SUCCESS)return{code:o,tracks:s};const c=`rc_mcu_${Date.now()}`,d=\"RongCloudRTC\";0===this._subTracks.length&&(this._subTracks.push(new ot(d,c),new at(d,c)),this._pc.updateSubRemoteTracks(this._subTracks.slice()));const u={sdp:yield this._pc.createOffer(!0),liveUrl:e,mediaType:r,simulcast:i?Mt.TINY:Mt.NORMAL,switchstream:!1},l=yield this._service.broadcastSubscribe(a,u);if(l.code!==T.SUCCESS)return C.error(`andience subscribe failed: ${l.code}`),{code:l.code,tracks:s};const h=l.data;if(h.resultCode!==T.SUCCESS)return C.error(`andience subscribe failed! code: ${h.resultCode}; message: ${h.message}`),{code:h.resultCode,tracks:s};C.debug(`andience subscribe success: ${e}`),this._livingType=t,this._mediaType=r,this._subTiny=i;const{sdp:p,subscribedList:_}=h,m=[];return _.forEach((e=>{const{mediaType:t}=e,r=this._subTracks[t];m.push(r),r.__innerSetRemoteMuted(!0)})),this._pc.setRemoteAnswer(p.sdp),{code:T.SUCCESS,tracks:m}}))}unsubscribe(){return S(this,void 0,void 0,(function*(){return k((()=>this.__unsubscribe()))}))}__unsubscribe(){var e;return S(this,void 0,void 0,(function*(){if(null===(e=this._pc)||void 0===e||e.clearReTryExchangeTimer(),!this._rtcToken||!this._liveUrl)return{code:T.SUCCESS};const{headers:t}=yield this._getReqHeaders(),{code:r}=yield this._service.broadcastExit(t);return r!==T.SUCCESS?C.error(`broadcast unsubscribe failed: ${r}`):C.debug(\"broadcast unsubscribe success\"),this._clearSubscribeInfo(),{code:r}}))}registerReportListener(e){var t;this._reportListener=e,null===(t=this._pc)||void 0===t||t.registerReportListener(e)}registerTrackEventListener(e){this._appListener=e}_onTrackReady(e){var t,r;const i=e.receiver.track,n=\"audio\"===i.kind?Fe.AUDIO_ONLY:Fe.VIDEO_ONLY,s=this._subTracks[n];s.__innerSetMediaStreamTrack(i);try{null===(r=null===(t=this._appListener)||void 0===t?void 0:t.onTrackReady)||void 0===r||r.call(t,s)}catch(e){C.error(e)}}}var gr,Sr;!function(e){e.RTMP=\"rtmp\",e.FLV=\"flv\",e.HLS=\"hls\"}(gr||(gr={})),function(e){e[e.NOT_HTTPS=0]=\"NOT_HTTPS\",e[e.HTTPS=1]=\"HTTPS\"}(Sr||(Sr={}));const Cr=Object.assign(Object.assign({},Ct(He.W176_H144)),{frameRate:Et(Be.FPS_15)});class Tr{constructor(e,t,r,i,n,s){this._context=e,this._runtime=t,this._initOptions=r,this._roomId=i,this._joinResData=n,this._livingType=s,this._roomAnchorList=[],this._roomRes={},this._roomAnchorRes={},this._remoteTracks={},this._appListener=null,this._subscribedList=[],this._sessionId=\"\",this._destroyed=!1,this._setInitData(),this._service=new vr(this._runtime,this._context,this._initOptions.mediaServer,this._initOptions.timeout),this._polarisReport=new Zt(this._context,this._runtime,this._roomId,this,qt.Audience),this._polarisReport.sendR1(),this._pc=new Wt(this._reTryExchange.bind(this),this._polarisReport),this._pc.on(Wt.__INNER_EVENT_TRACK_READY__,(e=>{const t=e.streams[0].id,r=e.receiver.track,i=[t,\"audio\"===r.kind?Fe.AUDIO_ONLY:Fe.VIDEO_ONLY].join(\"_\"),n=this._remoteTracks[i];n?(n.__innerSetMediaStreamTrack(r),this._callAppListener(\"onTrackReady\",n)):C.warn(\"cannot found RCRemoteTrack:\",r.id)})),this._context.onrtcdatachange=this.singalDataChange.bind(this)}_setInitData(){const{sessionId:e,remoteUserIds:t,remoteRTCUris:r,remoteMUCUris:i,remoteTracks:n,CDNUris:s}=((e,t)=>{const r=t.filter((e=>\"RC_RTC_SESSIONID\"===e.key))[0],i=r?r.value:\"\",n=t.filter((e=>\"RC_ANCHOR_LIST\"===e.key)).map((e=>JSON.parse(e.value||\"[]\")))[0],s=t.filter((e=>e.key.includes(\"RC_RES_\"))).map((e=>JSON.parse(e.value||\"{}\"))),o=s.length?JSON.parse(s[0].mcu_uris||\"[]\"):[],a=[];o.forEach((t=>{const{mediaType:r,tag:i}=t,n=r===Fe.AUDIO_ONLY?new ot(i,\"\",e):new at(i,\"\",e);a.push(n)}));const c=[],d=[];s.forEach((e=>{const t=JSON.parse(e.uris||\"[]\");c.push(...t),t.forEach((e=>{const{mediaType:t,tag:r,msid:i}=e,n=i.split(\"_\")[0],s=t===Fe.AUDIO_ONLY?new ot(r,n):new at(r,n);d.push(s)}))}));const u=t.filter((e=>\"RC_CDN\"===e.key)).map((e=>{const t=JSON.parse(e.value||\"[]\");return JSON.parse(t.cdn_uris)[0]}))[0];return{sessionId:i,remoteUserIds:n||[],remoteRTCUris:c,remoteMUCUris:o,remoteRTCTracks:d,remoteMCUTracks:a,remoteTracks:[...d,...a],CDNUris:u||{}}})(this._roomId,this._joinResData.kvEntries);this._sessionId=e,this._roomAnchorList=t,n.forEach((e=>{this._remoteTracks[e.getTrackId()]=e})),this._CDNUris=s,r.forEach((e=>{const t=e.msid.split(\"_\")[0];this._roomAnchorRes[t]?this._roomAnchorRes[t].push(e):this._roomAnchorRes[t]=[e]})),i.forEach((e=>{const{mediaType:t,tag:r}=e,i=[this._roomId,r,t].join(\"_\");this._roomRes[i]=e})),r.forEach((e=>{const t=mt(e);this._roomRes[t]=e}))}_assertRoomDestroyed(){if(this._destroyed){const e=\"This room has been destroyed. Please use `RCRTCClient.joinLivingRoomAsAudience` to catch another instance.\";return C.warn(e),T.ROOM_HAS_BEEN_DESTROYED}}singalDataChange(e,t){var r;if(t!==this._roomId)return void C.warn(`singalDataChange -> not the current room data: data roomId: ${t}, current roomId: ${this._roomId}`);C.debug(\"singalDataChange -> singalData:\",JSON.stringify(e||{}));const i=[],n=null===(r=e.filter((e=>\"RC_CDN\"===e.key))[0])||void 0===r?void 0:r.value;n&&this._diffCDNUris(JSON.parse(JSON.parse(n).cdn_uris)[0]),e.forEach((e=>{const{key:t,value:r,timestamp:n,uid:s}=e;if(-1!==t.indexOf(\"RC_RES_\")){const e=JSON.parse(r||\"{}\"),t=JSON.parse(e.mcu_uris||\"[]\"),n=JSON.parse(e.uris||\"[]\");return i.push(...t),void this._diffAnchorResource(n,s)}if(\"RC_ANCHOR_LIST\"===t){const e=JSON.parse(r||\"[]\"),{joinUserIds:t,leftUserIds:i}=this._diffAnchorList(e);t.length>0&&this._handleNewJoinedAnchor(t),i.length>0&&this._handleLeftedAnchor(i)}})),this._diffRoomResource(i)}_diffAnchorList(e){const t=e.filter((e=>this._roomAnchorList.indexOf(e)<0));return{leftUserIds:this._roomAnchorList.filter((t=>e.indexOf(t)<0)),joinUserIds:t}}_handleNewJoinedAnchor(e){this._roomAnchorList.push(...e),this._callAppListener(\"onAnchorJoin\",e)}_handleLeftedAnchor(e){return S(this,void 0,void 0,(function*(){this._roomAnchorList=this._roomAnchorList.filter((t=>!(e.indexOf(t)>-1)));const t=[];e.forEach((e=>{t.push(...this.getRemoteTracksByUserId(e)),delete this._roomAnchorRes[e]})),t.length&&(yield this.unsubscribe(t),t.forEach((e=>delete this._remoteTracks[e.getTrackId()]))),this._callAppListener(\"onAnchorLeave\",e)}))}_diffRoomResource(e){return S(this,void 0,void 0,(function*(){const t=[],r=[],i=[];e.forEach((e=>{const r=mt(e),{userId:n,tag:s,mediaType:o}=ft(r),a=[this._roomId,s,o].join(\"_\");if(!this._remoteTracks[a]){const r=o===Fe.AUDIO_ONLY?new ot(s,\"\",this._roomId):new at(s,\"\",this._roomId);t.push(r),this._remoteTracks[a]=r,this._roomRes[r.getTrackId()]=e}i.push(a)})),Object.keys(this._remoteTracks).forEach((e=>{i.indexOf(e)<0&&this._remoteTracks[e].isMCUTrack()&&r.push(this._remoteTracks[e])})),t.length>0&&this._callAppListener(\"onTrackPublish\",t),r.length>0&&this._onUserUnpublish(r,\"onTrackUnpublish\")}))}_diffAnchorResource(e,t){return S(this,void 0,void 0,(function*(){const r=this._roomAnchorRes[t]||(this._roomAnchorRes[t]=[]),{publishedList:i,unpublishedList:n,modifiedList:s}=gt(r,e);if(i.length){const e=r.map(mt),t=[],n=[];if(i.forEach((i=>{const s=mt(i),o=e.indexOf(s),{userId:a,tag:c,mediaType:d}=ft(s);o>-1?r[o]=i:r.push(i);let u=this._remoteTracks[s];this._roomRes[s]=i,u?u.isSubscribed()&&t.push(u):(u=d===Fe.AUDIO_ONLY?new ot(c,a):new at(c,a),this._remoteTracks[s]=u,n.push(u)),u.__innerSetRemoteMuted(0===i.state)})),t.length){const e=t.map((e=>e.getTrackId()));C.debug(`resub tracks -> ${JSON.stringify(e)}`);const{code:r}=yield k((()=>this._subscribeHandle(t,!0)));r!==T.SUCCESS&&C.error(`resub tracks failed -> code: ${r}, ids: ${JSON.stringify(e)}`)}this._callAppListener(\"onAnchorTrackPublish\",n)}if(n.length){const e=n.map(mt);for(let t=r.length-1;t>=0;t-=1){const i=r[t];e.includes(mt(i))&&r.splice(t,1)}const t=n.map((e=>{const t=mt(e);return this._remoteTracks[t]}));yield this._onUserUnpublish(t,\"onAnchorTrackUnpublish\")}if(s.length){const e=r.map(mt);for(let t=0;t<s.length;t++){const i=s[t],n=mt(i),o=e.indexOf(n);r[o].state=i.state;const a=this._remoteTracks[n];a.__innerSetRemoteMuted(0===i.state),a.isAudioTrack()?this._callAppListener(\"onAudioMuteChange\",a):this._callAppListener(\"onVideoMuteChange\",a)}}}))}_onUserUnpublish(e,t){return S(this,void 0,void 0,(function*(){yield this.unsubscribe(e),e.forEach((e=>{this._subscribedList=this._subscribedList.filter((t=>t.track.getTrackId()!==e.getTrackId())),delete this._roomRes[e.getTrackId()],e.__innerDestroy(),delete this._remoteTracks[e.getTrackId()]})),this._callAppListener(t,e)}))}_callAppListener(e,...t){var r;const i=null===(r=this._appListener)||void 0===r?void 0:r[e];if(i)try{i(...t)}catch(e){C.error(e)}}_reTryExchange(){return S(this,void 0,void 0,(function*(){k((()=>S(this,void 0,void 0,(function*(){var e;const{reqBody:t}=yield this._createSubscribeParams(this._subscribedList,{},!0),r=yield this._exchangeHandle(t);if(r.code!==T.SUCCESS)return C.error(`reTryExchange failed: ${r.code}`),{code:r.code};const{sdp:i,resultCode:n}=r.data;if(n!==T.SUCCESS)return C.error(`reTryExchange failed: ${n}`),{code:n};this._pc.clearReTryExchangeTimer();const s=this._subscribedList.filter((e=>e.track.isMCUTrack()));if(s.length>0){const t=s[0].track.getTrackId(),r=null===(e=this._roomRes[t])||void 0===e?void 0:e.msid,n=[this._roomId,\"RongCloudRTC\"].join(\"_\");i.sdp=i.sdp.replace(new RegExp(r,\"g\"),n)}const o=yield this._pc.setRemoteAnswer(i.sdp);return o!==T.SUCCESS?{code:o}:void 0}))))}))}_createSubscribeParams(e,t,r){return S(this,void 0,void 0,(function*(){const i=yield this._pc.createOffer(r),n={resolutionInfo:[]},s={min:0,max:0};Object.keys(t).forEach((e=>{const{mediaStream:r,tinyStream:o}=t[e];[r,o].forEach(((t,r)=>{var o;const a=1===r?[e,\"tiny\"].join(\"_\"):e;i.sdp=null===(o=i.sdp)||void 0===o?void 0:o.replace(new RegExp(t.id,\"g\"),a);const c=t.getVideoTracks()[0];if(!c)return;const d=0===r,{width:u,height:l,frameRate:h}=d?pt(c):Cr;n.resolutionInfo.push({trackId:c.id,simulcast:d?Mt.NORMAL:Mt.TINY,resolution:`${u}x${l}`});const p=Ge(u,l),_=We(h);s.min+=p.minBitrate*_,s.max+=p.maxBitrate*_}))}));return{reqBody:{sdp:i,switchstream:!1,newVersionFlag:!0,subscribeList:e.map((e=>({simulcast:e.subTiny?Mt.TINY:Mt.NORMAL,resolution:\"\",uri:this._roomRes[e.track.getTrackId()].uri})))},dynamicBitrate:s,offer:i}}))}_subscribeHandle(e,t=!1){var r;return S(this,void 0,void 0,(function*(){if(this._assertRoomDestroyed())return{code:T.ROOM_HAS_BEEN_DESTROYED};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"tracks\",e,(()=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e.length>0&&e.every((e=>e instanceof st||e.track instanceof st))),!0))return{code:T.PARAMS_ERROR};const i=this._subscribedList.map((e=>Object.assign({},e))),n=e.map((e=>e instanceof st?{track:e}:e));let s=!1;const o=[];return n.forEach((e=>{const t=e.track.getTrackId();o.push(t);const r=i.find((e=>e.track.getTrackId()===t));r&&r.subTiny===e.subTiny||(r?r.subTiny=e.subTiny:i.push(e),s=!0)})),s||t?(null===(r=this._polarisReport)||void 0===r||r.sendR2(zt.SUBSCRIBE,Qt.BEGIN,o),this._updateSubListHandle(i,!0)):{code:T.SUCCESS}}))}_getReqHeaders(){const e=this._context.getCurrentId();return{\"App-Key\":this._context.getAppkey(),RoomId:e,Token:this._joinResData.token,RoomType:_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE,UserId:e,\"Session-Id\":this._sessionId}}_exchangeHandle(e){return this._service.broadcastSubscribe(this._getReqHeaders(),e)}_updateSubListHandle(e,t=!1){var r;return S(this,void 0,void 0,(function*(){if(this._assertRoomDestroyed())return{code:T.ROOM_HAS_BEEN_DESTROYED};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"resources\",e,(()=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e.every((e=>e instanceof st||e.track instanceof st))),!0))return{code:T.PARAMS_ERROR};let i=e.map((e=>e instanceof st?{track:e}:Object.assign({},e)));const n={};i=i.filter((e=>{const t=e.track.getTrackId();return!n[t]&&(n[t]=!0)})).map((e=>Object.assign({},e)));const s=this._subscribedList.map((e=>Object.assign({},e)));if(!t){let e=!1;if(i.forEach((t=>{const r=s.findIndex((e=>e.track===t.track));if(-1===r)return void(e=!0);s.splice(r,1)[0].subTiny!==t.subTiny&&(e=!0)})),s.length&&(e=!0),!e)return{code:T.SUCCESS}}this._pc.clearReTryExchangeTimer(),this._pc.updateSubRemoteTracks(i.map((e=>e.track)));const{reqBody:o}=yield this._createSubscribeParams(i,{},!1),a=yield this._exchangeHandle(o);if(s.length){const e=[];s.forEach((t=>{e.push(t.track.getTrackId())})),null===(r=this._pc.reportParser)||void 0===r||r.clearLatestPacketsRecv(e)}if(a.code!==T.SUCCESS)return{code:a.code};const{sdp:u,resultCode:l,message:h,subscribedList:p}=a.data;if(l!==T.SUCCESS)return C.error(\"change subscribe list failed:\",h,l),{code:l};i.forEach((e=>{const{track:t}=e;if(t.isMCUTrack()){const e=this._roomRes[t.getTrackId()].msid,{tag:r,userId:i}=ft(t.getTrackId()),n=[i,r].join(\"_\");u.sdp=u.sdp.replace(new RegExp(e,\"g\"),n)}}));const _=yield this._pc.setRemoteAnswer(u.sdp);if(_!==T.SUCCESS)return{code:_};const m=null==p?void 0:p.map((e=>`${e.msid}_${e.mediaType}`)),f=i.filter((e=>{if(e.track.isMCUTrack()){const t=this._roomRes[e.track.getTrackId()],r=`${t.msid}_${t.mediaType}`;return m.includes(r)}return null==m?void 0:m.includes(e.track.getTrackId())})),v=null==f?void 0:f.map((e=>`${e.track.getTrackId()}`)),R=i.filter((e=>!(null==v?void 0:v.includes(e.track.getTrackId()))));for(const e in this._remoteTracks){const t=f.some((t=>t.track.getTrackId()===e));this._remoteTracks[e].__innerSetSubscribed(t)}return this._subscribedList.splice(0,this._subscribedList.length,...f),R.length?{code:T.SUCCESS,failedList:R}:{code:T.SUCCESS}}))}_diffCDNUris(e){return S(this,void 0,void 0,(function*(){if(this._CDNUris.url&&!e.url)return this._callAppListener(\"onCDNInfoDisable\"),void(this._CDNUris=e);(!this._CDNUris||!this._CDNUris.url&&e.url)&&this._callAppListener(\"onCDNInfoEnable\",{resolution:`W${e.w}_H${e.h}`,fps:`FPS_${e.fps}`});const t=this._CDNUris.w&&e.w&&this._CDNUris.w!==e.w,r=this._CDNUris.h&&e.h&&this._CDNUris.h!==e.h,i=this._CDNUris.fps&&e.fps&&this._CDNUris.fps!==e.fps;(t||r||i)&&this._callAppListener(\"onCDNInfoChange\",{resolution:`W${e.w}_H${e.h}`,fps:`FPS_${e.fps}`}),this._CDNUris=e}))}_getCDNPlayUrl(e){return S(this,void 0,void 0,(function*(){const{w:t,h:r,fps:i}=e,n=this._initOptions.pullInnerCDNProtocol||gr.FLV,s=this._initOptions.pullInnerCDNUseHttps===Sr.NOT_HTTPS?Sr.NOT_HTTPS:Sr.HTTPS;if(!this._CDNUris.url)return C.error(`cdn_uris url is empty, the anchor need to open or push CDN, code: ${T.CDN_RESOURCE_IS_EMPTY}`),{code:T.CDN_RESOURCE_IS_EMPTY};const o={\"App-Key\":this._context.getAppkey(),Token:this._joinResData.token,RoomId:this.getRoomId(),UserId:this._context.getCurrentId(),SessionId:this.getSessionId()},a=[];t&&a.push(`w=${t}`),r&&a.push(`h=${r}`),i&&a.push(`fps=${i}`),a.push(`kind=${n}`),a.push(`is_https=${s}`);const c=a.join(\"&\");let d=`${this._CDNUris.url}?`;c&&(d+=c);const{code:u,res:l}=yield this._service.getCDNResourceInfo(o,d);return u!==T.SUCCESS?(C.error(`getCDNPlayUrl failed: ${u}`),{code:u}):(C.info(`getCDNPlayUrl success: ${null==l?void 0:l.data.pull_url}`),{code:u,CDNPlayUrl:null==l?void 0:l.data.pull_url})}))}getCDNPlayUrl(e,t){return S(this,void 0,void 0,(function*(){if(e&&!Tt(e))return C.error(\"`resolution` is invalid\"),{code:T.PARAMS_ERROR};if(t&&!It(t))return C.error(\"`fps` is invalid\"),{code:T.PARAMS_ERROR};const{width:r,height:i}=e?Ct(e):{width:null,height:null},n=t?Et(t):null,s={};return r&&(s.w=r),i&&(s.h=i),n&&(s.fps=n),this._getCDNPlayUrl(s)}))}subscribe(e){return S(this,void 0,void 0,(function*(){return k((()=>this._subscribeHandle(e,!1)))}))}__unsubscribe(e){var t;return S(this,void 0,void 0,(function*(){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"tracks\",e,(()=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e.length>0&&e.every((e=>e instanceof st))),!0))return C.error(`unsubscribe failed, tracks is invalid -> roomId: ${this._roomId}`),{code:T.PARAMS_ERROR};const r=this._subscribedList.map((e=>Object.assign({},e))).filter((t=>!e.includes(t.track)));return null===(t=this._polarisReport)||void 0===t||t.sendR2(zt.SUBSCRIBE,Qt.END,e.map((e=>e.getTrackId()))),this._updateSubListHandle(r,!1)}))}unsubscribe(e){return S(this,void 0,void 0,(function*(){return k((()=>this.__unsubscribe(e)))}))}__destroy(e){var t;return S(this,void 0,void 0,(function*(){this._destroyed||(this._destroyed=!0,null===(t=this._audioLevelReport)||void 0===t||t.clearAudioLevelReportTimer(),e&&(yield this._context.quitLivingRoomAsAudience(this._roomId)),yield this._service.broadcastExit(this._getReqHeaders()),this._pc.destroy(),this._polarisReport=null,this._context.onrtcdatachange=()=>{})}))}getRemoteTrack(e){return this._remoteTracks[e]}__getPC(){return this._pc}getLocalTrack(e){return{}}__onReconnected(){return S(this,void 0,void 0,(function*(){const{code:e}=yield this._context.joinLivingRoomAsAudience(this._roomId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE);e!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS&&C.error(\"join living room error when on reconnected\")}))}registerRoomEventListener(e){this._appListener=e}onAudioLevelChange(e,t){var r;null===(r=this._audioLevelReport)||void 0===r||r.clearAudioLevelReportTimer(),this._audioLevelReport=new er(this),this._audioLevelReport.onAudioLevelChange(e,t||1e3)}registerReportListener(e){var t;null===(t=this._pc)||void 0===t||t.registerReportListener(e)}getRoomId(){return this._roomId}getCrtUserId(){return this._context.getCurrentId()}getSessionId(){return this._sessionId}getRemoteUserIds(){return this._roomAnchorList}getRemoteTracksByUserId(e){const t=[];for(const r in this._remoteTracks){const i=this._remoteTracks[r];i.getUserId()===e&&t.push(i)}return t}getRemoteTracks(){const e=[],t=[];for(const e in this._remoteTracks){if(2===t.length)break;const r=this._remoteTracks[e];r.isMCUTrack()&&t.push(r)}return this._roomAnchorList.forEach((t=>{e.push(...this.getRemoteTracksByUserId(t))})),[...t,...e]}getRemoteRTCTracks(){const e=[];for(const t in this._remoteTracks){const r=this._remoteTracks[t];r.isMCUTrack()||e.push(r)}return e}getRemoteMCUTracks(){const e=[];for(const t in this._remoteTracks){const r=this._remoteTracks[t];r.isMCUTrack()&&e.push(r)}return e}getCDNInfo(){return this._CDNUris.w?{resolution:`W${this._CDNUris.w}_H${this._CDNUris.h}`,fps:`FPS_${this._CDNUris.fps}`,CDNEnable:this._CDNUris.enableInnerCDN}:{CDNEnable:!1}}}const Ir=(e,t)=>{const r=[];return r[0]=(null==t?void 0:t.withoutAudio)?void 0:e.getAudioTracks()[0],r[1]=(null==t?void 0:t.withoutVideo)?void 0:e.getVideoTracks()[0],r};class Er{constructor(e,t,r){this._context=e,this._runtime=t,this._options=r,this._crtRoom=null,this._audience=null,this._crtAudienceLivingRoom=null,Kt.setSdpSemantics(r.sdpSemantics||\"plan-b\"),this._service=new vr(this._runtime,this._context,this._options.mediaServer,this._options.timeout),this._context.onconnectionstatechange=this._onIMStatusChange.bind(this),this._context.ondisconnect=this._onIMDisconnect.bind(this),this._context.ondestroy=this._onIMUninit.bind(this),this._context.onmessage=this._handleMessage.bind(this)}_handleMessage(e){var t;if(e.conversationType!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConversationType.RTC_ROOM)return!1;if(this._crtRoom instanceof _r){this._getJoinedPKRoomList().forEach((t=>{t.__parseInnerMessage(e)}))}return null===(t=this._crtRoom)||void 0===t||t.__parseInnerMessage(e),!0}_getJoinedPKRoomList(){const{code:e,roomPKHandler:t}=this._crtRoom.getRoomPKHandler();if(e===T.SUCCESS&&t){const e=t.getJoinedPKRooms()||{};return Object.values(e)}return[]}getCurrentId(){return this._context.getCurrentId()}joinRTCRoom(e,t){return k((()=>this._joinRTCRoom(e,t)))}_joinRTCRoom(e,t){return S(this,void 0,void 0,(function*(){if(Ot(this._context.getNaviInfo()))return{code:T.PACKAGE_ENVIRONMENT_ERROR};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"roomId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0))return{code:T.PARAMS_ERROR};if(this._crtRoom)return{code:T.REPERT_JOIN_ROOM};if(this._context.getConnectionStatus()!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConnectionStatus.CONNECTED)return{code:T.SIGNAL_DISCONNECTED};if(!this._service.getNaviMS().length)return{code:T.NOT_OPEN_VIDEO_AUDIO_SERVER};C.debug(`joinRoom -> roomId: ${e}; joinType: ${t||_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCJoinType.KICK}`);const{code:r,data:s}=yield this._context.joinRTCRoom(e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.RTC,void 0,t);if(r!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS){C.error(`joinRoom failed -> code: ${r}`);return{code:r===I.JOIN_REFUSED?T.SIGNAL_JOIN_RTC_ROOM_REFUSED:r}}C.debug(`joinRoom success -> userId: ${this._context.getCurrentId()}, roomId: ${e}, data: ${JSON.stringify(s)}`);const o=new mr(this._context,this._runtime,e,s,this._service,this._options,this._releaseCrtRoomObj.bind(this));return this._crtRoom=o,{room:o,code:T.SUCCESS,userIds:o.getRemoteUserIds(),tracks:o.getRemoteTracks()}}))}joinLivingRoom(e,t){return k((()=>this._joinLivingRoom(e,t)))}_joinLivingRoom(e,t){return S(this,void 0,void 0,(function*(){if(Ot(this._context.getNaviInfo()))return{code:T.PACKAGE_ENVIRONMENT_ERROR};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"roomId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0)||!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"livingType\",t,(e=>e===lr.AUDIO||e===lr.VIDEO)))return{code:T.PARAMS_ERROR};if(this._crtRoom)return{code:T.REPERT_JOIN_ROOM};if(this._context.getConnectionStatus()!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConnectionStatus.CONNECTED)return{code:T.SIGNAL_DISCONNECTED};if(!this._service.getNaviMS().length)return{code:T.NOT_OPEN_VIDEO_AUDIO_SERVER};C.debug(`joinRoom, roomId: ${e}`);const{code:r,data:s}=yield this._context.joinRTCRoom(e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE,t);if(r!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return C.error(`joinRoom failed -> code: ${r}`),{code:r};C.debug(`JoinRoom success -> userId: ${this._context.getCurrentId()}, roomId: ${e}, data: ${JSON.stringify(s)}`);const o=new _r(this._context,this._runtime,e,s,this._service,this._options,this._releaseCrtRoomObj.bind(this),t,!1,!0);this._crtRoom=o;const a={room:o,code:T.SUCCESS,userIds:o.getRemoteUserIds(),tracks:o.getRemoteTracks()};return o.__getCDNPushMode()===ur.MANUAL&&Object.assign(a,{CDNEnable:o.__getCDNEnable()}),a}))}getAudienceClient(){return this._audience||(this._audience=new Rr(this._context,this._runtime,this._options)),this._audience}_onIMStatusChange(e){if(C.debug(`signal server connection state change: ${e}`),e===_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ConnectionStatus.CONNECTED){if(this._crtRoom instanceof _r){this._getJoinedPKRoomList().forEach((e=>{e.__onReconnected()}))}this._crtRoom&&this._crtRoom.__onReconnected()}}_onIMDisconnect(){C.debug(\"TODO -> on IM disconnect\")}_onIMUninit(){C.debug(\"TODO -> on IM client ondestroy\")}leaveRoom(e){return k((()=>this._leaveRoom(e)))}_leaveRoom(e){return S(this,void 0,void 0,(function*(){return this._crtRoom?(yield this._crtRoom.__destroy(!0),C.debug(`quitRTCRoom -> userId: ${this._context.getCurrentId()} , roomId: ${this._crtRoom.getRoomId()}`),this._crtRoom=null,{code:T.SUCCESS}):{code:T.SUCCESS}}))}_releaseCrtRoomObj(){this._crtRoom=null}_getMediaStream(e,t=\"getUserMedia\"){return S(this,void 0,void 0,(function*(){try{const r=yield navigator.mediaDevices[t](e);return{code:T.SUCCESS,stream:r}}catch(e){if(\"Permission denied\"===e.message)return{code:T.PERMISSION_DENIED};C.error(`get user media failed -> ${e.message}`)}return{code:\"getUserMedia\"===t?T.GET_USER_MEDIA_FAILED:T.GET_DISPLAY_MEDIA_FAILED}}))}createMicrophoneAudioTrack(e=\"RongCloudRTC\",t){return S(this,void 0,void 0,(function*(){if(!ut(e))return{code:T.INVALID_TAGS};const r=this._context.getCurrentId();if(!r)return{code:T.INVALID_USER_ID};const{stream:i,code:n}=yield this._getMediaStream({audio:{deviceId:null==t?void 0:t.micphoneId,sampleRate:null==t?void 0:t.sampleRate}});if(n!==T.SUCCESS)return{code:n};const s=i.getAudioTracks()[0];return{code:n,track:new rt(e,r,s)}}))}createCameraVideoTrack(e=\"RongCloudRTC\",t){return S(this,void 0,void 0,(function*(){if(!ut(e))return{code:T.INVALID_TAGS};const r=this._context.getCurrentId();if(!r)return{code:T.INVALID_USER_ID};const i=Tt(null==t?void 0:t.resolution)?t.resolution:He.W640_H480,{width:n,height:s}=Ct(i),{stream:o,code:a}=yield this._getMediaStream({video:{deviceId:null==t?void 0:t.cameraId,frameRate:Et((null==t?void 0:t.frameRate)||Be.FPS_15),width:n,height:s,facingMode:null==t?void 0:t.faceMode}});if(a!==T.SUCCESS)return{code:a};const c=o.getVideoTracks()[0];return{code:a,track:new it(e,r,c)}}))}createMicrophoneAndCameraTracks(e=\"RongCloudRTC\",t){var r,i,n,s,o,a;return S(this,void 0,void 0,(function*(){const c=[];if(!ut(e))return{code:T.INVALID_TAGS,tracks:c};const d=this._context.getCurrentId();if(!d)return{code:T.INVALID_USER_ID,tracks:c};const u=Tt(null===(r=null==t?void 0:t.video)||void 0===r?void 0:r.resolution)?t.video.resolution:He.W640_H480,{width:l,height:h}=Ct(u),{stream:p,code:_}=yield this._getMediaStream({video:{deviceId:null===(i=null==t?void 0:t.video)||void 0===i?void 0:i.cameraId,frameRate:Et((null===(n=null==t?void 0:t.video)||void 0===n?void 0:n.frameRate)||Be.FPS_15),width:l,height:h,facingMode:null===(s=null==t?void 0:t.video)||void 0===s?void 0:s.faceMode},audio:{deviceId:null===(o=null==t?void 0:t.audio)||void 0===o?void 0:o.micphoneId,sampleRate:null===(a=null==t?void 0:t.audio)||void 0===a?void 0:a.sampleRate}});return _!==T.SUCCESS||p.getTracks().forEach((t=>{\"video\"===t.kind?c.push(new it(e,d,t)):c.unshift(new rt(e,d,t))})),{code:_,tracks:c}}))}createScreenVideoTrack(e=\"screenshare\",t){return S(this,void 0,void 0,(function*(){if(!ut(e))return{code:T.INVALID_TAGS};const r=this._context.getCurrentId();if(!r)return{code:T.INVALID_USER_ID};if(!bt())return{code:T.BROWSER_NOT_SUPPORT};const i=/Electron/.test(navigator.userAgent);if(i&&!(null==t?void 0:t.chromeMediaSourceId))return{code:T.PARAMS_ERROR};const n=Tt(null==t?void 0:t.resolution)?t.resolution:He.W1280_H720,{width:s,height:o}=Ct(n),a=i?{mandatory:{chromeMediaSourceId:t.chromeMediaSourceId,chromeMediaSource:\"desktop\",minWidth:s,maxWidth:s,minHeight:o,maxHeight:o}}:{frameRate:Et((null==t?void 0:t.frameRate)||Be.FPS_15),width:s,height:o},{stream:c,code:d}=yield this._getMediaStream({video:a,audio:!1},i?\"getUserMedia\":\"getDisplayMedia\");if(d!==T.SUCCESS)return{code:d};const u=c.getVideoTracks()[0];return{code:d,track:new nt(e,r,u)}}))}createLocalAudioTrack(e,t){return S(this,void 0,void 0,(function*(){if(!ut(e))return{code:T.INVALID_TAGS};if(!t||\"[object MediaStreamTrack]\"!==t.toString()||\"audio\"!==t.kind)return{code:T.CREATE_CUSTOM_TRACK_FAILED};const r=this._context.getCurrentId();return r?{code:T.SUCCESS,track:new Qe(e,r,t)}:{code:T.INVALID_USER_ID}}))}createLocalVideoTrack(e,t){return S(this,void 0,void 0,(function*(){if(!ut(e))return{code:T.INVALID_TAGS};if(!t||\"[object MediaStreamTrack]\"!==t.toString()||\"video\"!==t.kind)return{code:T.CREATE_CUSTOM_TRACK_FAILED};const r=this._context.getCurrentId();return r?{code:T.SUCCESS,track:new Xe(e,r,t)}:{code:T.INVALID_USER_ID}}))}createLocalFileTracks(e,t,r){return S(this,void 0,void 0,(function*(){if(!ut(e))return{code:T.INVALID_TAGS,tracks:[]};if(!kt())return{code:T.BROWSER_NOT_SUPPORT,tracks:[]};const i=t instanceof File?URL.createObjectURL(t):t;if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isHttpUrl)(i)&&!/^blob:/.test(i))return C.warn(`createLocalFileTracks failed: params error -> url: ${i}`),{code:T.PARAMS_ERROR,tracks:[]};const n=this._context.getCurrentId();return n?new Promise((t=>{const s=document.createElement(\"video\");(null==r?void 0:r.withoutAudio)&&(s.muted=!0),s.onloadedmetadata=()=>{const o=[];let a;try{const e=s.mozCaptureStream?\"mozCaptureStream\":\"captureStream\";a=s[e]()}catch(e){C.error(`create RCLocalFileTrack failed, captureSteam error. -> url: ${i}`),C.error(e),t({code:T.CREATE_FILE_TRACK_FAILED,tracks:o})}const[c,d]=Ir(a,r);c&&o.push(new tt(e,n,c,s)),d&&o.push(new et(e,n,d,s)),0===o.length&&(s.pause(),s.src=\"\"),s.onerror=null,t({code:T.SUCCESS,tracks:o})},s.onerror=()=>{C.error(`create RCLocalFileTrack failed -> url: ${i}`),t({code:T.CREATE_FILE_TRACK_FAILED,tracks:[]})},s.src=i,s.loop=!0,s.play()})):{code:T.INVALID_USER_ID,tracks:[]}}))}createLocalTracks(e,t,r){return S(this,void 0,void 0,(function*(){const i=[];if(!ut(e))return{code:T.INVALID_TAGS,tracks:i};if(!(t instanceof MediaStream))return{code:T.PARAMS_ERROR,tracks:i};const n=this._context.getCurrentId();if(!n)return{code:T.INVALID_USER_ID,tracks:i};const[s,o]=Ir(t,r);return s&&i.push(new Qe(e,n,s)),o&&i.push(new Xe(e,n,o)),{code:T.SUCCESS,tracks:i}}))}joinLivingRoomAsAudience(e,t){return S(this,void 0,void 0,(function*(){if(Ot(this._context.getNaviInfo()))return{code:T.PACKAGE_ENVIRONMENT_ERROR};if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"roomId\",e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0)||!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"livingType\",t,(e=>e===lr.AUDIO||e===lr.VIDEO)))return{code:T.PARAMS_ERROR};if(this._crtAudienceLivingRoom)return{code:T.REPERT_JOIN_ROOM};if(!this._service.getNaviMS().length)return{code:T.NOT_OPEN_VIDEO_AUDIO_SERVER};const{code:r,data:n}=yield this._context.joinLivingRoomAsAudience(e,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCMode.LIVE,t);if(r!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return C.error(\"audienceJoinLivingRoomError:\",r),{code:T.SIGNAL_AUDIENCE_JOIN_ROOM_FAILED};C.info(`joinLivingRoomAsAudience success, room data: ${JSON.stringify(n)}`);const s=new Tr(this._context,this._runtime,this._options,e,n,t);return this._crtAudienceLivingRoom=s,{room:s,code:T.SUCCESS,userIds:s.getRemoteUserIds(),RTCTracks:s.getRemoteRTCTracks(),MCUTracks:s.getRemoteMCUTracks(),CDNUris:s.getCDNInfo()}}))}leaveLivingRoomAsAudience(e){return S(this,void 0,void 0,(function*(){return this._crtAudienceLivingRoom?this._crtAudienceLivingRoom!==e?{code:T.PARAMS_ERROR}:(yield this._crtAudienceLivingRoom.__destroy(!0),this._crtAudienceLivingRoom=null,{code:T.SUCCESS}):{code:T.SUCCESS}}))}upgradeToAnchorRoom(e){return S(this,void 0,void 0,(function*(){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"room._roomId\",e._roomId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0))return{code:T.PARAMS_ERROR};if(this._crtRoom)return{code:T.REPERT_JOIN_ROOM};const{code:t,data:r}=yield this._context.rtcIdentityChange(e._roomId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCIdentityChangeType.ViewerToAnchor,e._livingType);if(t!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return C.error(\"change room identity error\",t),{code:T.SIGNAL_ROOM_CHANGE_IDENTITY_FAILED};yield this._crtAudienceLivingRoom.__destroy(!1);const n=new _r(this._context,this._runtime,e._roomId,r,this._service,this._options,this._releaseCrtRoomObj.bind(this),e._livingType,!0,!0);return this._crtRoom=n,this._crtAudienceLivingRoom=null,{room:n,code:T.SUCCESS,userIds:e.getRemoteUserIds(),tracks:n.getRemoteTracks()}}))}downgradeToAudienceRoom(e){return S(this,void 0,void 0,(function*(){if(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.validate)(\"room._roomId\",e._roomId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.notEmptyString,!0))return{code:T.PARAMS_ERROR};if(this._crtAudienceLivingRoom)return{code:T.REPERT_JOIN_ROOM};const{code:t,data:r}=yield this._context.rtcIdentityChange(e._roomId,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.RTCIdentityChangeType.AnchorToViewer,e.getLivingType());if(t!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS)return C.error(\"change room identity error\",t),{code:T.SIGNAL_ROOM_CHANGE_IDENTITY_FAILED};C.info(`downgradeToAudienceRoom success, room data: ${JSON.stringify(r)}`);const n=new Tr(this._context,this._runtime,this._options,e._roomId,r,e.getLivingType());return this._crtAudienceLivingRoom=n,this._crtRoom.__destroy(!1),this._crtRoom=null,{room:n,code:T.SUCCESS,userIds:n.getRemoteUserIds(),RTCTracks:n.getRemoteRTCTracks(),MCUTracks:n.getRemoteMCUTracks(),CDNUris:n.getCDNInfo()}}))}getJoinedRoomInfo(){return S(this,void 0,void 0,(function*(){const{code:e,data:t}=yield this._context.getRTCJoinedUserInfo(this._context.getCurrentId());return e!==_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.ErrorCode.SUCCESS?(C.error(\"getJoinedUserInfo error\",e),{code:T.SIGNAL_ROOM_CHANGE_IDENTITY_FAILED}):{code:T.SUCCESS,data:t}}))}}var yr;!function(e){e[e.SERVER_KICK=1]=\"SERVER_KICK\",e[e.OTHER_KICK=2]=\"OTHER_KICK\"}(yr||(yr={}));const kr={tag:\"RCRTC\",verify:e=>\"browser\"!==e.tag?(C.error(`RCRTC Plugin is not support the runtime '${e.tag}'`),!1):lt?(_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.VersionManage.add(\"plugin-rtc\",\"5.3.1\"),!!_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.VersionManage.validEngine(\"5.1.0\")||(C.error(`The current engine version '${_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.VersionManage.getInfo().engine}' error, plugin-rtc required engine version at least '5.1.0'.`),!1)):(C.error(\"Please use the https protocol or use `http://localhost` to open the page!\"),!1),setup:(e,t,i={})=>(C.setLogLevel(i.logLevel),C.setLogStdout(i.logStdout),C.warn(\"RCRTC Version: 5.3.1, Commit: e1af0f5ccb06a0084c94e1219d8af54c9793c06b\"),C.warn(`browserInfo.browser -> ${yt.browser}`),C.warn(`browserInfo.supportsUnifiedPlan -> ${yt.supportsUnifiedPlan}`),C.warn(`browserInfo.version -> ${yt.version}`),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.mediaServer\",i.mediaServer,(e=>!(!(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isHttpUrl)(e)||\"https:\"===location.protocol&&!/^https/.test(e)))),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.timeout\",i.timeout,(e=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)&&e>=5e3&&e<=3e4)),(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.assert)(\"options.pingGap\",i.pingGap,(e=>(0,_rongcloud_engine__WEBPACK_IMPORTED_MODULE_0__.isNumber)(e)&&e>=3e3&&e<=1e4)),new Er(e,t,i))},br={DEFAULT:\"RongCloudRTC\"},Pr={transResolution:Ct,transFrameRate:Et,parseTrackId:ft,ifSupportLocalFileTrack:kt,ifSupportScreenShare:bt};\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./node_modules/@rongcloud/plugin-rtc/dist/index.esm.js?");

/***/ }),

/***/ "./node_modules/events/events.js":
/*!***************************************!*\
  !*** ./node_modules/events/events.js ***!
  \***************************************/
/***/ ((module) => {

eval("// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./node_modules/events/events.js?");

/***/ }),

/***/ "./src/config.ts":
/*!***********************!*\
  !*** ./src/config.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"sdkStatus\": () => (/* binding */ sdkStatus),\n/* harmony export */   \"debug\": () => (/* binding */ debug),\n/* harmony export */   \"RCSeatStatus\": () => (/* binding */ RCSeatStatus)\n/* harmony export */ });\n//sdk自身状态\nvar sdkStatus;\n(function (sdkStatus) {\n    sdkStatus[sdkStatus[\"initing\"] = 0] = \"initing\";\n    sdkStatus[sdkStatus[\"ready\"] = 1] = \"ready\"; //初始化完成\n})(sdkStatus || (sdkStatus = {}));\nvar debug = true;\nvar RCSeatStatus = {\n    // 空麦位\n    RCSeatStatusEmpty: 0,\n    // 麦位被使用，userId不为null\n    RCSeatStatusUsing: 1,\n    // 麦位被锁定\n    RCSeatStatusLocking: 2\n};\n\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./src/config.ts?");

/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ \"./node_modules/events/events.js\");\n/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_im_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./modules/im/index */ \"./src/modules/im/index.ts\");\n/* harmony import */ var _modules_rtc_index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./modules/rtc/index */ \"./src/modules/rtc/index.ts\");\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config */ \"./src/config.ts\");\n/* harmony import */ var _loger__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./loger */ \"./src/loger.ts\");\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (undefined && undefined.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n\n// import * as RongIMNext from '@rongcloud/imlib-next'\n// import { installer, RCRTCCode, RCLivingType } from '@rongcloud/plugin-rtc'\n// import { RCRemoteTrack } from '../node_modules/@rongcloud/plugin-rtc/dist/index';\n\n\n\n\n\nvar RCVoiceRoomLibClass = /** @class */ (function (_super) {\n    __extends(RCVoiceRoomLibClass, _super);\n    function RCVoiceRoomLibClass() {\n        var _this = _super.call(this) || this;\n        _this._roomidcli = \"\";\n        _this.isAnchor = false; // 默认观众\n        _this.seatInfoList = []; //房间信息\n        _this.RCSeatInfoSeatPartPrefixKey = \"RCSeatInfoSeatPartPrefixKey_\";\n        // RCSeatInfoUserPartPrefixKey: string = \"RCSeatInfoUserPartPrefixKey_\";\n        _this.leaveRoomControl = true;\n        _this.seatInfo = {\n            status: 0,\n            mute: false,\n            speaking: false,\n        };\n        return _this;\n    }\n    /**\n    * 初始化\n    **/\n    RCVoiceRoomLibClass.prototype.init = function (item) {\n        var _this = this;\n        var AppKey = item.AppKey, RongIMLib = item.RongIMLib, RongRTCLib = item.RongRTCLib;\n        /**\n        * 开始初始化 imlib 和 rtc客户端\n        */\n        var im = new _modules_im_index__WEBPACK_IMPORTED_MODULE_1__.default({ appkey: AppKey, imLib: RongIMLib });\n        var rtc = new _modules_rtc_index__WEBPACK_IMPORTED_MODULE_2__.default();\n        this.im = im;\n        this.rtc = rtc;\n        //im初始化完成 进行rtc初始化\n        im.on(\"imReady\", function (RongIMLib) {\n            _loger__WEBPACK_IMPORTED_MODULE_4__.default.log('im初始化完成');\n            _this.rtc.init({ im: RongIMLib, rtcLib: RongRTCLib });\n        });\n        //im connect完成\n        im.on(\"connectReady\", function () {\n            _this.imready = true;\n            _this.readyCheck();\n        });\n        //im加入房间后 加入rtc房间\n        im.on(\"joinRoom\", function (o) { return __awaiter(_this, void 0, void 0, function () {\n            var Inseat;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.im.getRoomInfo(o)];\n                    case 1:\n                        Inseat = _a.sent();\n                        console.log('Inseat', Inseat);\n                        this.rtc.isAnchor = Inseat;\n                        return [2 /*return*/, this.rtc.joinRoom(o.roomId)];\n                }\n            });\n        }); });\n        //新房间初始化 如果是房主直接上0号麦位\n        im.on(\"setNewRoom\", function () { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this.seatInfoList = this.im.seatInfoList;\n                console.log('this.seatInfoList', this.seatInfoList);\n                this.emit(\"seatInfoDidUpdate\", this.seatInfoList);\n                return [2 /*return*/];\n            });\n        }); });\n        //changeRoomInfo 更改麦位数，更新房间内座位\n        im.on(\"changeRoomInfo\", function () {\n            _this.seatInfoList = _this.im.seatInfoList;\n            _this.emit(\"seatInfoDidUpdate\", _this.seatInfoList);\n        });\n        //房间信息发声变化\n        im.on(\"roomInfoDidUpdate\", function (parm) {\n            _this.roomInfo = parm.roomInfo;\n            console.log('parm.roomInfo', parm.roomInfo);\n            _this.emit(\"roomInfoDidUpdate\", _this.roomInfo);\n        });\n        //座位发生变化\n        im.on(\"seatInfoDidUpdate\", function () {\n            _this.seatInfoList = im.seatInfoList;\n            _this.emit(\"seatInfoDidUpdate\", _this.seatInfoList);\n        });\n        //座位发生变化(有人进来)\n        im.on(\"onAudienceEnter\", function (res) {\n            _this.emit(\"AudienceEnter\", res);\n        });\n        //座位发生变化(有人离开)\n        im.on(\"onAudienceExit\", function (res) {\n            _this.emit(\"AudienceExit\", res);\n        });\n        //各种公屏消息\n        im.on(\"onMessageReceived\", function (message) {\n            //默认消息\n            // console.log('onMessageReceived', message);\n            _this.emit(\"MessageReceived\", message);\n        });\n        // //音量状态变更\n        // im.on(\"speakingStatusChange\", (parm) => {     \n        //     this.emit(\"speakingStatusChange\", parm)\n        //     if (this.seatInfoList[Number(parm.index)]) {\n        //         this.seatInfoList[Number(parm.index)]['speaking'] = parm.speaking;\n        //     }\n        // })\n        //是否静音操作\n        im.on(\"mute\", function (ismute) {\n            if (ismute) {\n                _this.rtc.mute();\n            }\n            else {\n                _this.rtc.unmute();\n            }\n            _this.emit(\"SeatMute\", ismute);\n        });\n        //被抱下麦\n        im.on(\"leaveSeat\", function () {\n            console.log('被抱下麦leaveSeat');\n            _this.leaveSeat(true);\n            _this.emit(\"KickSeatReceived\");\n        });\n        //收到被邀请上麦\n        im.on(\"RCPickerUserSeatContent\", function (parm) {\n            _this.emit(\"RCPickerUserSeatContent\", parm);\n        });\n        //收到同意邀请上麦消息\n        im.on(\"VoiceRoomAgreeManagePick\", function (parm) {\n            _this.emit(\"VoiceRoomAgreeManagePick\", parm);\n        });\n        //收到拒绝邀请上麦消息\n        im.on(\"VoiceRoomRejectManagePick\", function (parm) {\n            _this.emit(\"VoiceRoomRejectManagePick\", parm);\n        });\n        //被踢出房间\n        im.on(\"RCKickUserOutRoomContent\", function (parm) {\n            _this.emit(\"RCKickUserOutRoomContent\", parm);\n            if (parm.targetId == _this.im.userId) {\n                // console.log('this._roomidcli', this._roomidcli);\n                _this.leaveRoom(_this._roomidcli);\n            }\n        });\n        //申请上麦被同意上报\n        im.on(\"RequestSeatAccepted\", function () { return __awaiter(_this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.im.seatInfoRemove('RCRequestSeatPrefixKey_' + this.im.userId).then(function (res) {\n                        // 强制删除聊天室属性成功\n                        if (res.code === 0) {\n                            _this.emit(\"RequestSeatAccepted\");\n                            return '操作成功:70000';\n                        }\n                    }).catch(function (error) {\n                        throw new Error('同意排麦请求发送失败:70017');\n                    })];\n            });\n        }); });\n        //申请上麦被拒绝上报\n        im.on(\"RequestSeatRejected\", function () { return __awaiter(_this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.im.seatInfoRemove('RCRequestSeatPrefixKey_' + this.im.userId).then(function (res) {\n                        // 强制删除聊天室属性成功\n                        if (res.code === 0) {\n                            _this.emit(\"RequestSeatRejected\");\n                            return '操作成功:70000';\n                        }\n                    }).catch(function (error) {\n                        throw new Error('拒绝排麦请求发送失败:70018');\n                    })];\n            });\n        }); });\n        //申请上麦人员发生变化上报\n        im.on(\"RequestSeatListChanged\", function () {\n            _this.emit(\"RequestSeatListChanged\");\n        });\n        //所有刷新消息的通知上报\n        im.on(\"onRoomNotificationReceived\", function (info) {\n            console.log(info);\n            _this.emit(\"RoomNotificationReceived\", info);\n        });\n        //房间关闭上报\n        im.on(\"VoiceRoomClosed\", function () {\n            _this.emit(\"VoiceRoomClosed\");\n        });\n        //更换背景上报\n        im.on(\"VoiceRoomBackgroundChanged\", function (img) {\n            _this.emit(\"VoiceRoomBackgroundChanged\", img);\n        });\n        //账号被顶掉上报\n        im.on(\"connectioBreakOff\", function () {\n            _this.emit(\"ConnectioBreakOff\");\n        });\n        //房间被销毁上报\n        im.on(\"chatroomDestroyed\", function () {\n            _this.emit(\"ChatroomDestroyed\");\n        });\n        //rtc 断开连接 主播端\n        this.rtc.on(\"onRTCPeerConnectionCloseByException\", function () {\n            _this.emit(\"RTCPeerConnectionCloseByException\");\n        });\n        //rtc初始化完成\n        rtc.on(\"ready\", function () {\n            _loger__WEBPACK_IMPORTED_MODULE_4__.default.log('rtc初始化完成');\n            _this.rtcready = true;\n            _this.readyCheck();\n        });\n        //rtc加入房间\n        rtc.on(\"joinRoom\", function () { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                // if (this.rtc.isDisable) {\n                //     this.rtc.mute();\n                //     return\n                // }\n                if (this.seatInfoList.length && this.seatInfoList[this.im.seatIndex] && this.seatInfoList[this.im.seatIndex].mute) {\n                    // console.log(\"上了静音买位\");\n                    this.rtc.mute();\n                }\n                return [2 /*return*/];\n            });\n        }); });\n        // rtc.on('audioChenge', (level: { track: { _userId: any; }; _userId: any; audioLevel: any; }) => {\n        //     if (level.track._userId && level.track._userId == this.im.userId) {\n        //         let content: { name: string; content: string; }\n        //         let speak: { index: string; speaking: string; }\n        //         if (level.audioLevel) {\n        //             content = {\n        //                 name: \"RCUserOnSeatSpeakingKey_\" + this.rtc.currentSeat,// 文本内容\n        //                 content: '1'\n        //             }\n        //             speak = {\n        //                 index: this.rtc.currentSeat + '',\n        //                 speaking: '1'\n        //             }\n        //         } else {\n        //             content = {\n        //                 name: \"RCUserOnSeatSpeakingKey_\" + this.rtc.currentSeat,// 文本内容\n        //                 content: '0'\n        //             }\n        //             speak = {\n        //                 index: this.rtc.currentSeat + '',\n        //                 speaking: '0'\n        //             }\n        //         }\n        //         // console.log('RCUserOnSeatSpeakingKey_', this.rtc.currentSeat);\n        //         this.im.messageUpdate(\"RC:VRLRefreshMsg\", content)\n        //         this.emit(\"speakingStatusChange\", speak)\n        //         if (this.seatInfoList[Number(speak.index)]) {\n        //             // this.seatInfoList[Number(parm.index)].speaking = parm.speaking;\n        //             if (Number(speak.speaking)) {\n        //                 this.seatInfoList[Number(speak.index)]['speaking'] = true\n        //             } else {\n        //                 this.seatInfoList[Number(speak.index)]['speaking'] = false\n        //             }\n        //         }\n        //     }\n        // })\n    };\n    /**\n    *\n    * im链接connect\n    *\n    */\n    RCVoiceRoomLibClass.prototype.connect = function (token) {\n        return this.im.connect(token);\n    };\n    /**\n    *\n    * 两模块就绪报上层ready\n    *\n    */\n    RCVoiceRoomLibClass.prototype.readyCheck = function () {\n        if (this.status == _config__WEBPACK_IMPORTED_MODULE_3__.sdkStatus.ready) {\n            _loger__WEBPACK_IMPORTED_MODULE_4__.default.log(\"已经就绪\");\n            return;\n        }\n        else {\n            if (this.imready && this.rtcready) {\n                this.emit(\"ready\");\n            }\n        }\n    };\n    /**\n    *\n    * 创建并加入房间(房间已创建)\n    *\n    */\n    RCVoiceRoomLibClass.prototype.createAndJoinRoom = function (op) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                // console.log(\"主播创建并加入房间\", op.roomId);\n                this.rtc.isAnchor = true;\n                this.rtc.currentSeat = 0;\n                this._roomidcli = op.roomId;\n                if (!('roomName' in op) || !('seatCount' in op)) {\n                    throw new Error('创建房间信息:70036');\n                }\n                return [2 /*return*/, this.im.joinRoom({\n                        roomId: op.roomId,\n                        roomName: op.roomName,\n                        seatCount: op.seatCount\n                    }).then(function (res) {\n                        return '创建并加入语聊房成功!';\n                    }).catch(function (err) {\n                        throw new Error('创建语聊房失败:70028');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 加入已创建房间(房间未创建)\n    *\n    */\n    RCVoiceRoomLibClass.prototype.joinRoom = function (roomid) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                // console.log(\"加入已存在房间:\", roomid);\n                this._roomidcli = roomid;\n                return [2 /*return*/, this.im.joinExistChatRoom({\n                        roomId: roomid\n                    }).then(function (res) {\n                        return '加入语聊房成功!';\n                    }).catch(function (err) {\n                        throw new Error('加入语聊房失败:70010');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 离开房间\n    *\n    */\n    RCVoiceRoomLibClass.prototype.leaveRoom = function (roomid) {\n        return __awaiter(this, void 0, void 0, function () {\n            var index;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.leaveRoomControl) return [3 /*break*/, 5];\n                        this.leaveRoomControl = false;\n                        index = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(index < this.seatInfoList.length)) return [3 /*break*/, 4];\n                        if (!(this.seatInfoList[index]['userId'] && this.seatInfoList[index]['userId'] == this.im.userId)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.leaveSeat(false, true)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        index += 1;\n                        return [3 /*break*/, 1];\n                    case 4: return [2 /*return*/, Promise.all([this.rtc.leaveRoom(roomid), this.im.leaveRoom(roomid)]).then(function () {\n                            _this.rtc.isDisable = false;\n                            setTimeout(function () {\n                                _this.leaveRoomControl = true;\n                            }, 1000);\n                            return '操作成功:70000';\n                        }).catch(function () {\n                            throw new Error('离开语聊房失败:70011');\n                        })];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n    *\n    * 寻找空麦位(除 0 号麦位外)\n    * 无空麦位 返回 null\n    */\n    RCVoiceRoomLibClass.prototype.findSeat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var i;\n            return __generator(this, function (_a) {\n                for (i = 1; i < this.seatInfoList.length; i++) {\n                    if (Number(this.seatInfoList[i].status) == _config__WEBPACK_IMPORTED_MODULE_3__.RCSeatStatus.RCSeatStatusEmpty) {\n                        return [2 /*return*/, i];\n                    }\n                    if (i == this.seatInfoList.length - 1) {\n                        return [2 /*return*/, null];\n                    }\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n    *\n    * 用户上麦\n    *\n    * @param seatIndex 麦位序号\n    */\n    RCVoiceRoomLibClass.prototype.enterSeat = function (seatIndex) {\n        return __awaiter(this, void 0, void 0, function () {\n            var i, targetSeatInfo;\n            var _this = this;\n            return __generator(this, function (_a) {\n                // console.log(\"上麦操作\", seatIndex);\n                // console.log(\"当前麦位信息\", this.seatInfoList);\n                // console.log(\"this.roomInfo.seatCount\", this.roomInfo.seatCount);\n                for (i = 0; i < this.seatInfoList.length; i += 1) {\n                    if (this.seatInfoList[i]['userId'] && this.seatInfoList[i]['userId'] == this.im.userId) {\n                        throw new Error('该上麦用户此时已经在麦位上:70003');\n                    }\n                }\n                // if (this.seatInfoList.length == seatIndex) { //本地麦位未更新时生成一个默认麦位\n                //     targetSeatInfo = this.seatInfo\n                // } else {\n                if (this.roomInfo && this.roomInfo.seatCount && (seatIndex >= this.roomInfo.seatCount)) {\n                    throw new Error('麦位序号不正确:70002');\n                }\n                targetSeatInfo = this.seatInfoList[seatIndex];\n                if (targetSeatInfo && targetSeatInfo.status != _config__WEBPACK_IMPORTED_MODULE_3__.RCSeatStatus.RCSeatStatusEmpty) { //当前麦位非空闲\n                    throw new Error(\"麦位不是空置状态,无法上麦:70006\");\n                }\n                // }\n                targetSeatInfo.userId = this.im.userId;\n                targetSeatInfo.status = _config__WEBPACK_IMPORTED_MODULE_3__.RCSeatStatus.RCSeatStatusUsing;\n                // console.log(\"当前更新\", this.RCSeatInfoSeatPartPrefixKey + seatIndex);\n                return [2 /*return*/, this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + seatIndex, targetSeatInfo).then(function () { return __awaiter(_this, void 0, void 0, function () {\n                        var _this = this;\n                        return __generator(this, function (_a) {\n                            this.seatInfoList[seatIndex]['userId'] = this.im.userId;\n                            this.seatInfoList[seatIndex]['status'] = Number(_config__WEBPACK_IMPORTED_MODULE_3__.RCSeatStatus.RCSeatStatusUsing);\n                            this.seatInfoList[seatIndex]['speaking'] = false;\n                            this.im.seatIndex = seatIndex;\n                            return [2 /*return*/, this.rtc.enterSeat(seatIndex).then(function () {\n                                    if (targetSeatInfo.mute || _this.rtc.isDisable) {\n                                        _this.rtc.isMuteOwner = true;\n                                        return _this.rtc.mute();\n                                    }\n                                    else {\n                                        return _this.rtc.unmute();\n                                    }\n                                })];\n                        });\n                    }); }).catch(function () {\n                        throw new Error('上麦失败');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 用户下麦\n    * 注意：和 enterSeat()成对调用\n    *\n    */\n    RCVoiceRoomLibClass.prototype.leaveSeat = function (ispassive, isLeaveRoom) {\n        return __awaiter(this, void 0, void 0, function () {\n            var index, have, status, i, value;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!isLeaveRoom) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.rtc.leaveSeat(true)];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 2: return [4 /*yield*/, this.rtc.leaveSeat(false)];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        this.im.seatIndex = null;\n                        if (ispassive) { //被动下麦不操作远程数据\n                            _loger__WEBPACK_IMPORTED_MODULE_4__.default.log(\"被动下麦\");\n                            return [2 /*return*/];\n                        }\n                        index = null;\n                        have = false;\n                        status = Number(_config__WEBPACK_IMPORTED_MODULE_3__.RCSeatStatus.RCSeatStatusEmpty);\n                        for (i = 0; i < this.seatInfoList.length; i += 1) {\n                            if (this.seatInfoList[i].userId == this.im.userId) {\n                                index = i;\n                                have = true;\n                            }\n                        }\n                        if (!have) {\n                            throw new Error('用户不在麦位上:70004');\n                        }\n                        else {\n                            value = __assign(__assign({}, this.seatInfoList[index]), { status: status });\n                            delete value['userId'];\n                            //console.log(this.RCSeatInfoSeatPartPrefixKey + index, '下麦操作：', value);\n                            return [2 /*return*/, this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + index, value).then(function (result) {\n                                    _this.seatInfoList[index]['status'] = status;\n                                    _this.seatInfoList[index]['mute'] = _this.seatInfoList[index].mute;\n                                    _this.seatInfoList[index]['speaking'] = _this.seatInfoList[index].speaking;\n                                    delete _this.seatInfoList[index]['userId'];\n                                    // this.seatInfoList[index]['userId'] = '';\n                                    // console.log('this.seatInfoList', this.seatInfoList);\n                                    return '操作成功:70000';\n                                }).catch(function () {\n                                    //  throw new Error('未知错误:-1')\n                                })];\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n    *\n    * 将指定麦位下麦\n    *\n    * @param userId   用户 Id\n    */\n    RCVoiceRoomLibClass.prototype.kickUserFromSeat = function (userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var index, have, arr, i, value;\n            var _this = this;\n            return __generator(this, function (_a) {\n                index = null;\n                have = false;\n                arr = [];\n                if (userId == this.im.userId) {\n                    throw new Error('不能踢自己下麦:70009');\n                }\n                for (i = 0; i < this.seatInfoList.length; i += 1) {\n                    //console.log(\"id:\",this.seatInfoList[i].userId);\n                    //console.log(\"idcheckd:\",userId);\n                    if (this.seatInfoList[i].userId == userId) {\n                        index = i;\n                        have = true;\n                    }\n                }\n                if (!have) {\n                    throw new Error('用户不在麦上:-1');\n                }\n                value = {\n                    status: 0,\n                    mute: this.seatInfoList[index].mute,\n                    speaking: this.seatInfoList[index].speaking,\n                };\n                arr.push(this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + index, value));\n                return [2 /*return*/, Promise.all(arr).then(function (result) {\n                        // this.seatInfoList[index] = {\n                        //     status: 0,\n                        //     mute: this.seatInfoList[index].mute,\n                        //     speaking: this.seatInfoList[index].speaking,\n                        // };\n                        _this.seatInfoList[index]['status'] = 0;\n                        _this.seatInfoList[index]['mute'] = _this.seatInfoList[index].mute;\n                        _this.seatInfoList[index]['speaking'] = _this.seatInfoList[index].speaking;\n                        delete _this.seatInfoList[index]['userId'];\n                        // this.seatInfoList[index]['userId'] = '';\n                        // console.log('this.seatInfoList', this.seatInfoList);\n                        return '操作成功:70000';\n                    }).catch(function () {\n                        throw new Error('未知错误:-1');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 用户跳麦\n    * 注意：在用户已经在麦位想切换麦位时调用\n    *\n    * @param seatIndex 需要跳转的麦位序号\n    */\n    RCVoiceRoomLibClass.prototype.switchSeatTo = function (seatIndex) {\n        return __awaiter(this, void 0, void 0, function () {\n            var index, i, valueOld;\n            var _this = this;\n            return __generator(this, function (_a) {\n                if (!this.seatInfoList[seatIndex]) {\n                    throw new Error('麦位不存在');\n                }\n                if (Number(this.seatInfoList[seatIndex].status) == _config__WEBPACK_IMPORTED_MODULE_3__.RCSeatStatus.RCSeatStatusLocking) {\n                    throw new Error(\"麦位被锁定不能跳麦\");\n                }\n                index = null;\n                for (i = 0; i < this.seatInfoList.length; i += 1) {\n                    if (this.seatInfoList[i].userId === this.im.userId) {\n                        index = i;\n                        break;\n                    }\n                }\n                if (index === null) {\n                    throw new Error('用户不在麦位上:70004');\n                }\n                else {\n                    if (!this.seatInfoList[seatIndex]['userId']) {\n                        valueOld = {\n                            status: 0,\n                            mute: this.seatInfoList[index].mute,\n                            speaking: this.seatInfoList[index].speaking,\n                        };\n                        return [2 /*return*/, this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + index, valueOld).then(function (result) {\n                                // this.seatInfoList[index] = valueOld\n                                _this.seatInfoList[index]['status'] = 0;\n                                _this.seatInfoList[index]['mute'] = _this.seatInfoList[index].mute;\n                                _this.seatInfoList[index]['speaking'] = _this.seatInfoList[index].speaking;\n                                delete _this.seatInfoList[index]['userId'];\n                                return _this.enterSeat(seatIndex);\n                            }).catch(function () {\n                                throw new Error('未知错误:-1');\n                            })];\n                    }\n                    else {\n                        if (this.seatInfoList[seatIndex].userId == this.im.userId) {\n                            throw new Error('用户跳麦的麦位和之前的一样:70005');\n                        }\n                        else {\n                            throw new Error('麦位不是空置状态:70006');\n                        }\n                    }\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n    *\n    * 抱用户上麦\n    *\n    * @param userId   用户 Id\n    */\n    RCVoiceRoomLibClass.prototype.pickUserToSeat = function (userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var value;\n            return __generator(this, function (_a) {\n                value = {\n                    // 填写开发者定义的消息内容\n                    content: \"RCPickerUserSeatContent\",\n                    invitationId: \"f9e6765b-304d-451a-be91-2bb936175888\",\n                    sendUserId: this.im.userId,\n                    targetId: userId,\n                    type: 0,\n                };\n                if (userId == this.im.userId) {\n                    throw new Error('抱人上麦不能选择自己:70007');\n                }\n                else {\n                    return [2 /*return*/, this.im.messageUpdate(\"RC:VRLInviteMsg\", value).then(function (massage) {\n                            return '操作成功:70000';\n                        }).catch(function (err) {\n                            throw new Error('发送上麦邀请失败:70008');\n                        })];\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n    *\n    * 将用户踢出房间\n    *\n    * @param userId   用户 Id\n    */\n    RCVoiceRoomLibClass.prototype.kickUserFromRoom = function (userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var value;\n            return __generator(this, function (_a) {\n                value = {\n                    // 填写开发者定义的消息内容\n                    content: \"RCKickUserOutRoomContent\",\n                    invitationId: \"yourRandomString\" + Math.random(),\n                    sendUserId: this.im.userId,\n                    targetId: userId,\n                    type: 0,\n                };\n                if (userId == this.im.userId) {\n                    throw new Error('未知错误:-1');\n                }\n                else {\n                    return [2 /*return*/, this.im.messageUpdate(\"RC:VRLInviteMsg\", value).then(function (massage) {\n                            return '操作成功:70000';\n                        }).catch(function (err) {\n                            throw new Error('发送信息失败:70023');\n                        })];\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n    *\n    * 将某个麦位静音\n    *\n    * @param seatIndex 麦位序号\n    * @param isMute    是否静音\n    */\n    RCVoiceRoomLibClass.prototype.muteSeat = function (seatIndex, ismute) {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr, value;\n            var _this = this;\n            return __generator(this, function (_a) {\n                arr = [];\n                value = __assign(__assign({}, this.seatInfoList[seatIndex]), { mute: ismute });\n                arr.push(this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + seatIndex, value));\n                return [2 /*return*/, Promise.all(arr).then(function (result) {\n                        if (seatIndex == _this.im.seatIndex) {\n                            if (ismute) {\n                                _this.rtc.mute();\n                            }\n                            else {\n                                _this.rtc.unmute();\n                            }\n                        }\n                        _this.seatInfoList[seatIndex]['mute'] = ismute;\n                        return '操作成功:70000';\n                    }).catch(function () {\n                        throw new Error('未知错误:-1');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 将某个麦位锁定\n    *\n    * @param seatIndex 麦位序号\n    * @param isLocked  是否锁麦位\n    */\n    RCVoiceRoomLibClass.prototype.lockSeat = function (seatIndex, isLocked) {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr, isLock, value;\n            var _this = this;\n            return __generator(this, function (_a) {\n                if (!this.seatInfoList[seatIndex]) {\n                    throw new Error('麦位不存在');\n                }\n                arr = [];\n                isLock = isLocked ? 2 : 0;\n                value = {\n                    mute: this.seatInfoList[seatIndex].mute,\n                    speaking: this.seatInfoList[seatIndex].speaking,\n                    status: isLock,\n                };\n                arr.push(this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + seatIndex, value));\n                return [2 /*return*/, Promise.all(arr).then(function (result) {\n                        _this.seatInfoList[seatIndex]['status'] = isLock;\n                        _this.seatInfoList[seatIndex]['mute'] = _this.seatInfoList[seatIndex].mute;\n                        _this.seatInfoList[seatIndex]['speaking'] = _this.seatInfoList[seatIndex].speaking;\n                        delete _this.seatInfoList[seatIndex]['userId'];\n                        return '操作成功:70000';\n                    }).catch(function () {\n                        throw new Error('未知错误:-1');\n                    })];\n            });\n        });\n    };\n    /**\n    * 设置房间信息，房间的id必须与当前房间id一致\n    *\n    * @param roomInfo 修改的房间信息\n    */\n    RCVoiceRoomLibClass.prototype.setRoomInfo = function (roomInfo) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(Number(roomInfo.seatCount) != Number(this.roomInfo.seatCount))) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.im.changeRoomInfo(roomInfo)];\n                    case 1:\n                        _a.sent();\n                        this.seatInfoList.length = roomInfo.seatCount;\n                        return [3 /*break*/, 6];\n                    case 2:\n                        if (!(roomInfo.isMuteAll != this.roomInfo.isMuteAll)) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.muteOtherSeats(roomInfo.isMuteAll, roomInfo)];\n                    case 3:\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 4:\n                        if (!(roomInfo.isLockAll != this.roomInfo.isLockAll)) return [3 /*break*/, 6];\n                        return [4 /*yield*/, this.lockOtherSeats(roomInfo.isLockAll, roomInfo)];\n                    case 5:\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 6: return [4 /*yield*/, this.im.seatInfoUpdate(\"RCRoomInfoKey\", roomInfo).then(function (res) {\n                            _this.roomInfo = __assign({}, roomInfo);\n                            _this.emit(\"roomInfoDidUpdate\", _this.roomInfo);\n                        })];\n                    case 7:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n    *\n    * 将所有麦位静音打开或者关闭\n    *\n    * @param isMute 是否静音\n    */\n    RCVoiceRoomLibClass.prototype.muteOtherSeats = function (isMute, roomInfo) {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr, roomData, i, value;\n            var _this = this;\n            return __generator(this, function (_a) {\n                arr = [];\n                if (roomInfo) {\n                    roomData = __assign(__assign({}, roomInfo), { isMuteAll: isMute });\n                }\n                else {\n                    roomData = __assign(__assign({}, this.roomInfo), { isMuteAll: isMute });\n                }\n                for (i = 0; i < this.seatInfoList.length; i += 1) {\n                    if (this.seatInfoList[i]['userId'] != this.im.userId && this.seatInfoList[i]['mute'] != isMute) {\n                        value = __assign(__assign({}, this.seatInfoList[i]), { mute: isMute });\n                        arr.push(this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + i, value));\n                    }\n                }\n                arr.push(this.im.seatInfoUpdate(\"RCRoomInfoKey\", roomData));\n                return [2 /*return*/, Promise.all(arr).then(function (result) {\n                        _this.roomInfo = __assign({}, roomData);\n                        _this.emit(\"roomInfoDidUpdate\", roomData);\n                        for (var i = 0; i < _this.seatInfoList.length; i += 1) {\n                            if (_this.seatInfoList[i]['userId'] != _this.im.userId && _this.seatInfoList[i]['mute'] != isMute) {\n                                _this.seatInfoList[i]['mute'] = isMute;\n                            }\n                        }\n                        _this.emit(\"seatInfoDidUpdate\", _this.seatInfoList);\n                        return result;\n                    }).catch(function (err) {\n                        return err;\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 将所有麦位所卖或者解除锁麦\n    *\n    * @param isLock 是否锁麦\n    */\n    RCVoiceRoomLibClass.prototype.lockOtherSeats = function (isLock, roomInfo) {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr, Lock, roomData, i, value;\n            var _this = this;\n            return __generator(this, function (_a) {\n                arr = [];\n                Lock = isLock ? 2 : 0;\n                if (roomInfo) {\n                    roomData = __assign(__assign({}, roomInfo), { isLockAll: isLock });\n                }\n                else {\n                    roomData = __assign(__assign({}, this.roomInfo), { isLockAll: isLock });\n                }\n                for (i = 0; i < this.seatInfoList.length; i += 1) {\n                    if (!this.seatInfoList[i]['userId'] && this.seatInfoList[i]['status'] != Lock) {\n                        value = __assign(__assign({}, this.seatInfoList[i]), { status: Lock });\n                        arr.push(this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + i, value));\n                    }\n                }\n                arr.push(this.im.seatInfoUpdate(\"RCRoomInfoKey\", roomData));\n                return [2 /*return*/, Promise.all(arr).then(function (result) {\n                        _this.roomInfo = __assign({}, roomData);\n                        _this.emit(\"roomInfoDidUpdate\", _this.roomInfo);\n                        for (var i = 0; i < _this.seatInfoList.length; i += 1) {\n                            if (!_this.seatInfoList[i]['userId'] && _this.seatInfoList[i]['status'] != Lock) {\n                                _this.seatInfoList[i]['status'] = Lock;\n                            }\n                        }\n                        _this.emit(\"seatInfoDidUpdate\", _this.seatInfoList);\n                        return result;\n                    }).catch(function (err) {\n                        return err;\n                    })];\n            });\n        });\n    };\n    /**\n    * 通知房间所有用户执行某个刷新操作\n    *\n    * @param name    刷新操作的名称\n    * @param content 刷新操作的内容\n    */\n    RCVoiceRoomLibClass.prototype.notifyVoiceRoom = function (name, content) {\n        return __awaiter(this, void 0, void 0, function () {\n            var value;\n            return __generator(this, function (_a) {\n                value = {\n                    content: content,\n                    name: name,\n                };\n                return [2 /*return*/, this.im.messageUpdate(\"RC:VRLRefreshMsg\", value).then(function (massage) {\n                        return '操作成功:70000';\n                    }).catch(function (err) {\n                        throw new Error('发送信息失败:70023');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 获取排麦用户的标识集合\n    *\n    */\n    RCVoiceRoomLibClass.prototype.getRequestSeatUserIds = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr;\n            return __generator(this, function (_a) {\n                arr = [];\n                return [2 /*return*/, this.im.chatRoom.getAllChatRoomEntries(this._roomidcli).then(function (data) {\n                        if (data.code === 0) {\n                            var entries_1 = data.data;\n                            Object.keys(entries_1).forEach(function (key) {\n                                if (key.split(\"_\")[0] == \"RCRequestSeatPrefixKey\" &&\n                                    entries_1[key] == \"RCRequestSeatContentRequest\") {\n                                    arr.push(key.split(\"_\")[1]);\n                                }\n                            });\n                            return arr;\n                        }\n                    }).catch(function () {\n                        throw new Error('获取排麦请求列表失败:70022');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 获取最新麦位信息\n    *\n    */\n    RCVoiceRoomLibClass.prototype.getLatestSeatInfo = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr;\n            return __generator(this, function (_a) {\n                arr = [];\n                // console.log('this._roomidcli', this._roomidcli);\n                return [2 /*return*/, this.im.chatRoom.getAllChatRoomEntries(this._roomidcli).then(function (res) {\n                        console.log('entries:', res);\n                        if (res.code === 0) {\n                            Object.keys(res.data).forEach(function (key) {\n                                var entriesArr = key.split(\"_\");\n                                if (entriesArr[0] == \"RCSeatInfoSeatPartPrefixKey\") {\n                                    //console.log('Number(entriesArr[1])', Number(entriesArr[1]));\n                                    //console.log('entries[key]', entries[key]);\n                                    arr[Number(entriesArr[1])] = JSON.parse(res.data[key]);\n                                }\n                            });\n                            return arr;\n                        }\n                    }).catch(function () {\n                        throw new Error('同步麦位信息失败:70030');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 更新指定麦位信息中的extra字段\n    *\n    * @param index 麦位\n    * @param extra extra字段\n    */\n    RCVoiceRoomLibClass.prototype.updateSeatInfoExtra = function (index, extra) {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr, value;\n            var _this = this;\n            return __generator(this, function (_a) {\n                arr = [];\n                value = __assign(__assign({}, this.seatInfoList[index]), { extra: extra });\n                arr.push(this.im.seatInfoUpdate(this.RCSeatInfoSeatPartPrefixKey + index, value));\n                return [2 /*return*/, Promise.all(arr).then(function (result) {\n                        _this.seatInfoList[index]['extra'] = extra;\n                        return '操作成功:70000';\n                    }).catch(function () {\n                        throw new Error('未知错误:-1');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 请求排麦\n    */\n    RCVoiceRoomLibClass.prototype.requestSeat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var len, bor, i, arr;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getRequestSeatUserIds()];\n                    case 1:\n                        len = _a.sent();\n                        bor = false;\n                        for (i = 0; i < len.length; i += 1) {\n                            if (len[i] == this.im.userId) {\n                                bor = true;\n                            }\n                        }\n                        arr = [];\n                        if (len.length > 20) {\n                            throw new Error('排麦人数过多:70014');\n                        }\n                        else if (bor) {\n                            throw new Error('已经在排麦中:70013');\n                        }\n                        else {\n                            arr.push(this.im.RequestseatInfoUpdate(\"RCRequestSeatPrefixKey_\" + this.im.userId, \"RCRequestSeatContentRequest\"));\n                            return [2 /*return*/, Promise.all(arr).then(function (result) {\n                                    return '操作成功:70000';\n                                }).catch(function () {\n                                    throw new Error('排麦请求发送失败:70015');\n                                })];\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n    *\n    * 取消排麦请求\n    *\n    */\n    RCVoiceRoomLibClass.prototype.cancelRequestSeat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.im.seatInfoRemove(\"RCRequestSeatPrefixKey_\" + this.im.userId).then(function (res) {\n                        // 强制删除聊天室属性成功\n                        if (res.code === 0) {\n                            return '操作成功:70000';\n                        }\n                    }).catch(function (error) {\n                        throw new Error('取消排麦发送失败:70016');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    *  同意用户排麦请求\n    *\n    * @param userId   请求排麦的用户 Id\n    */\n    RCVoiceRoomLibClass.prototype.acceptRequestSeat = function (userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr;\n            return __generator(this, function (_a) {\n                arr = [];\n                arr.push(this.im.RequestseatInfoUpdate(\"RCRequestSeatPrefixKey_\" + userId, \"RCRequestSeatContentAccept\"));\n                return [2 /*return*/, Promise.all(arr).then(function (result) {\n                        return '操作成功:70000';\n                    }).catch(function () {\n                        throw new Error('同意排麦请求发送失败:70017');\n                    })];\n            });\n        });\n    };\n    /**\n    * 拒绝用户排麦请求\n    *\n    * @param userId 请求排麦的用户 Id\n    */\n    RCVoiceRoomLibClass.prototype.rejectRequestSeat = function (userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var arr;\n            return __generator(this, function (_a) {\n                arr = [];\n                arr.push(this.im.RequestseatInfoUpdate(\"RCRequestSeatPrefixKey_\" + userId, \"RCRequestSeatContentDeny\"));\n                return [2 /*return*/, Promise.all(arr).then(function (result) {\n                        _loger__WEBPACK_IMPORTED_MODULE_4__.default.log('操作成功:70000');\n                    }).catch(function () {\n                        throw new Error('拒绝排麦请求发送失败:70018');\n                    })];\n            });\n        });\n    };\n    /**\n    *\n    * 静音所有远程音频流\n    *\n    * @param isMute 是否静音\n    */\n    RCVoiceRoomLibClass.prototype.muteAllRemoteStreams = function (isMute) {\n        return __awaiter(this, void 0, void 0, function () {\n            var remoteTracksObj;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.rtc.isMuteOther = isMute;\n                        return [4 /*yield*/, this.rtc.room.getRemoteTracks()];\n                    case 1:\n                        remoteTracksObj = _a.sent();\n                        if (remoteTracksObj.length) {\n                            if (isMute) {\n                                return [2 /*return*/, this.rtc.room.unsubscribe(remoteTracksObj)];\n                            }\n                            else {\n                                if (this.rtc.rtcTracks) {\n                                    return [2 /*return*/, this.rtc.room.subscribe(this.rtc.rtcTracks)];\n                                }\n                                else {\n                                    return [2 /*return*/, this.rtc.room.subscribe(remoteTracksObj)];\n                                }\n                            }\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n    *\n    * 禁用本地麦克风\n    *\n    * @param isDisable 是否禁用\n    */\n    RCVoiceRoomLibClass.prototype.disableAudioRecording = function (isDisable) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this.rtc.isDisable = isDisable;\n                if (isDisable) {\n                    return [2 /*return*/, this.rtc.mute()];\n                }\n                else {\n                    return [2 /*return*/, this.rtc.unmute()];\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n    *\n    * 获取本地本地麦克风状态\n    *\n    */\n    RCVoiceRoomLibClass.prototype.isDisableAudioRecording = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.rtc.isDisable];\n            });\n        });\n    };\n    /**\n    *\n    * 主动打开扬声器\n    *\n    */\n    RCVoiceRoomLibClass.prototype.enableSpeaker = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.rtc.audioPlay()];\n            });\n        });\n    };\n    /**\n    *\n    * 发布自定义音频流\n    * @param file 本地 MP3 file实例\n    */\n    RCVoiceRoomLibClass.prototype.createTrack = function (file) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.rtc.createTrack(file)];\n            });\n        });\n    };\n    /**\n    *\n    * 停止发布自定义音频流(调用默认已发布自定义音频流)\n    *\n    */\n    RCVoiceRoomLibClass.prototype.stopCreateTrack = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.rtc.stopCreateTrack()];\n            });\n        });\n    };\n    /**\n    *\n    * 直播预览\n    *\n    * @param videoNode\n    */\n    RCVoiceRoomLibClass.prototype.preview = function (o) {\n        this.rtc.preview(o.videoNode);\n    };\n    return RCVoiceRoomLibClass;\n}(events__WEBPACK_IMPORTED_MODULE_0__.EventEmitter));\nvar RCVoiceRoomLib = new RCVoiceRoomLibClass();\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RCVoiceRoomLib);\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./src/index.ts?");

/***/ }),

/***/ "./src/loger.ts":
/*!**********************!*\
  !*** ./src/loger.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ \"./src/config.ts\");\n/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! events */ \"./node_modules/events/events.js\");\n/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_1__);\n\n\nvar Loger = /** @class */ (function () {\n    function Loger() {\n        this.History = [];\n    }\n    Loger.prototype.log = function (target, t) {\n        if (t === void 0) { t = \"\"; }\n        if (!_config__WEBPACK_IMPORTED_MODULE_0__.debug)\n            return;\n        switch (typeof (target)) {\n            case \"number\":\n                console.log(\"its a number ===>\", target);\n                break;\n            case \"string\":\n                console.log(target, t);\n                break;\n            case \"object\":\n                console.log(\"its a object ===>\", target);\n                break;\n            case \"function\":\n                console.log(\"its a function ===>\", target);\n            default:\n                // console.log(target);\n                break;\n        }\n    };\n    Loger.prototype._log = function (target) {\n        var l = {\n            mainStatus: 0,\n            moduleNum: 0,\n            readyNum: 0,\n            loadingList: [],\n            readyList: [],\n            runningList: [],\n            brokenList: [],\n            unKnowStatesList: []\n        };\n        if (Array.isArray(target)) { //array类型.\n            target.forEach(function (element) {\n                if ((element instanceof events__WEBPACK_IMPORTED_MODULE_1__.EventEmitter) && (element.name)) { //队列内容是模块数据检查\n                    l.moduleNum++;\n                    switch (element.states) {\n                        case 0:\n                            l.loadingList.push(element.name);\n                            break;\n                        case 1:\n                            l.readyList.push(element.name);\n                            l.readyNum++;\n                            break;\n                        case 2:\n                            l.runningList.push(element.name);\n                            break;\n                        case 9:\n                            l.brokenList.push(element.name);\n                            break;\n                        default:\n                            l.unKnowStatesList.push(element.name);\n                            break;\n                    }\n                }\n                else {\n                    console.warn(\"数据非法\");\n                }\n            });\n            this.History.push(l);\n            if (this.History.length > 99) {\n                this.History.shift();\n            }\n        }\n        else { //普通对象类型\n            console.warn(\"_log 方法存在异常调用\", target);\n        }\n    };\n    Loger.prototype.history = function () {\n        console.log(this.History);\n    };\n    Loger.prototype.warn = function (target, e) {\n        if (e === void 0) { e = null; }\n        console.warn(target, e);\n    };\n    //错误上报: 参数 e:原始错误信息  errtype:错误类型 mod:错误发生模块 errnum:错误编号;errmessage:错误消息\n    Loger.prototype.error = function (e, errtype, mod, errnum, errmessage) {\n        if (errtype === void 0) { errtype = \"0\"; }\n        if (mod === void 0) { mod = null; }\n        if (errnum === void 0) { errnum = \"00\"; }\n        if (errmessage === void 0) { errmessage = \"unknow err\"; }\n        var errModNum = \"0\";\n        //遇到错误时尝试重启该模块.\n        mod.reboot();\n    };\n    Loger.prototype._error = function (target, e) {\n        if (e === void 0) { e = null; }\n        throw new Error(target);\n    };\n    return Loger;\n}());\nvar loger = new Loger();\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (loger);\n//执行码 \n/*\n千位 执行类别  1数据错误 2网络错误 3硬件 4外部软件环境原因 5自身错误\n百位 模块号 1主模块 2通信 3录音 4桥接 5pcm 0未找到具体模块\n十位个位 具体命令\n    00 未知错误;\n    01 初始化错误;\n    02 参数错误;\n    03 ws接收数据错误;\n    04 音频navigator获取失败;\n    05 模块自身损坏\n    06 native 相关错误\n    */ \n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./src/loger.ts?");

/***/ }),

/***/ "./src/modules/im/index.ts":
/*!*********************************!*\
  !*** ./src/modules/im/index.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _structure_modules__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../structure/modules */ \"./src/structure/modules.ts\");\n/* harmony import */ var _rongcloud_imlib_next__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @rongcloud/imlib-next */ \"./node_modules/@rongcloud/imlib-next/dist/index.esm.js\");\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../config */ \"./src/config.ts\");\n/* harmony import */ var _loger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../loger */ \"./src/loger.ts\");\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (undefined && undefined.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n\n\n\n\nvar IM = /** @class */ (function (_super) {\n    __extends(IM, _super);\n    function IM(item) {\n        var _this = _super.call(this) || this;\n        _this.states = 0; //0初始化未完成 1就绪 2正在初始化  9浏览器不支持\n        _this.userId = '';\n        _this.roomId = '';\n        _this.seatInfoList = [];\n        _this.init(item);\n        return _this;\n    }\n    //im注册\n    IM.prototype.init = function (item) {\n        return __awaiter(this, void 0, void 0, function () {\n            var RongIMLib, Events, that;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (item.imLib) {\n                            RongIMLib = item.imLib;\n                        }\n                        else {\n                            RongIMLib = _rongcloud_imlib_next__WEBPACK_IMPORTED_MODULE_1__;\n                        }\n                        return [4 /*yield*/, RongIMLib.__addSDKVersion('rcvoiceroomlib', '2.0.3')\n                            // 获取 IMLib 实例\n                        ];\n                    case 1:\n                        _a.sent();\n                        // 获取 IMLib 实例\n                        return [4 /*yield*/, RongIMLib.init({ appkey: item.appkey })];\n                    case 2:\n                        // 获取 IMLib 实例\n                        _a.sent();\n                        Events = RongIMLib.Events;\n                        this.chatRoom = RongIMLib;\n                        this.body = RongIMLib;\n                        that = this;\n                        //添加消息监听\n                        RongIMLib.addEventListener(Events.MESSAGES, function (m) {\n                            var message = m.messages[0];\n                            // console.log('message', message);\n                            switch (message.messageType) {\n                                case \"RC:VRLRefreshMsg\":\n                                    that.emit(\"onRoomNotificationReceived\", {\n                                        name: message.content.name,\n                                        content: message.content.content,\n                                    });\n                                    switch (message.content.name.split(\"_\")[0]) {\n                                        case \"RCAudienceJoinRoom\":\n                                            that.chatRoom.getChatRoomInfo(that.roomId, {\n                                                count: 0,\n                                                order: 0\n                                            }).then(function (result) {\n                                                if (result.code == 0) {\n                                                    that.emit(\"onAudienceEnter\", result.data.userCount);\n                                                }\n                                            });\n                                            break;\n                                        case \"RCAudienceLeaveRoom\":\n                                            that.chatRoom.getChatRoomInfo(that.roomId, {\n                                                count: 0,\n                                                order: 0\n                                            }).then(function (result) {\n                                                if (result.code == 0) {\n                                                    that.emit(\"onAudienceExit\", result.data.userCount);\n                                                }\n                                            });\n                                            break;\n                                        case \"RCUserOnSeatSpeakingKey\":\n                                            //console.log(\"originkey:\", message.content.name)\n                                            that.emit(\"speakingStatusChange\", { index: message.content.name.split(\"_\")[1], speaking: message.content.content });\n                                            break;\n                                        case \"VoiceRoomClosed\":\n                                            //console.log(\"originkey:\", message.content.name)\n                                            that.emit(\"VoiceRoomClosed\");\n                                            break;\n                                        case \"VoiceRoomBackgroundChanged\":\n                                            //console.log(\"originkey:\", message.content.name)\n                                            that.emit(\"VoiceRoomBackgroundChanged\", message.content.content);\n                                            break;\n                                        case \"VoiceRoomAgreeManagePick\":\n                                            //console.log(\"originkey:\", message.content.name)\n                                            that.emit(\"VoiceRoomAgreeManagePick\", message.content.content);\n                                            break;\n                                        case \"VoiceRoomRejectManagePick\":\n                                            //console.log(\"originkey:\", message.content.name)\n                                            that.emit(\"VoiceRoomRejectManagePick\", message.content.content);\n                                            break;\n                                        default:\n                                            break;\n                                    }\n                                    break;\n                                case \"RC:VRLInviteMsg\":\n                                    switch (message.content.content) {\n                                        case \"RCKickUserOutRoomContent\":\n                                            that.emit(\"RCKickUserOutRoomContent\", {\n                                                targetId: message.content.targetId,\n                                                userId: message.content.sendUserId,\n                                            });\n                                            break;\n                                        case \"RCPickerUserSeatContent\":\n                                            that.emit(\"RCPickerUserSeatContent\", {\n                                                targetId: message.content.targetId,\n                                                sendUserId: message.content.sendUserId,\n                                            });\n                                            //console.log(\"被抱上麦\");\n                                            break;\n                                        default:\n                                            break;\n                                    }\n                                default:\n                                    that.emit(\"onMessageReceived\", message);\n                                    break;\n                            }\n                        });\n                        /**\n                         * 正在链接的事件状态\n                         */\n                        RongIMLib.addEventListener(Events.CONNECTING, function () {\n                            // console.log('正在链接...')\n                        });\n                        /**\n                         * 链接到服务器会触发这个事件\n                         */\n                        RongIMLib.addEventListener(Events.CONNECTED, function () {\n                            console.log('连接成功');\n                        });\n                        /**\n                         * 手动调用 disconnect 方法或者用户被踢下线 会触发这个事件\n                         */\n                        RongIMLib.addEventListener(Events.DISCONNECT, function () {\n                            that.emit(\"connectioBreakOff\");\n                        });\n                        /**\n                         * 链接出问题时，内部进行重新链接，会出发这个事件\n                         */\n                        RongIMLib.addEventListener(Events.SUSPEND, function () {\n                            // console.log('链接中断,SDK 会尝试重连,业务层无需关心')\n                        });\n                        //聊天室KV更新\n                        RongIMLib.addEventListener(Events.CHATROOM, function (event) {\n                            if (event['chatroomDestroyed']) {\n                                that.emit(\"chatroomDestroyed\");\n                            }\n                            else {\n                                /**\n                                * 聊天室 KV 存储数据更新  ^[0-9]*$\n                                */\n                                var updatedEntries = event.updatedEntries;\n                                // console.log(\"kvup==================\", event.updatedEntries)\n                                updatedEntries.forEach(function (obj) {\n                                    switch (obj.key.split(\"_\")[0]) {\n                                        case \"RCRoomInfoKey\":\n                                            var roomInfo = JSON.parse(obj.value);\n                                            that.emit(\"roomInfoDidUpdate\", { roomInfo: roomInfo });\n                                            if (that.seatIndex && that.seatIndex > roomInfo.seatCount) {\n                                                _loger__WEBPACK_IMPORTED_MODULE_3__.default.log(\"seatCount不对下麦\");\n                                                that.emit(\"leaveSeat\");\n                                            }\n                                            if (that.seatInfoList.length > roomInfo.seatCount) {\n                                                that.seatInfoList.length = roomInfo.seatCount;\n                                            }\n                                            break;\n                                        case \"RCSeatInfoSeatPartPrefixKey\":\n                                            //麦位操作\n                                            //筛查被更改的麦位\n                                            if (roomInfo && (obj.key.split(\"_\")[1] >= roomInfo.seatCount)) { //大于当前seatCount的属性不处理\n                                                return;\n                                            }\n                                            var currentSeatInfo = that.seatInfoList[Number(obj.key.split(\"_\")[1])]; //当前麦位信息\n                                            if (!obj.value)\n                                                return; // 麦位信息不完整直接返回 \n                                            var newSeatInfo = JSON.parse(obj.value); //传入的麦位信息\n                                            if (that.seatIndex == obj.key.split(\"_\")[1]) { //当前在被操作的麦位上\n                                                for (var key in currentSeatInfo) {\n                                                    switch (key) {\n                                                        case \"userId\":\n                                                            // if (currentSeatInfo.userId != newSeatInfo.userId) {\n                                                            //     that.emit(\"leaveSeat\");\n                                                            // }\n                                                            break;\n                                                        case \"mute\":\n                                                            if (currentSeatInfo.mute != newSeatInfo.mute) {\n                                                                that.emit(\"mute\", newSeatInfo.mute);\n                                                            }\n                                                            break;\n                                                        case \"status\":\n                                                            switch (Number(newSeatInfo.status)) {\n                                                                case _config__WEBPACK_IMPORTED_MODULE_2__.RCSeatStatus.RCSeatStatusEmpty:\n                                                                    if (currentSeatInfo.status == 1) {\n                                                                        that.emit(\"leaveSeat\");\n                                                                        _loger__WEBPACK_IMPORTED_MODULE_3__.default.log(\"接受到消息下麦\");\n                                                                    }\n                                                                    break;\n                                                                case _config__WEBPACK_IMPORTED_MODULE_2__.RCSeatStatus.RCSeatStatusLocking:\n                                                                    _loger__WEBPACK_IMPORTED_MODULE_3__.default.log(\"锁麦位下麦\");\n                                                                    that.emit(\"leaveSeat\");\n                                                                    break;\n                                                                default:\n                                                                    break;\n                                                            }\n                                                        default:\n                                                            break;\n                                                    }\n                                                }\n                                            }\n                                            that.seatInfoList[obj.key.split(\"_\")[1]] = JSON.parse(obj.value);\n                                            that.emit(\"seatInfoDidUpdate\");\n                                            break;\n                                        case \"RCRequestSeatPrefixKey\":\n                                            if (that.userId && obj.key.split(\"_\")[1] == that.userId) {\n                                                if (obj.value == \"RCRequestSeatContentAccept\") {\n                                                    that.emit(\"RequestSeatAccepted\");\n                                                }\n                                                else if (obj.value == \"RCRequestSeatContentDeny\") {\n                                                    that.emit(\"RequestSeatRejected\");\n                                                }\n                                            }\n                                            that.emit(\"RequestSeatListChanged\");\n                                            break;\n                                        default:\n                                            break;\n                                    }\n                                });\n                            }\n                        });\n                        that.emit(\"imReady\", RongIMLib);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    //im链接\n    IM.prototype.connect = function (token) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.chatRoom.connect(token).then(function (res) {\n                        if (res.code === 0) {\n                            _this.emit(\"connectReady\");\n                            if (res.data.userId) {\n                                _this.userId = res.data.userId;\n                                return '操作成功:70000';\n                            }\n                            else {\n                                return '当前用户 Id 为空:70029';\n                            }\n                        }\n                    }).catch(function (error) {\n                        _this.userId = '';\n                        return '连接服务器失败:70001';\n                    })];\n            });\n        });\n    };\n    //加入房间\n    IM.prototype.joinRoom = function (o) {\n        return __awaiter(this, void 0, void 0, function () {\n            var that;\n            var _this = this;\n            return __generator(this, function (_a) {\n                if (o.roomName) {\n                    this._roomName = o.roomName;\n                }\n                this.roomId = o.roomId;\n                that = this;\n                return [2 /*return*/, this.chatRoom.joinChatRoom(o.roomId, {\n                        count: -1\n                    }).then(function (res) { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            // 加入聊天室成功\n                            that.messageUpdate(\"RC:VRLRefreshMsg\", {\n                                name: \"RCAudienceJoinRoom\",\n                                content: that.userId\n                            }).then(function () {\n                                _loger__WEBPACK_IMPORTED_MODULE_3__.default.log('发送进房间消息成功');\n                            }).catch(function (err) {\n                                _loger__WEBPACK_IMPORTED_MODULE_3__.default._error('发送进房间消息失败:', err);\n                            });\n                            that.emit(\"joinRoom\", o);\n                            return [2 /*return*/, '加入聊天室成功'];\n                        });\n                    }); }).catch(function (error) {\n                        return error;\n                    })];\n            });\n        });\n    };\n    //加入房间\n    IM.prototype.joinExistChatRoom = function (o) {\n        return __awaiter(this, void 0, void 0, function () {\n            var that;\n            var _this = this;\n            return __generator(this, function (_a) {\n                if (o.roomName) {\n                    this._roomName = o.roomName;\n                }\n                this.roomId = o.roomId;\n                that = this;\n                return [2 /*return*/, this.chatRoom.joinExistChatRoom(o.roomId, {\n                        count: -1\n                    }).then(function (res) { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            // 加入聊天室成功\n                            that.messageUpdate(\"RC:VRLRefreshMsg\", {\n                                name: \"RCAudienceJoinRoom\",\n                                content: that.userId\n                            }).then(function () {\n                                _loger__WEBPACK_IMPORTED_MODULE_3__.default.log('发送进房间消息成功');\n                            }).catch(function (err) {\n                                _loger__WEBPACK_IMPORTED_MODULE_3__.default._error('发送进房间消息失败:', err);\n                            });\n                            that.emit(\"joinRoom\", o);\n                            return [2 /*return*/, '加入聊天室成功'];\n                        });\n                    }); }).catch(function (error) {\n                        return error;\n                    })];\n            });\n        });\n    };\n    //获取房间属性\n    IM.prototype.getRoomInfo = function (o) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, ifinseat;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        ifinseat = false;\n                        return [4 /*yield*/, this.chatRoom.getAllChatRoomEntries(o.roomId).then(function (entries) {\n                                // console.log('获取所有聊天室属性信息:', entries.data);\n                                data = entries.data;\n                                if (JSON.stringify(data) == '{}') {\n                                    //空房间 初始化roominfo\n                                    _this.setNewRoom(o);\n                                    // ifinseat = true;\n                                }\n                                else {\n                                    for (var key in data) {\n                                        //this.roomInfo[i]=JSON.parse(info[i])\n                                        if (key == \"RCRoomInfoKey\") {\n                                            _this.roomInfo = JSON.parse(data[key]);\n                                            _this.emit(\"roomInfoDidUpdate\", { roomInfo: _this.roomInfo });\n                                        }\n                                        else if (key.split(\"_\")[0] == 'RCSeatInfoSeatPartPrefixKey') {\n                                            console.log('data[key]', data[key]);\n                                            _this.seatInfoList[key.split(\"_\")[1]] = JSON.parse(data[key]);\n                                            if (JSON.parse(data[key])['userId'] && JSON.parse(data[key])['userId'] == _this.userId) {\n                                                ifinseat = true;\n                                            }\n                                            _this.emit(\"seatInfoDidUpdate\");\n                                        }\n                                    }\n                                }\n                                ;\n                            })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, ifinseat];\n                }\n            });\n        });\n    };\n    //changeRoomInfo属性\n    IM.prototype.changeRoomInfo = function (roominfo) {\n        return __awaiter(this, void 0, void 0, function () {\n            var seatCount, OldseatCount, key, defaultSeatInfo, value, list, m, arr, i;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        seatCount = roominfo.seatCount;\n                        OldseatCount = this.roomInfo.seatCount;\n                        key = 'RCRoomInfoKey';\n                        defaultSeatInfo = {\n                            status: 0,\n                            mute: false,\n                            speaking: false,\n                        };\n                        value = JSON.stringify(roominfo);\n                        if (!(OldseatCount > seatCount)) return [3 /*break*/, 2];\n                        list = [];\n                        for (m = seatCount; m < OldseatCount; m++) {\n                            list.push(this.chatRoom.forceRemoveChatRoomEntry(this.roomId, {\n                                key: \"RCSeatInfoSeatPartPrefixKey_\" + m,\n                                isSendNotification: false\n                            }));\n                        }\n                        // console.log('removeChatRoomEntries', list);\n                        return [4 /*yield*/, Promise.all(list).then(function (res) {\n                                console.log(\"删除属性成功\", res);\n                            }).catch(function (error) {\n                                console.log(error);\n                            })\n                            // await this.chatRoom.removeChatRoomEntries(this.roomId, { entries: list, isAutoDelete: false }).then((res) => {\n                            //     console.log(\"删除属性成功\", res);\n                            // }).catch(error => {\n                            //     console.log(error)\n                            // })\n                        ];\n                    case 1:\n                        // console.log('removeChatRoomEntries', list);\n                        _a.sent();\n                        _a.label = 2;\n                    case 2: return [4 /*yield*/, this.chatRoom.forceSetChatRoomEntry(this.roomId, {\n                            key: key,\n                            value: value,\n                            isAutoDelete: false,\n                            isSendNotification: true,\n                            notificationExtra: 'Change Count'\n                        }).then(function (res) {\n                            _this.roomInfo = roominfo;\n                            // this.emit(\"roomInfoDidUpdate\", { roomInfo: this.roomInfo })\n                        }).catch(function (error) {\n                            console.log(error);\n                        })];\n                    case 3:\n                        _a.sent();\n                        arr = [];\n                        // let seatarr = []\n                        for (i = 1; i < seatCount; i += 1) {\n                            arr.push(this.chatRoom.forceSetChatRoomEntry(this.roomId, {\n                                key: \"RCSeatInfoSeatPartPrefixKey_\" + i,\n                                value: JSON.stringify(__assign({}, defaultSeatInfo)),\n                                isAutoDelete: false,\n                                isSendNotification: true,\n                                notificationExtra: 'Change Count'\n                            }));\n                            this.seatInfoList[i] = __assign({}, defaultSeatInfo);\n                        }\n                        return [4 /*yield*/, Promise.all(arr).then(function (res) {\n                                console.log(\"设置属性成功\", res);\n                            }).catch(function (error) {\n                                console.log(error);\n                            })\n                            // console.log('setChatRoomEntries', arr);\n                            // await this.chatRoom.setChatRoomEntries(this.roomId, { entries: arr, isAutoDelete: false }).then((res) => {\n                            //     console.log(\"设置属性成功\", res);\n                            // }).catch(error => {\n                            //     console.log(error)\n                            // })\n                        ];\n                    case 4:\n                        _a.sent();\n                        // console.log('setChatRoomEntries', arr);\n                        // await this.chatRoom.setChatRoomEntries(this.roomId, { entries: arr, isAutoDelete: false }).then((res) => {\n                        //     console.log(\"设置属性成功\", res);\n                        // }).catch(error => {\n                        //     console.log(error)\n                        // })\n                        this.seatInfoList.length = seatCount;\n                        // this.seatInfoList = seatarr\n                        this.emit('changeRoomInfo');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    //设置到RoomLib属性\n    IM.prototype.setNewRoom = function (parm) {\n        return __awaiter(this, void 0, void 0, function () {\n            var seatCount, key, defaultRoomInfo, value, defaultSeatInfo, arr, seatarr, i;\n            var _this = this;\n            return __generator(this, function (_a) {\n                console.log('setNewRoom', parm);\n                seatCount = 9;\n                if (parm && parm.seatCount) {\n                    seatCount = parm.seatCount;\n                }\n                key = 'RCRoomInfoKey';\n                defaultRoomInfo = {\n                    isFreeEnterSeat: false,\n                    isLockAll: false,\n                    isMuteAll: false,\n                    roomName: this._roomName + \"\",\n                    seatCount: seatCount //麦位数量\n                };\n                value = JSON.stringify(defaultRoomInfo);\n                this.chatRoom.forceSetChatRoomEntry(this.roomId, {\n                    key: key,\n                    value: value,\n                    isAutoDelete: false,\n                    isSendNotification: true,\n                    notificationExtra: 'Change Count'\n                }).then(function (res) {\n                    _this.roomInfo = defaultRoomInfo;\n                    _this.emit(\"roomInfoDidUpdate\", { roomInfo: _this.roomInfo });\n                }).catch(function (error) {\n                    console.log(error);\n                });\n                defaultSeatInfo = {\n                    status: 0,\n                    mute: false,\n                    speaking: false,\n                };\n                arr = [];\n                seatarr = [];\n                for (i = 0; i < seatCount; i += 1) {\n                    arr.push({\n                        key: \"RCSeatInfoSeatPartPrefixKey_\" + i,\n                        value: JSON.stringify(__assign({}, defaultSeatInfo)),\n                        isAutoDelete: false,\n                        isSendNotification: true,\n                        notificationExtra: 'Change Count'\n                    });\n                    seatarr.push(__assign({}, defaultSeatInfo));\n                }\n                this.chatRoom.setChatRoomEntries(parm.roomId, { entries: arr, isAutoDelete: false }).then(function (res) {\n                    console.log(\"设置属性成功\");\n                }).catch(function (error) {\n                    console.log(error);\n                });\n                this.seatInfoList = seatarr;\n                this.emit('setNewRoom');\n                return [2 /*return*/];\n            });\n        });\n    };\n    //更新消息\n    IM.prototype.messageUpdate = function (messageType, content) {\n        var PersonMessage = this.chatRoom.registerMessageType(messageType, false, false, []);\n        var message = new PersonMessage(content);\n        var arr = [\n            this.chatRoom\n                .sendMessage({\n                conversationType: this.chatRoom.ConversationType.CHATROOM,\n                targetId: this.roomId\n            }, message),\n            // this.chatRoom\n            //     .insertMessage(\n            //         {\n            //             conversationType: this.chatRoom.ConversationType.CHATROOM,\n            //             targetId: this.roomId\n            //         },\n            //         {\n            //             senderUserId: this.userId,\n            //             messageType: messageType,\n            //             content: content,\n            //         })\n        ];\n        return Promise.all(arr);\n    };\n    //im离开房间\n    IM.prototype.leaveRoom = function (roomid) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.chatRoom.quitChatRoom(roomid).then(function (res) {\n                        //退出时清理房间数据\n                        if (res.code === 0) {\n                            _this.roomInfo = null;\n                            _this.seatInfoList.length = 0;\n                            // console.log('退出聊天室 ' + roomid)\n                            _this.messageUpdate(\"RC:VRLRefreshMsg\", {\n                                name: \"RCAudienceLeaveRoom\",\n                                content: _this.userId,\n                            });\n                        }\n                    })];\n            });\n        });\n    };\n    //设置麦位信息\n    IM.prototype.seatInfoUpdate = function (key, value) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                //console.log(key);\n                return [2 /*return*/, this.chatRoom.forceSetChatRoomEntry(this.roomId, {\n                        key: key,\n                        value: JSON.stringify(value),\n                        notificationExtra: 'extra',\n                        isAutoDelete: false,\n                        isSendNotification: false,\n                    }).then(function () {\n                        return '设置聊天室属性成功!';\n                    }).catch(function (err) {\n                        return '设置聊天室属性失败:' + err;\n                    })];\n            });\n        });\n    };\n    //排麦消息设置\n    IM.prototype.RequestseatInfoUpdate = function (key, value) {\n        //console.log(key);\n        return this.chatRoom.forceSetChatRoomEntry(this.roomId, {\n            key: key,\n            value: value,\n            isAutoDelete: true,\n            type: 1,\n            isSendNotification: false,\n        }).then(function () {\n            return '排麦操作成功!';\n        }).catch(function (err) {\n            return '排麦操作失败:' + err;\n        });\n    };\n    //删除麦位信息\n    IM.prototype.seatInfoRemove = function (key) {\n        return this.chatRoom.forceRemoveChatRoomEntry(this.roomId, {\n            key: key,\n            isSendNotification: false,\n        });\n    };\n    return IM;\n}(_structure_modules__WEBPACK_IMPORTED_MODULE_0__.default));\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (IM);\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./src/modules/im/index.ts?");

/***/ }),

/***/ "./src/modules/rtc/index.ts":
/*!**********************************!*\
  !*** ./src/modules/rtc/index.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _structure_modules__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../structure/modules */ \"./src/structure/modules.ts\");\n/* harmony import */ var _rongcloud_plugin_rtc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @rongcloud/plugin-rtc */ \"./node_modules/@rongcloud/plugin-rtc/dist/index.esm.js\");\n/* harmony import */ var _rongcloud_engine__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @rongcloud/engine */ \"./node_modules/@rongcloud/engine/dist/index.esm.js\");\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (undefined && undefined.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\n\n// import { installer, RCRTCCode, RCLivingType } from '@rongcloud/plugin-rtc'\n\n\nvar RTC = /** @class */ (function (_super) {\n    __extends(RTC, _super);\n    // roomType: string;\n    // videoNode: any;\n    function RTC() {\n        var _this = _super.call(this) || this;\n        _this.states = 0; //0初始化未完成 1就绪 2正在初始化  9浏览器不支持\n        _this.isAnchor = false; //身份标识 是否主播\n        _this.audioTrack = null;\n        _this.isDisable = false;\n        _this.isMuteOther = false;\n        _this.isMuteOwner = false;\n        return _this;\n        // this.init(item);\n    }\n    RTC.prototype.init = function (item) {\n        /*初始化参数请参考下方参数说明*/\n        var im = item.im;\n        // console.log('item.rtcLib', item.rtcLib);\n        if (item.rtcLib) {\n            this.RTCLib = item.rtcLib;\n        }\n        else {\n            this.RTCLib = _rongcloud_plugin_rtc__WEBPACK_IMPORTED_MODULE_1__;\n        }\n        var rtcClient = im.installPlugin(this.RTCLib.installer, {});\n        this.body = rtcClient;\n        console.log('rtc初始化完成', rtcClient);\n        if (!item.rtcLib) {\n            console.log('内部各SDK版本', _rongcloud_engine__WEBPACK_IMPORTED_MODULE_2__.VersionManage.getInfo());\n        }\n        this.emit(\"ready\");\n    };\n    RTC.prototype.joinRoom = function (roomid) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                // console.log(\"加入rtcroom\", roomid);\n                console.log(\"我是不是主播\", this.isAnchor);\n                if (this.isAnchor) {\n                    this.joinLivingRoomAsAnchor(roomid);\n                }\n                else {\n                    this.joinLivingRoomAsAudience(roomid);\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    //主播加入rtcroom\n    RTC.prototype.joinLivingRoomAsAnchor = function (roomid) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, room, RTCTracks, MCUTracks, CDNUris, userIds, code, that, getTrack, publishTrack, remoteTracksObj, obj;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        console.log(\"主播加入rtcroom\", roomid);\n                        return [4 /*yield*/, this.body.joinLivingRoom(roomid, this.RTCLib.RCLivingType.AUDIO)\n                            // 若加入失败，则 room、userIds、tracks 值为 undefined\n                        ];\n                    case 1:\n                        _a = _b.sent(), room = _a.room, RTCTracks = _a.RTCTracks, MCUTracks = _a.MCUTracks, CDNUris = _a.CDNUris, userIds = _a.userIds, code = _a.code;\n                        // 若加入失败，则 room、userIds、tracks 值为 undefined\n                        console.log(code);\n                        console.log(this.RTCLib.RCRTCCode.SUCCESS);\n                        if (code !== this.RTCLib.RCRTCCode.SUCCESS) {\n                            return [2 /*return*/];\n                        }\n                        // this.rtcTracks = RTCTracks\n                        // let object\n                        // if (!this.isMuteOther) {\n                        //     object = room.subscribe(RTCTracks);\n                        // } else {\n                        //     object = room.unsubscribe(RTCTracks);\n                        // }\n                        this.room = room;\n                        that = this;\n                        // 注册房间事件监听器，重复注册时，仅最后一次注册有效\n                        room.registerRoomEventListener({\n                            onRTCPeerConnectionCloseByException: function () {\n                                that.emit('onRTCPeerConnectionCloseByException');\n                            },\n                            /**\n                             * 当本端被剔出房间\n                             * @description 被踢出房间可能是由于服务端超出一定时间未能收到 rtcPing 消息，所以认为己方离线。\n                             * 另一种可能是己方 rtcPing 失败次数超出上限，故而主动断线\n                             * @param byServer\n                             * 当值为 false 时，说明本端 rtcPing 超时\n                             * 当值为 true 时，说明本端收到被踢出房间通知\n                             */\n                            onKickOff: function (byServer) {\n                            },\n                            /**\n                             * 接收到房间信令时回调，用户可通过房间实例的 `messageUpdate(name, content)` 接口发送信令\n                             * @param name 信令名\n                             * @param content 信令内容\n                             * @param senderUserId 发送者 Id\n                             * @param messageUId 消息唯一标识\n                             */\n                            onMessageReceive: function (name, content, senderUserId, messageUId) {\n                                // console.log(\"eeeeeevent: 主播房间收到消息\", name, content, senderUserId, messageUId);\n                            },\n                            /**\n                             * 监听房间属性变更通知\n                             * @param name\n                             * @param content\n                             */\n                            onRoomAttributeChange: function (name, content) {\n                                // console.log(\"eeeeeevent: 主播房间属性变更\");\n                            },\n                            /**\n                             * 房间用户禁用/启用音频\n                             * @param audioTrack RCRemoteAudioTrack 类实例\n                             */\n                            onAudioMuteChange: function (audioTrack) {\n                                //console.log(\"eeeeeevent: 主播房间 音频 静音\");\n                            },\n                            /**\n                             * 房间用户禁用/启用视频\n                             * @param videoTrack RCRemoteVideoTrack 类实例对象\n                             */\n                            onVideoMuteChange: function (videoTrack) {\n                                //console.log(\"eeeeeevent: 主播房间 视频 静音\");\n                            },\n                            /**\n                             * 房间内用户发布资源\n                             * @param tracks 新发布的音轨与视轨数据列表，包含新发布的 RCRemoteAudioTrack 与 RCRemoteVideoTrack 实例\n                             */\n                            onTrackPublish: function (tracks) {\n                                return __awaiter(this, void 0, void 0, function () {\n                                    var obj;\n                                    return __generator(this, function (_a) {\n                                        // 按业务需求选择需要订阅资源，\n                                        that.rtcTracks = tracks;\n                                        console.log('tracks+++++', tracks);\n                                        if (!that.isMuteOther) {\n                                            obj = room.subscribe(tracks);\n                                        }\n                                        else {\n                                            obj = room.unsubscribe(tracks);\n                                        }\n                                        return [2 /*return*/];\n                                    });\n                                });\n                            },\n                            /**\n                             * 房间用户取消发布资源\n                             * @param tracks 被取消发布的音轨与视轨数据列表\n                             * @description 当资源被取消发布时，SDK 内部会取消对相关资源的订阅，业务层仅需处理 UI 业务\n                             */\n                            onTrackUnpublish: function (tracks) {\n                                //console.log(\"eeeeeevent: 主播房间取消发布\", tracks);\n                            },\n                            /*\n                             * 房间内主播资源发布\n                             * @param track RCRemoteTrack 类实例\n                             * * 触发时机: 主播发布资源后\n                             */\n                            onAnchorTrackPublish: function (tracks) {\n                                // that.rtcTracks = tracks\n                                // let obj\n                                // if (!that.isMuteOther) {\n                                //     obj = room.subscribe(tracks);\n                                // } else {\n                                //     obj = room.unsubscribe(tracks);\n                                // }\n                            },\n                            /*\n                           * 房间内主播资源取消发布\n                           * @param track RCRemoteTrack 类实例\n                           * * 触发时机: 主播取消发布资源后\n                           */\n                            onAnchorTrackUnpublish: function (tracks) {\n                                // console.log('onAnchorTrackUnpublish', tracks);\n                            },\n                            /**\n                             * 订阅的音视频流通道已建立, track 已可以进行播放\n                             * @param track RCRemoteTrack 类实例\n                             */\n                            onTrackReady: function (track) {\n                                console.log('tracks+++++====', track);\n                                that.audioTrack = track;\n                                if (track.isAudioTrack()) {\n                                    // 音轨不需要传递播放控件\n                                    track.play();\n                                }\n                                else {\n                                    // 视轨需要一个 video 标签才可进行播放\n                                    // const element = document.createElement('video')\n                                    // document.body.appendChild(element)\n                                    // track.play(element)\n                                }\n                            },\n                            /**\n                             * 人员加入\n                             * @param userIds 加入的人员 id 列表\n                             */\n                            onUserJoin: function (userIds) {\n                                //console.log(\"eeeeeevent: 主播房间 用户加入\", userIds);\n                            },\n                            /**\n                             * 人员退出\n                             * @param userIds\n                             */\n                            onUserLeave: function (userIds) {\n                                //console.log(\"eeeeeevent: 主播房间 用户离开\", userIds);\n                            },\n                        });\n                        return [4 /*yield*/, this.body.createMicrophoneAudioTrack()\n                            //console.log(\"track\", getTrack.track)\n                        ];\n                    case 2:\n                        getTrack = _b.sent();\n                        //console.log(\"track\", getTrack.track)\n                        this.tracks = getTrack.track;\n                        if (!(this.isDisable || this.isMuteOwner)) return [3 /*break*/, 4];\n                        return [4 /*yield*/, room.unpublish([getTrack.track])];\n                    case 3:\n                        publishTrack = _b.sent();\n                        return [3 /*break*/, 6];\n                    case 4: return [4 /*yield*/, room.publish([getTrack.track])];\n                    case 5:\n                        publishTrack = _b.sent();\n                        _b.label = 6;\n                    case 6:\n                        // 若资源发布失败\n                        if (publishTrack.code !== this.RTCLib.RCRTCCode.SUCCESS) {\n                            console.log('资源发布失败:', publishTrack.code);\n                        }\n                        else {\n                            // console.log(\"资源 发布成功\");\n                            // const handler = (audioLevelReportList: { track, audioLevel: number }[]) => {\n                            //     // let level: number = 0;\n                            //     for (var i in audioLevelReportList) {\n                            //         // level = audioLevelReportList[i].audioLevel\n                            //         this.emit(\"audioChenge\", audioLevelReportList[i])\n                            //         // console.log(\"audioreport++++++++++++++++:\", audioLevelReportList[i])\n                            //     }\n                            // }\n                            // room.onAudioLevelChange(handler, 1000)\n                            console.log(\"资源 发布 成功\");\n                        }\n                        return [4 /*yield*/, room.getRemoteTracks()];\n                    case 7:\n                        remoteTracksObj = _b.sent();\n                        this.rtcTracks = false;\n                        if (!remoteTracksObj.length) return [3 /*break*/, 11];\n                        if (!this.isMuteOther) return [3 /*break*/, 9];\n                        return [4 /*yield*/, room.unsubscribe(remoteTracksObj)];\n                    case 8:\n                        obj = _b.sent();\n                        return [3 /*break*/, 11];\n                    case 9: return [4 /*yield*/, room.subscribe(remoteTracksObj)];\n                    case 10:\n                        obj = _b.sent();\n                        _b.label = 11;\n                    case 11:\n                        this.emit(\"joinRoom\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    //观众加入rtcroom\n    RTC.prototype.joinLivingRoomAsAudience = function (roomid) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, room, RTCTracks, MCUTracks, CDNUris, userIds, code, obj, that;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        console.log(\"观众加入rtcroom\", roomid);\n                        return [4 /*yield*/, this.body.joinLivingRoomAsAudience(roomid, this.RTCLib.RCLivingType.AUDIO)\n                            // 若加入失败，则 room 值为 undefined\n                        ];\n                    case 1:\n                        _a = _b.sent(), room = _a.room, RTCTracks = _a.RTCTracks, MCUTracks = _a.MCUTracks, CDNUris = _a.CDNUris, userIds = _a.userIds, code = _a.code;\n                        // 若加入失败，则 room 值为 undefined\n                        if (code !== this.RTCLib.RCRTCCode.SUCCESS) {\n                            // console.log('join room as audience failed:', code)\n                            return [2 /*return*/];\n                        }\n                        this.room = room;\n                        this.tracks = MCUTracks;\n                        // const MCUTracks = room.getRemoteMCUTracks();\n                        if (MCUTracks.length != 0) {\n                            obj = void 0;\n                            this.rtcTracks = MCUTracks;\n                            if (this.isMuteOther) {\n                                obj = room.unsubscribe(MCUTracks);\n                            }\n                            else {\n                                obj = room.subscribe(MCUTracks);\n                            }\n                        }\n                        that = this;\n                        room.registerRoomEventListener({\n                            /**\n                             * 主播加入\n                             * @param userIds 加入的主播 id 列表\n                             */\n                            onAnchorJoin: function (userIds) {\n                                //console.log(\"观众房间监听\");\n                                //console.log(\"主播加入\", userIds)\n                            },\n                            /**\n                             * 主播离开\n                             * @param userIds 离开的主播 id 列表\n                             */\n                            onAnchorLeave: function (userIds) {\n                            },\n                            /*\n                             * 房间内直播合流资源发布\n                             * @param track RCRemoteTrack 类实例\n                             * * 房间类型以第一个加入房间用户设置的直播类型为准\n                             * * 房间直播类型为 RCLivingType.AUDIO_VIDEO ，tracks 包含 RCRemoteAudioTrack 与 RCRemoteVideoTrack 实例\n                             * * 直播类型为 RCLivingType.AUDIO ， tracks 仅包含 RCRemoteAudioTrack 实例\n                             */\n                            onTrackPublish: function (tracks) {\n                                that.rtcTracks = tracks;\n                                var obj;\n                                if (that.isMuteOther) {\n                                    obj = room.unsubscribe(tracks);\n                                }\n                                else {\n                                    obj = room.subscribe(tracks);\n                                }\n                            },\n                            /*\n                             * 房间内直播合流资源取消发布\n                             * @param track RCRemoteTrack 类实例\n                             * * 触发时机: 全部主播退出房间（因资源为多个主播发布的合流资源，单个主播取消发布不会触发）\n                             */\n                            onTrackUnpublish: function (tracks) {\n                            },\n                            onTrackReady: function (track) {\n                                that.audioTrack = track;\n                                // 订阅的音视频轨道已连接，可以根据业务需求选择性播放\n                                if (track.isAudioTrack()) {\n                                    // 音频播放无需传递组件\n                                    track.play();\n                                }\n                                else {\n                                    // 此处的 videoNode 为 <video> 标签元素实例\n                                    //track.play(videoNode)\n                                }\n                            }\n                        });\n                        // const handler = (audioLevelReportList: { track, audioLevel: number }[]) => {\n                        //     // let level: number = 0;\n                        //     for (var i in audioLevelReportList) {\n                        //         // level = audioLevelReportList[i].audioLevel\n                        //         this.emit(\"audioChenge\", audioLevelReportList[i])\n                        //     }\n                        // }\n                        // room.onAudioLevelChange(handler, 1000)\n                        this.emit(\"joinRoom\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    //离开rtc房间\n    RTC.prototype.leaveRoom = function (roomid) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (roomid && roomid != '') {\n                    if (this.isAnchor) { //在麦位退出房间或下麦\n                        return [2 /*return*/, this.body.leaveRoom(this.room)];\n                    }\n                    else {\n                        return [2 /*return*/, this.body.leaveLivingRoomAsAudience(this.room)];\n                    }\n                }\n                else {\n                    console.log('roomid 错误');\n                    return [2 /*return*/];\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    //闭麦\n    RTC.prototype.mute = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var code;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.tracks || this.tracks.length == 0)\n                            return [2 /*return*/];\n                        console.log('this.room', this.room);\n                        if (!this.room) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.room.unpublish([this.tracks])];\n                    case 1:\n                        code = (_a.sent()).code;\n                        console.log('取消发布', code);\n                        return [3 /*break*/, 3];\n                    case 2:\n                        console.log('this.room', this.room);\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    //开麦\n    RTC.prototype.unmute = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var code;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // console.log(this.tracks);\n                        if (!this.tracks || this.tracks.length == 0)\n                            return [2 /*return*/];\n                        console.log('this.room', this.room);\n                        return [4 /*yield*/, this.room.publish([this.tracks])\n                            // // 若资源发布失败\n                        ];\n                    case 1:\n                        code = (_a.sent()).code;\n                        // // 若资源发布失败\n                        if (code !== this.RTCLib.RCRTCCode.SUCCESS) {\n                            console.log('资源发布失败:', code);\n                        }\n                        else {\n                            console.log(\"资源发布成功\");\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    //上麦\n    RTC.prototype.enterSeat = function (index) {\n        return __awaiter(this, void 0, void 0, function () {\n            var id, that;\n            return __generator(this, function (_a) {\n                this.currentSeat = index;\n                if (this.isAnchor) {\n                    // console.log(\"用户已经在麦上\");\n                    return [2 /*return*/];\n                }\n                id = this.room.getRoomId();\n                that = this;\n                return [2 /*return*/, this.leaveRoom(id).then(function () {\n                        that.isAnchor = true;\n                        return that.joinLivingRoomAsAnchor(id);\n                    })];\n            });\n        });\n    };\n    //下麦\n    RTC.prototype.leaveSeat = function (item) {\n        return __awaiter(this, void 0, void 0, function () {\n            var id, that;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.currentSeat = null;\n                        if (!this.isAnchor) {\n                            console.log(\"已经是观众无法下麦\");\n                            return [2 /*return*/];\n                        }\n                        if (this.tracks) {\n                            this.tracks.destroy();\n                        }\n                        return [4 /*yield*/, this.stopCreateTrack()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.room.getRoomId()];\n                    case 2:\n                        id = _a.sent();\n                        if (item) {\n                            return [2 /*return*/, this.leaveRoom(id)];\n                        }\n                        that = this;\n                        return [2 /*return*/, this.leaveRoom(id).then(function () { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    // console.log('this.leaveRoom(id)');\n                                    that.isAnchor = false;\n                                    return [2 /*return*/, that.joinLivingRoomAsAudience(id)];\n                                });\n                            }); })];\n                }\n            });\n        });\n    };\n    //自定义音频流发布\n    RTC.prototype.createTrack = function (item) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, code, tracks, re;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this.isAnchor) {\n                            console.log('非主播不能发布自定义音频流');\n                            return [2 /*return*/];\n                        }\n                        return [4 /*yield*/, this.body.createLocalFileTracks('tag', // track 标识\n                            item, // 网络资源 url 地址或者file 实例\n                            {\n                                withoutAudio: false,\n                                withoutVideo: true, // 当值为 true 时将不产生视轨，默认为 false\n                            })];\n                    case 1:\n                        _a = _b.sent(), code = _a.code, tracks = _a.tracks;\n                        console.log('createLocalFileTracks.code', code);\n                        // console.log('createLocalFileTracks.tracks', tracks,);\n                        this.musicTracks = tracks;\n                        if (!this.isDisable) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.room.publish(__spreadArray([], tracks, true))];\n                    case 2:\n                        re = _b.sent();\n                        return [3 /*break*/, 5];\n                    case 3: return [4 /*yield*/, this.room.publish(__spreadArray(__spreadArray([], tracks, true), [this.tracks], false))];\n                    case 4:\n                        re = _b.sent();\n                        _b.label = 5;\n                    case 5:\n                        console.log('发布自定义音频流发布', re.code);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RTC.prototype.stopCreateTrack = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var code;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.isAnchor) {\n                            console.log('非主播不能操作自定义音频流');\n                            return [2 /*return*/];\n                        }\n                        if (!this.musicTracks) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.room.unpublish(this.musicTracks)];\n                    case 1:\n                        code = (_a.sent()).code;\n                        this.musicTracks[0].destroy();\n                        console.log('停止发布自定义音频流', code);\n                        _a.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    //兼容mac火狐不能自动播放问题\n    RTC.prototype.preview = function (videoNode) {\n        return __awaiter(this, void 0, void 0, function () {\n            var o;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.body.createCameraVideoTrack('RongCloudRTC')];\n                    case 1:\n                        o = _a.sent();\n                        return [2 /*return*/, o.track.play(videoNode)];\n                }\n            });\n        });\n    };\n    //兼容mac火狐不能自动播放问题\n    RTC.prototype.audioPlay = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this.audioTrack || this.audioTrack.length == 0)\n                    return [2 /*return*/];\n                return [2 /*return*/, this.audioTrack.play()];\n            });\n        });\n    };\n    return RTC;\n}(_structure_modules__WEBPACK_IMPORTED_MODULE_0__.default));\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RTC);\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./src/modules/rtc/index.ts?");

/***/ }),

/***/ "./src/structure/modules.ts":
/*!**********************************!*\
  !*** ./src/structure/modules.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ \"./node_modules/events/events.js\");\n/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _loger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../loger */ \"./src/loger.ts\");\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n\n\nvar Module = /** @class */ (function (_super) {\n    __extends(Module, _super);\n    function Module() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Module.prototype.init = function (d) {\n        if (d === void 0) { d = null; }\n        _loger__WEBPACK_IMPORTED_MODULE_1__.default.log(\"default init: \" + this.name + \":\" + this.name, d);\n    };\n    Module.prototype.input = function (d) {\n        _loger__WEBPACK_IMPORTED_MODULE_1__.default.log(\"default input: \" + this.name + \":\" + this.name, d);\n    };\n    Module.prototype.start = function () {\n        _loger__WEBPACK_IMPORTED_MODULE_1__.default.log(\"default start: \" + this.name);\n    };\n    Module.prototype.stop = function () {\n        _loger__WEBPACK_IMPORTED_MODULE_1__.default.log(\"default stop: \" + this.name);\n    };\n    Module.prototype.cancel = function () {\n        _loger__WEBPACK_IMPORTED_MODULE_1__.default.log(\"default cancel\" + this.name);\n    };\n    Module.prototype.reboot = function () {\n        var _this = this;\n        switch (this.states) {\n            case 1: //就绪.\n                _loger__WEBPACK_IMPORTED_MODULE_1__.default.log(\"no Err please check code.\");\n                break;\n            case 2: //占用中.\n                _loger__WEBPACK_IMPORTED_MODULE_1__.default.log(this.name + ' is on using. try reboot.');\n                setTimeout(function () {\n                    _this.cancel();\n                }, 0);\n            default:\n                _loger__WEBPACK_IMPORTED_MODULE_1__.default.log(\"unknowStates at rebooting.\" + this.name);\n                break;\n        }\n    };\n    Module.prototype.reinit = function () {\n        var _this = this;\n        console.log(\"reiniting\");\n        var initpro = new Promise(function (resolve, reject) {\n            _this.init(1);\n        });\n        initpro.then(function (resolve) {\n            var o = {\n                from: _this.name,\n                to: \"main\",\n                data: \"reboot\",\n            };\n            _this.emit(\"output\", o);\n            console.log(\"重启成功!\");\n        });\n        initpro.catch(function (e) {\n            _loger__WEBPACK_IMPORTED_MODULE_1__.default.error(e, \"5\", _this, \"01\", \"重启失败放弃吧少年\");\n        });\n    };\n    return Module;\n}(events__WEBPACK_IMPORTED_MODULE_0__.EventEmitter));\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Module);\n\n\n//# sourceURL=webpack://@rongcloud/rcvoiceroomlib-v1/./src/structure/modules.ts?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.ts");
/******/ 	
/******/ 	return __webpack_exports__;
/******/ })()
;
});