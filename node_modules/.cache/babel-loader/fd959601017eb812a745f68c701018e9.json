{"remainingRequest":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/thread-loader/dist/cjs.js!/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/babel-loader/lib/index.js!/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/eslint-loader/index.js??ref--13-0!/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/src/utils/utils.js","dependencies":[{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/src/utils/utils.js","mtime":1648104828611},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/babel.config.js","mtime":1648104828534},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9jdWlmZW5nYm8vd29yay9SQ1JUQy1HaXQvcmNydGMtd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lLmpzIjsKaW1wb3J0ICogYXMgUmVjb3JkUlRDIGZyb20gInJlY29yZHJ0YyI7CmltcG9ydCByZXF1ZXN0IGZyb20gIi4uL3JlcXVlc3QvaW5kZXgiOwppbXBvcnQgY29uZmlnIGZyb20gJy4uL2NvbmZpZyc7IC8vaW1wb3J0IHsgaW52b2tlU2F2ZUFzRGlhbG9nIH0gZnJvbSAicmVjb3JkcnRjIgoKZnVuY3Rpb24gR2V0UXVlcnlTdHJpbmcobmFtZSkgewogIGlmICghd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoIj8iKVsxXSkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIHF1ZXJ5ID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoIj8iKVsxXTsKICB2YXIgdmFycyA9IHF1ZXJ5LnNwbGl0KCImIik7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgdmFycy5sZW5ndGg7IGkrKykgewogICAgdmFyIHBhaXIgPSB2YXJzW2ldLnNwbGl0KCI9Iik7CgogICAgaWYgKHBhaXJbMF0gPT0gbmFtZSkgewogICAgICByZXR1cm4gcGFpclsxXTsKICAgIH0KICB9CgogIHJldHVybjsKfQoKdmFyIHJlY29yZGVyOwp2YXIgc3RtOwp2YXIgUmVjb3JkZXIgPSB7CiAgc3RhdHVzOiAwLAogIHN0YXJ0OiBmdW5jdGlvbiBzdGFydCgpIHsKICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHsKICAgICAgYXVkaW86IHRydWUKICAgIH0pLnRoZW4oIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHN0cmVhbSkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJlY29yZGVyID0gUmVjb3JkUlRDKHN0cmVhbSwgewogICAgICAgICAgICAgICAgICB0eXBlOiAnYXVkaW8nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHN0bSA9IHN0cmVhbTsKICAgICAgICAgICAgICAgIHJlY29yZGVyLnN0YXJ0UmVjb3JkaW5nKCk7CiAgICAgICAgICAgICAgICByZWNvcmRlci5zdGF0VGltZSA9IG5ldyBEYXRlKCk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKSk7CiAgfSwKICBjYW5jZWw6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgIHJlY29yZGVyLnN0b3BSZWNvcmRpbmcoZnVuY3Rpb24gKCkge30pOwogICAgc3RtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7CiAgICAgIHJldHVybiB0cmFjay5zdG9wKCk7CiAgICB9KTsKICB9LAogIHN0b3A6IGZ1bmN0aW9uIHN0b3AodXNlcikgewogICAgcmVjb3JkZXIuc3RvcFJlY29yZGluZyhmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBibG9iID0gcmVjb3JkZXIuZ2V0QmxvYigpOwogICAgICBibG9iLmxhc3RNb2RpZmllZERhdGUgPSBuZXcgRGF0ZSgpOwogICAgICBibG9iLm5hbWUgPSAiZmlsZU5hbWUiOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWYKCiAgICAgIHZhciBmaWxlID0gbmV3IEZpbGUoW2Jsb2JdLCAicmVjLm1wMyIsIHsKICAgICAgICB0eXBlOiAibXAzIiwKICAgICAgICBsYXN0TW9kaWZpZWQ6IERhdGUubm93KCkKICAgICAgfSk7CiAgICAgIHJlcXVlc3QudXBsb2FkZmlsZShmaWxlKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PSAxMDAwMCkgewogICAgICAgICAgY29uc29sZS5sb2coIuS4iuS8oOaIkOWKn+WcsOWdgO+8miIsIGNvbmZpZy5waWNQYXRoLCByZXMuZGF0YS5kYXRhKTsKICAgICAgICAgIHZhciBjb250ZW50ID0gewogICAgICAgICAgICBfZHVyYXRpb246IE1hdGguZmxvb3IoKGJsb2IubGFzdE1vZGlmaWVkRGF0ZSAtIHJlY29yZGVyLnN0YXRUaW1lKSAvIDEwMDAgKyAxKSArICIiLAogICAgICAgICAgICBfcGF0aDogY29uZmlnLnBpY1BhdGggKyByZXMuZGF0YS5kYXRhLAogICAgICAgICAgICBfdXNlcklkOiB1c2VyLnVzZXJJZCwKICAgICAgICAgICAgX3VzZXJOYW1lOiB1c2VyLnVzZXJOYW1lCiAgICAgICAgICB9OwogICAgICAgICAgdXNlci5pbS5tZXNzYWdlVXBkYXRlKCJSQzpWUlZvaWNlTXNnIiwgY29udGVudCk7CiAgICAgICAgICB2YXIgdm9pY2VNc2c7CiAgICAgICAgICB2b2ljZU1zZyA9ICI8c3BhbiBzdHlsZT0nY29sb3I6IzdmN2Y3ZicgPiIgKyBjb250ZW50Ll91c2VyTmFtZSArICIgPC9zcGFuPiIgKyAiPHNwYW4gaGVpZ2h0OiAyMnB4O2JhY2tncm91bmQ6IG5vbmU7Ym9yZGVyLXJhZGl1czogNHB4OyBib3JkZXI6IDFweCBzb2xpZDsgY29sb3I6ICM2NjY7IG9uY2xpY2s9XCJuZXcgQXVkaW8oJyIgKyBjb250ZW50Ll9wYXRoICsgIicpLnBsYXkoKTtcIj4iICsgY29udGVudC5fZHVyYXRpb24gKyAiJyAiICsgIjxzcGFuICBzdHlsZT0nd2lkdGg6MjBweDtoZWlnaHQ6MjBweDtkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW4tYm90dG9tOi01cHg7YmFja2dyb3VuZC1pbWFnZTogdXJsKCIgKyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWYKICAgICAgICAgIHJlcXVpcmUoIi4uL2Fzc2V0cy9saXZlL2ljb24tdm9pY2UucG5nIikgKyAiKTsgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjtiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0O2JhY2tncm91bmQtc2l6ZToxNHB4IDE0cHgnPjwvc3Bhbj4iICsgIjwvc3Bhbj4iOwogICAgICAgICAgdXNlci5jaGF0cm9vbS5wdXNoKHZvaWNlTXNnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coIuS4iuS8oOmUmeivr+S6hiIsIHJlcyk7CiAgICAgICAgfQoKICAgICAgICBzdG0uZ2V0VHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHsKICAgICAgICAgIHJldHVybiB0cmFjay5zdG9wKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgfQp9OwpleHBvcnQgeyBHZXRRdWVyeVN0cmluZywgUmVjb3JkZXIgfTs="},{"version":3,"sources":["/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/src/utils/utils.js"],"names":["RecordRTC","request","config","GetQueryString","name","window","location","href","split","query","vars","i","length","pair","recorder","stm","Recorder","status","start","navigator","mediaDevices","getUserMedia","audio","then","stream","type","startRecording","statTime","Date","cancel","stopRecording","getTracks","forEach","track","stop","user","blob","getBlob","lastModifiedDate","file","File","lastModified","now","uploadfile","res","data","code","console","log","picPath","content","_duration","Math","floor","_path","_userId","userId","_userName","userName","im","messageUpdate","voiceMsg","require","chatroom","push"],"mappings":"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","sourcesContent":["\nimport * as RecordRTC from \"recordrtc\"\nimport request from \"../request/index\";\nimport config from '../config'\n//import { invokeSaveAsDialog } from \"recordrtc\"\nfunction GetQueryString(name) {\n    if (!window.location.href.split(\"?\")[1]) {\n        return;\n    }\n    var query = window.location.href.split(\"?\")[1]\n    var vars = query.split(\"&\");\n    for (var i = 0; i < vars.length; i++) {\n        var pair = vars[i].split(\"=\");\n        if (pair[0] == name) { return pair[1]; }\n    }\n    return\n}\n\nlet recorder;\nlet stm;\nlet Recorder = {\n    status: 0,\n    start: function () {\n        navigator.mediaDevices.getUserMedia({\n            audio: true\n        }).then(async function (stream) {\n            recorder = RecordRTC(stream, {\n                type: 'audio'\n            });\n            stm = stream;\n            recorder.startRecording();\n            recorder.statTime = new Date();\n        });\n    },\n    cancel: function () {\n        recorder.stopRecording(function () { });\n        stm.getTracks().forEach(track => track.stop());\n    },\n    stop: function (user) {\n        recorder.stopRecording(function () {\n            let blob = recorder.getBlob();\n            blob.lastModifiedDate = new Date();\n            blob.name = \"fileName\";\n            // eslint-disable-next-line no-undef\n            var file = new File([blob], \"rec.mp3\", { type: \"mp3\", lastModified: Date.now() });\n\n            request.uploadfile(file).then((res) => {\n                if (res.data.code == 10000) {\n                    console.log(\"上传成功地址：\", config.picPath, res.data.data);\n                    let content = {\n                        _duration: Math.floor((blob.lastModifiedDate - recorder.statTime) / 1000 + 1) + \"\",\n                        _path: config.picPath + res.data.data,\n                        _userId: user.userId,\n                        _userName: user.userName\n                    }\n                    user.im.messageUpdate(\"RC:VRVoiceMsg\", content);\n                    let voiceMsg;\n                    voiceMsg =\n                        \"<span style='color:#7f7f7f' >\" +\n                        content._userName +\n                        \" </span>\" +\n                        `<span height: 22px;background: none;border-radius: 4px; border: 1px solid; color: #666; onclick=\"new Audio('` +\n                        content._path +\n                        `').play();\">` +\n                        content._duration +\n                        \"' \" +\n                        \"<span  style='width:20px;height:20px;display:inline-block;margin-bottom:-5px;background-image: url(\" +\n                        // eslint-disable-next-line no-undef\n                        require(\"../assets/live/icon-voice.png\") +\n                        \");  background-position: center;background-repeat: no-repeat;background-size:14px 14px'></span>\" +\n                        \"</span>\";\n\n\n                    user.chatroom.push(voiceMsg);\n                } else {\n                    console.log(\"上传错误了\", res);\n                }\n                stm.getTracks().forEach(track => track.stop());\n            });\n        });\n    }\n}\n\nexport {\n    GetQueryString,\n    Recorder,\n}"]}]}