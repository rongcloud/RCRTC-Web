{"remainingRequest":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/src/components/ModifyUser.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/src/components/ModifyUser.vue","mtime":1648104828591},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBSZXF1ZXN0IGZyb20gIi4uL3JlcXVlc3QvaW5kZXguanMiOwppbXBvcnQgeyBidG9rZW4gfSBmcm9tICIuLi9yZXF1ZXN0L0J1c2luZXNzVG9rZW4iOwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBkaWFsb2dGb3JtVmlzaWJsZTogZmFsc2UsCiAgICAgIHZhbHVlOiAiIiwKICAgICAgcG9ydHJhaXQ6ICIiLAogICAgICBwb3J0cmFpdFVybDogIiIsCiAgICAgIGJ0b2tlbjogYnRva2VuLAogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIC8v5omT5byA5Liq5Lq65L+h5oGv57yW6L6RCiAgICBzZXRQb3B1cDogZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnZhbHVlID0gdGhpcy4kc3RvcmUuc3RhdGUudXNlckluZm8udXNlck5hbWU7CiAgICAgIHRoaXMucG9ydHJhaXQgPSB0aGlzLiRzdG9yZS5zdGF0ZS51c2VySW5mby5wb3J0cmFpdAogICAgICAgID8gdGhpcy4kc3RvcmUuc3RhdGUuZGVmYXVsdEFkZHJlc3MgKyB0aGlzLiRzdG9yZS5zdGF0ZS51c2VySW5mby5wb3J0cmFpdAogICAgICAgIDogdGhpcy4kc3RvcmUuc3RhdGUuZGVmYXVsdEF2YXRhclVybDsKICAgICAgdGhpcy5kaWFsb2dGb3JtVmlzaWJsZSA9IHRydWU7CiAgICB9LAogICAgLy/lhbPpl63kuKrkurrkv6Hmga/nvJbovpEKICAgIG9uQ2xvc2VkOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMudmFsdWUgPSAiIjsKICAgICAgdGhpcy5wb3J0cmFpdFVybCA9ICIiOwogICAgfSwKICAgIC8v54K55Ye7CiAgICB1cGRhdGVWYWx1ZTogZnVuY3Rpb24gKCkgewogICAgICBpZiAoIXRoaXMudmFsdWUpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLono3kupEgUlRDOueUqOaIt+WQjeS4jeiDveS4uuepuiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBSZXF1ZXN0LnVzZXJVcGRhdGUoewogICAgICAgIHVzZXJOYW1lOiB0aGlzLnZhbHVlLAogICAgICAgIHBvcnRyYWl0OiB0aGlzLnBvcnRyYWl0VXJsIHx8IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvLnBvcnRyYWl0LAogICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29kZSA9PSAxMDAwMCkgewogICAgICAgICAgICBjb25zdCBvYmogPSB7CiAgICAgICAgICAgICAgcG9ydHJhaXQ6IHJlc3BvbnNlLmRhdGEuZGF0YS5wb3J0cmFpdCwKICAgICAgICAgICAgICB1c2VyTmFtZTogcmVzcG9uc2UuZGF0YS5kYXRhLm5hbWUsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJ1cGRhdGVVc2VySW5mbyIsIG9iaik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgic2hvd1RvYXN0IiwgewogICAgICAgICAgICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLm1zZywKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycikgPT4gewogICAgICAgICAgY29uc29sZS5sb2coImVycjoiLCBlcnIpOwogICAgICAgIH0pOwogICAgICB0aGlzLmRpYWxvZ0Zvcm1WaXNpYmxlID0gZmFsc2U7CiAgICB9LAogICAgLy/ngrnlh7vpgIDlh7rnmbvlvZUKICAgIGxvZ091dDogZnVuY3Rpb24gKCkgewogICAgICBjb25zdCBvYmogPSB7CiAgICAgICAgYXV0aG9yaXphdGlvbjogIiIsCiAgICAgICAgaW1Ub2tlbjogIiIsCiAgICAgICAgcG9ydHJhaXQ6ICIiLAogICAgICAgIHR5cGU6ICIiLAogICAgICAgIHVzZXJJZDogIiIsCiAgICAgICAgdXNlck5hbWU6ICIiLAogICAgICB9OwogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgidXBkYXRlVXNlckluZm8iLCBvYmopOwogICAgICB0aGlzLmRpYWxvZ0Zvcm1WaXNpYmxlID0gZmFsc2U7CiAgICAgIC8vIHRoaXMuJGZvcmNlVXBkYXRlKCk7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCIvaG9tZSIpOwogICAgICB0aGlzLiRyb3V0ZXIuZ28oMCk7CiAgICB9LAogICAgLy9mb2N1c+WKqOS9nAogICAgb25PcGVuOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuJHJlZnMuZm9jdXNJbnB1dC5mb2N1cygpOwogICAgfSwKICAgIC8v5LiK5Lyg5aS05YOP5Zu+54mH5oiQ5Yqf5LmL5ZCOCiAgICBoYW5kbGVQb3B1cFN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMsIGZpbGUpIHsKICAgICAgY29uc29sZS5sb2cocmVzLCBmaWxlKTsKICAgICAgaWYgKHJlc1siY29kZSJdICYmIHJlc1siY29kZSJdID09IDEwMDAwKSB7CiAgICAgICAgdGhpcy5wb3J0cmFpdFVybCA9IHJlcy5kYXRhOwogICAgICAgIHRoaXMucG9ydHJhaXQgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUucmF3KTsKICAgICAgfQogICAgfSwKICAgIC8v5LiK5Lyg5aS05YOP5Zu+54mH5LmL5YmNCiAgICBiZWZvcmVQb3B1cFVwbG9hZChmaWxlKSB7CiAgICAgIGNvbnNvbGUubG9nKGZpbGUpOwogICAgICBjb25zdCBpc0pQRyA9IGZpbGUudHlwZSA9PT0gImltYWdlL2pwZWciIHx8ICJpbWFnZS9wbmciOwogICAgICBjb25zdCBpc0x0Mk0gPSBmaWxlLnNpemUgLyAxMDI0IC8gMTAyNCA8IDI7CgogICAgICBpZiAoIWlzSlBHKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5LiK5Lyg5aS05YOP5Zu+54mH5Y+q6IO95pivIEpQR+OAgXBuZyDmoLzlvI8hIik7CiAgICAgIH0KICAgICAgaWYgKCFpc0x0Mk0pIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLkuIrkvKDlpLTlg4/lm77niYflpKflsI/kuI3og73otoXov4cgMk1CISIpOwogICAgICB9CiAgICAgIHJldHVybiBpc0pQRyAmJiBpc0x0Mk07CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["ModifyUser.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ModifyUser.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <el-dialog\n    :visible.sync=\"dialogFormVisible\"\n    :append-to-body=\"true\"\n    class=\"popup\"\n    width=\"2.93rem\"\n    top=\"25vh\"\n    @closed=\"onClosed\"\n    @opened=\"onOpen\"\n    :center=\"true\"\n  >\n    <el-upload\n      class=\"popup-uploader\"\n      :show-file-list=\"false\"\n      :action=\"this.$store.state.uploadAddress\"\n      :headers=\"{\n        authorization: this.$store.state.userInfo.authorization,\n        BusinessToken: btoken,\n      }\"\n      :on-success=\"handlePopupSuccess\"\n      :before-upload=\"beforePopupUpload\"\n    >\n      <div\n        :style=\"{ backgroundImage: 'url(' + portrait + ')' }\"\n        class=\"avatar\"\n      ></div>\n      <div class=\"popup-change-portrait\"></div>\n    </el-upload>\n\n    <el-input\n      v-model=\"value\"\n      autocomplete=\"off\"\n      :clearable=\"true\"\n      ref=\"focusInput\"\n      :maxlength=\"10\"\n      class=\"dialog-input\"\n    ></el-input>\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button\n        class=\"dialog-footer-primary\"\n        type=\"primary\"\n        @click=\"updateValue\"\n        >保存</el-button\n      >\n      <el-button class=\"dialog-footer-default\" @click=\"logOut\"\n        >退出登录</el-button\n      >\n    </div>\n  </el-dialog>\n</template>\n<script>\nimport Request from \"../request/index.js\";\nimport { btoken } from \"../request/BusinessToken\";\n\nexport default {\n  data() {\n    return {\n      dialogFormVisible: false,\n      value: \"\",\n      portrait: \"\",\n      portraitUrl: \"\",\n      btoken: btoken,\n    };\n  },\n  methods: {\n    //打开个人信息编辑\n    setPopup: function () {\n      this.value = this.$store.state.userInfo.userName;\n      this.portrait = this.$store.state.userInfo.portrait\n        ? this.$store.state.defaultAddress + this.$store.state.userInfo.portrait\n        : this.$store.state.defaultAvatarUrl;\n      this.dialogFormVisible = true;\n    },\n    //关闭个人信息编辑\n    onClosed: function () {\n      this.value = \"\";\n      this.portraitUrl = \"\";\n    },\n    //点击\n    updateValue: function () {\n      if (!this.value) {\n        this.$message.error(\"融云 RTC:用户名不能为空\");\n        return;\n      }\n      Request.userUpdate({\n        userName: this.value,\n        portrait: this.portraitUrl || this.$store.state.userInfo.portrait,\n      })\n        .then((response) => {\n          if (response.data.code == 10000) {\n            const obj = {\n              portrait: response.data.data.portrait,\n              userName: response.data.data.name,\n            };\n            this.$store.dispatch(\"updateUserInfo\", obj);\n          } else {\n            this.$store.dispatch(\"showToast\", {\n              value: response.data.msg,\n            });\n          }\n        })\n        .catch((err) => {\n          console.log(\"err:\", err);\n        });\n      this.dialogFormVisible = false;\n    },\n    //点击退出登录\n    logOut: function () {\n      const obj = {\n        authorization: \"\",\n        imToken: \"\",\n        portrait: \"\",\n        type: \"\",\n        userId: \"\",\n        userName: \"\",\n      };\n      this.$store.dispatch(\"updateUserInfo\", obj);\n      this.dialogFormVisible = false;\n      // this.$forceUpdate();\n      this.$router.push(\"/home\");\n      this.$router.go(0);\n    },\n    //focus动作\n    onOpen: function () {\n      this.$refs.focusInput.focus();\n    },\n    //上传头像图片成功之后\n    handlePopupSuccess: function (res, file) {\n      console.log(res, file);\n      if (res[\"code\"] && res[\"code\"] == 10000) {\n        this.portraitUrl = res.data;\n        this.portrait = URL.createObjectURL(file.raw);\n      }\n    },\n    //上传头像图片之前\n    beforePopupUpload(file) {\n      console.log(file);\n      const isJPG = file.type === \"image/jpeg\" || \"image/png\";\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error(\"上传头像图片只能是 JPG、png 格式!\");\n      }\n      if (!isLt2M) {\n        this.$message.error(\"上传头像图片大小不能超过 2MB!\");\n      }\n      return isJPG && isLt2M;\n    },\n  },\n};\n</script>\n<style scoped>\n.popup {\n  font-size: 0.16rem;\n}\n.popup /deep/ .el-dialog__header {\n  padding: 0.2rem 0.2rem 0.05rem;\n}\n.popup /deep/ .el-dialog__footer {\n  padding: 0rem 0.2rem 0rem;\n}\n.popup /deep/ .el-dialog--center {\n  height: 2.84rem;\n  border-radius: 0.12rem;\n}\n.popup /deep/ .el-dialog__close {\n  font-weight: 500;\n  color: black;\n  font-size: 0.2rem;\n}\n.popup /deep/ .el-dialog__body {\n  padding: 0rem 0.2rem 0.3rem;\n  text-align: center;\n}\n.dialog-input /deep/ input {\n  background-color: #f3f4f5;\n  width: 2.33rem;\n  border: 0;\n}\n.popup-change-portrait {\n  width: 0.2rem;\n  height: 0.2rem;\n  border-radius: 50%;\n  background-repeat: no-repeat;\n  background-size: 0.2rem 0.2rem;\n  background-position: center;\n  background-image: url(../assets/home/changeportrait.png);\n  position: absolute;\n  top: 0.73rem;\n  right: 1.1rem;\n}\n.popup-uploader {\n  text-align: center;\n  width: 100%;\n  margin-bottom: 0.23rem;\n}\n\n.popup-uploader /deep/ .el-upload {\n  width: 0.7rem;\n  height: 0.7rem;\n  border-radius: 50%;\n  border: 1px solid;\n}\n\n.dialog-footer {\n  position: relative;\n  text-align: center;\n}\n.dialog-footer-primary {\n  width: 2.33rem;\n  margin-left: 0;\n  font-size: 0.17rem;\n  font-weight: 400;\n  background-color: #7983fe;\n  border-color: #7983fe;\n}\n\n.dialog-footer-default {\n  margin-top: 0.15rem;\n  margin-left: 0 !important;\n  border: 0;\n  font-size: 0.15rem;\n  font-weight: 400;\n  color: #020037;\n  padding: 0;\n  width: 0.6rem;\n  height: 0.21rem;\n  line-height: 0.21rem;\n}\n.avatar {\n  width: 0.7rem;\n  height: 0.7rem;\n  border-radius: 50%;\n  display: block;\n  background-repeat: no-repeat;\n  background-size: cover;\n  background-position: center;\n}\n</style>"]}]}