{"remainingRequest":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/src/pages/live/index.vue?vue&type=style&index=0&id=dde7b01a&scoped=true&lang=css&","dependencies":[{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/src/pages/live/index.vue","mtime":1648439450932},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cuifengbo/work/RCRTC-Git/rcrtc-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCB1cmwoIi4vaW5kZXguY3NzIik7Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAg5BA","file":"index.vue","sourceRoot":"src/pages/live","sourcesContent":["<template>\n  <div class=\"liveroom\">\n    <el-dialog title=\"提示\" :visible.sync=\"qiutConfirm\" width=\"80%\" center>\n      <span>确定结束本次直播吗？</span>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"qiutConfirm = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"stopCast\">确 定</el-button>\n      </span>\n    </el-dialog>\n    <roomBack ref=\"RoomBack\" @RoomBackClose=\"onRoomBackClose\" />\n    <RoomFit ref=\"RoomFit\" :RoomFitItemList=\"RoomFitItemList\" />\n    <Notice ref=\"Notice\" />\n    <UserList\n      ref=\"UserList\"\n      @onCloseUserList=\"onCloseUserList\"\n      @onClickUserList=\"onClickUserList\"\n    />\n    <ConnetWeat ref=\"ConnetWeat\" />\n    <div\n      class=\"quit\"\n      :class=\"{ menu: !isAnchor }\"\n      v-show=\"status == 2\"\n      @click=\"quitRoom()\"\n    ></div>\n    <video\n      class=\"videocontainer\"\n      :class=\"{ fliped: isAnchor }\"\n      width=\"100%\"\n      height=\"100%\"\n      ref=\"video\"\n    ></video>\n    <video\n      class=\"videoInVideo\"\n      :class=\"{\n        noshow:\n          this.$RCLiveRoomLib.seatInfoList[1] &&\n          this.$RCLiveRoomLib.seatInfoList[1].userId != '',\n      }\"\n      width=\"93px\"\n      height=\"166px\"\n      ref=\"videoInVideo\"\n      @click=\"minvideoClicked\"\n    ></video>\n    <liveCreate v-if=\"status == 0\" @startShow=\"startShow\" />\n    <liveTitle\n      :title=\"userName\"\n      :userAvatar=\"userAvatar\"\n      :isAnchor=\"isAnchor\"\n      :delay=\"delay\"\n      :giftNum=\"this.$store.state.giftNum\"\n      @clickNotice=\"clickNotice\"\n      v-if=\"status == 2\"\n    />\n\n    <liveAudience\n      v-if=\"status == 2\"\n      @audienceList=\"audienceList\"\n      :num=\"this.$store.state.roomUserList.length\"\n    />\n    <videoBox :status=\"0\" :size=\"50\" v-if=\"false\" />\n    <liveChat\n      ref=\"chatroom\"\n      v-show=\"status == 2\"\n      @nameClick=\"nameClick\"\n      @onGiftMsg=\"onGiftMsg\"\n      :top=\"50\"\n      :height=\"40\"\n    />\n    <!-- <roomUi /> -->\n    <liveQuitSeat\n      v-if=\"quitMic\"\n      @quit=\"qiutMicAction\"\n      @cancel=\"quitMic = false\"\n    >\n    </liveQuitSeat>\n    <CancelEvenSeat ref=\"CancelEvenSeat\" :roomType=\"'live'\" />\n    <UserCard />\n    <bottomBar\n      v-if=\"!showGift && status == 2\"\n      @msgOut=\"msgOut\"\n      @btnGift=\"btnGift\"\n      @ApplyWeatModel=\"ConnectMic\"\n      @ApplyWeat=\"ApplyWeat\"\n      @SetupModel=\"ConnectOperation\"\n      @quitSeat=\"quitSeat\"\n      ref=\"bottomBar\"\n    ></bottomBar>\n    <!-- <div class=\"input\">\n      <input class=\"inputer\" @keydown=\"keydown\" type=\"text\" v-model=\"msg\" />\n    </div> -->\n\n    <giftPanel\n      @hideGift=\"hideGift\"\n      @sendGiftSuccess=\"sendGiftSuccess\"\n      :isActive=\"showGift\"\n      :roomId=\"roomId\"\n      ref=\"giftPanel\"\n    ></giftPanel>\n  </div>\n</template>\n\n<script>\nimport liveTitle from \"../../components/baseUi/liveTitle.vue\";\nimport liveCreate from \"../../components/baseUi/liveCreate.vue\";\nimport liveChat from \"../../components/baseUi/liveChat.vue\";\nimport bottomBar from \"../../components/baseUi/bottomBar.vue\";\nimport giftPanel from \"../../components/baseUi/giftPanel.vue\";\nimport videoBox from \"../../components/baseUi/videoBox.vue\";\nimport liveAudience from \"../../components/baseUi/liveAudience.vue\";\nimport liveQuitSeat from \"../../components/baseUi/liveQuitSeat.vue\";\nimport CancelEvenSeat from \"../../components/room/CancelEvenSeat.vue\";\n\nimport roomBack from \"../../components/room/RoomBack.vue\";\nimport ConnetWeat from \"../../components/room/ConnetWeat.vue\";\nimport RoomFit from \"../../components/RoomFit.vue\";\nimport Notice from \"../../components/room/Notice.vue\";\nimport UserList from \"../../components/room/UserList.vue\";\nimport UserCard from \"../../components/baseUi/userCard.vue\";\n\nimport { GetQueryString } from \"../../utils/utils\";\nimport Request from \"../../request/index.js\";\nimport config from \"../../config\";\n\n// import CallRoom from \"./callRoom/index.vue\";\n// import PopupInput from \"../../components/PopupInput.vue\";\n\nexport default {\n  name: \"Roomlive\",\n  data: function () {\n    return {\n      // msg: \"ccc\",\n      videoNode: this.$refs.video,\n      miniNode: this.$refs.videoInVideo,\n      showGift: false,\n\n      isAnchor: false,\n      status: 2, // 0 主播开播 1 主播模式 2 观众模式\n      newroom: false, //是否新建房间\n      roomId: \"\", //本房间id\n      userAvatar: \"\", //主播头像\n      userName: \"\", //主播名字\n      roomName: \"\", //房间名字\n      delay: 0, //房间延迟\n      userId: \"\", //主播的id\n      giftNum: 0, //当前主播收到的礼物总量\n      isPrivate: \"\", //是否私密\n\n      seatInfoList: [], //麦位信息\n      userlist: {}, //进入过房间的用户列表\n      RoomFitItemList: [],\n      qiutConfirm: false, //主播退出确认\n      quitMic: false, //展示下麦界面\n      defaultAvatarUrl:\n        \"https://cdn.ronghub.com/demo/default/rce_default_avatar.png\",\n      defaultAddress: config.picPath,\n    };\n  },\n  components: {\n    liveCreate,\n    liveTitle,\n    videoBox,\n    liveChat,\n    bottomBar,\n    giftPanel,\n    liveAudience,\n    roomBack,\n    ConnetWeat,\n    RoomFit,\n    Notice,\n    liveQuitSeat,\n    CancelEvenSeat,\n    UserList,\n    UserCard,\n  },\n  methods: {\n    //创建房间\n    init: function () {\n      console.log(\"初始化房间 \");\n      this.$data.seatInfoList = this.$RCLiveRoomLib.seatInfoList; //更新麦位信息\n      this.getRoominformation();\n      this.getUserList();\n      this.$RCLiveRoomLib.on(\"RtcRtt\", (RtcRtt) => {\n        this.$data.delay = RtcRtt;\n      });\n    },\n    ConnectMic: function () {\n      this.$refs.ConnetWeat.openConnetWheat(false);\n    },\n    //打开公告\n    clickNotice: function () {\n      console.log(this.$RCLiveRoomLib);\n      this.$refs.Notice.setPopup({\n        isShow: false,\n        value: this.$RCLiveRoomLib.im._roomNotice\n          ? this.$RCLiveRoomLib.im._roomNotice\n          : \"欢迎来到 \" + this.$store.state.roomTitle,\n      });\n    },\n    onCloseUserList: function () {\n      console.log(\"onCloseUserList\");\n    },\n    onClickUserList: function () {\n      console.log(\"onClickUserList\");\n    },\n    minvideoClicked: function () {\n      if (\n        this.$RCLiveRoomLib.im.seatInfoList &&\n        this.$RCLiveRoomLib.im.seatInfoList[1] &&\n        this.$RCLiveRoomLib.im.seatInfoList[1].userId != \"\"\n      ) {\n        //1号麦位上有人\n        this.$data.quitMic = true;\n      }\n    },\n    audienceList: function () {\n      Request.roomuser({\n        roomId: this.$RCLiveRoomLib._roomidcli,\n      }).then((res) => {\n        console.log(res);\n        this.$store.dispatch(\"getRoomUserList\", res.data.data);\n      });\n      this.houseFilter = 5;\n      this.$refs.UserList.openUserList();\n    },\n    getRoominformation: function () {\n      Request.roominformation({ roomId: this.$RCLiveRoomLib._roomidcli })\n        .then((res) => {\n          if (res.data.code == 10000) {\n            this.$store.dispatch(\"getRoomInformation\", res.data.data);\n            this.$store.dispatch(\n              \"getroomBackground\",\n              res.data.data.backgroundUrl\n            );\n\n            this.$data.roomName = res.data.data.roomName;\n            this.$store.dispatch(\"getroomTitle\", res.data.data.roomName);\n            this.$store.dispatch(\"getroomPrivate\", {\n              isPrivate: res.data.data.isPrivate,\n              password: res.data.data.password,\n            });\n            this.$refs.chatroom.welcome();\n            this.$data.userlist[res.data.data.createUser.userId] =\n              res.data.data.createUser;\n\n            if (res.data.data.createUser.portrait) {\n              console.log(\"应用了头像\", this.$data.defaultAvatarUrl);\n              this.$data.userAvatar =\n                this.$data.defaultAddress + res.data.data.createUser.portrait;\n            } else {\n              console.log(\"应用了默认头像\", this.$data.defaultAvatarUrl);\n              this.$data.userAvatar = this.$data.defaultAvatarUrl;\n            }\n            this.$data.userName = res.data.data.createUser.userName;\n            this.$data.userId = res.data.data.createUser.userId;\n            if (\n              this.$store.state.userInfo.userId ==\n              res.data.data.createUser.userId\n            ) {\n              this.$store.state.creatUser = true;\n            }\n            console.log(\"state\", this.$store.state.userInfo.userId);\n          } else {\n            console.log(\"err\", res.data);\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    },\n    getUserList: function () {\n      Request.roomuser({\n        roomId: this.$RCLiveRoomLib._roomidcli,\n      }).then((res) => {\n        console.log(\"当前房间用户\", res);\n        this.$store.dispatch(\"getRoomUserList\", res.data.data);\n        for (var i = 0; i < res.data.data.length; i++) {\n          this.$data.userlist[res.data.data[i].userId] = res.data.data[i];\n        }\n        this.getGiftAndMan();\n      });\n    },\n    //获取gift和管理员\n    getGiftAndMan: function () {\n      console.log(\"getGiftAndMan called\");\n      Promise.all([this.getGiftList(), this.getManageList()])\n        .then((res) => {\n          console.log(res);\n          if (this.$RCLiveRoomLib.im.userId in res[1][\"ManageObj\"]) {\n            this.$store.dispatch(\"setRoomAdmin\", true);\n          } else {\n            this.$store.dispatch(\"setRoomAdmin\", false);\n          }\n          // // console.log(this.$store.state.roomUserList);\n          this.$nextTick(() => {\n            let Obj = {};\n            for (let i = 0; i < res.length; i += 1) {\n              Obj = {\n                ...Obj,\n                ...res[i],\n              };\n            }\n            this.GiftAndManageList = {\n              ...Obj,\n            };\n            this.$store.dispatch(\"getGiftAndManageList\", Obj);\n            // console.log(Obj);\n            this.SetSeatList(Obj);\n          });\n        })\n        .catch((err) => {\n          console.log(\"err\", err);\n        });\n    },\n    //设置座位List\n    SetSeatList: async function (resValue) {\n      console.log(\"GiftAndManageList:\", resValue);\n      this.houserMap = {};\n      let roomUserListMap = {};\n      this.itemList = [];\n\n      if (this.$store.state.roomUserList.length == 0) {\n        return;\n      }\n\n      console.log(this.$RCLiveRoomLib.seatInfoList);\n      if (!this.$RCLiveRoomLib.seatInfoList[0]) {\n        this.$RCLiveRoomLib.seatInfoList[0] = {\n          ...this.seatInfo,\n        };\n\n        // this.$RCLiveRoomLib.seatInfoList[0] = JSON.parse(\n        //   JSON.stringify(this.seatInfo)\n        // );\n        this.$RCLiveRoomLib.seatInfoList[0][\"status\"] = 1;\n        this.$RCLiveRoomLib.seatInfoList[0][\"userId\"] =\n          this.$store.state.roomInformation.createUser.userId;\n        // this.$RCLiveRoomLib.seatInfoList[0]['portrait']=this.$store.state.roomInformation.createUser.portrait\n      }\n      console.log(this.$RCLiveRoomLib.seatInfoList[0]);\n      for (let m = 0; m < this.$store.state.roomUserList.length; m += 1) {\n        roomUserListMap[this.$store.state.roomUserList[m][\"userId\"]] =\n          this.$store.state.roomUserList[m];\n      }\n\n      if (this.$RCLiveRoomLib.seatInfoList[0][\"mute\"] != !this.OwerMute) {\n        this.OwerMute = !this.$RCLiveRoomLib.seatInfoList[0][\"mute\"];\n      }\n\n      if (\n        this.$RCLiveRoomLib.seatInfoList[0][\"userId\"] &&\n        this.$RCLiveRoomLib.seatInfoList[0][\"userId\"] in roomUserListMap\n      ) {\n        this.houserMap = {\n          ...roomUserListMap[this.$RCLiveRoomLib.seatInfoList[0][\"userId\"]],\n        };\n      }\n\n      if (\n        this.$RCLiveRoomLib.seatInfoList[0][\"userId\"] &&\n        this.$RCLiveRoomLib.seatInfoList[0][\"userId\"] in resValue.GiftObj\n      ) {\n        this.houserMap = {\n          ...this.houserMap,\n          gift: resValue.GiftObj[this.$RCLiveRoomLib.seatInfoList[0][\"userId\"]],\n        };\n      }\n\n      this.houserMap = {\n        ...this.houserMap,\n        ...this.$RCLiveRoomLib.seatInfoList[0],\n      };\n\n      let arr = [];\n      // console.log(\n      //   \"this.$RCLiveRoomLib.roomInfo\",\n      //   this.$RCLiveRoomLib.roomInfo\n      // );\n      let seatCountNumber = 9;\n\n      for (let p = 1; p < seatCountNumber; p += 1) {\n        let OtherMap = {};\n        if (\n          this.$RCLiveRoomLib.seatInfoList[p] &&\n          this.$RCLiveRoomLib.seatInfoList[p][\"userId\"]\n        ) {\n          if (\n            this.$RCLiveRoomLib.seatInfoList[p][\"userId\"] in roomUserListMap\n          ) {\n            OtherMap = {\n              ...roomUserListMap[this.$RCLiveRoomLib.seatInfoList[p][\"userId\"]],\n            };\n          }\n\n          if (\n            this.$RCLiveRoomLib.seatInfoList[p][\"userId\"] in resValue.ManageObj\n          ) {\n            OtherMap = {\n              ...OtherMap,\n              isAdmin: true,\n            };\n          }\n\n          if (\n            this.$RCLiveRoomLib.seatInfoList[p][\"userId\"] in resValue.GiftObj\n          ) {\n            OtherMap = {\n              ...OtherMap,\n              gift: resValue.GiftObj[\n                this.$RCLiveRoomLib.seatInfoList[p][\"userId\"]\n              ],\n            };\n          }\n        }\n\n        if (this.$RCLiveRoomLib.seatInfoList[p]) {\n          arr.push({\n            ...OtherMap,\n            ...this.$RCLiveRoomLib.seatInfoList[p],\n            index: p,\n          });\n        } else {\n          this.$RCLiveRoomLib.seatInfoList[p] = {\n            ...this.seatInfo,\n          };\n          arr.push({\n            ...OtherMap,\n            ...this.seatInfo,\n            index: p,\n          });\n        }\n      }\n      for (let index = 0; index < arr.length; index += 1) {\n        if (this.$RCLiveRoomLib.im.userId == arr[index].userId) {\n          this.$store.dispatch(\"updateuserInseat\", true);\n          break;\n        }\n        if (index == arr.length - 1) {\n          this.$store.dispatch(\"updateuserInseat\", false);\n        }\n      }\n      this.itemList = arr;\n      this.$store.dispatch(\"updateItemList\", arr);\n\n      //  console.log(this.$RCLiveRoomLib.seatInfoList);\n      // console.log(\"OtherList\", arr);\n      // console.log(\"this.houserMap\", this.houserMap);\n    },\n    //房主设置状态控制\n    ConnectOperation: function () {\n      // console.log(this.$RCLiveRoomLib.roomInfo);\n      // const RoomFitList = JSON.parse(JSON.stringify(RoomFitItemList));\n      const RoomFitList = [\n        {\n          value: \"房间上锁\",\n          // eslint-disable-next-line no-undef\n          img: \"url(\" + require(\"../../assets/roomicon/LockRoon.png\") + \")\",\n        },\n        {\n          value: \"房间标题\",\n          // eslint-disable-next-line no-undef\n          img: \"url(\" + require(\"../../assets/roomicon/RoomTitle.png\") + \")\",\n        },\n        {\n          value: \"房间公告\",\n          // eslint-disable-next-line no-undef\n          img: \"url(\" + require(\"../../assets/roomicon/RoomNotice.png\") + \")\",\n        },\n        {\n          value: \"屏蔽词\",\n          img:\n            // eslint-disable-next-line no-undef\n            \"url(\" + require(\"../../assets/roomicon/ShieldingWords.png\") + \")\",\n        },\n      ];\n\n      // console.log(this.$store.state.roomPrivate);\n      if (this.$store.state.roomPrivate.isPrivate == 1) {\n        RoomFitList[0] = {\n          value: \"房间解锁\",\n          img:\n            // eslint-disable-next-line no-undef\n            \"url(\" + require(\"../../assets/roomicon/UnLockRoom.png\") + \")\",\n        };\n      }\n      console.log(\"构建：\", this.$store.state.isFreeEnterSeat);\n      if (this.$store.state.isFreeEnterSeat) {\n        RoomFitList.push({\n          value: \"申请上麦\",\n          img:\n            // eslint-disable-next-line no-undef\n            \"url(\" + require(\"../../assets/roomicon/BApplyWheat.png\") + \")\",\n        });\n      } else {\n        RoomFitList.push({\n          value: \"自由上麦\",\n          img:\n            // eslint-disable-next-line no-undef\n            \"url(\" + require(\"../../assets/roomicon/BFreeWheat.png\") + \")\",\n        });\n      }\n      this.RoomFitItemList = RoomFitList;\n      // console.log(this.RoomFitItemList);\n      this.$refs.RoomFit.openRoomFit();\n    },\n    //请求排麦与否\n    ApplyWeat: async function () {\n      if (this.$store.state.HasApply) {\n        this.$refs.CancelEvenSeat.CancelEvenSeatOpen();\n      } else {\n        if (this.$RCLiveRoomLib.im._FreeEnterSeat) {\n          //自由上麦的情况\n          if (\n            this.$RCLiveRoomLib.im.seatInfoList[1] &&\n            this.$RCLiveRoomLib.im.seatInfoList[1].userId &&\n            this.$RCLiveRoomLib.im.seatInfoList[1].userId.length\n          ) {\n            console.log(this.$RCLiveRoomLib.im.seatInfoList[1]);\n            this.$store.dispatch(\"showToast\", {\n              value: \"麦位已满\",\n            });\n          } else {\n            this.$RCLiveRoomLib.requestSeat();\n            //  this.$RCLiveRoomLib.enterSeat(1);\n            this.$store.state.onLink = true;\n            this.$store.state.onMic = true;\n            return;\n          }\n        } else {\n          await this.$RCLiveRoomLib.requestSeat();\n          this.$store.dispatch(\"showToast\", {\n            value: \"已申请连线，等待房主接受\",\n          });\n          setTimeout(() => {\n            this.$store.dispatch(\"userHasApply\", true);\n          }, 50);\n        }\n      }\n      // console.log(this.$store.state.HasApply);\n    },\n    getSeatInfolist: async function () {\n      const list = await this.$RCLiveRoomLib.getLatestSeatInfo();\n      console.log(list);\n    },\n    createRoom: function () {\n      console.log(\"crtRoom===\", this.$refs.video, this.$refs.videoInVideo);\n\n      console.log(\"当前用户：\", this.$store.state);\n      this.$RCLiveRoomLib\n        .createAndJoinRoom({\n          roomId: this.$data.roomId,\n          roomName: this.$data.roomName,\n          roomType: \"live\",\n          videoNode: this.$refs.video,\n          miniNode: this.$refs.videoInVideo,\n        })\n        .then(() => {\n          this.init();\n        });\n    },\n    joinroom: function () {\n      console.log(\"sdk加入房间动作\");\n      this.$RCLiveRoomLib\n        .joinRoom({\n          roomId: GetQueryString(\"roomid\"),\n          roomType: \"live\",\n          videoNode: this.$refs.video,\n          miniNode: this.$refs.videoInVideo,\n        })\n        .then(() => {\n          this.init();\n        });\n    },\n    quitRoom: function () {\n      if (this.$data.isAnchor) {\n        this.$data.qiutConfirm = true;\n      } else {\n        let BackList  =[];\n        if(this.$store.state.onMic){//在麦位上时不允许收起房间\n          BackList = [\n            {\n              value: \"离开房间\",\n              // eslint-disable-next-line no-undef\n              img: \"url(\" + require(\"../../assets/roomicon/CloseRoom.png\") + \")\",\n            }]\n        }else{\n          BackList = [\n            {\n              value: \"收起房间\",\n              // eslint-disable-next-line no-undef\n              img: \"url(\" + require(\"../../assets/roomicon/LeaveRoom.png\") + \")\",\n            },\n            {\n              value: \"离开房间\",\n              // eslint-disable-next-line no-undef\n              img: \"url(\" + require(\"../../assets/roomicon/CloseRoom.png\") + \")\",\n            },\n          ];\n        }\n        console.log(this.$refs.RoomBack.RoomBackOpen);\n        this.$refs.RoomBack.RoomBackOpen(BackList);\n      }\n    },\n    stopCast: function () {\n      //关播\n      this.$RCLiveRoomLib.leaveRoom(this.$data.roomId).then(() => {\n        this.$RCLiveRoomLib._roomidcli = \"\";\n        this.$router.push(\"room?roomType=liveRoom\");\n      });\n    },\n    msgOut: function (msg) {\n      //本地消息\n      console.log(msg);\n      if (msg.replace(/\\s*/g, \"\").length == 0) {\n        this.$store.dispatch(\"showToast\", {\n          value: \"消息不能为空\",\n        });\n        return;\n      }\n\n      //取屏蔽词列表\n      Request.getsensitiveList({\n        roomId: this.$RCLiveRoomLib._roomidcli,\n      }).then((res) => {\n        let send = true;\n        console.log(\"屏蔽词列表\", res);\n        if (res.data.code == 10000 && res.data.data) {\n          for (let index = 0; index < res.data.data.length; index++) {\n            if (msg.indexOf(res.data.data[index][\"name\"]) != -1) {\n              send = false;\n              break;\n            }\n          }\n        }\n        if (this.$RCLiveRoomLib.im._roomShields) {\n          for (let j = 0; j < this.$RCLiveRoomLib.im._roomShields.length; j++) {\n            if (this.$RCLiveRoomLib.im._roomShields[j] == msg) {\n              send = false;\n              break;\n            }\n          }\n        }\n        let txtMsg = {\n          userName: this.$store.state.userInfo.userName, // 文本内容\n          userId: this.$store.state.userInfo.userId,\n          content: msg,\n        };\n        this.$RCLiveRoomLib.emit(\"onMessageReceived\", {\n          //发本地\n          //模拟本地消息发送\n          messageType: \"RC:Chatroom:Barrage\",\n          content: txtMsg,\n        });\n        if (send) {\n          // console.log(txtMsg);\n          this.$RCLiveRoomLib.im.messageUpdate(\"RC:Chatroom:Barrage\", txtMsg);\n        }\n      });\n    },\n    nameClick: function (e) {\n      console.log(e, \"clicked\");\n    },\n    onGiftMsg: function () {\n      setTimeout(() => {\n        this.getGiftList();\n      }, 1000);\n    },\n    //礼物更新\n    sendGiftSuccess: async function () {\n      // const gift = await this.getGiftList();\n      // console.log(gift);\n      // this.updateAdminAndGift(gift);\n    },\n    //礼物请求获取数据\n    getGiftList: function () {\n      return Request.giftList(this.$RCLiveRoomLib._roomidcli).then(\n        async (res) => {\n          let GiftObj = {};\n          if (res.data.code == 10000 && res.data.data.length > 0) {\n            for (let i = 0; i < res.data.data.length; i += 1) {\n              if (res.data.data[i][this.$data.userId]) {\n                this.$store.state.giftNum = Number(\n                  res.data.data[i][this.$data.userId]\n                );\n              }\n              GiftObj = {\n                ...GiftObj,\n                ...res.data.data[i],\n              };\n            }\n          }\n          return { GiftObj: GiftObj };\n        }\n      );\n    },\n    //获取管理员数据\n    getManageList: function () {\n      return Request.manageList({\n        roomId: this.$RCLiveRoomLib._roomidcli,\n      }).then(async (res) => {\n        let ManageObj = {};\n        if (res.data.code == 10000 && res.data.data.length > 0) {\n          for (let i = 0; i < res.data.data.length; i += 1) {\n            ManageObj[res.data.data[i][\"userId\"]] = res.data.data[i];\n          }\n        }\n        return { ManageObj: ManageObj };\n        // this.$nextTick(() => {\n        //   this.ManageObj = ManageObj;\n        // });\n      });\n    },\n    //点击送单人礼物\n    giftClick: function (item) {\n      console.log(\"item\", item);\n      if (\n        this.$store.state.roomInformation.createUser[\"userId\"] == item[\"userId\"]\n      ) {\n        item[\"creatuser\"] = true;\n      } else {\n        item[\"creatuser\"] = false;\n      }\n      this.$data.showGift = true;\n      this.$refs.giftPanel.showGift([item]);\n    },\n    //已经上麦的观众下麦\n    quitSeat: function () {\n      this.$data.quitMic = true;\n      //this.$store.state.onMic = false;\n    },\n    //下麦动作\n    qiutMicAction: function () {\n      this.$data.quitMic = false;\n      this.$store.state.onMic = false;\n      this.$store.state.onLink = false;\n      if (GetQueryString(\"isAnchor\")) {\n        //是房主踢1号麦位\n        this.$RCLiveRoomLib.updateKeyValue({\n          key: \"LIVE_VIDEO_SEAT_INFO_PRE_1\",\n          value: JSON.stringify({\n            userId: \"\",\n            mute: false,\n            userEnableVideo: true,\n            frame:\n              \"{{0.68330000000000002, 0.69059999999999999}, {0.29999999999999999, 0.16880000000000001}}\",\n            lock: false,\n            userEnableAudio: true,\n            index: 1,\n          }),\n        });\n        \n      } else {\n        this.$RCLiveRoomLib.leaveSeat(false, false);\n      }\n    },\n    btnGift: function () {\n      this.$data.showGift = true;\n      let userInseatList = [];\n      for (var i = 0; i < this.$RCLiveRoomLib.seatInfoList.length; i++) {\n        console.log(this.$RCLiveRoomLib.seatInfoList[i], this.$data.userlist);\n        if (\n          this.$RCLiveRoomLib.seatInfoList[i].userId &&\n          this.$data.userlist[this.$RCLiveRoomLib.seatInfoList[i].userId]\n        ) {\n          if (\n            this.$store.state.roomInformation.createUser[\"userId\"] ==\n            this.$data.userlist[this.$RCLiveRoomLib.seatInfoList[i].userId][\n              \"userId\"\n            ]\n          ) {\n            this.$data.userlist[this.$RCLiveRoomLib.seatInfoList[i].userId][\n              \"creatuser\"\n            ] = true;\n          } else {\n            this.$data.userlist[this.$RCLiveRoomLib.seatInfoList[i].userId][\n              \"creatuser\"\n            ] = false;\n          }\n          userInseatList.push(\n            this.$data.userlist[this.$RCLiveRoomLib.seatInfoList[i].userId]\n          );\n        }\n      }\n      console.log(\"userInseatList\", userInseatList);\n      this.$refs.giftPanel.showGift(userInseatList);\n    },\n    hideGift: function () {\n      console.log(\"hid\");\n      this.$data.showGift = false;\n    },\n    startShow: function (e) {\n      console.log(\"上报\", e);\n\n      this.$data.roomId = e.data.roomId;\n      this.$data.roomName = this.$store.state.roomTitle = e.data.roomName;\n      this.$data.userId = e.data.createUser.userId;\n      this.$data.userAvatar = e.data.createUser.portrait; //主播头像\n      this.$data.userName = e.data.createUser.userName; //主播名\n      this.$data.isPrivate = e.data.isPrivate; //是否私密\n\n      this.$data.status = 2; // 房间初始化成功\n      this.createRoom();\n    },\n    onRoomBackClose: function () {},\n  },\n  created() {\n    if (GetQueryString(\"isAnchor\")) {\n      this.$data.isAnchor = true;\n      this.$data.status = 0;\n    } else {\n      this.$data.isAnchor = false;\n    }\n\n    if (GetQueryString(\"roomid\")) {\n      // this.$data.roomId = GetQueryString(\"roomid\");\n      console.log(\"isin room\");\n      this.$data.roomId = GetQueryString(\"roomid\");\n    }\n    // this.$RCLiveRoomLib.on(\"remoteVideoTrack\", (track) => {\n    //   console.log(\"rct\", track._userId);\n    //   if (this.$data.userId == track._userId) {\n    //     console.log(\"自己的远端流\", track);\n    //     this.$refs.video && track.play(this.$refs.video);\n    //   } else {\n    //     console.log(\"非自己远端流\");\n    //     this.$refs.videoInVideo && track.play(this.$refs.videoInVideo);\n    //   }\n    // });\n    this.$store.state.giftNum = 0; //清零礼物\n  },\n  mounted() {\n    console.log(\"moted\");\n    if (this.$store.state.userInfo.imToken == \"\") {\n      console.log(\"未登录状态转到登录页面\", this.$store.state.userInfo.imToken);\n      this.$router.push(\"/login\");\n      return;\n    }\n\n    //视频节点传到sdk\n    this.$RCLiveRoomLib.rtc.body.videoNode = this.$refs.video;\n    this.$RCLiveRoomLib.rtc.body.miniNode = this.$refs.videoInVideo;\n    //聊天室组建传到store\n    this.$store.state.Chatroom = this.$refs.chatroom;\n\n    if (this.$data.isAnchor) {\n      console.log(\"主播身份\");\n    } else {\n      console.log(\"观众 身份\");\n      if (\n        this.$RCLiveRoomLib._roomidcli &&\n        this.$RCLiveRoomLib._roomidcli != \"\"\n      ) {\n        //在房间内。\n        if (this.$RCLiveRoomLib._roomidcli == GetQueryString(\"roomid\")) {\n          console.log(\"在原房间\");\n          this.$RCLiveRoomLib.rtc.body.videoNode = this.$refs.video;\n          this.$RCLiveRoomLib.rtc.body.miniNode = this.$refs.videoInVideo;\n          this.$RCLiveRoomLib.getExist();\n          this.init(); //初始化房间信息\n        } else {\n          console.log(\"新房间\");\n          this.$store.state.currentRoomId = GetQueryString(\"roomid\");\n          this.$RCLiveRoomLib\n            .leaveRoom(this.$RCLiveRoomLib._roomidcli)\n            .then(() => {\n              setTimeout(() => {\n                this.joinroom();\n              }, 1000);\n            });\n        }\n      } else {\n        console.log(\"没有加入房间观众加入房间\");\n        this.joinroom();\n      }\n    }\n\n    console.log(\"this.$store.state.Chatroom\", this.$store.state.Chatroom);\n    if (this.$data.isAnchor) {\n      tryPreview(this);\n    }\n    function tryPreview(target) {\n      if (target.$RCLiveRoomLib && target.$RCLiveRoomLib.rtcready) {\n        target.$RCLiveRoomLib.preview({\n          videoNode: target.$refs.video,\n        });\n      } else {\n        setTimeout(() => {\n          tryPreview(target);\n        }, 20);\n      }\n    }\n  },\n  beforeRouteLeave(to, from, next) {\n    console.log(\"路由\", this.$data.isAnchor);\n    if (this.$data.isAnchor) {\n      //如果是主播直接退出房间\n      this.$RCLiveRoomLib.leaveRoom(this.$data.roomId);\n      Request.deleteRoom({ roomId: this.$data.roomId });\n      this.$data.isAnchor = false;\n    }\n    this.$store.state.giftNum = 0;\n    this.$store.state.onMic = false;\n    this.$store.state.onLink = false;\n    this.$store.state.creatUser = false;\n    this.$store.state.isFreeEnterSeat = false;\n    this.$data.isAnchor = false;\n    this.$store.state.RequestSeatUserIds = [];\n    next();\n  },\n};\n</script>\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n@import url(\"./index.css\");\n</style>"]}]}