"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@rongcloud/engine"),t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var n=function(){return n=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},n.apply(this,arguments)};function o(e,t,n,o){return new(n||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}))}function s(e,t){var n,o,s,r,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(r){return function(i){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(s=2&r[0]?o.return:r[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,r[1])).done)return s;switch(o=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){a.label=r[1];break}if(6===r[0]&&a.label<s[1]){a.label=s[1],s=r;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(r);break}s[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],o=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,i])}}}var r=new e.Logger("RCIM"),a=function(){return!("undefined"==typeof uni||!function(e){for(var t=["canIUse","getSystemInfo"],n=0,o=t.length;n<o;n++)if(!e[t[n]])return!1;return!0}(uni))},i=a();var c,d={tag:"browser",httpReq:function(t){var n=t.method||e.HttpMethod.GET,o=t.timeout||6e4,s=t.headers,r=t.query,a=t.body,i=e.appendUrl(t.url,r);return new Promise((function(e){var t,r=(t="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,"undefined"!=typeof XMLHttpRequest&&t?new XMLHttpRequest:"undefined"!=typeof XDomainRequest?new XDomainRequest:new ActiveXObject("Microsoft.XMLHTTP")),c="[object XDomainRequest]"===Object.prototype.toString.call(r);if(r.open(n,i),s&&r.setRequestHeader)for(var d in s)r.setRequestHeader(d,s[d]);if(c){r.timeout=o,r.onload=function(){e({data:r.responseText,status:r.status||200})},r.onerror=function(){e({status:r.status||0})},r.ontimeout=function(){e({status:r.status||0})};var u="object"==typeof a?JSON.stringify(a):a;r.send(u)}else r.onreadystatechange=function(){4===r.readyState&&e({data:r.responseText,status:r.status})},r.onerror=function(){e({status:r.status||0})},setTimeout((function(){return e({status:r.status||0})}),o),r.send(a)}))},localStorage:null===window||void 0===window?void 0:window.localStorage,sessionStorage:null===window||void 0===window?void 0:window.sessionStorage,isSupportSocket:function(){var e="undefined"!=typeof WebSocket;return e||r.warn("websocket not support"),e},useNavi:!0,connectPlatform:"",isFromUniapp:i,createWebSocket:function(e,t){var n=new WebSocket(e,t);return n.binaryType="arraybuffer",{onClose:function(e){n.onclose=function(t){var n=t.code,o=t.reason;e(n,o)}},onError:function(e){n.onerror=e},onMessage:function(e){n.onmessage=function(t){e(t.data)}},onOpen:function(e){n.onopen=e},send:function(e){n.send(e)},close:function(e,t){n.close(e,t)}}},createDataChannel:function(t,n){return this.isSupportSocket()&&"websocket"===n?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)}},u=a(),l=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return wx[e].apply(wx,t)}catch(e){r.error(e)}}},g={setItem:l("setStorageSync"),getItem:l("getStorageSync"),removeItem:l("removeStorageSync"),clear:l("clearStorageSync")},p={tag:"wechat",httpReq:function(t){var n=t.method||e.HttpMethod.GET,o=t.timeout||6e4,s=t.headers,r=t.query,a=t.body,i=e.appendUrl(t.url,r);return new Promise((function(t){wx.request({url:i,method:n,headers:s,timeout:o,data:a,success:function(e){t({data:e.data,status:e.statusCode})},fail:function(){t({status:e.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:g,sessionStorage:g,isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:u,createWebSocket:function(e,t){var n=wx.connectSocket({url:e,protocols:t});return{onClose:function(e){n.onClose((function(t){e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){e(t.data)}))},onOpen:function(e){n.onOpen(e)},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(t,n){return"websocket"===n?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)}},f=a(),m=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return my[e].apply(my,t)}catch(e){r.error(e)}}},C={setItem:m("setStorageSync"),getItem:m("getStorageSync"),removeItem:m("removeStorageSync"),clear:m("clearStorageSync")},v={tag:"alipay",httpReq:function(t){var n=t.method||e.HttpMethod.GET,o=t.timeout||6e4,s=t.headers,r=t.query,a=t.body,i=e.appendUrl(t.url,r),c=t.dataType||"json";return new Promise((function(t){my.request({url:i,method:n,headers:s,timeout:o,data:a,dataType:c,success:function(e){t({data:e.data,status:e.status})},fail:function(){t({status:e.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:C,sessionStorage:C,isSupportSocket:function(){return!1},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:f,createDataChannel:function(t,n){return"websocket"===n?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)}},h=a(),E=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return console.log("tt",tt),tt[e].apply(tt,t)}catch(e){r.error(e)}}},S={setItem:E("setStorageSync"),getItem:E("getStorageSync"),removeItem:E("removeStorageSync"),clear:E("clearStorageSync")},I={tag:"toutiao",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:h,localStorage:S,sessionStorage:S,httpReq:function(e){return new Promise((function(t,n){tt.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(e){console.log("调用成功",e.data);var n=(null==e?void 0:e.data)||{},o={data:JSON.stringify(n),status:e.statusCode};t(o)},fail:function(e){console.log("调用失败",e.errMsg),n({data:e.errMsg})}})}))},createWebSocket:function(e,t){var n=tt.connectSocket({url:e,protocols:t});return{onOpen:function(e){n.onOpen(e)},onClose:function(e){n.onClose((function(t){return e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){return e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){return e(t.data)}))},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(t,n){return"websocket"===n?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)}},T=a(),R=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return console.log("swan",swan),swan[e].apply(swan,t)}catch(e){r.error(e)}}},y={setItem:R("setStorageSync"),getItem:R("getStorageSync"),removeItem:R("removeStorageSync"),clear:R("clearStorageSync")},A={tag:"baidu",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:T,localStorage:y,sessionStorage:y,httpReq:function(e){return new Promise((function(t,n){swan.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(e){console.log("调用成功",e.data);var n=(null==e?void 0:e.data)||{},o={data:JSON.stringify(n),status:e.statusCode};t(o)},fail:function(e){console.log("调用失败",e.errorCode),n({data:e.errorCode})}})}))},createWebSocket:function(e,t){var n=swan.connectSocket({url:e,protocols:t});return{onOpen:function(e){n.onOpen(e)},onClose:function(e){n.onClose((function(t){return e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){return e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){return e(t.data)}))},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(t,n){return"websocket"===n?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)}},N=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return uni[e].apply(uni,t)}catch(e){r.error(e)}}},x={setItem:N("setStorageSync"),getItem:N("getStorageSync"),removeItem:N("removeStorageSync"),clear:N("clearStorageSync")},M={tag:"uniapp",httpReq:function(t){var n=t.method||e.HttpMethod.GET,o=t.timeout||6e4,s=t.headers,r=t.query,a=t.body,i=e.appendUrl(t.url,r);return new Promise((function(t){uni.request({url:i,method:n,headers:s,timeout:o,data:a,success:function(e){t({data:e.data,status:e.statusCode})},fail:function(){t({status:e.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:x,sessionStorage:x,isSupportSocket:function(){return!0},useNavi:!0,connectPlatform:"",isFromUniapp:!0,createWebSocket:function(e,t){var n={complete:function(){},url:e,protocols:t},o=uni.connectSocket(n);return{onClose:function(e){o.onClose((function(t){e(t.code,t.reason)}))},onError:function(e){o.onError((function(t){e(t.errMsg)}))},onMessage:function(e){o.onMessage((function(t){e(t.data)}))},onOpen:function(e){o.onOpen(e)},send:function(e){o.send({data:e})},close:function(e,t){o.close({code:e,reason:t})}}},createDataChannel:function(t,n){return"websocket"===n?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)}},U=function(e){return e&&e.canIUse&&e.getSystemInfo},O="undefined"!=typeof uni&&U(uni)?function(){switch(process.env.VUE_APP_PLATFORM){case"app-plus":return M;case"mp-baidu":return A;case"mp-toutiao":return I;case"mp-alipay":return v;case"mp-weixin":return p;default:return d}}():"undefined"!=typeof wx&&U(wx)?p:"undefined"!=typeof my&&U(my)?v:"undefined"!=typeof tt&&U(tt)?I:"undefined"!=typeof swan&&U(swan)?A:d;function _(t){var n=t.conversationType,o=t.channelId,s=t.messageType,r=t.content,a=t.senderUserId,i=t.targetId,c=t.sentTime,d=t.receivedTime,u=t.messageUId,l=t.messageDirection,g=t.isPersited,p=t.isCounted,f=t.isOffLineMessage,m=t.canIncludeExpansion,C=t.expansion,v=t.receivedStatus,h=t.disableNotification,E=t.isMentioned,S=t.isStatusMessage,I=t.readReceiptInfo,T=t.pushConfig,R=t.messageId,y=t.isInterrupt,A=t.isModifyMessage;v||(v=e.ReceivedStatus.UNREAD);var N={messageType:s,channelId:o||"",content:r,senderUserId:a,targetId:i,conversationType:n,sentTime:c,receivedTime:d,messageUId:u,messageDirection:l,isPersited:g,isCounted:p,isMentioned:E,disableNotification:h,isStatusMessage:S,canIncludeExpansion:m,expansion:C,receivedStatus:v,readReceiptInfo:I,pushConfig:T,messageId:R,isInterrupt:y,isModifyMessage:A};return n!==e.ConversationType.ULTRA_GROUP&&(N.isOffLineMessage=f),N}exports.Events=void 0,(c=exports.Events||(exports.Events={})).CONNECTING="CONNECTING",c.CONNECTED="CONNECTED",c.DISCONNECT="DISCONNECT",c.SUSPEND="SUSPEND",c.MESSAGES="MESSAGES",c.READ_RECEIPT_RECEIVED="READ_RECEIPT_RECEIVED",c.MESSAGE_RECEIPT_REQUEST="MESSAGE_RECEIPT_REQUEST",c.MESSAGE_RECEIPT_RESPONSE="MESSAGE_RECEIPT_RESPONSE",c.CONVERSATION="CONVERSATION",c.CHATROOM="CHATROOM",c.EXPANSION="EXPANSION",c.PULL_OFFLINE_MESSAGE_FINISHED="PULL_OFFLINE_MESSAGE_FINISHED",c.TAG="TAG",c.CONVERSATION_TAG="CONVERSATION_TAG",c.TYPING_STATUS="TYPING_STATUS",c.MESSAGE_BLOCKED="MESSAGE_BLOCKED",c.ULTRA_GROUP_ENABLE="ULTRA_GROUP_ENABLE",c.OPERATE_STATUS="OPERATE_STATUS",c.ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED="ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED",c.ULTRA_GROUP_MESSAGE_MODIFIED="ULTRA_GROUP_MESSAGE_MODIFIED",c.ULTRA_GROUP_MESSAGE_RECALLED="ULTRA_GROUP_MESSAGE_RECALLED";var w,b=function(n){function o(t){var s=n.call(this)||this;if(o.imClient)return r.error("Please do not repeatedly perform the init method"),o.imClient;e.assert("options.navigators",t.navigators,(function(t){return e.isArray(t)&&(0===t.length||t.every(e.isHttpUrl))}));var a=null==t?void 0:t.connectType;return a?e.CONNECTION_TYPE.WEBSOCKET!==a&&e.CONNECTION_TYPE.COMET!==a&&(r.warn("RongIMLib connectionType must be "+e.CONNECTION_TYPE.WEBSOCKET+" or "+e.CONNECTION_TYPE.COMET),a=e.CONNECTION_TYPE.WEBSOCKET):a=e.CONNECTION_TYPE.WEBSOCKET,s._context=e.APIContext.init(O,{appkey:t.appkey,apiVersion:"5.2.1",navigators:t.navigators||[],miniCMPProxy:t.customCMP||[],connectionType:a,logLevel:t.logLevel,logStdout:t.logStdout,indexDBSwitch:t.indexDBSwitch,checkCA:t.checkCA}),s.watch(),o.imClient=s,s}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}(o,n),Object.defineProperty(o.prototype,"context",{get:function(){if(!this._context)throw new Error("Please perform the init method!");return this._context},enumerable:!1,configurable:!0}),o.prototype.watch=function(){var t=this,n={onConnecting:function(){t.emit(exports.Events.CONNECTING)},onConnected:function(){t.emit(exports.Events.CONNECTED)},onDisconnect:function(e){t.emit(exports.Events.DISCONNECT,e)},onSuspend:function(e){t.emit(exports.Events.SUSPEND,e)},batchMessage:function(e){t.emit(exports.Events.MESSAGES,{messages:e.map((function(e){return _(e)}))})},typingState:function(e){t.emit(exports.Events.TYPING_STATUS,{status:e})},readReceiptReceived:function(e,n,o){t.emit(exports.Events.READ_RECEIPT_RECEIVED,{conversation:e,messageUId:n,sentTime:o})},messageReceiptRequest:function(e,n,o){t.emit(exports.Events.MESSAGE_RECEIPT_REQUEST,{conversation:e,messageUId:n,senderUserId:o})},messageReceiptResponse:function(e,n,o){t.emit(exports.Events.MESSAGE_RECEIPT_RESPONSE,{conversation:e,receivedUserId:n,messageUIdList:o})},conversationState:function(n){var o=n.map((function(t){var n=t.conversationType;return n===e.ConversationType.ULTRA_GROUP?{conversation:{conversationType:n,latestMessage:t.latestMessage?_(t.latestMessage):null,targetId:t.targetId,unreadMessageCount:t.unreadMessageCount,unreadMentionedCount:t.unreadMentionedCount,versionTime:t.versionTime,notificationStatus:t.notificationStatus,lastUnreadTime:t.lastUnreadTime,channelId:t.channelId}}:{conversation:{conversationType:n,latestMessage:t.latestMessage?_(t.latestMessage):null,targetId:t.targetId,unreadMessageCount:t.unreadMessageCount,hasMentioned:t.hasMentioned,mentionedInfo:t.mentionedInfo,lastUnreadTime:t.lastUnreadTime,notificationStatus:t.notificationStatus,isTop:t.isTop,channelId:t.channelId,unreadMentionedCount:t.unreadMentionedCount},updatedItems:t.updatedItems}}));t.emit(exports.Events.CONVERSATION,{conversationList:o})},chatroomState:function(e){t.emit(exports.Events.CHATROOM,e)},expansion:function(e){t.emit(exports.Events.EXPANSION,e)},pullFinished:function(){t.emit(exports.Events.PULL_OFFLINE_MESSAGE_FINISHED)},tag:function(){t.emit(exports.Events.TAG)},conversationTagChanged:function(){t.emit(exports.Events.CONVERSATION_TAG)},messageBlocked:function(e){t.emit(exports.Events.MESSAGE_BLOCKED,e)},ultraGroupEnable:function(e){t.emit(exports.Events.ULTRA_GROUP_ENABLE,e)},operateStatus:function(e){t.emit(exports.Events.OPERATE_STATUS,e)},ultraGroupMessageExpansionUpdated:function(e){t.emit(exports.Events.ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED,e)},ultraGroupMessageModified:function(e){t.emit(exports.Events.ULTRA_GROUP_MESSAGE_MODIFIED,e)},ultraGroupMessageRecalled:function(e){t.emit(exports.Events.ULTRA_GROUP_MESSAGE_RECALLED,e)}};this.context.assignWatcher(n)},o}(e.EventEmitter),P={TIMEOUT:{code:-1,msg:"Network timeout"},SDK_INTERNAL_ERROR:{code:-2,msg:"SDK internal error"},PARAMETER_ERROR:{code:-3,msg:"Please check the parameters, the {param} expected a value of {expect} but received {current}"},REJECTED_BY_BLACKLIST:{code:405,msg:"Blacklisted by the other party"},SEND_TOO_FAST:{code:20604,msg:"Sending messages too quickly"},NOT_IN_GROUP:{code:22406,msg:"Not in group"},FORBIDDEN_IN_GROUP:{code:22408,msg:"Forbbiden from speaking in the group"},NOT_IN_CHATROOM:{code:23406,msg:"Not in chatRoom"},FORBIDDEN_IN_CHATROOM:{code:23408,msg:"Forbbiden from speaking in the chatRoom"},KICKED_FROM_CHATROOM:{code:23409,msg:"Kicked out and forbbiden from joining the chatRoom"},CHATROOM_NOT_EXIST:{code:23410,msg:"ChatRoom does not exist"},CHATROOM_IS_FULL:{code:23411,msg:"ChatRoom members exceeded"},PARAMETER_INVALID_CHATROOM:{code:23412,msg:"Invalid chatRoom parameters"},ROAMING_SERVICE_UNAVAILABLE_CHATROOM:{code:23414,msg:"ChatRoom message roaming service is not open, Please go to the developer to open this service"},RECALLMESSAGE_PARAMETER_INVALID:{code:25101,msg:"Invalid recall message parameter"},ROAMING_SERVICE_UNAVAILABLE_MESSAGE:{code:25102,msg:"Single group chat roaming service is not open, Please go to the developer to open this service"},PUSHSETTING_PARAMETER_INVALID:{code:26001,msg:"Invalid push parameter"},OPERATION_BLOCKED:{code:20605,msg:"Operation is blocked"},OPERATION_NOT_SUPPORT:{code:20606,msg:"Operation is not supported"},MSG_BLOCKED_SENSITIVE_WORD:{code:21501,msg:"The sent message contains sensitive words"},REPLACED_SENSITIVE_WORD:{code:21502,msg:"Sensitive words in the message have been replaced"},NOT_CONNECTED:{code:30001,msg:"Please connect successfully first"},NAVI_REQUEST_ERROR:{code:30007,msg:"Navigation http request failed"},CMP_REQUEST_ERROR:{code:30010,msg:"CMP sniff http request failed"},CONN_APPKEY_FAKE:{code:31002,msg:"Your appkey is fake"},CONN_MINI_SERVICE_NOT_OPEN:{code:31003,msg:"Mini program service is not open, Please go to the developer to open this service"},CONN_ACK_TIMEOUT:{code:31e3,msg:"Connection ACK timeout"},CONN_TOKEN_INCORRECT:{code:31004,msg:"Your token is not valid or expired"},CONN_NOT_AUTHRORIZED:{code:31005,msg:"AppKey and Token do not match"},CONN_REDIRECTED:{code:31006,msg:"Connection redirection"},CONN_APP_BLOCKED_OR_DELETED:{code:31008,msg:"AppKey is banned or deleted"},CONN_USER_BLOCKED:{code:31009,msg:"User blocked"},CONN_DOMAIN_INCORRECT:{code:31012,msg:"Connect domain error, Please check the set security domain"},ROAMING_SERVICE_UNAVAILABLE:{code:33007,msg:"Roaming service cloud is not open, Please go to the developer to open this service"},RC_CONNECTION_EXIST:{code:34001,msg:"Connection already exists"},CHATROOM_KV_EXCEED:{code:23423,msg:"ChatRoom KV setting exceeds maximum"},CHATROOM_KV_OVERWRITE_INVALID:{code:23424,msg:"ChatRoom KV already exists"},CHATROOM_KV_STORE_NOT_OPEN:{code:23426,msg:"ChatRoom KV storage service is not open, Please go to the developer to open this service"},CHATROOM_KEY_NOT_EXIST:{code:23427,msg:"ChatRoom key does not exist"},MSG_KV_NOT_SUPPORT:{code:34008,msg:"The message cannot be extended"},SEND_MESSAGE_KV_FAIL:{code:34009,msg:"Sending RC expansion message fail"},EXPANSION_LIMIT_EXCEET:{code:34010,msg:"The message expansion size is beyond the limit"},ILLGAL_PARAMS:{code:33003,msg:"Incorrect parameters passed in while calling the interface"},UPLOAD_FILE_FAILED:{code:35020,msg:"File upload failed"},CHATROOM_KV_STORE_NOT_ALL_SUCCESS:{code:23428,msg:"Chatroom kv store not all success"},CHATROOM_KV_STORE_OUT_LIMIT:{code:23429,msg:"Chatroom kv's length is out of limit"},TAG_EXISTS:{code:33101,msg:"The tag already exists"},TAG_NOT_EXIST:{code:33100,msg:"The tag does not exist"},NOT_SUPPORT:{code:e.ErrorCode.NOT_SUPPORT,msg:"The method is not supported in a browser!"}},L={},G={};for(var D in P){var H=P[D],k=H.code;L[k]=D,G[k]=H}P.ROAMING_SERVICE_UNAVAILABLE.code;var B=function(t){e.assert("options.key",t.key,e.AssertRules.STRING,!0),e.assert("options.value",t.value,e.AssertRules.STRING,!0),e.assert("options.isAutoDelete",t.isAutoDelete,e.AssertRules.BOOLEAN),e.assert("options.isSendNotification",t.isSendNotification,e.AssertRules.BOOLEAN),e.assert("options.notificationExtra",t.notificationExtra,e.AssertRules.STRING)},F=function(t){e.assert("options.key",t.key,e.AssertRules.STRING,!0),e.assert("options.isSendNotification",t.isSendNotification,e.AssertRules.BOOLEAN),e.assert("options.notificationExtra",t.notificationExtra,e.AssertRules.STRING)};var q=function(e,t,n,o){void 0===n&&(n=!0),void 0===o&&(o=!0),this.messageType=e,this.content=t,this.isPersited=n,this.isCounted=o};function V(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0);return function(o){return new q(e,o,t,n)}}var z,j,K=V("RC:ImgMsg"),X=V("RC:HQVCMsg"),W=V("RC:SightMsg"),J=V("RC:TxtMsg"),Y=V("RC:CombineMsg"),Q=V("RC:FileMsg"),$=V("RC:GIFMsg"),Z=V("RC:VcMsg"),ee=V("RC:LBSMsg"),te=V("RC:ReferenceMsg"),ne=V("RC:ImgTextMsg"),oe={qiniu:function(t,n,o,s){var r,a="https://"+n.uploadHost.qiniu;r=ie()+se[0][1]||a,se.shift();var i=new XMLHttpRequest;i.upload&&n.support_options&&(i.upload.onprogress=function(e){o.onProgress(e.loaded,e.total)});i.onreadystatechange=function(){if(4===i.readyState){var r=i.responseText||"{}";(r=JSON.parse(r)).filename=n.uniqueValue,r.uploadMethod=e.UploadMethod?e.UploadMethod.QINIU:"",200===i.status?o.onCompleted(r):se.length?oe[se[0][0]](t,n,o,s):o.onError("upload fail")}},n.isChunk&&(r=function(e,t){var n="";ae(t,(function(e,t){"token"!==e&&(n+=(n?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t))})),n&&(e+=(e.indexOf("?")>0?"&":"?")+n);return e}(r+="/mkblk/"+t.size,n.multi_parmas));i.open(n.method,r,!0),o.onOpen(i),n.stream&&i.setRequestHeader("authorization","UpToken "+n.multi_parmas.token);ae(n.headers,(function(e,t){i.setRequestHeader(e,t)})),i.send(t)},baidu:function(e,t,n,o){if(console.log(o,t),o.size>re)throw new Error("the file size is over 5GB!");var s=t||{};t=t||j;var r=new XMLHttpRequest,a=ie();if(!s.uploadHost.bos&&!s.bosUploadPath)return;var i=a+se[0][1]+s.bosUploadPath;se.shift();var c=s.bosHeader||{},d={filename:t.uniqueValue||o.uniqueName,name:o.name,downloadUrl:i,isBosRes:!0};r.upload&&t.support_options&&(r.upload.onprogress=function(e){n.onProgress(e.loaded,e.total,!0)});r.onreadystatechange=function(){if(4===r.readyState){var s=r.responseText||"{}";if((s=JSON.parse(s)).filename=t.uniqueValue,200===r.status){n.onCompleted(d,!0)}else se.length?oe[se[0][0]](e,t,n,o):n.onError("upload fail")}},r.open(t.method,i,!0),r.setRequestHeader("authorization",c.bosToken),r.setRequestHeader("x-bce-date",c.bosDate),r.send(o)},aliyun:function(t,n,o,s){if(s.size>re)throw new Error("the file size is over 5GB!");const r=new FormData;r.set("file",t.get("file")),r.set("key",t.get("key")),r.set("token",t.get("token"));const a=se[0][1];se.shift(),t=t||z,n=(n=n||{})||j;var i=new XMLHttpRequest,c=ie()+n.ossBucketName+"."+a;i.upload&&n.support_options&&(i.upload.onprogress=function(e){o.onProgress(e.loaded,e.total)});i.onreadystatechange=function(){if(4===i.readyState){var t=i.responseText||"{}";(t=JSON.parse(t)).name=n.uniqueValue,t.filename=n.uploadFileName,t.uploadMethod=e.UploadMethod?e.UploadMethod.ALI:"",200===i.status?o.onCompleted(t):se.length?oe[se[0][0]](r,n,o,s):o.onError("upload fail")}},i.open(n.method,c,!0),console.log("ali:url",c);var d=n.aliHeader||{};t.set("OSSAccessKeyId",d.osskeyId),t.set("policy",d.ossPolicy),t.set("Signature",d.ossSign),t.set("success_action_status",200),t.delete("key"),t.append("key",n.uploadFileName),t.delete("file"),t.append("file",s),i.send(t)},s3:function(t,n,o,s){var r=new FormData,a=new XMLHttpRequest,i=ie();const c=se[0][1];var d=i+n.s3BucketName+"."+c;console.log("uploadS3:url",d),se.shift(),a.upload&&n.support_options&&(a.upload.onprogress=function(e){o.onProgress(e.loaded,e.total)});a.onreadystatechange=function(){if(4===a.readyState){var r=a.responseText||"{}";if((r=JSON.parse(r)).name=n.uniqueValue,r.filename=n.uploadFileName,r.uploadMethod=e.UploadMethod.AWS,console.log("UploadMethod:",e.UploadMethod),200===a.status||204===a.status)o.onCompleted(r);else if(se.length){const e=new FormData;e.set("file",t.get("file")),e.set("key",t.get("key")),e.set("token",t.get("token")),oe[se[0][0]](e,n,o,s)}else o.onError("upload fail")}},a.open(n.method,d,!0);var u=n?n.s3Header:{},l=s&&s.type;"text/html"===l?r.set("Content-Disposition","inline;"):r.set("Content-Disposition","attachment;");r.set("Content-Type",l),r.set("x-amz-credential",u.s3Credential),r.set("x-amz-algorithm",u.s3Algorithm),r.set("x-amz-date",u.s3Date),r.set("policy",u.s3Policy),r.set("x-amz-signature",u.s3Signature),r.set("key",n.uploadFileName),r.set("file",s),a.send(r)},stc:function(t,n,o,s){new FormData;var r=new XMLHttpRequest;ie();var a="https://"+se[0][1]+"/"+n.stcBucketName+"/"+n.uploadFileName;se.shift(),r.upload&&n.support_options&&(r.upload.onprogress=function(e){o.onProgress(e.loaded,e.total)});r.onreadystatechange=function(){if(4===r.readyState){var a=r.responseText||"{}";if((a=JSON.parse(a)).name=n.uniqueValue,a.filename=n.uploadFileName,a.uploadMethod=e.UploadMethod?e.UploadMethod.STC:"",200===r.status||204===r.status)o.onCompleted(a);else if(se.length){const e=new FormData;e.set("file",t.get("file")),e.set("key",t.get("key")),e.set("token",t.get("token")),oe[se[0][0]](e,n,o,s)}else o.onError("upload fail")}},r.open("PUT",a,!0);var i=n?n.stcHeader:{};r.setRequestHeader("Content-Type",s.type),"text/html"===s.type?r.setRequestHeader("Content-Disposition","inline;"):r.setRequestHeader("Content-Disposition","attachment;");r.setRequestHeader("Authorization",i.stcAuthorization),r.setRequestHeader("x-amz-content-sha256",i.stcContentSha256),r.setRequestHeader("x-amz-date",i.stcDate),r.send(s)}},se=[],re=5368709120;function ae(e,t){for(var n in e)t(n,e[n])}function ie(){var e="https://";return"http:"!==location.protocol&&"file:"!==location.protocol||(e="http://"),e}function ce(t,n,o){var s,r,a=t&&t.type||"text/plain",i=a.indexOf("image")>-1?1:4,c=Math.ceil(t.size/n.stc_chunk_size),d=n&&JSON.parse(n.ossConfig?n.ossConfig:"");Array.isArray(d)||(d=[]);var u=d.find((e=>Object.keys(e).includes("stc"))),l="uploads";b.imClient.getFileToken(i,s,"POST",l).then((function(e){s=e.fileName,r="https://"+u.stc+"/"+n.stcBucketName+"/"+s,console.log("uploadStcMultipart:url",r);var t=new XMLHttpRequest;t.open("POST",r+"?"+l,!0),"text/html"===a?t.setRequestHeader("Content-Disposition","inline;"):t.setRequestHeader("Content-Disposition","attacshment;"),t.setRequestHeader("Authorization",e&&e.stcAuthorization),t.setRequestHeader("x-amz-content-sha256",e&&e.stcContentSha256),t.setRequestHeader("x-amz-date",e&&e.stcDate),t.setRequestHeader("Content-Type",a),t.send(),t.onreadystatechange=function(e){if(4===t.readyState){var n=t.response.match(/(?:<UploadId>)(\S*?)(?:<\/UploadId>)/);console.log("uploadId",n),200===t.status||204===t.status?function(e){for(var t=[],n=1;n<=c;n++)t.push(m(e,n));f(e,t)}(Array.isArray(n)&&n[1]):o.onError("uploadStcMultipart:did not get uploadId")}}}),(function(e){o.onError("uploadStcMultipart:"+e)}));var g=[],p=new Map;function f(d,u){u&&Array.isArray(u)&&0!==u.length&&Promise.all(u).then((()=>{var u="uploadId="+d;if(p.size===c)b.imClient.context.getFileToken(i,s,"POST",u).then((function(s){console.log("onSuccess",s),console.log("onSuccess:uploadId",d);var i=new XMLHttpRequest;i.open("POST",r+"?"+u,!0),i.setRequestHeader("Authorization",s&&s.stcAuthorization),i.setRequestHeader("x-amz-content-sha256",s&&s.stcContentSha256),i.setRequestHeader("x-amz-date",s&&s.stcDate),i.setRequestHeader("Content-Type",a);var c="<CompleteMultipartUpload xmlns='http://s3.amazonaws.com/doc/2006-03-01/'>",l=Array.from(p.keys()||[]).sort(((e,t)=>e-t));console.log("keys",l),l.map((e=>{c+=`<Part><ETag>${p.get(e)}</ETag><PartNumber>${e}</PartNumber></Part>`})),c+="</CompleteMultipartUpload>",i.send(c),console.log("xml",c),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||204===i.status){var s={};s.name=t.name,s.filename=n.uploadFileName,s.uploadMethod=e.UploadMethod.STC,o.onCompleted(s)}else o.onError("uploadStcMultipart:upload does not end")}}),(function(e){o.onError("uploadStcMultipart:"+e)}));else{var l=[];for(var C of g)l.push(m(d,C));f(d,l)}}),(e=>{console.error(e),o.onError("uploadStcMultipart: chunkFiles upload failed and those will reupload");var t=[];for(var n of g)t.push(m(d,n));f(d,t)}))}function m(e,o){return new Promise(((c,d)=>{var u="partNumber="+o+"&uploadId="+e;b.imClient.context.getFileToken(i,s,"PUT",u).then((function(e){console.log("signature "+o+" onSuccess",e);var s=t&&t.slice((o-1)*n.stc_chunk_size,o*n.stc_chunk_size);console.log("fileChunk:size",s.size);var i=new XMLHttpRequest;i.open("PUT",r+"?"+u,!0),i.setRequestHeader("Authorization",e&&e.stcAuthorization),i.setRequestHeader("x-amz-content-sha256",e&&e.stcContentSha256),i.setRequestHeader("x-amz-date",e&&e.stcDate),i.setRequestHeader("Content-Type",a),i.send(s),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||204===i.status){var e=i.getResponseHeader("etag");console.log("etag:"+o,e),p.set(o,e),c(e)}else g.includes(o)||g.push(o),d(o)}}),(function(e){console.log("getETags:签名验证失败"),g.includes(o)||g.push(o),d(o)}))}))}}var de={form:function(e,t){var n=new FormData;if(t.unique_key){var o=e.name.substr(e.name.lastIndexOf(".")),s=ue()+o;n.append(t.unique_key,s),t.uniqueValue=s}return n.append(t.file_data_name,e),le(t.multi_parmas,(function(e,t){n.append(e,t)})),n},json:function(e,t){var n={};if(t.unique_key){var o=e.name.substr(e.name.lastIndexOf(".")),s=ue()+o;n[t.unique_key]=s,t.uniqueValue=s}return n[t.file_data_name]=e,le(t.multi_parmas,(function(e,t){n[e]=t})),JSON.stringify(n)},data:function(e,t){return e}};function ue(){var e=(new Date).getTime();return"xxxxxx4xxxyxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}function le(e,t){for(var n in e)t(n,e[n])}var ge,pe=0;function fe(e){this.options=function(e){var t={domain:"",method:"POST",file_data_name:"file",unique_key:"key",base64_size:4194304,chunk_size:4194304,bos_chunk_size:4294967296,stc_chunk_size:10485760,headers:{},multi_parmas:{},query:{},support_options:!0,data:de.form,genUId:ue};if(!e||!e.domain)throw new Error("domain is null");for(var n in e)t[n]=e[n];return t}(e),this.setOptions=function(e){var t=this;le(e,(function(e,n){t.options[e]=n}))},console.log("options",e),this.upload=function(e,t){if(e){var n=this;!function(e,t,n){if(z=e,j=t,se=[],t.ossConfig){const e=JSON.parse(t.ossConfig);let n,o,s="";const r=[];e.forEach((e=>{const t=Number(e.p)-1;for(const a in e)"aliyun"===a&&(s=e[a]),"s3"===a&&(n=e[a]),"stc"===a&&(o=e[a]),"p"!==a&&(r[t]=[a,e[a]])})),r.forEach((function(e){e&&se.push(e)})),e.length!==se.length&&(se=[["qiniu",t.domain],["baidu",t.uploadHost.bos],["aliyun",s],["s3",n],["stc",o]])}else se=[["qiniu",t.domain],["baidu",t.uploadHost.bos]];var o;if(t.ossConfig){var s=t&&JSON.parse(t.ossConfig);Array.isArray(s)||(s=[]),o=s.find((e=>Object.keys(e).includes("stc")))}if(o&&1===parseInt(o.p)&&e.size>=4194304)ce(e,t,n);else{var r=t.data(e,t);oe[se[0][0]](r,t,n,e)}}(e,this.options,{onProgress:function(e,n,o){if(ge=e,o){ge=pe+e/n*(n-pe)}else pe=ge;t.onProgress(ge,n)},onCompleted:function(e){t.onCompleted(e)},onError:function(e){t.onError(e)},onOpen:function(e){n.xhr=e}})}else t.onError("upload file is null.")},this.cancel=function(){this.xhr&&this.xhr.abort()}}var me={init:function(e){return new fe(e)},dataType:de,resize:function(e,t,n){e.type;var o=document.createElement("canvas"),s=new FileReader;s.readAsDataURL(e),s.onload=function(e){var s=e.target.result,r=new Image;r.src=s;var a=r.width,i=r.height,c=function(e,t){var n=1,o=e.width,s=t.maxWidth||0;s>0&&o>s&&(n=s/o);var r=e.height,a=t.maxHeight||0;if(a>0&&r>a){var i=a/r;n=Math.min(n,i)}var c=t.maxSize||0,d=Math.ceil(e.size/1e3);if(d>c){var u=c/d;n=Math.min(n,u)}return n}({width:a,height:i,size:e.total},t),d=s;c<1&&(d=function(e,t,n){o.width=t,o.height=n,o.getContext("2d").drawImage(e,0,0,t,n);var s="image/jpg";return o.toDataURL(s)}(r,a*c,i*c)),n(d)}}};const Ce=function(e,t,n){var o=document.createElement("canvas"),s=o.getContext("2d"),r=new Image;r.onload=function(){var a=function(e,t,n){var o,s,r,a=e<t,i=0,c=0;return(a?t/e:e/t)>n.scale?(a?(s=100,c=((r=t/(o=e/100))-n.maxHeight)/2):(r=100,i=((s=e/(o=t/100))-n.maxWidth)/2),{w:s,h:r,x:-i,y:-c}):(a?(o=t/n.maxHeight,r=n.maxHeight,s=e/o):(o=e/n.maxWidth,s=n.maxWidth,r=t/o),{w:s,h:r,x:-i,y:-c})}(r.width,r.height,t);o.width=a.w>t.maxWidth?t.maxWidth:a.w,o.height=a.h>t.maxHeight?t.maxHeight:a.h,s.drawImage(r,a.x,a.y,a.w,a.h);try{var i=o.toDataURL(e.type,t.quality),c=new RegExp("^data:image/[^;]+;base64,");i=i.replace(c,""),n(i)}catch(e){throw new Error(e)}},r.src="string"==typeof e?"data:image/jpg;base64,"+e:function(e){var t=window.URL||window.webkitURL;return t?t.createObjectURL(e):""}(e)},ve=function(e,t){var n=e.file,o=e.compress;Ce(n,o,t)},he=function(e,t){if(e.getToken)e.getToken((function(n,o){o=o||{},e.multi_parmas||(e.multi_parmas={}),e.multi_parmas.token=n,e.uploadHost||(e.uploadHost={}),e.uploadHost.bos=o.bos,e.ossConfig=o.ossConfig,e.bosHeader||(e.bosHeader={}),e.bosHeader.bosDate=o.bosDate,e.bosHeader.bosToken=o.bosToken,e.bosUploadPath=o.path,e.aliHeader={},e.aliHeader.osskeyId=o.osskeyId,e.aliHeader.ossPolicy=o.ossPolicy,e.aliHeader.ossSign=o.ossSign,e.ossBucketName=o.ossBucketName,e.uploadFileName=o.fileName,e.s3Header={},e.s3Header.s3Credential=o.s3Credential,e.s3Header.s3Algorithm=o.s3Algorithm,e.s3Header.s3Date=o.s3Date,e.s3Header.s3Policy=o.s3Policy,e.s3Header.s3Signature=o.s3Signature,e.s3BucketName=o.s3BucketName,e.stcHeader={},e.stcHeader.stcAuthorization=o.stcAuthorization,e.stcHeader.stcContentSha256=o.stcContentSha256,e.stcHeader.stcDate=o.stcDate,e.stcBucketName=o.stcBucketName,e.headers||(e.headers={}),e.base64&&(e.headers["Content-type"]="application/octet-stream",e.headers.Authorization="UpToken "+n),console.log("data",o);var s=me.init(e);t(s)}));else{e.headers||(e.headers={}),e.base64&&(e.headers["Content-type"]="application/octet-stream");var n=me.init(e);t(n)}};var Ee,Se,Ie=function(e,t,n){t.upload(e.file,{onError:function(e){n.onError(e)},onProgress:function(e,t){n.onProgress(e,t)},onCompleted:function(t){t.filename||(t.filename=t.hash);var o=e.compressThumbnail||ve;e.compress?o(e,(function(e){t.thumbnail=e,n.onCompleted(t)})):n.onCompleted(t)}})},Te=function(e){var t=this;this.instance=e,this.upload=function(e,n){Ie({file:e},t.instance,n)},this.cancel=function(){t.instance.cancel()}},Re=function(e,t){var n=this;this.cfg=t,this.instance=e,this.upload=function(e,t){var o={file:e,compress:n.cfg};Ie(o,n.instance,t)},this.cancel=function(){n.instance.cancel()}},ye=function(e,t){he(e,(function(n){var o={maxHeight:e.maxHeight||160,maxWidth:e.maxWidth||160,quality:e.quality||.5,scale:e.scale||2.4},s=new Re(n,o);t(s)}))},Ae=function(e,t){he(e,(function(e){var n=new Te(e);t(n)}))},Ne=ye;me.dataType;function xe(e){return Ee=Ee||new AudioContext,new Promise((function(t,n){Ee.decodeAudioData(e,(function(e){t({duration:e.duration,length:e.length})}),n)}))}function Me(t,n,o,s,r){return e.assert("fileType",t,e.isValidFileType,!0),e.assert("filename",n,e.AssertRules.STRING),e.assert("saveName",o,e.AssertRules.STRING),e.assert("serverType",r,e.AssertRules.NUMBER),new Promise((function(a){b.imClient.context.getFileUrl(t,n,o,s,r).then((function(t){a({code:e.ErrorCode.SUCCESS,data:t})})).catch((function(e){a({code:e})}))}))}function Ue(t,n,a){return o(this,void 0,void 0,(function(){var o,i,c,d,u,l,g,p,f,m;return s(this,(function(s){switch(s.label){case 0:return a=a||{},n instanceof q==!1?(r.warn("send message fail -> message parameter is not an instance of BaseMessage"),[2,P.ILLGAL_PARAMS]):(e.assert("conversation.channelId",null==t?void 0:t.channelId,e.AssertRules.CHANNEL_ID),o=t.conversationType,i=t.targetId,c=t.channelId,d="conversationType:"+o+",targetId:"+i,r.debug("send message  ->"+d),(u=Object.assign(a,n)).channelId=c||"",[4,b.imClient.context.sendMessage(o,i,u)]);case 1:return l=s.sent(),g=l.code,p=l.data,g===e.ErrorCode.SUCCESS?(f=_(p),[2,{code:g,data:f}]):(r.warn("send message fail ->"+g+":"+L[g]+","+d),m={isMentioned:!!a.isMentioned,content:n.content,messageType:n.messageType,isPersited:n.isPersited||!1,isCounted:n.isCounted||!1,disableNotification:!!(null==a?void 0:a.disableNotification),canIncludeExpansion:!!(null==a?void 0:a.canIncludeExpansion),expansion:(null==a?void 0:a.expansion)||null,conversationType:t.conversationType,targetId:t.targetId,channelId:t.channelId,senderUserId:b.imClient.context.getCurrentUserId(),messageUId:"",messageDirection:e.MessageDirection.SEND,sentTime:(null==p?void 0:p.sentTime)||0,receivedTime:0,isStatusMessage:a.isStatusMessage||!1,receivedStatus:e.ReceivedStatus.UNREAD,isOffLineMessage:!1},o!==e.ConversationType.ULTRA_GROUP&&(m.isOffLineMessage=!1),[2,{code:g,msg:L[g],data:_(m)}])}}))}))}function Oe(t,r){return function(a,i,c,d){return new Promise((function(u){var l;!function(t,r,a,i){var c,d=this;if(void 0===r&&(r=e.FileType.FILE),c=r===e.FileType.IMAGE?e.FileType.IMAGE:e.FileType.FILE,!Se){Se="upload.qiniup.com";var u=b.imClient.context.getInfoFromCache();if(u&&u.ossConfig)try{var l=JSON.parse(u.ossConfig).find((function(e){return void 0!==e.qiniu}));l&&(Se=l.qiniu)}catch(e){}}var g=n({domain:Se,getToken:function(e){b.imClient.context.getFileToken(c).then((function(t){e(t.token,t)})).catch((function(e){a.onFail(e)}))}},i);(c===e.FileType.IMAGE?Ne:Ae)(g,(function(n){n.upload(t,{onProgress:function(e,t){var n,o=Math.floor(e/t*100);null===(n=a.onProgress)||void 0===n||n.call(a,o)},onCompleted:function(n){return o(d,void 0,void 0,(function(){var i=this;return s(this,(function(d){return Me(c,n.filename,n.name,n,n.uploadMethod).then((function(d){return o(i,void 0,void 0,(function(){var o,i;return s(this,(function(s){return 0!==d.code?(a.onFail(d),[2]):((o=d.data).type=t.type,o.name=n.name||n.filename,r===e.FileType.AUDIO?("function"==typeof t.arrayBuffer?t.arrayBuffer().then(xe).then((function(e){Object.assign(o,e),a.onSuccess(o)}),(function(){a.onSuccess(o)})):((i=new FileReader).onload=function(){i.result?xe(i.result).then((function(e){Object.assign(o,e),a.onSuccess(o)}),(function(){a.onSuccess(o)})):a.onSuccess(o)},i.onerror=function(){o.duration=0,a.onSuccess(o)},i.readAsArrayBuffer(t)),[2]):(c===e.FileType.IMAGE&&(o.thumbnail=n.thumbnail),a.onSuccess(o),[2]))}))}))})).catch((function(e){a.onFail(e)})),[2]}))}))},onError:function(e){a.onFail(e)}})}))}(i.file,t,{onProgress:null==c?void 0:c.onProgress,onSuccess:function(e){var t,n=(null===(t=null==c?void 0:c.onComplete)||void 0===t?void 0:t.call(c,{url:e.downloadUrl}))||r(e,i);Ue(a,n,d).then(u)},onFail:function(t){u({code:e.ErrorCode.UPLOAD_FILE_FAILED,msg:t||e.ErrorCode[e.ErrorCode.UPLOAD_FILE_FAILED]})}},(null===(l=d)||void 0===l?void 0:l.thumbnailConfig)||{})}))}}var _e=Oe(e.FileType.FILE,(function(e,t){return new Q({name:e.name,size:t.file.size,type:t.file.type,fileUrl:e.downloadUrl,user:t.user,extra:t.extra})})),we=Oe(e.FileType.IMAGE,(function(e,t){return new K({content:e.thumbnail,imageUri:e.downloadUrl,user:t.user,extra:t.extra})})),be=Oe(e.FileType.AUDIO,(function(e,t){return new X({remoteUrl:e.downloadUrl,duration:e.duration,type:e.type,user:t.user,extra:t.extra})})),Pe=Oe(e.FileType.SIGHT,(function(e,t){return new W({sightUrl:e.downloadUrl,content:t.thumbnail,duration:t.duration,size:t.file.size||e.size,name:t.name||e.name,user:t.user,extra:t.extra})}));Oe(e.FileType.COMBINE_HTML,(function(e,t){return new Y({remoteUrl:e.downloadUrl,nameList:t.nameList,summaryList:t.summaryList,conversationType:t.conversationType,user:t.user,extra:t.extra})}));e.VersionManage.add("imlib","5.2.1"),e.VersionManage.validEngine("5.2.1")||r.error("The current engine version '"+e.VersionManage.getInfo().engine+"' error，imlib required engine version at least '5.2.1'."),Object.defineProperty(exports,"ConnectionStatus",{enumerable:!0,get:function(){return e.ConnectionStatus}}),Object.defineProperty(exports,"ConversationType",{enumerable:!0,get:function(){return e.ConversationType}}),Object.defineProperty(exports,"ErrorCode",{enumerable:!0,get:function(){return e.ErrorCode}}),Object.defineProperty(exports,"LogLevel",{enumerable:!0,get:function(){return e.LogLevel}}),Object.defineProperty(exports,"MentionedType",{enumerable:!0,get:function(){return e.MentionedType}}),Object.defineProperty(exports,"MessageBlockType",{enumerable:!0,get:function(){return e.MessageBlockType}}),Object.defineProperty(exports,"MessageDirection",{enumerable:!0,get:function(){return e.MessageDirection}}),Object.defineProperty(exports,"NotificationStatus",{enumerable:!0,get:function(){return e.NotificationStatus}}),Object.defineProperty(exports,"ReceivedStatus",{enumerable:!0,get:function(){return e.ReceivedStatus}}),Object.defineProperty(exports,"UploadMethod",{enumerable:!0,get:function(){return e.UploadMethod}}),exports.BaseMessage=q,exports.CombineMessage=Y,exports.ConnectType={COMET:"comet",WEBSOCKET:"websocket"},exports.FileMessage=Q,exports.GIFMessage=$,exports.HQVoiceMessage=X,exports.ImageMessage=K,exports.LocationMessage=ee,exports.MessageType={TEXT:"RC:TxtMsg",VOICE:"RC:VcMsg",HQ_VOICE:"RC:HQVCMsg",IMAGE:"RC:ImgMsg",GIF:"RC:GIFMsg",RICH_CONTENT:"RC:ImgTextMsg",LOCATION:"RC:LBSMsg",FILE:"RC:FileMsg",SIGHT:"RC:SightMsg",COMBINE:"RC:CombineMsg",CHRM_KV_NOTIFY:"RC:chrmKVNotiMsg",LOG_COMMAND:"RC:LogCmdMsg",EXPANSION_NOTIFY:"RC:MsgExMsg",REFERENCE:"RC:ReferenceMsg",RECALL_MESSAGE_TYPE:"RC:RcCmd"},exports.ReferenceMessage=te,exports.RichContentMessage=ne,exports.SightMessage=W,exports.TextMessage=J,exports.VoiceMessage=Z,exports.__addSDKVersion=function(t,n){e.VersionManage.add(t,n)},exports.addConversationsToTag=function(t,n){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:return e.assert("tagId",t,e.AssertRules.STRING,!0),e.assert("conversations",n,e.AssertRules.ARRAY,!0),n.forEach((function(t){e.assert("conversation.conversationType",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("conversation.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("conversation.channelId",t.channelId,e.AssertRules.CHANNEL_ID)})),r.info("addTagForConversations ->tagId:"+t),[4,b.imClient.context.addTagForConversations(t,n)];case 1:return(o=s.sent().code)===e.ErrorCode.SUCCESS?[2,{code:o}]:(r.warn("addTagForConversations ->code:"+o+",tagId:"+t),[2,{code:o,msg:L[o]}])}}))}))},exports.addEventListener=function(e,t,n){w.on(e,t,n)},exports.addTag=function(t){return o(this,void 0,void 0,(function(){var n;return s(this,(function(o){switch(o.label){case 0:return e.assert("tag.tagId",t.tagId,e.AssertRules.STRING,!0),e.assert("tag.tagId",t.tagId,(function(e){return e.length<=10})),e.assert("tag.tagName",t.tagName,(function(e){return e.length<=15})),e.assert("tag.tagName",t.tagName,e.AssertRules.STRING,!0),r.info("createTag ->tagId:"+t.tagId+",tagName:"+t.tagName),[4,b.imClient.context.createTag(t)];case 1:return(n=o.sent().code)===e.ErrorCode.SUCCESS?[2,{code:n}]:(r.warn("createTag ->code:"+n+",tagId:"+t.tagId),[2,{code:n,msg:L[n]}])}}))}))},exports.bindRTCRoomForChatroom=function(e){return o(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,b.imClient.context.bindRTCRoomForChatroom(e)];case 1:return[2,{code:t=n.sent(),msg:L[t]}]}}))}))},exports.clearAllMessagesUnreadStatus=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,b.imClient.context.clearAllUnreadCount()];case 1:return[2,{code:e.sent()}]}}))}))},exports.clearEventListeners=function(){w.clear()},exports.clearHistoryMessages=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.timestamp",n,e.AssertRules.NUMBER,!0),e.assert("conversation.channelId",null==t?void 0:t.channelId,e.AssertRules.CHANNEL_ID),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("clear message ->"+o),[4,b.imClient.context.deleteRemoteMessageByTimestamp(t.conversationType,t.targetId,n,t.channelId)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("clear message ->"+a+":"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:e.ErrorCode.SUCCESS}]}}))}))},exports.clearMessages=function(t){return o(this,void 0,void 0,(function(){var n;return s(this,(function(o){switch(o.label){case 0:return e.usingCppEngine()?(r.info("clearMessages ->targetId:"+t.targetId+",conversationType:"+t.conversationType),[4,b.imClient.context.clearMessages(t.conversationType,t.targetId,t.channelId)]):[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return(n=o.sent())===e.ErrorCode.SUCCESS?[2,{code:n}]:(r.warn("clearMessages ->code:"+n+",targetId:"+t.targetId),[2,{code:n,msg:L[n]}])}}))}))},exports.clearMessagesUnreadStatus=function(t){return o(this,void 0,void 0,(function(){var n,o;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),[4,b.imClient.context.clearUnreadCount(t.conversationType,t.targetId,t.channelId)];case 1:return n=s.sent(),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("clear unreadMsgNum ->"+o),n!==e.ErrorCode.SUCCESS?(r.warn("clear unreadMsgNum fail ->"+n+":"+L[n]+","+o),[2,{code:n,msg:L[n]}]):[2,{code:n}]}}))}))},exports.clearTextMessageDraft=function(t){return o(this,void 0,void 0,(function(){var n,o;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),n="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("delete draft  ->"+n),[4,b.imClient.context.clearConversationMessageDraft(t.conversationType,t.targetId,t.channelId)];case 1:return(o=s.sent())===e.ErrorCode.SUCCESS?[2,{code:o}]:(r.warn("delete draft fail ->"+o+":"+L[o]+","+n),[2,{code:o,msg:L[o]}])}}))}))},exports.clearUnreadCountByTimestamp=function(t,n){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:return e.usingCppEngine()?(r.info("clearUnreadCountByTimestamp ->targetId:"+t.targetId+",conversationType:"+t.conversationType),[4,b.imClient.context.clearUnreadCountByTimestamp(t.conversationType,t.targetId,n,t.channelId)]):[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return(o=s.sent())===e.ErrorCode.SUCCESS?[2,{code:o}]:(r.warn("clearUnreadCountByTimestamp ->code:"+o+",targetId:"+t.targetId),[2,{code:o,msg:L[o]}])}}))}))},exports.connect=function(t,n){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:return e.assert("token",t,e.AssertRules.STRING,!0),r.warn("RongIMLib Version: 5.2.1, Commit: 5f3d7b5af1e6e31d4545ef0973b990837060617b"),[4,w.context.connect(t,!1,n)];case 1:return(o=s.sent()).code===e.ErrorCode.SUCCESS?[2,{code:o.code,data:{userId:o.userId}}]:[2,{code:o.code,msg:L[o.code]}]}}))}))},exports.deleteLocalMessagesByTimestamp=function(t,n,a){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:return e.usingCppEngine()?(e.assert("conversationType",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("timestamp",n,e.AssertRules.NUMBER,!0),e.assert("cleanSpace",a,e.AssertRules.BOOLEAN),[4,b.imClient.context.deleteMessagesByTimestamp(t.conversationType,t.targetId,n,a,t.channelId)]):[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return(o=s.sent())===e.ErrorCode.SUCCESS?[2,{code:o}]:(r.warn("deleteLocalMessagesByTimestamp ->code:"+o+",targetId:"+t.targetId),[2,{code:o,msg:L[o]}])}}))}))},exports.deleteMessages=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("options",n,(function(t){return e.isArray(t)&&t.length}),!0),n.forEach((function(t){e.assert("options.messageUId",t.messageUId,e.AssertRules.STRING,!0),e.assert("options.sentTime",t.sentTime,e.AssertRules.NUMBER,!0),e.assert("options.messageDirection",t.messageDirection,(function(e){return 1===e||2===e}),!0)})),e.assert("conversation.channelId",null==t?void 0:t.channelId,e.AssertRules.CHANNEL_ID),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("delete messages ->"+o),[4,b.imClient.context.deleteRemoteMessage(t.conversationType,t.targetId,n,t.channelId)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("delete message fail ->"+a+":"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:e.ErrorCode.SUCCESS}]}}))}))},exports.disconnect=function(){return w.context.disconnect()},exports.forceRemoveChatRoomEntry=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("targetId",t,e.AssertRules.STRING,!0),F(n),o="id:"+t,r.debug("force remove chatroom entry ->"+o),[4,b.imClient.context.forceRemoveChatroomEntry(t,n)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("force remove chatroom entry fail ->code+:"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:a}]}}))}))},exports.forceSetChatRoomEntry=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("targetId",t,e.AssertRules.STRING,!0),B(n),o="id:"+t,r.debug("force set chatroom entry ->"+o),[4,b.imClient.context.forceSetChatroomEntry(t,n)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("force set chatroom entry fail ->code+:"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:a}]}}))}))},exports.getAllChatRoomEntries=function(t){return o(this,void 0,void 0,(function(){var n,o,a,i;return s(this,(function(s){switch(s.label){case 0:return n="id:"+t,r.debug("get all chatroom entries->"+n),[4,b.imClient.context.getAllChatroomEntries(t)];case 1:return o=s.sent(),a=o.code,i=o.data,a===e.ErrorCode.SUCCESS&&i?[2,{code:a,data:i}]:(r.warn("get all chatroom entries fail ->code+:"+L[a]+","+n),[2,{code:a,msg:L[a]}])}}))}))},exports.getAllConversationState=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){return[2,b.imClient.context.getAllConversationState()]}))}))},exports.getAllUnreadMentionedCount=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){return r.debug("getAllUnreadMentionedCount"),[2,b.imClient.context.getAllUnreadMentionedCount()]}))}))},exports.getBlockUltraGroupList=function(){return o(this,void 0,void 0,(function(){var t,n,o;return s(this,(function(s){switch(s.label){case 0:return[4,b.imClient.context.getBlockUltraGroupList()];case 1:return t=s.sent(),n=t.code,o=t.data,n===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS,data:o}]:(r.warn("get block ultragroup  ->"+n+":"+L[n]),[2,{code:n,msg:L[n]}])}}))}))},exports.getBlockedConversationList=function(){return o(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(o){switch(o.label){case 0:return[4,b.imClient.context.getBlockConversationList()];case 1:return e=o.sent(),t=e.code,n=e.data,[2,{code:t,data:n}]}}))}))},exports.getChatRoomEntry=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c;return s(this,(function(s){switch(s.label){case 0:return e.assert("key",n,(function(t){return e.isString(t)&&/[\w+=-]+/.test(t)&&t.length<=128}),!0),o="id:"+t,r.debug("get chatroom entry->"+o),[4,b.imClient.context.getChatroomEntry(t,n)];case 1:return a=s.sent(),i=a.code,c=a.data,i===e.ErrorCode.SUCCESS&&c?[2,{code:i,data:c}]:(r.warn("get chatroom entry fail ->code+:"+L[i]+","+o),[2,{code:i,msg:L[i]}])}}))}))},exports.getChatRoomInfo=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.count",n.count,e.AssertRules.NUMBER),e.assert("options.order",n.order,(function(e){return[0,1,2].includes(e)})),o="id:"+t,r.debug("get chatroom info ->"+o),[4,b.imClient.context.getChatroomInfo(t,n.count,n.order)];case 1:return a=s.sent(),i=a.code,c=a.data,i===e.ErrorCode.SUCCESS&&c?[2,{code:i,data:c}]:(r.warn("get chatroom info fail ->code+:"+L[i]+","+o),[2,{code:i,msg:L[i]}])}}))}))},exports.getChatroomHistoryMessages=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.timestamp",n.timestamp,e.AssertRules.NUMBER),e.assert("options.count",n.count,e.AssertRules.NUMBER),e.assert("options.order",n.order,(function(e){return 0===e||1===e})),o="id:"+t,r.debug("get chatroom history message->"+o),[4,b.imClient.context.getChatRoomHistoryMessages(t,n.count,n.order,n.timestamp)];case 1:return a=s.sent(),i=a.code,c=a.data,i===e.ErrorCode.SUCCESS&&c?(d=c.list.map((function(e){return _(e)})),[2,{code:i,data:{list:d,hasMore:!!c.hasMore}}]):(r.warn("get chatroom history message fail ->code+:"+L[i]+","+o),[2,{code:i,msg:L[i]}])}}))}))},exports.getConnectionStatus=function(){return w.context.getConnectionStatus()},exports.getConversationList=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c;return s(this,(function(s){switch(s.label){case 0:return r.debug("get conversation list ->"),[4,b.imClient.context.getConversationList(null==t?void 0:t.count,void 0,null==t?void 0:t.startTime,null==t?void 0:t.order,n)];case 1:return o=s.sent(),a=o.code,i=o.data,a===e.ErrorCode.SUCCESS&&i?(c=i.map((function(e){return function(e){var t=e.conversationType,n=e.targetId,o=e.latestMessage,s=e.unreadMessageCount,r=e.hasMentioned,a=e.mentionedInfo,i=e.lastUnreadTime,c=e.notificationStatus,d=e.isTop,u=e.channelId,l=e.unreadMentionedCount;return{conversationType:t,targetId:n,latestMessage:o&&_(o),unreadMessageCount:s,hasMentioned:r,mentionedInfo:r?{type:null==a?void 0:a.type,userIdList:null==a?void 0:a.userIdList}:void 0,lastUnreadTime:i,notificationStatus:c,isTop:d,channelId:u,unreadMentionedCount:l}}(e)})),[2,{code:0,data:c}]):(r.warn("get conversation list fail ->"+a+":"+L[a]),[2,{code:a,msg:L[a]}])}}))}))},exports.getConversationNotificationStatus=function(t){return o(this,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),r.info("getConversationNotificationStatus ->targetId:"+t.targetId+",conversationType:"+t.conversationType),[4,b.imClient.context.getConversationNotificationStatus(t.conversationType,t.targetId,t.channelId)];case 1:return n=s.sent(),o=n.code,a=n.data,o===e.ErrorCode.SUCCESS?[2,{code:o,data:a}]:(r.warn("getConversationNotificationStatus ->code:"+o+",targetId:"+t.targetId),[2,{code:o,msg:L[o]}])}}))}))},exports.getConversationsFromTagByPage=function(t,n,a){return o(this,void 0,void 0,(function(){var o,i,c;return s(this,(function(s){switch(s.label){case 0:return e.assert("tagId",t,e.AssertRules.STRING,!0),e.assert("count",n,e.AssertRules.NUMBER,!0),e.assert("startTime",a,e.AssertRules.NUMBER,!0),r.info("getConversationListByTag ->tagId:"+t),[4,b.imClient.context.getConversationListByTag(t,a,n)];case 1:return o=s.sent(),i=o.code,c=o.data,i===e.ErrorCode.SUCCESS?[2,{code:i,data:c}]:(r.warn("getConversationListByTag ->code:"+i+",tagId:"+t),[2,{code:i,msg:L[i]}])}}))}))},exports.getCurrentUserId=function(){return w.context.getCurrentUserId()},exports.getFileToken=function(t,n,o,s){return new Promise((function(r){b.imClient.context.getFileToken(t,n,o,s).then((function(t){r({code:e.ErrorCode.SUCCESS,data:t})})).catch((function(e){r({code:e,msg:L[e]})}))}))},exports.getFileUrl=Me,exports.getFirstUnreadMessage=function(t){return o(this,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:return e.usingCppEngine()?(e.assert("conversation.conversationType",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("conversation.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("conversation.channelId",null==t?void 0:t.channelId,e.AssertRules.CHANNEL_ID),[4,b.imClient.context.getFirstUnreadMessage(t.conversationType,t.targetId,t.channelId)]):[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return n=s.sent(),o=n.code,a=n.data,o===e.ErrorCode.SUCCESS?[2,{code:o,data:a}]:(r.warn("insertMessage ->code:"+o+",targetId:"+t.targetId),[2,{code:o,msg:L[o]}])}}))}))},exports.getHistoryMessages=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.timestamp",null==n?void 0:n.timestamp,e.AssertRules.NUMBER),e.assert("options.count",null==n?void 0:n.count,e.AssertRules.NUMBER),e.assert("options.order",null==n?void 0:n.order,(function(e){return 0===e||1===e})),e.assert("conversation.channelId",null==t?void 0:t.channelId,e.AssertRules.CHANNEL_ID),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("get history message ->"+o),[4,b.imClient.context.getHistoryMessage(t.conversationType,t.targetId,null==n?void 0:n.timestamp,null==n?void 0:n.count,null==n?void 0:n.order,null==t?void 0:t.channelId)];case 1:return a=s.sent(),i=a.code,c=a.data,i===e.ErrorCode.SUCCESS&&c?(d=c.list.map((function(e){return _(e)})),[2,{code:i,data:{list:d,hasMore:c.hasMore}}]):(r.warn("get history message fail ->"+i+":"+L[i]+","+o),[2,{code:i,msg:L[i]}])}}))}))},exports.getMessage=function(t){return o(this,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:return e.usingCppEngine()?[4,b.imClient.context.getMessage(t)]:[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return n=s.sent(),o=n.code,a=n.data,o===e.ErrorCode.SUCCESS?[2,{code:o,data:_(a)}]:(r.warn("getMessage ->code:"+o+",messageId:"+t),[2,{code:o,msg:L[o]}])}}))}))},exports.getMessageReader=function(t,n,a){return o(this,void 0,void 0,(function(){var o,i,c,d;return s(this,(function(s){switch(s.label){case 0:return e.assert("messageUId",n,e.AssertRules.STRING,!0),o="messageUId:"+n+",targetId:"+t,r.debug("get message reader ->"+o),[4,b.imClient.context.getMessageReader(t,n,a)];case 1:return i=s.sent(),c=i.code,d=i.data,c===e.ErrorCode.SUCCESS?[2,{code:c,data:d}]:(r.warn("get message reader fail ->"+c+":"+L[c]+","+o),[2,{code:c,msg:L[c]}])}}))}))},exports.getRemoteHistoryMessages=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.timestamp",null==n?void 0:n.timestamp,e.AssertRules.NUMBER),e.assert("options.count",null==n?void 0:n.count,e.AssertRules.NUMBER),e.assert("options.order",null==n?void 0:n.order,(function(e){return 0===e||1===e})),e.assert("conversation.channelId",null==t?void 0:t.channelId,e.AssertRules.CHANNEL_ID),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("get history message ->"+o),[4,b.imClient.context.getRemoteHistoryMessages(t.conversationType,t.targetId,(null==n?void 0:n.timestamp)||0,(null==n?void 0:n.count)||20,(null==n?void 0:n.order)||0,t.channelId||"")];case 1:return a=s.sent(),i=a.code,c=a.data,i===e.ErrorCode.SUCCESS&&c?(d=c.list.map((function(e){return _(e)})),[2,{code:i,data:{list:d,hasMore:c.hasMore}}]):(r.warn("get history message fail ->"+i+":"+L[i]+","+o),[2,{code:i,msg:L[i]}])}}))}))},exports.getServerTime=function(){return w.context.getServerTime()},exports.getTags=function(){return o(this,void 0,void 0,(function(){var t,n,o;return s(this,(function(s){switch(s.label){case 0:return[4,b.imClient.context.getTagList()];case 1:return t=s.sent(),n=t.code,o=t.data,n===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS,data:o}]:(r.warn("getTagList ->code:"+n),[2,{code:n,msg:L[n]}])}}))}))},exports.getTagsFromConversation=function(t){return o(this,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("conversationType",t.conversationType,e.AssertRules.NUMBER),e.assert("targetId",t.targetId,e.AssertRules.STRING),e.assert("channelId",t.channelId,e.AssertRules.CHANNEL_ID),r.info("getTagsForConversation ->targetId:"+t.targetId+",conversationType:"+t.conversationType),[4,b.imClient.context.getTagsForConversation(t)];case 1:return n=s.sent(),o=n.code,a=n.data,o===e.ErrorCode.SUCCESS?[2,{code:o,data:a}]:[2,{code:o,msg:L[o]}]}}))}))},exports.getTextMessageDraft=function(t){return o(this,void 0,void 0,(function(){var n,o,a,i;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),[4,b.imClient.context.getConversationMessageDraft(t.conversationType,t.targetId,t.channelId)];case 1:return n=s.sent(),o=n.code,a=n.data,i="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("get draft ->"+i),o===e.ErrorCode.SUCCESS?[2,{code:o,data:a||""}]:(r.warn("get draft fail ->"+o+":"+L[o]+","+i),[2,{code:o,msg:L[o]}])}}))}))},exports.getTopConversationList=function(){return o(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(o){switch(o.label){case 0:return[4,b.imClient.context.getTopConversationList()];case 1:return e=o.sent(),t=e.code,n=e.data,[2,{code:t,data:n}]}}))}))},exports.getTotalUnreadCount=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d,u;return s(this,(function(s){switch(s.label){case 0:if(r.debug("get total unread count -> ConversationType:"+JSON.stringify(n)+" includeMuted:"+t),e.assert("includeMuted",t,e.AssertRules.BOOLEAN,!1),e.assert("conversationTypes",n,e.AssertRules.ARRAY,!1),n)for(o=0,a=n;o<a.length;o++)i=a[o],e.assert("conversationType",i,e.isValidConversationType);return[4,b.imClient.context.getTotalUnreadCount("",n,t)];case 1:return c=s.sent(),d=c.code,u=c.data,d===e.ErrorCode.SUCCESS?[2,{code:d,data:u}]:(r.warn("getTotalUnreadCount fail ->"+d+":"+L[d]),[2,{code:d,msg:L[d]}])}}))}))},exports.getUltraGroupList=function(){return o(this,void 0,void 0,(function(){var t,n,o;return s(this,(function(s){switch(s.label){case 0:return[4,b.imClient.context.getUltraGroupList()];case 1:return t=s.sent(),n=t.code,o=t.data,n===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS,data:o}]:(r.warn("get ultragroup  ->"+n+":"+L[n]),[2,{code:n,msg:L[n]}])}}))}))},exports.getUltraGroupMessageListByMessageUId=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d,u,l,g;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("msgs",n,e.AssertRules.ARRAY,!0),o=t.targetId,a=t.conversationType,i=t.channelId,c=[],n.forEach((function(e){var t=e.sendTime,n=e.messageUId;c.push({sendTime:t,messageUId:n,channelId:i})})),d={targetId:o,conversationType:a,messages:c},[4,b.imClient.context.getUltraGroupMessageListByMessageUId(d)];case 1:return u=s.sent(),l=u.code,g=u.data,l===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS,data:g}]:(r.warn("get UltraGroup MessageList by messageUId   ->"+l+":"+L[l]),[2,{code:l,msg:L[l]}])}}))}))},exports.getUltraGroupUnreadMentionedCountByTargetId=function(t){return o(this,void 0,void 0,(function(){var n,o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("cotargetIdntent",t,e.AssertRules.STRING,!0),r.debug("get UltraGroup unreadMentionedCount by targetId:"+t),[4,b.imClient.context.getUltraGroupUnreadMentionedCountByTargetId(t)];case 1:return n=s.sent(),o=n.code,a=n.data,o===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS,data:a}]:(r.warn("get UltraGroup unreadMentionedCount by targetId error ->"+o+":"+L[o]),[2,{code:o,msg:L[o]}])}}))}))},exports.getUnreadCount=function(t){return o(this,void 0,void 0,(function(){var n,o,a,i;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),[4,b.imClient.context.getUnreadCount(t.conversationType,t.targetId,t.channelId)];case 1:return n=s.sent(),o=n.code,a=n.data,i="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("get unreadCount ->"+i),o===e.ErrorCode.SUCCESS?[2,{code:o,data:a}]:(r.warn("get unreadCount fail ->"+o+":"+L[o]+","+i),[2,{code:o,msg:L[o]}])}}))}))},exports.getUnreadCountByTag=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i;return s(this,(function(s){switch(s.label){case 0:return e.assert("tagId",t,e.AssertRules.STRING,!0),e.assert("containMuted",n,e.AssertRules.BOOLEAN,!0),r.info("getUnreadCountByTag ->tagId:"+t),[4,b.imClient.context.getUnreadCountByTag(t,n)];case 1:return o=s.sent(),a=o.code,i=o.data,r.info(a,i),a===e.ErrorCode.SUCCESS?[2,{code:a,data:i}]:(r.warn("getUnreadCountByTag ->code:"+a+",tagId:"+t),[2,{code:a,msg:L[a]}])}}))}))},exports.getUnreadMentionedCount=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(n){return e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),r.debug("getUnreadMentionedCount"+t.targetId+",channelId:"+t.channelId),[2,b.imClient.context.getUnreadMentionedCount(t)]}))}))},exports.getUnreadMentionedMessages=function(t){if(!e.usingCppEngine())return{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]};e.assert("conversationType",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("targetId",t.targetId,e.AssertRules.STRING,!0);var n=b.imClient.context.getUnreadMentionedMessages(t.conversationType,t.targetId),o=[];return n&&n.length&&n.forEach((function(e){return o.push(_(e))})),{code:e.ErrorCode.SUCCESS,data:o}},exports.init=function(e){w=w||new b(e)},exports.insertMessage=function(t,n,a){return void 0===a&&(a={}),o(this,void 0,void 0,(function(){var o,i,c,d,u,l,g,p,f,m,C,v,h,E,S,I;return s(this,(function(s){switch(s.label){case 0:return e.usingCppEngine()?(o=n.senderUserId,i=n.messageType,c=n.content,d=n.messageDirection,u=n.messageUId,l=n.canIncludeExpansion,g=n.expansion,p=n.disableNotification,f=n.sentTime,m=n.sentStatus,r.info("insertMessage ->targetId:"+t.targetId+",conversationType:"+t.conversationType),C=a.isUnread,v=a.searchContent,h={senderUserId:o,messageType:i,content:c,messageDirection:d,sentTime:f,sentStatus:m,searchContent:v,isUnread:C,messageUId:u,disableNotification:p,canIncludeExpansion:l,expansionMsg:JSON.stringify(g),channelId:t.channelId||""},[4,b.imClient.context.insertMessage(t.conversationType,t.targetId,h)]):[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return E=s.sent(),S=E.code,I=E.data,S===e.ErrorCode.SUCCESS?[2,{code:S,data:_(I)}]:(r.warn("insertMessage ->code:"+S+",targetId:"+t.targetId),[2,{code:S,msg:L[S]}])}}))}))},exports.installPlugin=function(e,t){return null==w?void 0:w.context.install(e,t)},exports.joinChatRoom=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.count",n.count,e.AssertRules.NUMBER,!0),o="id:"+t,r.debug("join chatroom ->"+o),[4,b.imClient.context.joinChatroom(t,n.count)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("join chatroom fail ->code+:"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:a}]}}))}))},exports.joinExistChatRoom=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.count",n.count,e.AssertRules.NUMBER,!0),o="id:"+t,r.debug("join exist chatroom ->"+o),[4,b.imClient.context.joinExistChatroom(t,n.count)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("join exist chatroom fail ->code:"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:a}]}}))}))},exports.modifyMessage=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d,u,l,g,p,f;return s(this,(function(s){switch(s.label){case 0:return e.assert("content",t,e.AssertRules.OBJECT,!0),e.assert("message",n,e.AssertRules.OBJECT,!0),o=n.conversationType,a=n.targetId,i=n.messageUId,c=n.senderUserId,d=n.sentTime,u=n.canIncludeExpansion,l=n.channelId,g="conversationType:"+o+",targetId:"+a+",channelId:"+l+",messageUId:"+i,r.debug("update ultragroup message expansion ->"+g),p={targetId:a,channelId:l,conversationType:o,fromUserId:c,sendTime:d,canIncludeExpansion:u,messageUId:i,content:t},[4,b.imClient.context.modifyMessage(p)];case 1:return(f=s.sent().code)===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS}]:(r.warn("modify ultraGroup message   ->"+f+":"+L[f]),[2,{code:f,msg:L[f]}])}}))}))},exports.onceEventListener=function(e,t,n){w.once(e,t,n)},exports.quitChatRoom=function(t){return o(this,void 0,void 0,(function(){var n,o;return s(this,(function(s){switch(s.label){case 0:return n="id:"+t,r.debug("quit chatroom ->"+n),[4,b.imClient.context.quitChatroom(t)];case 1:return(o=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("quit chatroom fail ->code+:"+L[o]+","+n),[2,{code:o,msg:L[o]}]):[2,{code:o}]}}))}))},exports.recallMessage=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.messageUId",n.messageUId,e.AssertRules.STRING,!0),e.assert("options.sentTime",n.sentTime,e.AssertRules.NUMBER,!0),e.assert("options.disableNotification",null==n?void 0:n.disableNotification,e.AssertRules.BOOLEAN),e.assert("options.pushConfig",null==n?void 0:n.pushConfig,e.AssertRules.OBJECT),e.assert("conversation.channelId",null==t?void 0:t.channelId,e.AssertRules.CHANNEL_ID),o={user:n.user,channelId:t.channelId||"",disableNotification:null==n?void 0:n.disableNotification,pushConfig:null==n?void 0:n.pushConfig},a="conversationType:"+t.conversationType+",targetId:"+t.targetId+",messageUId:"+n.messageUId,r.debug("recall message ->"+a),[4,b.imClient.context.recallMessage(t.conversationType,t.targetId,n.messageUId,n.sentTime,o)];case 1:return i=s.sent(),c=i.code,d=i.data,c===e.ErrorCode.SUCCESS&&d?[2,{code:c,data:_(d)}]:c===e.ErrorCode.SUCCESS?[2,{code:c}]:(r.warn("recall message fail ->"+c+":"+L[c]+","+a),[2,{code:c,msg:L[c]}])}}))}))},exports.registerMessageType=function(t,n,o,s,r){return e.assert("messageType",t,e.AssertRules.STRING,!0),e.assert("isPersited",n,e.AssertRules.BOOLEAN,!0),e.assert("isCounted",o,e.AssertRules.BOOLEAN,!0),e.assert("isStatusMessage",r,e.AssertRules.BOOLEAN,!1),b.imClient.context.registerMessageType(t,n,o,s,r),V(t,n,o)},exports.removeAllExpansionForUltraGroupMessage=function(t){return o(this,void 0,void 0,(function(){var n,o,a,i,c,d,u,l,g;return s(this,(function(s){switch(s.label){case 0:return e.assert("message",t,e.AssertRules.OBJECT,!0),n=t.conversationType,o=t.targetId,a=t.messageUId,i=t.sentTime,c=t.canIncludeExpansion,d=t.channelId,u="conversationType:"+n+",targetId:"+o+",channelId:"+d+",messageUId:"+a,r.debug("remove all expansion for ultraGroup message ->"+u),l={targetId:o,channelId:d,conversationType:n,sendTime:i,canIncludeExpansion:c,messageUId:a,removeAll:!0},[4,b.imClient.context.expandUltraMessage(l)];case 1:return(g=s.sent().code)===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS}]:(r.warn("remove all expansion for ultraGroup message   ->"+g+":"+L[g]),[2,{code:g,msg:L[g]}])}}))}))},exports.removeChatRoomEntries=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d;return s(this,(function(s){switch(s.label){case 0:return e.assert("targetId",t,e.AssertRules.STRING,!0),function(t){t.entries.forEach((function(t){e.assert("key",t,e.AssertRules.STRING,!0)})),e.assert("options.notificationExtra",t.notificationExtra,e.AssertRules.STRING)}(n),o="id:"+t,r.debug("remove chatroom entry->"+o),(a=Object.assign({},n)).entries=n.entries.map((function(e){return{key:e}})),[4,b.imClient.context.removeChatroomEntries(t,a)];case 1:return i=s.sent(),c=i.code,d=i.data,c!==e.ErrorCode.SUCCESS?(r.warn("remove chatroom entry fail ->code+:"+L[c]+","+o),[2,{code:c,msg:L[c],data:d}]):[2,{code:c}]}}))}))},exports.removeChatRoomEntry=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("targetId",t,e.AssertRules.STRING,!0),F(n),o="id:"+t,r.debug("remove chatroom entry->"+o),[4,b.imClient.context.removeChatroomEntry(t,n)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("remove chatroom entry fail ->code+:"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:a}]}}))}))},exports.removeConversation=function(t){return o(this,void 0,void 0,(function(){var n,o;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),[4,b.imClient.context.removeConversation(t.conversationType,t.targetId,t.channelId)];case 1:return n=s.sent(),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("destroy conversation ->"+o),n!==e.ErrorCode.SUCCESS?(r.warn("destroy conversation fail ->"+n+":"+L[n]+","+o),[2,{code:n,msg:L[n]}]):[2,{code:n}]}}))}))},exports.removeConversationsFromTag=function(t,n){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:return e.assert("tagId",t,e.AssertRules.STRING,!0),e.assert("conversations",n,e.AssertRules.ARRAY,!0),n.forEach((function(t){e.assert("conversation.conversationType",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("conversation.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("conversation.channelId",t.channelId,e.AssertRules.CHANNEL_ID)})),r.info("removeTagForConversations ->tagId:"+t),[4,b.imClient.context.removeTagForConversations(t,n)];case 1:return(o=s.sent().code)===e.ErrorCode.SUCCESS?[2,{code:o}]:(r.warn("removeTagForConversations ->code:"+o+",tagId:"+t),[2,{code:o,msg:L[o]}])}}))}))},exports.removeEventListener=function(e,t,n){w.off(e,t,n)},exports.removeEventListeners=function(e){w.removeAll(e)},exports.removeExpansionForUltraGroupMessage=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d,u,l,g,p;return s(this,(function(s){switch(s.label){case 0:return e.assert("expansion",t,e.AssertRules.ARRAY,!0),e.assert("message",n,e.AssertRules.OBJECT,!0),o=n.conversationType,a=n.targetId,i=n.messageUId,c=n.sentTime,d=n.canIncludeExpansion,u=n.channelId,l="conversationType:"+o+",targetId:"+a+",channelId:"+u+",messageUId:"+i,r.debug("remove expansion for ultragroup message  ->"+l),g={targetId:a,channelId:u,conversationType:o,sendTime:c,canIncludeExpansion:d,messageUId:i,keys:t},[4,b.imClient.context.expandUltraMessage(g)];case 1:return(p=s.sent().code)===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS}]:(r.warn("remove expansion for ultraGroup message   ->"+p+":"+L[p]),[2,{code:p,msg:L[p]}])}}))}))},exports.removeMessageExpansionForKey=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d,u,l;return s(this,(function(s){switch(s.label){case 0:return e.assert("keys",t,e.AssertRules.ARRAY,!0),e.assert("message",n,e.AssertRules.OBJECT,!0),o=n.conversationType,a=n.targetId,i=n.messageUId,c=n.canIncludeExpansion,d=n.channelId,u="conversationType:"+o+",targetId:"+a+",messageUId:"+i,r.debug("remove message expansion ->"+u),[4,b.imClient.context.sendExpansionMessage({conversationType:o,targetId:a,messageUId:i,canIncludeExpansion:c,keys:t,channelId:d})];case 1:return(l=s.sent().code)!==e.ErrorCode.SUCCESS?(r.warn("remove message expansion fail ->"+l+":"+L[l]+","+u),[2,{code:l,msg:L[l]}]):[2,{code:l}]}}))}))},exports.removeTag=function(t){return o(this,void 0,void 0,(function(){var n;return s(this,(function(o){switch(o.label){case 0:return e.assert("tagId",t,e.AssertRules.STRING,!0),r.info("removeTag ->tagId:"+t),[4,b.imClient.context.removeTag(t)];case 1:return(n=o.sent().code)===e.ErrorCode.SUCCESS?[2,{code:n}]:(r.warn("removeTag ->code:"+n+",tagId:"+t),[2,{code:n,msg:L[n]}])}}))}))},exports.removeTagFromConversations=function(t,n){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:return e.assert("tagId",t,e.AssertRules.STRING,!0),e.assert("conversations",n,e.AssertRules.ARRAY,!0),n.forEach((function(t){e.assert("conversation.conversationType",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("conversation.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("conversation.channelId",t.channelId,e.AssertRules.CHANNEL_ID)})),r.info("removeTagForConversations ->tagId:"+t),[4,b.imClient.context.removeTagForConversations(t,n)];case 1:return(o=s.sent().code)===e.ErrorCode.SUCCESS?[2,{code:o}]:(r.warn("removeTagForConversations ->code:"+o+",tagId:"+t),[2,{code:o,msg:L[o]}])}}))}))},exports.removeTagsFromConversation=function(t,n){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:return e.assert("conversation.conversationType",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("conversation.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("conversation.channelId",t.channelId,e.AssertRules.CHANNEL_ID),e.assert("tagIds",n,e.AssertRules.ARRAY,!0),n.forEach((function(t){e.assert("tagId",t,e.AssertRules.STRING,!0)})),r.info("removeTagsForConversation ->tagIds:"+n+",targetId:"+t.targetId+",conversationType:"+t.conversationType),[4,b.imClient.context.removeTagsForConversation(t,n)];case 1:return(o=s.sent().code)===e.ErrorCode.SUCCESS?[2,{code:o}]:(r.warn("removeTagsForConversation ->code:"+o+",tagIds:"+n),[2,{code:o,msg:L[o]}])}}))}))},exports.saveTextMessageDraft=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),e.assert("draft",n,e.AssertRules.STRING,!0),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("set draft ->"+o),[4,b.imClient.context.saveConversationMessageDraft(t.conversationType,t.targetId,n,t.channelId)];case 1:return(a=s.sent())===e.ErrorCode.SUCCESS?[2,{code:a}]:(r.warn("set draft fail ->"+a+":"+L[a]+","+o),[2,{code:a,msg:L[a]}])}}))}))},exports.searchConversationByContent=function(t,n,a,i){return o(this,void 0,void 0,(function(){var o,c,d;return s(this,(function(s){switch(s.label){case 0:return e.usingCppEngine()?(r.info("searchConversationByContent ->keyword:"+t),[4,b.imClient.context.searchConversationByContent(t,a,i,n)]):[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return o=s.sent(),c=o.code,d=o.data,c===e.ErrorCode.SUCCESS?[2,{code:c,data:d}]:(r.warn("searchConversationByContent ->code:"+c+",keyword:"+t),[2,{code:c,msg:L[c]}])}}))}))},exports.searchMessages=function(t,n,a,i){return o(this,void 0,void 0,(function(){var o,c,d,u;return s(this,(function(s){switch(s.label){case 0:return e.usingCppEngine()?(e.assert("conversationType",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("keyword",n,e.AssertRules.STRING,!0),e.assert("timestamp",a,e.AssertRules.NUMBER),e.assert("count",i,e.AssertRules.NUMBER),1,[4,b.imClient.context.searchMessageByContent(t.conversationType,t.targetId,n,a,i,1,t.channelId)]):[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return o=s.sent(),c=o.code,d=o.data,c===e.ErrorCode.SUCCESS?(u=[],(null==d?void 0:d.messages)&&d.messages.length&&d.messages.forEach((function(e){return u.push(_(e))})),[2,{code:c,data:{messages:u,count:null==d?void 0:d.count}}]):(r.warn("searchMessages ->code:"+c+",targetId:"+t.targetId),[2,{code:c,msg:L[c]}])}}))}))},exports.sendFileMessage=_e,exports.sendHQVoiceMessage=be,exports.sendImageMessage=we,exports.sendMessage=Ue,exports.sendReadReceiptMessage=function(t,n,r,a){return o(this,void 0,void 0,(function(){var o,i,c,d,u;return s(this,(function(s){switch(s.label){case 0:return o={targetId:t,conversationType:e.ConversationType.PRIVATE,channelId:a},i=new q("RC:ReadNtf",{messageUId:n,lastMessageSendTime:r,type:1}),[4,Ue(o,i)];case 1:return c=s.sent(),d=c.code,u=c.msg,0===d?[2,{code:d}]:[2,{code:d,msg:u}]}}))}))},exports.sendReadReceiptRequest=function(t,n,a){return o(this,void 0,void 0,(function(){var o,i,c,d,u;return s(this,(function(s){switch(s.label){case 0:return e.assert("messageUId",n,e.AssertRules.STRING,!0),e.assert("channelId",a,e.AssertRules.CHANNEL_ID),o="messageUId:"+n+",targetId:"+t,r.debug("send read receipt message ->"+o),i=new q("RC:RRReqMsg",{messageUId:n}),[4,Ue({targetId:t,conversationType:e.ConversationType.GROUP,channelId:a},i)];case 1:return c=s.sent(),d=c.code,u=c.msg,0===d?[2,{code:d}]:[2,{code:d,msg:u}]}}))}))},exports.sendReadReceiptResponse=function(e,t,n){return o(this,void 0,void 0,(function(){return s(this,(function(e){throw new Error("This method is deprecated, please use method sendReadReceiptResponseV2.")}))}))},exports.sendReadReceiptResponseV2=function(t,n,a){return o(this,void 0,void 0,(function(){var o,i,c,d,u,l,g;return s(this,(function(s){switch(s.label){case 0:return e.assert("targetId",t,e.AssertRules.STRING,!0),e.assert("messageList",n,e.AssertRules.OBJECT,!0),e.assert("channelId",a,e.AssertRules.CHANNEL_ID),Object.keys(n).forEach((function(t){e.assert(t,n[t],e.AssertRules.ARRAY)})),o={targetId:t,conversationType:e.ConversationType.GROUP,channelId:a},c=b.imClient.context.getInfoFromCache(),0!==(d=(null==c?void 0:c.grpRRVer)||0)?[3,2]:(u=new q("RC:RRRspMsg",{receiptMessageDic:n}),[4,Ue(o,u)]);case 1:return i=s.sent(),[3,4];case 2:return 1!==d?[3,4]:(l=[],Object.keys(n).forEach((function(e){n[e].forEach((function(e){-1===l.indexOf(e)&&l.push(e)}))})),l.length?[4,b.imClient.context.sendReadReceiptMessage(t,l,a)]:(r.warn("Error in parameter messageList."),[2,{code:e.ErrorCode.PARAMETER_ERROR}]));case 3:i=s.sent(),s.label=4;case 4:return(g=i.code)===e.ErrorCode.SUCCESS?[2,{code:g}]:(r.warn("send read receipt message fail ->"+g+":"+L[g]),[2,{code:g,msg:L[g]}])}}))}))},exports.sendSightMessage=Pe,exports.sendSyncReadStatusMessage=function(t,n){return o(this,void 0,void 0,(function(){var o,r,a,i;return s(this,(function(s){switch(s.label){case 0:return e.assert("conversation.type",t.conversationType,e.AssertRules.NUMBER,!0),e.assert("conversation.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("lastMessageSendTime",n,e.AssertRules.NUMBER,!0),e.assert("conversation.channelId",null==t?void 0:t.channelId,e.AssertRules.CHANNEL_ID),o=new q("RC:SRSMsg",{lastMessageSendTime:n}),[4,Ue(t,o)];case 1:return r=s.sent(),a=r.code,i=r.msg,0===a?[2,{code:a}]:[2,{code:a,msg:i}]}}))}))},exports.sendTextMessage=function(e,t,n){return Ue(e,new J(t),n)},exports.sendTypingStatusMessage=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d;return s(this,(function(s){switch(s.label){case 0:return e.assert("typingContentType",n,e.AssertRules.STRING,!0),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("send typing status message ->"+o),a={messageType:"RC:TypSts",content:{typingContentType:n},isStatusMessage:!0,channelId:t.channelId},[4,b.imClient.context.sendMessage(t.conversationType,t.targetId,a)];case 1:return i=s.sent(),c=i.code,d=i.data,c===e.ErrorCode.SUCCESS?[2,{code:c,data:_(d)}]:(r.warn("send typing status message fail ->"+c+":"+L[c]+","+o),[2,{code:c,msg:L[c]}])}}))}))},exports.sendUltraGroupTypingStatus=function(t){return o(this,void 0,void 0,(function(){var n;return s(this,(function(o){switch(o.label){case 0:return e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),[4,b.imClient.context.sendUltraGroupTypingStatus(t)];case 1:return(n=o.sent().code)===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS}]:(r.warn("send ultraGroup OperateStatus   ->"+n+":"+L[n]),[2,{code:n,msg:L[n]}])}}))}))},exports.setChatRoomEntries=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c;return s(this,(function(s){switch(s.label){case 0:return e.assert("targetId",t,e.AssertRules.STRING,!0),function(t){t.entries.forEach((function(t){e.assert("entry.key",t.key,e.AssertRules.STRING,!0),e.assert("entry.value",t.value,e.AssertRules.STRING,!0)})),e.assert("options.isAutoDelete",t.isAutoDelete,e.AssertRules.BOOLEAN),e.assert("options.notificationExtra",t.notificationExtra,e.AssertRules.STRING)}(n),n.entries.length>10?[2,P.CHATROOM_KV_STORE_OUT_LIMIT]:(o="id:"+t,r.debug("set chatroom entry->"+o),[4,b.imClient.context.setChatroomEntries(t,n)]);case 1:return a=s.sent(),i=a.code,c=a.data,i!==e.ErrorCode.SUCCESS?(r.warn("set chatroom entry fail ->code+:"+L[i]+","+o),[2,{code:i,msg:L[i],data:c}]):[2,{code:i}]}}))}))},exports.setChatRoomEntry=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("targetId",t,e.AssertRules.STRING,!0),B(n),o="id:"+t,r.debug("set chatroom entry->"+o),[4,b.imClient.context.setChatroomEntry(t,n)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("set chatroom entry fail ->code+:"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:a}]}}))}))},exports.setConversationNotificationStatus=function(t,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.conversationType",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),e.assert("notificationStatus",n,(function(e){return 1===e||2===e}),!0),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("set conversation status ->"+o),[4,b.imClient.context.setConversationStatus(t.conversationType,t.targetId,void 0,n,t.channelId)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("set conversation status fail ->"+a+":"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:a}]}}))}))},exports.setConversationToTop=function(t,n){return void 0===n&&(n=!0),o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return e.assert("options.type",t.conversationType,e.isValidConversationType,!0),e.assert("options.targetId",t.targetId,e.AssertRules.STRING,!0),e.assert("options.channelId",t.channelId,e.AssertRules.CHANNEL_ID),o="conversationType:"+t.conversationType+",targetId:"+t.targetId,r.debug("set conversation status ->"+o),[4,b.imClient.context.setConversationStatus(t.conversationType,t.targetId,n,void 0,t.channelId)];case 1:return(a=s.sent())!==e.ErrorCode.SUCCESS?(r.warn("set conversation status fail ->"+a+":"+L[a]+","+o),[2,{code:a,msg:L[a]}]):[2,{code:a}]}}))}))},exports.setConversationToTopInTag=function(t,n,a){return o(this,void 0,void 0,(function(){var o,i;return s(this,(function(s){switch(s.label){case 0:return e.assert("tagId",t,e.AssertRules.STRING,!0),e.assert("conversation.targetId",n.targetId,e.AssertRules.STRING,!0),e.assert("conversation.conversationType",n.conversationType,e.AssertRules.NUMBER,!0),e.assert("conversation.channelId",n.channelId,e.AssertRules.CHANNEL_ID),e.assert("status.isTop",a,e.AssertRules.BOOLEAN,!0),r.info("setConversationStatusInTag ->tagId:"+t+",targetId:"+n.targetId+",conversationType"+n.conversationType),[4,b.imClient.context.setConversationStatusInTag(t,n,{isTop:a})];case 1:return o=s.sent(),(i=o.code)===e.ErrorCode.SUCCESS?[2,{code:i}]:(r.warn("setConversationStatusInTag ->code:"+i+",tagId:"+t),[2,{code:i,msg:L[i]}])}}))}))},exports.setMessageReceivedStatus=function(t,n){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:return e.usingCppEngine()?(e.assert("messageId",t,e.AssertRules.NUMBER,!0),e.assert("receivedStatus",n,e.AssertRules.NUMBER,!0),r.info("setMessageReceivedStatus ->messageId:"+t+",receivedStatus:"+n),[4,b.imClient.context.setMessageReceivedStatus(t,n)]):[2,{code:e.ErrorCode.NOT_SUPPORT,msg:L[e.ErrorCode.NOT_SUPPORT]}];case 1:return(o=s.sent())===e.ErrorCode.SUCCESS?[2,{code:o}]:(r.warn("setMessageReceivedStatus ->code:"+o+",messageId:"+t),[2,{code:o,msg:L[o]}])}}))}))},exports.updateExpansionForUltraGroupMessage=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d,u,l,g,p;return s(this,(function(s){switch(s.label){case 0:return e.assert("expansion",t,e.AssertRules.OBJECT,!0),e.assert("message",n,e.AssertRules.OBJECT,!0),o=n.conversationType,a=n.targetId,i=n.messageUId,c=n.sentTime,d=n.canIncludeExpansion,u=n.channelId,l="conversationType:"+o+",targetId:"+a+",channelId:"+u+",messageUId:"+i,r.debug("update expansion for ultragroup message  ->"+l),g={targetId:a,channelId:u,conversationType:o,sendTime:c,canIncludeExpansion:d,messageUId:i,expansion:t},[4,b.imClient.context.expandUltraMessage(g)];case 1:return(p=s.sent().code)===e.ErrorCode.SUCCESS?[2,{code:e.ErrorCode.SUCCESS}]:(r.warn("update expansion for ultragroup message   ->"+p+":"+L[p]),[2,{code:p,msg:L[p]}])}}))}))},exports.updateMessageExpansion=function(t,n){return o(this,void 0,void 0,(function(){var o,a,i,c,d,u,l,g;return s(this,(function(s){switch(s.label){case 0:return e.assert("expansion",t,e.AssertRules.OBJECT,!0),e.assert("message",n,e.AssertRules.OBJECT,!0),o=n.conversationType,a=n.targetId,i=n.messageUId,c=n.canIncludeExpansion,d=n.expansion,u=n.channelId,l="conversationType:"+o+",targetId:"+a+",messageUId:"+i,r.debug("update message expansion ->"+l),[4,b.imClient.context.sendExpansionMessage({conversationType:o,targetId:a,messageUId:i,expansion:t,canIncludeExpansion:c,originExpansion:d,channelId:u})];case 1:return(g=s.sent().code)!==e.ErrorCode.SUCCESS?(r.warn("update message expansion fail ->"+g+":"+L[g]+","+l),[2,{code:g,msg:L[g]}]):[2,{code:g}]}}))}))},exports.updateTag=function(t){return o(this,void 0,void 0,(function(){var n;return s(this,(function(o){switch(o.label){case 0:return e.assert("tag.tagId",t.tagId,e.AssertRules.STRING,!0),e.assert("tag.tagName",t.tagName,e.AssertRules.STRING,!0),e.assert("tag.tagName",t.tagName,(function(e){return e.length<=15})),r.info("updateTag ->tagId:"+t.tagId+",tagName:"+t.tagName),[4,b.imClient.context.updateTag(t)];case 1:return(n=o.sent().code)===e.ErrorCode.SUCCESS?[2,{code:n}]:(r.warn("updateTag ->code:"+n+",tagId:"+t.tagId),[2,{code:n,msg:L[n]}])}}))}))};
